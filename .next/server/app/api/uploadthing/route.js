(()=>{var e={};e.id=735,e.ids=[735],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},5511:e=>{"use strict";e.exports=require("crypto")},682:(e,t,s)=>{"use strict";let i,n,r,a,o,c,l,u,h,p,d,f,m,g,b,x,y,v,w,S,_,k,O,E;s.r(t),s.d(t,{patchFetch:()=>Ka,routeModule:()=>Ks,serverHooks:()=>Kr,workAsyncStorage:()=>Ki,workUnitAsyncStorage:()=>Kn});var C,R,I={};s.r(I),s.d(I,{LoggerTypeId:()=>BW,add:()=>BV,addEffect:()=>BG,addScoped:()=>BY,batched:()=>B1,defaultLogger:()=>ql,filterLogLevel:()=>BZ,isLogger:()=>qS,json:()=>qb,jsonLogger:()=>qu,logFmt:()=>qx,logfmtLogger:()=>qh,make:()=>BK,map:()=>B0,mapInput:()=>BX,mapInputOptions:()=>BQ,minimumLogLevel:()=>qw,none:()=>B4,pretty:()=>qy,prettyLogger:()=>qd,prettyLoggerDefault:()=>qf,remove:()=>B6,replace:()=>B8,replaceEffect:()=>B7,replaceScoped:()=>B9,simple:()=>qe,stringLogger:()=>qp,structured:()=>qv,structuredLogger:()=>qm,succeed:()=>qt,sync:()=>qs,test:()=>qi,tracerLogger:()=>qg,withConsoleError:()=>B5,withConsoleLog:()=>B2,withLeveledConsole:()=>B3,withMinimumLogLevel:()=>qn,withSpanAnnotations:()=>qr,zip:()=>qa,zipLeft:()=>qo,zipRight:()=>qc});var T={};s.r(T),s.d(T,{GET:()=>Ke,POST:()=>Kt});var F=s(190),A=s(8951),N=s(7326);let M=function(e,t){if("function"==typeof e)return function(){return e(arguments)?t.apply(this,arguments):e=>t(e,...arguments)};switch(e){case 0:case 1:throw RangeError(`Invalid arity ${e}`);case 2:return function(e,s){return arguments.length>=2?t(e,s):function(s){return t(s,e)}};case 3:return function(e,s,i){return arguments.length>=3?t(e,s,i):function(i){return t(i,e,s)}};case 4:return function(e,s,i,n){return arguments.length>=4?t(e,s,i,n):function(n){return t(n,e,s,i)}};case 5:return function(e,s,i,n,r){return arguments.length>=5?t(e,s,i,n,r):function(r){return t(r,e,s,i,n)}};default:return function(){if(arguments.length>=e)return t.apply(this,arguments);let s=arguments;return function(e){return t(e,...s)}}}},j=e=>e,z=e=>()=>e,P=z(!0),D=z(!1),L=z(void 0);function $(e,t,s,i,n,r,a,o,c){switch(arguments.length){case 1:return e;case 2:return t(e);case 3:return s(t(e));case 4:return i(s(t(e)));case 5:return n(i(s(t(e))));case 6:return r(n(i(s(t(e)))));case 7:return a(r(n(i(s(t(e))))));case 8:return o(a(r(n(i(s(t(e)))))));case 9:return c(o(a(r(n(i(s(t(e))))))));default:{let e=arguments[0];for(let t=1;t<arguments.length;t++)e=arguments[t](e);return e}}}let U=()=>"3.10.15",B=Symbol.for(`effect/GlobalValue/globalStoreId/${U()}`);B in globalThis||(globalThis[B]=new Map);let q=globalThis[B],H=(e,t)=>(q.has(e)||q.set(e,t()),q.get(e)),J=e=>"string"==typeof e,W=e=>"number"==typeof e,K=e=>"boolean"==typeof e,V=e=>"bigint"==typeof e,G=e=>"symbol"==typeof e,Y=e=>"function"==typeof e,X=e=>void 0===e,Q=e=>void 0!==e,Z=e=>null!==e,ee=e=>!1,et=e=>"object"==typeof e&&null!==e,es=e=>et(e)||Y(e),ei=M(2,(e,t)=>es(e)&&t in e),en=M(2,(e,t)=>ei(e,"_tag")&&e._tag===t),er=e=>null==e,ea=e=>null!=e,eo=e=>e instanceof Date,ec=e=>ei(e,Symbol.iterator),el=e=>et(e)&&!Array.isArray(e),eu=e=>ei(e,"then")&&Y(e.then),eh=e=>`BUG: ${e} - please report an issue at https://github.com/Effect-TS/effect/issues`;Symbol.iterator;class ep{constructor(e){this.called=!1,this.self=e}next(e){return this.called?{value:e,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(e){return{value:e,done:!0}}throw(e){throw e}[Symbol.iterator](){return new ep(this.self)}}class ed{constructor(e,t,s,i){return er(t)&&er(e)?(t=0xffffffff*Math.random()>>>0,e=0):er(t)&&(t=e,e=0),er(i)&&er(s)?(i=this._state?this._state[3]:0xf767814f,s=this._state?this._state[2]:0x14057b7e):er(i)&&(i=s,s=0),this._state=new Int32Array([0,0,s>>>0,(1|(i||0))>>>0]),this._next(),ef(this._state,this._state[0],this._state[1],e>>>0,t>>>0),this._next(),this}getState(){return[this._state[0],this._state[1],this._state[2],this._state[3]]}setState(e){this._state[0]=e[0],this._state[1]=e[1],this._state[2]=e[2],this._state[3]=1|e[3]}integer(e){return Math.round(this.number()*Number.MAX_SAFE_INTEGER)%e}number(){return(0x8000000*((0x3ffffff&this._next())*1)+(0x7ffffff&this._next())*1)/0x20000000000000}_next(){var e;let t,s,i,n;let r=this._state[0]>>>0,a=this._state[1]>>>0;e=this._state,t=(a>>>16)*32557>>>0,s=(65535&a)*19605>>>0,i=(65535&a)*32557>>>0,n=(a>>>16)*19605+((s>>>16)+(t>>>16))>>>0,(i=i+(s=s<<16>>>0)>>>0)>>>0<s>>>0&&(n=n+1>>>0),(i=i+(t=t<<16>>>0)>>>0)>>>0<t>>>0&&(n=n+1>>>0),n=(n=n+Math.imul(a,0x5851f42d)>>>0)+Math.imul(r,0x4c957f2d)>>>0,e[0]=n,e[1]=i,ef(this._state,this._state[0],this._state[1],this._state[2],this._state[3]);let o=r>>>18,c=(a>>>18|r<<14)>>>0;o=(o^r)>>>0;let l=((c=(c^a)>>>0)>>>27|o<<5)>>>0,u=r>>>27;return(l>>>u|l<<((-u>>>0&31)>>>0))>>>0}}function ef(e,t,s,i,n){let r=t+i>>>0,a=s+n>>>0;a>>>0<s>>>0&&(r=r+1|0),e[0]=r,e[1]=a}let em=Symbol.for("effect/Utils/YieldWrap");class eg{#e;constructor(e){this.#e=e}[em](){return this.#e}}function eb(e){if("object"==typeof e&&null!==e&&em in e)return e[em]();throw Error(eh("yieldWrapGet"))}let ex=H("effect/Utils/isStructuralRegion",()=>({enabled:!1,tester:void 0})),ey=(e=>{let t={[e]:e=>e()};return function(s){return t[e](s)}})("effect_internal_function"),ev=H(Symbol.for("effect/Hash/randomHashCache"),()=>new WeakMap),ew=Symbol.for("effect/Hash"),eS=e=>{if(!0===ex.enabled)return 0;switch(typeof e){case"number":return eC(e);case"bigint":return eR(e.toString(10));case"boolean":case"symbol":return eR(String(e));case"string":return eR(e);case"undefined":return eR("undefined");case"function":case"object":if(null===e)return eR("null");if(e instanceof Date)return eS(e.toISOString());if(eE(e))return e[ew]();return e_(e);default:throw Error(`BUG: unhandled typeof ${typeof e} - please report an issue at https://github.com/Effect-TS/effect/issues`)}},e_=e=>(ev.has(e)||ev.set(e,eC(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER))),ev.get(e)),ek=e=>t=>53*t^e,eO=e=>0xbfffffff&e|e>>>1&0x40000000,eE=e=>ei(e,ew),eC=e=>{if(e!=e||e===1/0)return 0;let t=0|e;for(t!==e&&(t^=0xffffffff*e);e>0xffffffff;)t^=e/=0xffffffff;return eO(t)},eR=e=>{let t=5381,s=e.length;for(;s;)t=33*t^e.charCodeAt(--s);return eO(t)},eI=(e,t)=>{let s=12289;for(let i=0;i<t.length;i++)s^=$(eR(t[i]),ek(eS(e[t[i]])));return eO(s)},eT=e=>eI(e,Object.keys(e)),eF=e=>{let t=6151;for(let s=0;s<e.length;s++)t=$(t,ek(eS(e[s])));return eO(t)},eA=function(){if(1==arguments.length){let e=arguments[0];return function(t){return Object.defineProperty(e,ew,{value:()=>t,enumerable:!1}),t}}let e=arguments[0],t=arguments[1];return Object.defineProperty(e,ew,{value:()=>t,enumerable:!1}),t},eN=Symbol.for("effect/Equal");function eM(){return 1==arguments.length?e=>ej(e,arguments[0]):ej(arguments[0],arguments[1])}function ej(e,t){if(e===t)return!0;let s=typeof e;if(s!==typeof t)return!1;if("object"===s||"function"===s){if(null!==e&&null!==t){if(ez(e)&&ez(t))return!!(eS(e)===eS(t)&&e[eN](t))||!!ex.enabled&&!!ex.tester&&ex.tester(e,t);if(e instanceof Date&&t instanceof Date)return e.toISOString()===t.toISOString()}if(ex.enabled){if(Array.isArray(e)&&Array.isArray(t))return e.length===t.length&&e.every((e,s)=>ej(e,t[s]));if(Object.getPrototypeOf(e)===Object.prototype&&Object.getPrototypeOf(e)===Object.prototype){let s=Object.keys(e),i=Object.keys(t);if(s.length===i.length){for(let i of s)if(!(i in t&&ej(e[i],t[i])))return!!ex.tester&&ex.tester(e,t);return!0}}return!!ex.tester&&ex.tester(e,t)}}return!!ex.enabled&&!!ex.tester&&ex.tester(e,t)}let ez=e=>ei(e,eN),eP=()=>eM,eD=Symbol.for("nodejs.util.inspect.custom"),eL=e=>ei(e,"toJSON")&&Y(e.toJSON)&&0===e.toJSON.length?e.toJSON():Array.isArray(e)?e.map(eL):eG(e),e$=e=>JSON.stringify(e,null,2),eU={toJSON(){return eL(this)},[eD](){return this.toJSON()},toString(){return e$(this.toJSON())}};class eB{[eD](){return this.toJSON()}toString(){return e$(this.toJSON())}}let eq=(e,t=2)=>{if("string"==typeof e)return e;try{return"object"==typeof e?eH(e,t):String(e)}catch(t){return String(e)}},eH=(e,t)=>{let s=[],i=JSON.stringify(e,(e,t)=>"object"==typeof t&&null!==t?s.includes(t)?void 0:s.push(t)&&(void 0!==eK.fiberRefs&&eW(t)?t[eJ](eK.fiberRefs):t):t,t);return s=void 0,i},eJ=Symbol.for("effect/Inspectable/Redactable"),eW=e=>"object"==typeof e&&null!==e&&eJ in e,eK=H("effect/Inspectable/redactableState",()=>({fiberRefs:void 0})),eV=(e,t)=>{let s=eK.fiberRefs;eK.fiberRefs=e;try{return t()}finally{eK.fiberRefs=s}},eG=e=>eW(e)&&void 0!==eK.fiberRefs?e[eJ](eK.fiberRefs):e,eY=(e,t)=>{switch(t.length){case 0:return e;case 1:return t[0](e);case 2:return t[1](t[0](e));case 3:return t[2](t[1](t[0](e)));case 4:return t[3](t[2](t[1](t[0](e))));case 5:return t[4](t[3](t[2](t[1](t[0](e)))));case 6:return t[5](t[4](t[3](t[2](t[1](t[0](e))))));case 7:return t[6](t[5](t[4](t[3](t[2](t[1](t[0](e)))))));case 8:return t[7](t[6](t[5](t[4](t[3](t[2](t[1](t[0](e))))))));case 9:return t[8](t[7](t[6](t[5](t[4](t[3](t[2](t[1](t[0](e)))))))));default:{let s=e;for(let e=0,i=t.length;e<i;e++)s=t[e](s);return s}}},eX="Async",eQ="Commit",eZ="Failure",e0="OnFailure",e1="OnSuccess",e2="OnSuccessAndFailure",e3="Success",e5="Sync",e4="UpdateRuntimeFlags",e6="While",e8="Iterator",e7="WithRuntime",e9="Yield",te="RevertFlags",tt=Symbol.for("effect/Effect"),ts=Symbol.for("effect/Stream"),ti=Symbol.for("effect/Sink"),tn=Symbol.for("effect/Channel"),tr={_R:e=>e,_E:e=>e,_A:e=>e,_V:U()},ta={[tt]:tr,[ts]:tr,[ti]:{_A:e=>e,_In:e=>e,_L:e=>e,_E:e=>e,_R:e=>e},[tn]:{_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutElem:e=>e,_OutDone:e=>e},[eN](e){return this===e},[ew](){return eA(this,e_(this))},[Symbol.iterator](){return new ep(new eg(this))},pipe(){return eY(this,arguments)}},to={[ew](){return eA(this,eT(this))},[eN](e){let t=Object.keys(this),s=Object.keys(e);if(t.length!==s.length)return!1;for(let s of t)if(!(s in e&&eM(this[s],e[s])))return!1;return!0}},tc={...ta,_op:eQ},tl={...tc,...to},tu=function(){function e(){}return e.prototype=tc,e}(),th=function(){function e(){}return e.prototype=tl,e}(),tp=Symbol.for("effect/Option"),td={...ta,[tp]:{_A:e=>e},[eD](){return this.toJSON()},toString(){return e$(this.toJSON())}},tf=Object.assign(Object.create(td),{_tag:"Some",_op:"Some",[eN](e){return tb(e)&&ty(e)&&eM(this.value,e.value)},[ew](){return eA(this,ek(eS(this._tag))(eS(this.value)))},toJSON(){return{_id:"Option",_tag:this._tag,value:eL(this.value)}}}),tm=eS("None"),tg=Object.assign(Object.create(td),{_tag:"None",_op:"None",[eN]:e=>tb(e)&&tx(e),[ew]:()=>tm,toJSON(){return{_id:"Option",_tag:this._tag}}}),tb=e=>ei(e,tp),tx=e=>"None"===e._tag,ty=e=>"Some"===e._tag,tv=Object.create(tg),tw=e=>{let t=Object.create(tf);return t.value=e,t},tS=Symbol.for("effect/Context/Tag"),t_=Symbol.for("effect/STM"),tk={...ta,_op:"Tag",[t_]:tr,[tS]:{_Service:e=>e,_Identifier:e=>e},toString(){return e$(this.toJSON())},toJSON(){return{_id:"Tag",key:this.key,stack:this.stack}},[eD](){return this.toJSON()},of:e=>e,context(e){return tF(this,e)}},tO=Symbol.for("effect/Context"),tE={[tO]:{_Services:e=>e},[eN](e){if(tI(e)&&this.unsafeMap.size===e.unsafeMap.size){for(let t of this.unsafeMap.keys())if(!e.unsafeMap.has(t)||!eM(this.unsafeMap.get(t),e.unsafeMap.get(t)))return!1;return!0}return!1},[ew](){return eA(this,eC(this.unsafeMap.size))},pipe(){return eY(this,arguments)},toString(){return e$(this.toJSON())},toJSON(){return{_id:"Context",services:Array.from(this.unsafeMap).map(eL)}},[eD](){return this.toJSON()}},tC=e=>{let t=Object.create(tE);return t.unsafeMap=e,t},tR=e=>{let t=Error(`Service not found${e.key?`: ${String(e.key)}`:""}`);if(e.stack){let s=e.stack.split("\n");if(s.length>2){let e=s[2].match(/at (.*)/);e&&(t.message=t.message+` (defined at ${e[1]})`)}}if(t.stack){let e=t.stack.split("\n");e.splice(1,3),t.stack=e.join("\n")}return t},tI=e=>ei(e,tO),tT=tC(new Map),tF=(e,t)=>tC(new Map([[e.key,t]])),tA=M(3,(e,t,s)=>{let i=new Map(e.unsafeMap);return i.set(t.key,s),tC(i)}),tN=M(2,(e,t)=>{if(!e.unsafeMap.has(t.key))throw tR(t);return e.unsafeMap.get(t.key)}),tM=M(2,(e,t)=>e.unsafeMap.has(t.key)?tw(e.unsafeMap.get(t.key)):tv),tj=M(2,(e,t)=>{let s=new Map(e.unsafeMap);for(let[e,i]of t.unsafeMap)s.set(e,i);return tC(s)}),tz=e=>{let t=Error.stackTraceLimit;Error.stackTraceLimit=2;let s=Error();Error.stackTraceLimit=t;let i=Object.create(tk);return Object.defineProperty(i,"stack",{get:()=>s.stack}),i.key=e,i},tP=e=>ei(e,tS),tD=()=>tT,tL=e=>()=>{let t=Error.stackTraceLimit;Error.stackTraceLimit=2;let s=Error();function i(){}return Error.stackTraceLimit=t,Object.setPrototypeOf(i,tk),i.key=e,Object.defineProperty(i,"stack",{get:()=>s.stack}),i},t$=Symbol.for("effect/Either"),tU={...ta,[t$]:{_R:e=>e},[eD](){return this.toJSON()},toString(){return e$(this.toJSON())}},tB=Object.assign(Object.create(tU),{_tag:"Right",_op:"Right",[eN](e){return tH(e)&&tW(e)&&eM(this.right,e.right)},[ew](){return ek(eS(this._tag))(eS(this.right))},toJSON(){return{_id:"Either",_tag:this._tag,right:eL(this.right)}}}),tq=Object.assign(Object.create(tU),{_tag:"Left",_op:"Left",[eN](e){return tH(e)&&tJ(e)&&eM(this.left,e.left)},[ew](){return ek(eS(this._tag))(eS(this.left))},toJSON(){return{_id:"Either",_tag:this._tag,left:eL(this.left)}}}),tH=e=>ei(e,t$),tJ=e=>"Left"===e._tag,tW=e=>"Right"===e._tag,tK=e=>{let t=Object.create(tq);return t.left=e,t},tV=e=>{let t=Object.create(tB);return t.right=e,t},tG=((e,t)=>tx(e)?tK(t()):tV(e.value),M(2,(e,t)=>tJ(e)?tK(t(e.left)):tV(e.right))),tY=M(2,(e,t)=>tW(e)?tV(t(e.right)):tK(e.left)),tX=M(2,(e,{onLeft:t,onRight:s})=>tJ(e)?t(e.left):s(e.right)),tQ=tX({onLeft:j,onRight:j}),tZ=M(2,(e,t)=>{if(tW(e))return e.right;throw t(e.left)}),t0=tZ(()=>Error("getOrThrow called on a Left")),t1=e=>(t,s)=>t===s||e(t,s),t2=M(2,(e,t)=>t1((s,i)=>e(t(s),t(i)))),t3=e=>t1((t,s)=>{if(t.length!==s.length)return!1;for(let i=0;i<t.length;i++)if(!e(t[i],s[i]))return!1;return!0}),t5=e=>e.length>0,t4=()=>tv,t6=M(2,(e,{onNone:t,onSome:s})=>tx(e)?t():s(e.value)),t8=M(2,(e,t)=>tx(e)?t():e.value),t7=M(2,(e,t)=>tx(e)?t():e),t9=M(2,(e,t)=>tx(e)?tw(t()):e),se=e=>null==e?t4():tw(e),st=t8(L),ss=e=>(...t)=>{try{return tw(e(...t))}catch(e){return t4()}},si=M(2,(e,t)=>{if(ty(e))return e.value;throw t()})(()=>Error("getOrThrow called on a None")),sn=M(2,(e,t)=>tx(e)?t4():tw(t(e.value))),sr=M(2,(e,t)=>tx(e)?t4():t(e.value)),sa=e=>{if(Symbol.iterator in e){let t=[];for(let s of e){if(tx(s))return t4();t.push(s.value)}return tw(t)}let t={};for(let s of Object.keys(e)){let i=e[s];if(tx(i))return t4();t[s]=i.value}return tw(t)},so=M(2,(e,t)=>tx(e)?t4():t(e.value)),sc=M(2,(e,t)=>so(e,e=>t(e)?tw(e):tv)),sl=e=>t1((t,s)=>tx(t)?tx(s):!tx(s)&&e(t.value,s.value)),su=(m=eP(),M(2,(e,t)=>!tx(e)&&m(e.value,t))),sh=M(2,(e,t)=>!tx(e)&&t(e.value)),sp=e=>{let t=e[Symbol.iterator]().next();if(t.done)throw Error("unsafeHead: empty iterable");return t.value};Symbol.iterator,()=>sd;let sd={next:()=>({done:!0,value:void 0})},sf=e=>(t,s)=>t===s?0:e(t,s),sm=sf((e,t)=>e<t?-1:1),sg=((e,t)=>e<t?-1:1,M(2,(e,t)=>sf((s,i)=>e(t(s),t(i))))),sb=e=>0===sw(e).length;Object.fromEntries,(e,t)=>{let s=[];for(let i of sw(e))s.push(t(i,e[i]));return s};let sx=M(2,(e,t)=>Object.prototype.hasOwnProperty.call(e,t)),sy=M(2,(e,t)=>{if(!sx(e,t))return{...e};let s={...e};return delete s[t],s}),sv=M(2,(e,t)=>{let s={...e};for(let i of sw(e))s[i]=t(e[i],i);return s}),sw=e=>Object.keys(e),sS=M(3,(e,t,s)=>({...e,[t]:s})),s_=(...e)=>e,sk=(...e)=>e,sO=e=>Array(e),sE=(e,t)=>{let s=Math.max(1,Math.floor(e)),i=Array(s);for(let e=0;e<s;e++)i[e]=t(e);return i},sC=e=>Array.isArray(e)?e:Array.from(e),sR=e=>Array.isArray(e)?e:[e],sI=M(2,(e,{onEmpty:t,onNonEmpty:s})=>sz(e)?s(e):t()),sT=M(2,(e,{onEmpty:t,onNonEmpty:s})=>sz(e)?s(sB(e),sJ(e)):t()),sF=M(2,(e,t)=>[t,...e]),sA=M(2,(e,t)=>[...e,t]),sN=M(2,(e,t)=>sC(e).concat(sC(t))),sM=Array.isArray,sj=e=>0===e.length,sz=t5,sP=(e,t)=>e<0||e>=t.length,sD=(e,t)=>Math.floor(Math.min(Math.max(0,e),t.length)),sL=M(2,(e,t)=>{let s=Math.floor(t);return sP(s,e)?t4():tw(e[s])}),s$=M(2,(e,t)=>{let s=Math.floor(t);if(sP(s,e))throw Error(`Index ${s} out of bounds`);return e[s]}),sU=sL(0),sB=s$(0),sq=e=>sz(e)?tw(sH(e)):t4(),sH=e=>e[e.length-1],sJ=e=>e.slice(1),sW=(e,t)=>{let s=0;for(let i of e){if(!t(i,s))break;s++}return s},sK=M(2,(e,t)=>s0(e,sW(e,t))),sV=M(2,(e,t)=>{let s=sC(e);return s.slice(sD(t,s),s.length)}),sG=((e,t)=>{let s=sC(e);for(let e=s.length-1;e>=0;e--){let i=s[e],n=t(i,e);if(K(n)){if(n)return tw(i)}else if(ty(n))return n}return t4()},e=>Array.from(e).reverse()),sY=M(2,(e,t)=>{let s=Array.from(e);return s.sort(t),s}),sX=M(2,(e,t)=>sQ(e,t,s_)),sQ=M(3,(e,t,s)=>{let i=sC(e),n=sC(t);if(sz(i)&&sz(n)){let e=[s(sB(i),sB(n))],t=Math.min(i.length,n.length);for(let r=1;r<t;r++)e[r]=s(i[r],n[r]);return e}return[]}),sZ=eP(),s0=M(2,(e,t)=>{let s=Array.from(e),i=Math.floor(t);return sz(s)?i>=1?s1(s,i):[[],s]:[s,[]]}),s1=M(2,(e,t)=>{let s=Math.max(1,Math.floor(t));return s>=e.length?[s2(e),[]]:[sF(e.slice(1,s),sB(e)),e.slice(s)]}),s2=e=>e.slice(),s3=M(3,(e,t,s)=>{let i=sC(e),n=sC(t);return sz(i)?sz(n)?iu(s)(sN(i,n)):i:n}),s5=M(2,(e,t)=>s3(e,t,sZ)),s4=()=>[],s6=e=>[e],s8=M(2,(e,t)=>e.map(t)),s7=M(2,(e,t)=>{if(sj(e))return[];let s=[];for(let i=0;i<e.length;i++){let n=t(e[i],i);for(let e=0;e<n.length;e++)s.push(n[e])}return s}),s9=s7(j),ie=M(2,(e,t)=>{let s=sC(e),i=[];for(let e=0;e<s.length;e++){let n=t(s[e],e);ty(n)&&i.push(n.value)}return i}),it=M(2,(e,t)=>{let s=0,i=[];for(let n of e){let e=t(n,s);if(ty(e))i.push(e.value);else break;s++}return i}),is=M(2,(e,t)=>{let s=[],i=[],n=sC(e);for(let e=0;e<n.length;e++){let r=t(n[e],e);tJ(r)?s.push(r.left):i.push(r.right)}return[s,i]}),ii=ie(j),ir=M(2,(e,t)=>{let s=sC(e),i=[];for(let e=0;e<s.length;e++)t(s[e],e)&&i.push(s[e]);return i}),ia=M(3,(e,t,s)=>sC(e).reduce((e,t,i)=>s(e,t,i),t)),io=M(3,(e,t,s)=>sC(e).reduceRight((e,t,i)=>s(e,t,i),t)),ic=M(2,(e,t)=>e.every(t)),il=(e,t)=>{let s;let i=[],n=e;for(;ty(s=t(n));){let[e,t]=s.value;i.push(e),n=t}return i},iu=M(2,(e,t)=>{let s=sC(e);if(sz(s)){let e=[sB(s)];for(let i of sJ(s))e.every(e=>!t(i,e))&&e.push(i);return e}return[]}),ih=e=>iu(e,eP()),ip=M(2,(e,t)=>sC(e).join(t)),id=M(3,(e,t,s)=>{let i=0,n=t,r=[];for(let t of e){let e=s(n,t,i);n=e[0],r.push(e[1]),i++}return[n,r]}),im=Symbol.for("effect/Chunk"),ig=[],ib=t1((e,t)=>e.length===t.length&&iC(e).every((e,s)=>eM(e,iA(t,s)))),ix={[im]:{_A:e=>e},toString(){return e$(this.toJSON())},toJSON(){return{_id:"Chunk",values:iC(this).map(eL)}},[eD](){return this.toJSON()},[eN](e){return iv(e)&&ib(this,e)},[ew](){return eA(this,eF(iC(this)))},[Symbol.iterator](){switch(this.backing._tag){case"IArray":return this.backing.array[Symbol.iterator]();case"IEmpty":return ig[Symbol.iterator]();default:return iC(this)[Symbol.iterator]()}},pipe(){return eY(this,arguments)}},iy=e=>{let t=Object.create(ix);switch(t.backing=e,e._tag){case"IEmpty":t.length=0,t.depth=0,t.left=t,t.right=t;break;case"IConcat":t.length=e.left.length+e.right.length,t.depth=1+Math.max(e.left.depth,e.right.depth),t.left=e.left,t.right=e.right;break;case"IArray":t.length=e.array.length,t.depth=0,t.left=iw,t.right=iw;break;case"ISingleton":t.length=1,t.depth=0,t.left=iw,t.right=iw;break;case"ISlice":t.length=e.length,t.depth=e.chunk.depth+1,t.left=iw,t.right=iw}return t},iv=e=>ei(e,im),iw=iy({_tag:"IEmpty"}),iS=()=>iw,i_=(...e)=>1===e.length?ik(e[0]):iF(e),ik=e=>iy({_tag:"ISingleton",a:e}),iO=e=>iv(e)?e:iy({_tag:"IArray",array:sC(e)}),iE=(e,t,s)=>{switch(e.backing._tag){case"IArray":!function(e,t,s,i,n){for(let t=0;t<Math.min(e.length,0+n);t++)s[i+t-0]=e[t]}(e.backing.array,0,t,s,e.length);break;case"IConcat":iE(e.left,t,s),iE(e.right,t,s+e.left.length);break;case"ISingleton":t[s]=e.backing.a;break;case"ISlice":{let i=0,n=s;for(;i<e.length;)t[n]=iA(e,i),i+=1,n+=1}}},iC=e=>{switch(e.backing._tag){case"IEmpty":return ig;case"IArray":return e.backing.array;default:{let t=Array(e.length);return iE(e,t,0),e.backing={_tag:"IArray",array:t},e.left=iw,e.right=iw,e.depth=0,t}}},iR=e=>{switch(e.backing._tag){case"IEmpty":case"ISingleton":return e;case"IArray":return iy({_tag:"IArray",array:sG(e.backing.array)});case"IConcat":return iy({_tag:"IConcat",left:iR(e.backing.right),right:iR(e.backing.left)});case"ISlice":return iT(sG(iC(e)))}},iI=M(2,(e,t)=>t<0||t>=e.length?t4():tw(iA(e,t))),iT=e=>iy({_tag:"IArray",array:e}),iF=e=>iT(e),iA=M(2,(e,t)=>{switch(e.backing._tag){case"IEmpty":throw Error("Index out of bounds");case"ISingleton":if(0!==t)throw Error("Index out of bounds");return e.backing.a;case"IArray":if(t>=e.length||t<0)throw Error("Index out of bounds");return e.backing.array[t];case"IConcat":return t<e.left.length?iA(e.left,t):iA(e.right,t-e.left.length);case"ISlice":return iA(e.backing.chunk,t+e.backing.offset)}}),iN=M(2,(e,t)=>iD(e,ik(t))),iM=M(2,(e,t)=>iD(ik(t),e)),ij=M(2,(e,t)=>{if(t<=0)return iw;if(t>=e.length)return e;switch(e.backing._tag){case"ISlice":return iy({_tag:"ISlice",chunk:e.backing.chunk,length:t,offset:e.backing.offset});case"IConcat":if(t>e.left.length)return iy({_tag:"IConcat",left:e.left,right:ij(e.right,t-e.left.length)});return ij(e.left,t);default:return iy({_tag:"ISlice",chunk:e,offset:0,length:t})}}),iz=M(2,(e,t)=>{if(t<=0)return e;if(t>=e.length)return iw;switch(e.backing._tag){case"ISlice":return iy({_tag:"ISlice",chunk:e.backing.chunk,offset:e.backing.offset+t,length:e.backing.length-t});case"IConcat":if(t>e.left.length)return iz(e.right,t-e.left.length);return iy({_tag:"IConcat",left:iz(e.left,t),right:e.right});default:return iy({_tag:"ISlice",chunk:e,offset:t,length:e.length-t})}}),iP=M(2,(e,t)=>{let s=iC(e),i=s.length,n=0;for(;n<i&&t(s[n]);)n++;return iz(e,n)}),iD=M(2,(e,t)=>{if("IEmpty"===e.backing._tag)return t;if("IEmpty"===t.backing._tag)return e;let s=t.depth-e.depth;if(1>=Math.abs(s))return iy({_tag:"IConcat",left:e,right:t});if(s<-1){if(e.left.depth>=e.right.depth){let s=iD(e.right,t);return iy({_tag:"IConcat",left:e.left,right:s})}{let s=iD(e.right.right,t);if(s.depth===e.depth-3){let t=iy({_tag:"IConcat",left:e.right.left,right:s});return iy({_tag:"IConcat",left:e.left,right:t})}{let t=iy({_tag:"IConcat",left:e.left,right:e.right.left});return iy({_tag:"IConcat",left:t,right:s})}}}if(t.right.depth>=t.left.depth)return iy({_tag:"IConcat",left:iD(e,t.left),right:t.right});{let s=iD(e,t.left.left);if(s.depth===t.depth-3){let e=iy({_tag:"IConcat",left:s,right:t.left.right});return iy({_tag:"IConcat",left:e,right:t.right})}{let e=iy({_tag:"IConcat",left:t.left.right,right:t.right});return iy({_tag:"IConcat",left:s,right:e})}}}),iL=M(2,(e,t)=>iT(ie(e,t))),i$=M(2,(e,t)=>iT(ir(e,t))),iU=((e,t)=>iT(it(e,t)),M(2,(e,t)=>{if("ISingleton"===e.backing._tag)return t(e.backing.a,0);let s=iw,i=0;for(let n of e)s=iD(s,t(n,i++));return s})),iB=M(2,(e,t)=>iC(e).forEach(t)),iq=iU(j),iH=e=>0===e.length,iJ=e=>e.length>0,iW=iI(0),iK=e=>iA(e,0),iV=e=>iA(e,e.length-1),iG=M(2,(e,t)=>"ISingleton"===e.backing._tag?ik(t(e.backing.a,0)):iT($(iC(e),s8((e,s)=>t(e,s))))),iY=((e,t,s)=>{let[i,n]=id(e,t,s);return[i,iT(n)]},M(2,(e,t)=>[ij(e,t),iz(e,t)])),iX=M(2,(e,t)=>{let s=0;for(let i of iC(e)){if(t(i))break;s++}return iY(e,s)}),iQ=e=>iz(e,1),iZ=M(2,(e,t)=>iz(e,e.length-t)),i0=M(2,(e,t)=>{let s=[];for(let i of iC(e))if(t(i))s.push(i);else break;return iT(s)}),i1=M(3,(e,t,s)=>iT(sQ(e,t,s))),i2=M(2,(e,t)=>iO(sE(e,t))),i3=(e,t)=>e<=t?i2(t-e+1,t=>e+t):ik(e),i5=M(2,(e,t)=>sC(e).some(t)),i4=Symbol.for("effect/Duration"),i6=BigInt(0),i8=BigInt(24),i7=BigInt(60),i9=BigInt(1e3),ne=BigInt(1e6),nt=BigInt(1e9),ns=/^(-?\d+(?:\.\d+)?)\s+(nanos?|micros?|millis?|seconds?|minutes?|hours?|days?|weeks?)$/,ni=e=>{if(nc(e))return e;if(W(e))return nd(e);if(V(e))return nh(e);if(Array.isArray(e)){if(2===e.length&&W(e[0])&&W(e[1]))return nh(BigInt(e[0])*nt+BigInt(e[1]))}else if(J(e)){ns.lastIndex=0;let t=ns.exec(e);if(t){let[e,s,i]=t,n=Number(s);switch(i){case"nano":case"nanos":return nh(BigInt(s));case"micro":case"micros":return np(BigInt(s));case"milli":case"millis":return nd(n);case"second":case"seconds":return nf(n);case"minute":case"minutes":return nm(n);case"hour":case"hours":return ng(n);case"day":case"days":return nb(n);case"week":case"weeks":return nx(n)}}}throw Error("Invalid DurationInput")},nn={_tag:"Millis",millis:0},nr={_tag:"Infinity"},na={[i4]:i4,[ew](){return eA(this,eT(this.value))},[eN](e){return nc(e)&&nI(this,e)},toString(){return`Duration(${nF(this)})`},toJSON(){switch(this.value._tag){case"Millis":return{_id:"Duration",_tag:"Millis",millis:this.value.millis};case"Nanos":return{_id:"Duration",_tag:"Nanos",hrtime:nS(this)};case"Infinity":return{_id:"Duration",_tag:"Infinity"}}},[eD](){return this.toJSON()},pipe(){return eY(this,arguments)}},no=e=>{let t=Object.create(na);return W(e)?isNaN(e)||e<=0?t.value=nn:Number.isFinite(e)?Number.isInteger(e)?t.value={_tag:"Millis",millis:e}:t.value={_tag:"Nanos",nanos:BigInt(Math.round(1e6*e))}:t.value=nr:e<=i6?t.value=nn:t.value={_tag:"Nanos",nanos:e},t},nc=e=>ei(e,i4),nl=e=>"Infinity"!==e.value._tag,nu=no(0),nh=e=>no(e),np=e=>no(e*i9),nd=e=>no(e),nf=e=>no(1e3*e),nm=e=>no(6e4*e),ng=e=>no(36e5*e),nb=e=>no(864e5*e),nx=e=>no(6048e5*e),ny=e=>n_(e,{onMillis:e=>e,onNanos:e=>Number(e)/1e6}),nv=e=>n_(e,{onMillis:e=>e/1e3,onNanos:e=>Number(e)/1e9}),nw=e=>{let t=ni(e);switch(t.value._tag){case"Infinity":throw Error("Cannot convert infinite duration to nanos");case"Nanos":return t.value.nanos;case"Millis":return BigInt(Math.round(1e6*t.value.millis))}},nS=e=>{let t=ni(e);switch(t.value._tag){case"Infinity":return[1/0,0];case"Nanos":return[Number(t.value.nanos/nt),Number(t.value.nanos%nt)];case"Millis":return[Math.floor(t.value.millis/1e3),Math.round(t.value.millis%1e3*1e6)]}},n_=M(2,(e,t)=>{let s=ni(e);switch(s.value._tag){case"Nanos":return t.onNanos(s.value.nanos);case"Infinity":return t.onMillis(1/0);case"Millis":return t.onMillis(s.value.millis)}}),nk=M(3,(e,t,s)=>{let i=ni(e),n=ni(t);if("Infinity"===i.value._tag||"Infinity"===n.value._tag)return s.onMillis(ny(i),ny(n));if("Nanos"===i.value._tag||"Nanos"===n.value._tag){let e="Nanos"===i.value._tag?i.value.nanos:BigInt(Math.round(1e6*i.value.millis)),t="Nanos"===n.value._tag?n.value.nanos:BigInt(Math.round(1e6*n.value.millis));return s.onNanos(e,t)}return s.onMillis(i.value.millis,n.value.millis)}),nO=(e,t)=>nk(e,t,{onMillis:(e,t)=>e===t,onNanos:(e,t)=>e===t}),nE=M(2,(e,t)=>nk(e,t,{onMillis:(e,t)=>no(e+t),onNanos:(e,t)=>no(e+t)})),nC=((e,t)=>nk(e,t,{onMillis:(e,t)=>e<t,onNanos:(e,t)=>e<t}),M(2,(e,t)=>nk(e,t,{onMillis:(e,t)=>e>t,onNanos:(e,t)=>e>t}))),nR=M(2,(e,t)=>nk(e,t,{onMillis:(e,t)=>e>=t,onNanos:(e,t)=>e>=t})),nI=M(2,(e,t)=>nO(ni(e),ni(t))),nT=e=>{let t=ni(e);if("Infinity"===t.value._tag)return{days:1/0,hours:1/0,minutes:1/0,seconds:1/0,millis:1/0,nanos:1/0};let s=nw(t),i=s/ne,n=i/i9,r=n/i7,a=r/i7;return{days:Number(a/i8),hours:Number(a%i8),minutes:Number(r%i7),seconds:Number(n%i7),millis:Number(i%i9),nanos:Number(s%ne)}},nF=e=>{let t=ni(e);if("Infinity"===t.value._tag)return"Infinity";let s=nT(t),i=[];return 0!==s.days&&i.push(`${s.days}d`),0!==s.hours&&i.push(`${s.hours}h`),0!==s.minutes&&i.push(`${s.minutes}m`),0!==s.seconds&&i.push(`${s.seconds}s`),0!==s.millis&&i.push(`${s.millis}ms`),0!==s.nanos&&i.push(`${s.nanos}ns`),i.join(" ")};function nA(e,t){var s;return s=e&t-1,s-=s>>1&0x55555555,s=(s=(0x33333333&s)+(s>>2&0x33333333))+(s>>4)&0xf0f0f0f,s+=s>>8,127&(s+=s>>16)}let nN=(e,t)=>({value:e,previous:t});function nM(e,t,s,i){let n=i;if(!e){let e=i.length;n=Array(e);for(let t=0;t<e;++t)n[t]=i[t]}return n[t]=s,n}function nj(e,t,s){let i=s.length-1,n=0,r=0,a=s;if(e)n=r=t;else for(a=Array(i);n<t;)a[r++]=s[n++];for(++n;n<=i;)a[r++]=s[n++];return e&&(a.length=i),a}class nz{modify(e,t,s,i,n,r){let a=s(t4());return tx(a)?new nz:(++r.value,new nL(e,i,n,a))}constructor(){this._tag="EmptyNode"}}function nP(e){return en(e,"EmptyNode")}function nD(e,t){return!nP(e)&&t===e.edit}class nL{constructor(e,t,s,i){this._tag="LeafNode",this.edit=e,this.hash=t,this.key=s,this.value=i}modify(e,t,s,i,n,r){if(eM(n,this.key)){let t=s(this.value);return t===this.value?this:tx(t)?(--r.value,new nz):nD(this,e)?(this.value=t,this):new nL(e,i,n,t)}let a=s(t4());return tx(a)?this:(++r.value,nq(e,t,this.hash,this,i,new nL(e,i,n,a)))}}class n${constructor(e,t,s){this._tag="CollisionNode",this.edit=e,this.hash=t,this.children=s}modify(e,t,s,i,n,r){if(i===this.hash){let t=nD(this,e),i=this.updateCollisionList(t,e,this.hash,this.children,s,n,r);return i===this.children?this:i.length>1?new n$(e,this.hash,i):i[0]}let a=s(t4());return tx(a)?this:(++r.value,nq(e,t,this.hash,this,i,new nL(e,i,n,a)))}updateCollisionList(e,t,s,i,n,r,a){let o=i.length;for(let c=0;c<o;++c){let o=i[c];if("key"in o&&eM(r,o.key)){let l=o.value,u=n(l);if(u===l)return i;if(tx(u))return--a.value,nj(e,c,i);return nM(e,c,new nL(t,s,r,u),i)}}let c=n(t4());return tx(c)?i:(++a.value,nM(e,o,new nL(t,s,r,c),i))}}class nU{constructor(e,t,s){this._tag="IndexedNode",this.edit=e,this.mask=t,this.children=s}modify(e,t,s,i,n,r){let a;let o=this.mask,c=this.children,l=i>>>t&31,u=1<<l,h=nA(o,u),p=o&u,d=nD(this,e);if(!p){let a=new nz().modify(e,t+5,s,i,n,r);return a?c.length>=16?function(e,t,s,i,n){let r=[],a=i,o=0;for(let e=0;a;++e)1&a&&(r[e]=n[o++]),a>>>=1;return r[t]=s,new nB(e,o+1,r)}(e,l,a,o,c):new nU(e,o|u,function(e,t,s,i){let n=i.length;if(e){let e=n;for(;e>=t;)i[e--]=i[e];return i[t]=s,i}let r=0,a=0,o=Array(n+1);for(;r<t;)o[a++]=i[r++];for(o[t]=s;r<n;)o[++a]=i[r++];return o}(d,h,a,c)):this}let f=c[h],m=f.modify(e,t+5,s,i,n,r);if(f===m)return this;let g=o;if(nP(m)){var b;if(!(g&=~u))return new nz;if(c.length<=2&&(nP(b=c[1^h])||"LeafNode"===b._tag||"CollisionNode"===b._tag))return c[1^h];a=nj(d,h,c)}else a=nM(d,h,m,c);return d?(this.mask=g,this.children=a,this):new nU(e,g,a)}}class nB{constructor(e,t,s){this._tag="ArrayNode",this.edit=e,this.size=t,this.children=s}modify(e,t,s,i,n,r){let a,o=this.size,c=this.children,l=i>>>t&31,u=c[l],h=(u||new nz).modify(e,t+5,s,i,n,r);if(u===h)return this;let p=nD(this,e);if(nP(u)&&!nP(h))++o,a=nM(p,l,h,c);else if(!nP(u)&&nP(h)){if(--o<=8)return function(e,t,s,i){let n=Array(t-1),r=0,a=0;for(let e=0,t=i.length;e<t;++e)if(e!==s){let t=i[e];t&&!nP(t)&&(n[r++]=t,a|=1<<e)}return new nU(e,a,n)}(e,o,l,c);a=nM(p,l,new nz,c)}else a=nM(p,l,h,c);return p?(this.size=o,this.children=a,this):new nB(e,o,a)}}function nq(e,t,s,i,n,r){let a;let o=t;for(;;){let t=function(e,t,s,i,n,r){if(s===n)return new n$(e,s,[r,i]);let a=s>>>t&31,o=n>>>t&31;return a===o?t=>new nU(e,1<<a|1<<o,[t]):new nU(e,1<<a|1<<o,a<o?[i,r]:[r,i])}(e,o,s,i,n,r);if("function"==typeof t)a=nN(t,a),o+=5;else{let e=t;for(;null!=a;)e=a.value(e),a=a.previous;return e}}}let nH="effect/HashMap",nJ=Symbol.for(nH),nW={[nJ]:nJ,[Symbol.iterator](){return new nV(this,(e,t)=>[e,t])},[ew](){let e=eS(nH);for(let t of this)e^=$(eS(t[0]),ek(eS(t[1])));return eA(this,e)},[eN](e){if(n0(e)){if(e._size!==this._size)return!1;for(let t of this){let s=$(e,n2(t[0],eS(t[0])));if(tx(s)||!eM(t[1],s.value))return!1}return!0}return!1},toString(){return e$(this.toJSON())},toJSON(){return{_id:"HashMap",values:Array.from(this).map(eL)}},[eD](){return this.toJSON()},pipe(){return eY(this,arguments)}},nK=(e,t,s,i)=>{let n=Object.create(nW);return n._editable=e,n._edit=t,n._root=s,n._size=i,n};class nV{constructor(e,t){this.map=e,this.f=t,this.v=nY(this.map._root,this.f,void 0)}next(){if(tx(this.v))return{done:!0,value:void 0};let e=this.v.value;return this.v=nG(e.cont),{done:!1,value:e.value}}[Symbol.iterator](){return new nV(this.map,this.f)}}let nG=e=>e?nX(e[0],e[1],e[2],e[3],e[4]):t4(),nY=(e,t,s)=>{switch(e._tag){case"LeafNode":if(ty(e.value))return tw({value:t(e.key,e.value.value),cont:s});return nG(s);case"CollisionNode":case"ArrayNode":case"IndexedNode":{let i=e.children;return nX(i.length,i,0,t,s)}default:return nG(s)}},nX=(e,t,s,i,n)=>{for(;s<e;){let r=t[s++];if(r&&!nP(r))return nY(r,i,[e,t,s,i,n])}return nG(n)},nQ=nK(!1,0,new nz,0),nZ=()=>nQ,n0=e=>ei(e,nJ),n1=M(2,(e,t)=>n2(e,t,eS(t))),n2=M(3,(e,t,s)=>{let i=e._root,n=0;for(;;)switch(i._tag){case"LeafNode":return eM(t,i.key)?i.value:t4();case"CollisionNode":if(s===i.hash){let e=i.children;for(let s=0,i=e.length;s<i;++s){let i=e[s];if("key"in i&&eM(t,i.key))return i.value}}return t4();case"IndexedNode":{let e=1<<(s>>>n&31);if(i.mask&e){i=i.children[nA(i.mask,e)],n+=5;break}return t4()}case"ArrayNode":if(i=i.children[s>>>n&31]){n+=5;break}return t4();default:return t4()}}),n3=M(2,(e,t)=>ty(n2(e,t,eS(t)))),n5=M(3,(e,t,s)=>re(e,t,()=>tw(s))),n4=M(3,(e,t,s)=>e._editable?(e._root=t,e._size=s,e):t===e._root?e:nK(e._editable,e._edit,t,s)),n6=e=>new nV(e,e=>e),n8=e=>e._size,n7=e=>nK(!0,e._edit+1,e._root,e._size),n9=e=>(e._editable=!1,e),re=((e,t)=>{let s=n7(e);return t(s),n9(s)},M(3,(e,t,s)=>rt(e,t,eS(t),s))),rt=M(4,(e,t,s,i)=>{let n={value:e._size},r=e._root.modify(e._editable?e._edit:NaN,0,i,s,t,n);return $(e,n4(r,n.value))}),rs=M(2,(e,t)=>re(e,t,t4)),ri=M(2,(e,t)=>rr(e,nZ(),(e,s,i)=>n5(e,i,t(s,i)))),rn=M(2,(e,t)=>rr(e,void 0,(e,s,i)=>t(s,i))),rr=M(3,(e,t,s)=>{let i;let n=e._root;if("LeafNode"===n._tag)return ty(n.value)?s(t,n.value.value,n.key):t;if("EmptyNode"===n._tag)return t;let r=[n.children];for(;i=r.pop();)for(let e=0,n=i.length;e<n;){let n=i[e++];n&&!nP(n)&&("LeafNode"===n._tag?ty(n.value)&&(t=s(t,n.value.value,n.key)):r.push(n.children))}return t}),ra="effect/HashSet",ro=Symbol.for(ra),rc={[ro]:ro,[Symbol.iterator](){return n6(this._keyMap)},[ew](){return eA(this,ek(eS(this._keyMap))(eS(ra)))},[eN](e){return!!ru(e)&&n8(this._keyMap)===n8(e._keyMap)&&eM(this._keyMap,e._keyMap)},toString(){return e$(this.toJSON())},toJSON(){return{_id:"HashSet",values:Array.from(this).map(eL)}},[eD](){return this.toJSON()},pipe(){return eY(this,arguments)}},rl=e=>{let t=Object.create(rc);return t._keyMap=e,t},ru=e=>ei(e,ro),rh=rl(nZ()),rp=()=>rh,rd=M(2,(e,t)=>n3(e._keyMap,t)),rf=M(2,(e,t)=>{let s=!1;for(let i of e)if(s=t(i))break;return s}),rm=M(2,(e,t)=>!rf(e,e=>!t(e))),rg=e=>rl(n7(e._keyMap)),rb=e=>(e._keyMap._editable=!1,e),rx=M(2,(e,t)=>{let s=rg(e);return t(s),rb(s)}),ry=M(2,(e,t)=>e._keyMap._editable?(n5(t,!0)(e._keyMap),e):rl(n5(t,!0)(e._keyMap))),rv=M(2,(e,t)=>e._keyMap._editable?(rs(t)(e._keyMap),e):rl(rs(t)(e._keyMap))),rw=M(2,(e,t)=>rx(e,e=>{for(let s of t)rv(e,s)})),rS=M(2,(e,t)=>rx(rp(),s=>{for(let i of(r_(e,e=>ry(s,e)),t))ry(s,i)})),r_=M(2,(e,t)=>rn(e._keyMap,(e,s)=>t(s))),rk=M(3,(e,t,s)=>rr(e._keyMap,t,(e,t,i)=>s(e,i))),rO=e=>{let t=rg(rp());for(let s of e)ry(t,s);return rb(t)},rE=(...e)=>{let t=rg(rp());for(let s of e)ry(t,s);return rb(t)},rC=e=>n8(e._keyMap),rR=Symbol.for("effect/MutableRef"),rI={[rR]:rR,toString(){return e$(this.toJSON())},toJSON(){return{_id:"MutableRef",current:eL(this.current)}},[eD](){return this.toJSON()},pipe(){return eY(this,arguments)}},rT=e=>{let t=Object.create(rI);return t.current=e,t},rF=M(3,(e,t,s)=>!!eM(t,e.current)&&(e.current=s,!0)),rA=e=>e.current,rN=M(2,(e,t)=>(e.current=t,e)),rM="effect/FiberId",rj=Symbol.for(rM),rz="None",rP="Runtime",rD="Composite",rL=eR(`${rM}-${rz}`);class r${[ew](){return rL}[eN](e){return rH(e)&&e._tag===rz}toString(){return e$(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag}}[eD](){return this.toJSON()}constructor(){this[rj]=rj,this._tag=rz,this.id=-1,this.startTimeMillis=-1}}class rU{constructor(e,t){this[rj]=rj,this._tag=rP,this.id=e,this.startTimeMillis=t}[ew](){return eA(this,eR(`${rM}-${this._tag}-${this.id}-${this.startTimeMillis}`))}[eN](e){return rH(e)&&e._tag===rP&&this.id===e.id&&this.startTimeMillis===e.startTimeMillis}toString(){return e$(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,id:this.id,startTimeMillis:this.startTimeMillis}}[eD](){return this.toJSON()}}class rB{constructor(e,t){this[rj]=rj,this._tag=rD,this.left=e,this.right=t}[ew](){return $(eR(`${rM}-${this._tag}`),ek(eS(this.left)),ek(eS(this.right)),eA(this))}[eN](e){return rH(e)&&e._tag===rD&&eM(this.left,e.left)&&eM(this.right,e.right)}toString(){return e$(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,left:eL(this.left),right:eL(this.right)}}[eD](){return this.toJSON()}}let rq=new r$,rH=e=>ei(e,rj),rJ=e=>e._tag===rz||$(rX(e),rm(e=>rJ(e))),rW=M(2,(e,t)=>e._tag===rz?t:t._tag===rz?e:new rB(e,t)),rK=M(2,(e,t)=>rJ(e)?t:e),rV=e=>{switch(e._tag){case rz:return rp();case rP:return rE(e.id);case rD:return $(rV(e.left),rS(rV(e.right)))}},rG=H(Symbol.for("effect/Fiber/Id/_fiberCounter"),()=>rT(0)),rY=e=>Array.from(rV(e)).map(e=>`#${e}`).join(","),rX=e=>{switch(e._tag){case rz:return rp();case rP:return rE(e);case rD:return $(rX(e.left),rS(rX(e.right)))}},rQ=rq,rZ=(e,t)=>new rU(e,t),r0=(e,t)=>new rB(e,t),r1=()=>{let e=rA(rG);return $(rG,rN(e+1)),new rU(e,Date.now())},r2=e=>{let t=n7(nZ());for(let s of e)n5(t,s[0],s[1]);return n9(t)},r3=e=>e&&nP(e._root),r5=Symbol.for("effect/List"),r4=e=>sC(e),r6=t2(t3(eM),r4),r8={[r5]:r5,_tag:"Cons",toString(){return e$(this.toJSON())},toJSON(){return{_id:"List",_tag:"Cons",values:r4(this).map(eL)}},[eD](){return this.toJSON()},[eN](e){return at(e)&&this._tag===e._tag&&r6(this,e)},[ew](){return eA(this,eF(r4(this)))},[Symbol.iterator](){let e=!1,t=this;return{next(){if(e)return this.return();if("Nil"===t._tag)return e=!0,this.return();let s=t.head;return t=t.tail,{done:e,value:s}},return:t=>(e||(e=!0),{done:!0,value:t})}},pipe(){return eY(this,arguments)}},r7=(e,t)=>{let s=Object.create(r8);return s.head=e,s.tail=t,s},r9=eR("Nil"),ae=Object.create({[r5]:r5,_tag:"Nil",toString(){return e$(this.toJSON())},toJSON:()=>({_id:"List",_tag:"Nil"}),[eD](){return this.toJSON()},[ew]:()=>r9,[eN](e){return at(e)&&this._tag===e._tag},[Symbol.iterator]:()=>({next:()=>({done:!0,value:void 0})}),pipe(){return eY(this,arguments)}}),at=e=>ei(e,r5),as=e=>"Nil"===e._tag,ai=e=>"Cons"===e._tag,an=(e,t)=>r7(e,t),ar=()=>ae,aa=e=>r7(e,ae),ao=M(2,(e,t)=>al(t,e)),ac=M(2,(e,t)=>an(t,e)),al=M(2,(e,t)=>{if(as(e))return t;if(as(t))return e;{let s=r7(t.head,e),i=s,n=t.tail;for(;!as(n);){let t=r7(n.head,e);i.tail=t,i=t,n=n.tail}return s}}),au=M(3,(e,t,s)=>{let i=t,n=e;for(;!as(n);)i=s(i,n.head),n=n.tail;return i}),ah=e=>{let t=ar(),s=e;for(;!as(s);)t=ac(t,s.head),s=s.tail;return t},ap="Expected List to be non-empty",ad=e=>{if(as(e))throw Error(ap);return e.head},af=e=>{if(as(e))throw Error(ap);return e.tail};Array.prototype;let am=function(){function e(e){e&&Object.assign(this,e)}return e.prototype=to,e}(),ag=e=>Object.assign(Object.create(to),e),ab=Symbol.for("effect/DifferChunkPatch");function ax(e){return e}({...am.prototype,[ab]:{_Value:ax,_Patch:ax}});let ay=Symbol.for("effect/DifferContextPatch");function av(e){return e}let aw={...am.prototype,[ay]:{_Value:av,_Patch:av}},aS=Object.create(Object.assign(Object.create(aw),{_tag:"Empty"})),a_=()=>aS,ak=Object.assign(Object.create(aw),{_tag:"AndThen"}),aO=(e,t)=>{let s=Object.create(ak);return s.first=e,s.second=t,s},aE=Object.assign(Object.create(aw),{_tag:"AddService"}),aC=(e,t)=>{let s=Object.create(aE);return s.key=e,s.service=t,s},aR=Object.assign(Object.create(aw),{_tag:"RemoveService"}),aI=e=>{let t=Object.create(aR);return t.key=e,t},aT=Object.assign(Object.create(aw),{_tag:"UpdateService"}),aF=(e,t)=>{let s=Object.create(aT);return s.key=e,s.update=t,s},aA=(e,t)=>{let s=new Map(e.unsafeMap),i=a_();for(let[e,n]of t.unsafeMap.entries())if(s.has(e)){let t=s.get(e);s.delete(e),eM(t,n)||(i=aN(aF(e,()=>n))(i))}else s.delete(e),i=aN(aC(e,n))(i);for(let[e]of s.entries())i=aN(aI(e))(i);return i},aN=M(2,(e,t)=>aO(e,t)),aM=M(2,(e,t)=>{if("Empty"===e._tag)return t;let s=!1,i=ik(e),n=new Map(t.unsafeMap);for(;iJ(i);){let e=iK(i),t=iQ(i);switch(e._tag){case"Empty":i=t;break;case"AddService":n.set(e.key,e.service),i=t;break;case"AndThen":i=iM(iM(t,e.second),e.first);break;case"RemoveService":n.delete(e.key),i=t;break;case"UpdateService":n.set(e.key,e.update(n.get(e.key))),s=!0,i=t}}if(!s)return tC(n);let r=new Map;for(let[e]of t.unsafeMap)n.has(e)&&(r.set(e,n.get(e)),n.delete(e));for(let[e,t]of n)r.set(e,t);return tC(r)}),aj=Symbol.for("effect/DifferHashMapPatch");function az(e){return e}({...am.prototype,[aj]:{_Value:az,_Key:az,_Patch:az}});let aP=Symbol.for("effect/DifferHashSetPatch");function aD(e){return e}let aL={...am.prototype,[aP]:{_Value:aD,_Key:aD,_Patch:aD}},a$=Object.create(Object.assign(Object.create(aL),{_tag:"Empty"})),aU=()=>a$,aB=Object.assign(Object.create(aL),{_tag:"AndThen"}),aq=(e,t)=>{let s=Object.create(aB);return s.first=e,s.second=t,s},aH=Object.assign(Object.create(aL),{_tag:"Add"}),aJ=e=>{let t=Object.create(aH);return t.value=e,t},aW=Object.assign(Object.create(aL),{_tag:"Remove"}),aK=e=>{let t=Object.create(aW);return t.value=e,t},aV=(e,t)=>{let[s,i]=rk([e,aU()],([e,t],s)=>rd(s)(e)?[rv(s)(e),t]:[e,aG(aJ(s))(t)])(t);return rk(i,(e,t)=>aG(aK(t))(e))(s)},aG=M(2,(e,t)=>aq(e,t)),aY=M(2,(e,t)=>{if("Empty"===e._tag)return t;let s=t,i=ik(e);for(;iJ(i);){let e=iK(i),t=iQ(i);switch(e._tag){case"Empty":i=t;break;case"AndThen":i=iM(e.first)(iM(e.second)(t));break;case"Add":s=ry(e.value)(s),i=t;break;case"Remove":s=rv(e.value)(s),i=t}}return s}),aX=Symbol.for("effect/DifferOrPatch");function aQ(e){return e}let aZ={...am.prototype,[aX]:{_Value:aQ,_Key:aQ,_Patch:aQ}},a0=Object.create(Object.assign(Object.create(aZ),{_tag:"Empty"})),a1=Object.assign(Object.create(aZ),{_tag:"AndThen"}),a2=(e,t)=>{let s=Object.create(a1);return s.first=e,s.second=t,s},a3=Object.assign(Object.create(aZ),{_tag:"SetLeft"}),a5=Object.assign(Object.create(aZ),{_tag:"SetRight"}),a4=Object.assign(Object.create(aZ),{_tag:"UpdateLeft"}),a6=Object.assign(Object.create(aZ),{_tag:"UpdateRight"}),a8=((e,t)=>a2(e,t),Symbol.for("effect/DifferReadonlyArrayPatch"));function a7(e){return e}let a9={...am.prototype,[a8]:{_Value:a7,_Patch:a7}},oe=Object.create(Object.assign(Object.create(a9),{_tag:"Empty"})),ot=()=>oe,os=Object.assign(Object.create(a9),{_tag:"AndThen"}),oi=(e,t)=>{let s=Object.create(os);return s.first=e,s.second=t,s},on=Object.assign(Object.create(a9),{_tag:"Append"}),or=e=>{let t=Object.create(on);return t.values=e,t},oa=Object.assign(Object.create(a9),{_tag:"Slice"}),oo=(e,t)=>{let s=Object.create(oa);return s.from=e,s.until=t,s},oc=Object.assign(Object.create(a9),{_tag:"Update"}),ol=(e,t)=>{let s=Object.create(oc);return s.index=e,s.patch=t,s},ou=e=>{let t=0,s=ot();for(;t<e.oldValue.length&&t<e.newValue.length;){let i=e.oldValue[t],n=e.newValue[t],r=e.differ.diff(i,n);eM(r,e.differ.empty)||(s=oh(s,ol(t,r))),t+=1}return t<e.oldValue.length&&(s=oh(s,oo(0,t))),t<e.newValue.length&&(s=oh(s,or(sV(t)(e.newValue)))),s},oh=M(2,(e,t)=>oi(e,t)),op=M(3,(e,t,s)=>{if("Empty"===e._tag)return t;let i=t.slice(),n=s6(e);for(;t5(n);){let e=sB(n),t=sJ(n);switch(e._tag){case"Empty":n=t;break;case"AndThen":t.unshift(e.first,e.second),n=t;break;case"Append":for(let t of e.values)i.push(t);n=t;break;case"Slice":i=i.slice(e.from,e.until),n=t;break;case"Update":i[e.index]=s.patch(e.patch,i[e.index]),n=t}}return i}),od={[Symbol.for("effect/Differ")]:{_P:j,_V:j}},of=e=>{let t=Object.create(od);return t.empty=e.empty,t.diff=e.diff,t.combine=e.combine,t.patch=e.patch,t},om=()=>of({empty:a_(),combine:(e,t)=>aN(t)(e),diff:(e,t)=>aA(e,t),patch:(e,t)=>aM(t)(e)}),og=()=>of({empty:aU(),combine:(e,t)=>aG(t)(e),diff:(e,t)=>aV(e,t),patch:(e,t)=>aY(t)(e)}),ob=e=>of({empty:ot(),combine:(e,t)=>oh(e,t),diff:(t,s)=>ou({oldValue:t,newValue:s,differ:e}),patch:(t,s)=>op(t,s,e)}),ox=()=>oy((e,t)=>t),oy=e=>of({empty:j,combine:(e,t)=>e===j?t:t===j?e:s=>t(e(s)),diff:(e,t)=>eM(e,t)?j:z(t),patch:(t,s)=>e(s,t(s))}),ov=e=>255&e,ow=e=>e>>8&255,oS=(e,t)=>(255&e)+((t&e&255)<<8),o_=oS(0,0),ok=M(2,(e,t)=>oS(ov(e)&~t,ow(e))),oO=M(2,(e,t)=>e|t),oE=e=>~e>>>0&255,oC=e=>oF(e,32),oR=((e,t)=>e&~t,M(2,(e,t)=>e|t)),oI=e=>oT(e)&&!oj(e),oT=e=>oF(e,1),oF=M(2,(e,t)=>(e&t)!=0),oA=(...e)=>e.reduce((e,t)=>e|t,0),oN=oA(0),oM=e=>oF(e,4),oj=e=>oF(e,16),oz=M(2,(e,t)=>oS(e^t,t)),oP=M(2,(e,t)=>e&(oE(ov(t))|ow(t))|ov(t)&ow(t)),oD=of({empty:o_,diff:(e,t)=>oz(e,t),combine:(e,t)=>oO(t)(e),patch:(e,t)=>oP(t,e)}),oL=e=>oS(e,e),o$=e=>oS(e,0),oU="Empty",oB="Fail",oq="Interrupt",oH="Parallel",oJ="Sequential",oW="effect/Cause",oK=Symbol.for(oW),oV={[oK]:{_E:e=>e},[ew](){return $(eS(oW),ek(eS(cl(this))),eA(this))},[eN](e){return o1(e)&&cc(this,e)},pipe(){return eY(this,arguments)},toJSON(){switch(this._tag){case"Empty":return{_id:"Cause",_tag:this._tag};case"Die":return{_id:"Cause",_tag:this._tag,defect:eL(this.defect)};case"Interrupt":return{_id:"Cause",_tag:this._tag,fiberId:this.fiberId.toJSON()};case"Fail":return{_id:"Cause",_tag:this._tag,failure:eL(this.error)};case"Sequential":case"Parallel":return{_id:"Cause",_tag:this._tag,left:eL(this.left),right:eL(this.right)}}},toString(){return cy(this)},[eD](){return this.toJSON()}},oG=(()=>{let e=Object.create(oV);return e._tag=oU,e})(),oY=e=>{let t=Object.create(oV);return t._tag=oB,t.error=e,t},oX=e=>{let t=Object.create(oV);return t._tag="Die",t.defect=e,t},oQ=e=>{let t=Object.create(oV);return t._tag=oq,t.fiberId=e,t},oZ=(e,t)=>{let s=Object.create(oV);return s._tag=oH,s.left=e,s.right=t,s},o0=(e,t)=>{let s=Object.create(oV);return s._tag=oJ,s.left=e,s.right=t,s},o1=e=>ei(e,oK),o2=e=>"Die"===e._tag,o3=e=>e._tag===oU||cb(e,!0,(e,t)=>{switch(t._tag){case oU:return tw(e);case"Die":case oB:case oq:return tw(!1);default:return t4()}}),o5=e=>ty(ct(e)),o4=e=>cx(void 0,cd)(e),o6=e=>iR(cb(e,iS(),(e,t)=>t._tag===oB?tw($(e,iM(t.error))):t4())),o8=e=>iR(cb(e,iS(),(e,t)=>"Die"===t._tag?tw($(e,iM(t.defect))):t4())),o7=e=>cb(e,rp(),(e,t)=>t._tag===oq?tw($(e,ry(t.fiberId))):t4()),o9=e=>ch(e,e=>e._tag===oB?tw(e.error):t4()),ce=e=>{let t=o9(e);switch(t._tag){case"None":return tV(e);case"Some":return tK(t.value)}},ct=e=>ch(e,e=>e._tag===oq?tw(e.fiberId):t4()),cs=e=>cg(e,{onEmpty:t4(),onFail:e=>tw(oX(e)),onDie:e=>tw(oX(e)),onInterrupt:()=>t4(),onSequential:(e,t)=>ty(e)&&ty(t)?tw(o0(e.value,t.value)):ty(e)&&tx(t)?tw(e.value):tx(e)&&ty(t)?tw(t.value):t4(),onParallel:(e,t)=>ty(e)&&ty(t)?tw(oZ(e.value,t.value)):ty(e)&&tx(t)?tw(e.value):tx(e)&&ty(t)?tw(t.value):t4()}),ci=e=>cg(e,{onEmpty:oG,onFail:()=>oG,onDie:e=>oX(e),onInterrupt:e=>oQ(e),onSequential:o0,onParallel:oZ}),cn=e=>cg(e,{onEmpty:oG,onFail:e=>oX(e),onDie:e=>oX(e),onInterrupt:e=>oQ(e),onSequential:(e,t)=>o0(e,t),onParallel:(e,t)=>oZ(e,t)}),cr=M(2,(e,t)=>cg(e,{onEmpty:tw(oG),onFail:e=>tw(oY(e)),onDie:e=>ty(t(e))?t4():tw(oX(e)),onInterrupt:e=>tw(oQ(e)),onSequential:(e,t)=>ty(e)&&ty(t)?tw(o0(e.value,t.value)):ty(e)&&tx(t)?tw(e.value):tx(e)&&ty(t)?tw(t.value):t4(),onParallel:(e,t)=>ty(e)&&ty(t)?tw(oZ(e.value,t.value)):ty(e)&&tx(t)?tw(e.value):tx(e)&&ty(t)?tw(t.value):t4()})),ca=M(2,(e,t)=>co(e,e=>oY(t(e)))),co=M(2,(e,t)=>cg(e,{onEmpty:oG,onFail:e=>t(e),onDie:e=>oX(e),onInterrupt:e=>oQ(e),onSequential:(e,t)=>o0(e,t),onParallel:(e,t)=>oZ(e,t)})),cc=(e,t)=>{let s=ik(e),i=ik(t);for(;iJ(s)&&iJ(i);){let[e,t]=$(iK(s),cb([rp(),iS()],([e,t],s)=>{let[i,n]=cp(s);return tw([$(e,rS(i)),$(t,iD(n))])})),[n,r]=$(iK(i),cb([rp(),iS()],([e,t],s)=>{let[i,n]=cp(s);return tw([$(e,rS(i)),$(t,iD(n))])}));if(!eM(e,n))return!1;s=t,i=r}return!0},cl=e=>cu(ik(e),iS()),cu=(e,t)=>{for(;;){let[s,i]=$(e,ia([rp(),iS()],([e,t],s)=>{let[i,n]=cp(s);return[$(e,rS(i)),$(t,iD(n))]})),n=rC(s)>0?$(t,iM(s)):t;if(iH(i))return iR(n);e=i,t=n}throw Error(eh("Cause.flattenCauseLoop"))},ch=M(2,(e,t)=>{let s=[e];for(;s.length>0;){let e=s.pop(),i=t(e);switch(i._tag){case"None":switch(e._tag){case oJ:case oH:s.push(e.right),s.push(e.left)}break;case"Some":return i}}return t4()}),cp=e=>{let t=e,s=[],i=rp(),n=iS();for(;void 0!==t;)switch(t._tag){case oU:if(0===s.length)return[i,n];t=s.pop();break;case oB:if(i=ry(i,i_(t._tag,t.error)),0===s.length)return[i,n];t=s.pop();break;case"Die":if(i=ry(i,i_(t._tag,t.defect)),0===s.length)return[i,n];t=s.pop();break;case oq:if(i=ry(i,i_(t._tag,t.fiberId)),0===s.length)return[i,n];t=s.pop();break;case oJ:switch(t.left._tag){case oU:t=t.right;break;case oJ:t=o0(t.left.left,o0(t.left.right,t.right));break;case oH:t=oZ(o0(t.left.left,t.right),o0(t.left.right,t.right));break;default:n=iM(n,t.right),t=t.left}break;case oH:s.push(t.right),t=t.left}throw Error(eh("Cause.evaluateCauseLoop"))},cd={emptyCase:P,failCase:D,dieCase:D,interruptCase:P,sequentialCase:(e,t,s)=>t&&s,parallelCase:(e,t,s)=>t&&s},cf="SequentialCase",cm="ParallelCase",cg=M(2,(e,{onDie:t,onEmpty:s,onFail:i,onInterrupt:n,onParallel:r,onSequential:a})=>cx(e,void 0,{emptyCase:()=>s,failCase:(e,t)=>i(t),dieCase:(e,s)=>t(s),interruptCase:(e,t)=>n(t),sequentialCase:(e,t,s)=>a(t,s),parallelCase:(e,t,s)=>r(t,s)})),cb=M(3,(e,t,s)=>{let i=t,n=e,r=[];for(;void 0!==n;){let e=s(i,n);switch(i=ty(e)?e.value:i,n._tag){case oJ:case oH:r.push(n.right),n=n.left;break;default:n=void 0}void 0===n&&r.length>0&&(n=r.pop())}return i}),cx=M(3,(e,t,s)=>{let i=[e],n=[];for(;i.length>0;){let e=i.pop();switch(e._tag){case oU:n.push(tV(s.emptyCase(t)));break;case oB:n.push(tV(s.failCase(t,e.error)));break;case"Die":n.push(tV(s.dieCase(t,e.defect)));break;case oq:n.push(tV(s.interruptCase(t,e.fiberId)));break;case oJ:i.push(e.right),i.push(e.left),n.push(tK({_tag:cf}));break;case oH:i.push(e.right),i.push(e.left),n.push(tK({_tag:cm}))}}let r=[];for(;n.length>0;){let e=n.pop();switch(e._tag){case"Left":switch(e.left._tag){case cf:{let e=r.pop(),i=r.pop(),n=s.sequentialCase(t,e,i);r.push(n);break}case cm:{let e=r.pop(),i=r.pop(),n=s.parallelCase(t,e,i);r.push(n)}}break;case"Right":r.push(e.right)}}if(0===r.length)throw Error("BUG: Cause.reduceWithContext - please report an issue at https://github.com/Effect-TS/effect/issues");return r.pop()}),cy=(e,t)=>o4(e)?"All fibers interrupted without errors.":cC(e).map(function(e){return t?.renderErrorCause!==!0||void 0===e.cause?e.stack:`${e.stack} {
${cv(e.cause,"  ")}
}`}).join("\n"),cv=(e,t)=>{let s=e.stack.split("\n"),i=`${t}[cause]: ${s[0]}`;for(let e=1,n=s.length;e<n;e++)i+=`
${t}${s[e]}`;return e.cause&&(i+=` {
${cv(e.cause,`${t}  `)}
${t}}`),i};class cw extends globalThis.Error{constructor(e){let t="object"==typeof e&&null!==e,s=Error.stackTraceLimit;Error.stackTraceLimit=1,super(cS(e),t&&"cause"in e&&void 0!==e.cause?{cause:new cw(e.cause)}:void 0),this.span=void 0,""===this.message&&(this.message="An error has occurred"),Error.stackTraceLimit=s,this.name=e instanceof Error?e.name:"Error",t&&(cE in e&&(this.span=e[cE]),Object.keys(e).forEach(t=>{t in this||(this[t]=e[t])})),this.stack=cO(`${this.name}: ${this.message}`,e instanceof Error&&e.stack?e.stack:"",this.span)}}let cS=e=>{if("string"==typeof e)return e;if("object"==typeof e&&null!==e&&e instanceof Error)return e.message;try{if(ei(e,"toString")&&Y(e.toString)&&e.toString!==Object.prototype.toString&&e.toString!==globalThis.Array.prototype.toString)return e.toString()}catch{}return eH(e)},c_=/\((.*)\)/,ck=H("effect/Tracer/spanToTrace",()=>new WeakMap),cO=(e,t,s)=>{let i=[e],n=t.startsWith(e)?t.slice(e.length).split("\n"):t.split("\n");for(let e=1;e<n.length&&!n[e].includes("Generator.next");e++){if(n[e].includes("effect_internal_function")){i.pop();break}i.push(n[e].replace(/at .*effect_instruction_i.*\((.*)\)/,"at $1").replace(/EffectPrimitive\.\w+/,"<anonymous>"))}if(s){let e=s,t=0;for(;e&&"Span"===e._tag&&t<10;){let s=ck.get(e);if("function"==typeof s){let t=s();if("string"==typeof t){let s=t.match(c_),n=s?s[1]:t.replace(/^at /,"");i.push(`    at ${e.name} (${n})`)}else i.push(`    at ${e.name}`)}else i.push(`    at ${e.name}`);e=st(e.parent),t++}}return i.join("\n")},cE=Symbol.for("effect/SpanAnnotation"),cC=e=>cx(e,void 0,{emptyCase:()=>[],dieCase:(e,t)=>[new cw(t)],failCase:(e,t)=>[new cw(t)],interruptCase:()=>[],parallelCase:(e,t,s)=>[...t,...s],sequentialCase:(e,t,s)=>[...t,...s]}),cR="Pending",cI="Done",cT=Symbol.for("effect/Deferred"),cF={_E:e=>e,_A:e=>e},cA=e=>({_tag:cR,joiners:e}),cN=e=>({_tag:cI,effect:e});class cM{constructor(e){this.called=!1,this.self=e}next(e){return this.called?{value:e,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(e){return{value:e,done:!0}}throw(e){throw e}[Symbol.iterator](){return new cM(this.self)}}let cj=Symbol.for("effect/EffectError"),cz=e=>ei(e,cj),cP=e=>({[cj]:cj,_tag:"EffectError",cause:e}),cD=(e,t)=>{let s=new cB("Blocked");return s.effect_instruction_i0=e,s.effect_instruction_i1=t,s},cL=e=>{let t=new cB("RunBlocked");return t.effect_instruction_i0=e,t},c$=Symbol.for("effect/Effect");class cU{constructor(e,t){this._op=te,this.patch=e,this.op=t}}class cB{constructor(e){this.effect_instruction_i0=void 0,this.effect_instruction_i1=void 0,this.effect_instruction_i2=void 0,this.trace=void 0,this[c$]=tr,this._op=e}[eN](e){return this===e}[ew](){return eA(this,e_(this))}pipe(){return eY(this,arguments)}toJSON(){return{_id:"Effect",_op:this._op,effect_instruction_i0:eL(this.effect_instruction_i0),effect_instruction_i1:eL(this.effect_instruction_i1),effect_instruction_i2:eL(this.effect_instruction_i2)}}toString(){return e$(this.toJSON())}[eD](){return this.toJSON()}[Symbol.iterator](){return new cM(new eg(this))}}class cq{constructor(e){this.effect_instruction_i0=void 0,this.effect_instruction_i1=void 0,this.effect_instruction_i2=void 0,this.trace=void 0,this[c$]=tr,this._op=e,this._tag=e}[eN](e){return uX(e)&&"Failure"===e._op&&eM(this.effect_instruction_i0,e.effect_instruction_i0)}[ew](){return $(eR(this._tag),ek(eS(this.effect_instruction_i0)),eA(this))}get cause(){return this.effect_instruction_i0}pipe(){return eY(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,cause:this.cause.toJSON()}}toString(){return e$(this.toJSON())}[eD](){return this.toJSON()}[Symbol.iterator](){return new cM(new eg(this))}}class cH{constructor(e){this.effect_instruction_i0=void 0,this.effect_instruction_i1=void 0,this.effect_instruction_i2=void 0,this.trace=void 0,this[c$]=tr,this._op=e,this._tag=e}[eN](e){return uX(e)&&"Success"===e._op&&eM(this.effect_instruction_i0,e.effect_instruction_i0)}[ew](){return $(eR(this._tag),ek(eS(this.effect_instruction_i0)),eA(this))}get value(){return this.effect_instruction_i0}pipe(){return eY(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,value:eL(this.value)}}toString(){return e$(this.toJSON())}[eD](){return this.toJSON()}[Symbol.iterator](){return new cM(new eg(this))}}let cJ=e=>ei(e,c$),cW=e=>{let t=new cB(e7);return t.effect_instruction_i0=e,t},cK=M(3,(e,t,s)=>lj(i=>lr(e,e=>lr(c7(lI(()=>i(t(e)))),t=>lI(()=>s(e,t)).pipe(lu({onFailure:e=>{switch(t._tag){case eZ:return lt(o0(t.effect_instruction_i0,e));case e3:return lt(e)}},onSuccess:()=>t})))))),cV=M(2,(e,t)=>lr(e,()=>lR(t))),cG=e=>cV(e,void 0),cY=function(){let e=new cB(eQ);switch(arguments.length){case 2:e.effect_instruction_i0=arguments[0],e.commit=arguments[1];break;case 3:e.effect_instruction_i0=arguments[0],e.effect_instruction_i1=arguments[1],e.commit=arguments[2];break;case 4:e.effect_instruction_i0=arguments[0],e.effect_instruction_i1=arguments[1],e.effect_instruction_i2=arguments[2],e.commit=arguments[3];break;default:throw Error(eh("you're not supposed to end up here"))}return e},cX=(e,t=rQ)=>{let s;let i=new cB(eX);return i.effect_instruction_i0=t=>{s=e(t)},i.effect_instruction_i1=t,l_(i,e=>cJ(s)?s:lz)},cQ=(e,t=rQ)=>cY(e,function(){let e,s,i,n;function r(t){e?e(t):void 0===s&&(s=t)}let a=new cB(eX);return a.effect_instruction_i0=t=>{e=t,s&&t(s)},a.effect_instruction_i1=t,1!==this.effect_instruction_i0.length?(n=new AbortController,i=ey(()=>this.effect_instruction_i0(r,n.signal))):i=ey(()=>this.effect_instruction_i0(r)),i||n?l_(a,e=>(n&&n.abort(),i??lz)):a}),cZ=M(2,(e,t)=>{let s=new cB(e0);return s.effect_instruction_i0=e,s.effect_instruction_i1=t,s}),c0=M(2,(e,t)=>lh(e,{onFailure:t,onSuccess:lR})),c1=M(3,(e,t,s)=>cZ(e,e=>{let i=ce(e);switch(i._tag){case"Left":return t(i.left)?s(i.left):lt(e);case"Right":return lt(i.right)}})),c2=Symbol.for("effect/SpanAnnotation"),c3=Symbol.for("effect/OriginalAnnotation"),c5=(e,t)=>ty(t)?new Proxy(e,{has:(e,t)=>t===c2||t===c3||t in e,get:(s,i)=>i===c2?t.value:i===c3?e:s[i]}):e,c4=e=>!es(e)||c2 in e?lt(oX(e)):cW(t=>lt(oX(c5(e,hO(t))))),c6=e=>ls(()=>oX(new uD(e))),c8=e=>lh(e,{onFailure:e=>lR(tK(e)),onSuccess:e=>lR(tV(e))}),c7=e=>ll(e,{onFailure:u4,onSuccess:hs}),c9=e=>!es(e)||c2 in e?lt(oY(e)):cW(t=>lt(oY(c5(e,hO(t))))),le=e=>lr(lT(e),c9),lt=e=>{let t=new cq(eZ);return t.effect_instruction_i0=e,t},ls=e=>lr(lT(e),lt),li=cW(e=>lR(e.id())),ln=e=>cW(t=>e(t.id())),lr=M(2,(e,t)=>{let s=new cB(e1);return s.effect_instruction_i0=e,s.effect_instruction_i1=t,s}),la=M(2,(e,t)=>lr(e,e=>{let s="function"==typeof t?t(e):t;return cJ(s)?s:eu(s)?cQ(e=>{s.then(t=>e(lR(t)),t=>e(c9(new uY(t))))}):lR(s)})),lo=e=>{let t=new cB("OnStep");return t.effect_instruction_i0=e,t},lc=e=>lr(e,j),ll=M(2,(e,t)=>lu(e,{onFailure:e=>lR(t.onFailure(e)),onSuccess:e=>lR(t.onSuccess(e))})),lu=M(2,(e,t)=>{let s=new cB(e2);return s.effect_instruction_i0=e,s.effect_instruction_i1=t.onFailure,s.effect_instruction_i2=t.onSuccess,s}),lh=M(2,(e,t)=>lu(e,{onFailure:e=>{if(o8(e).length>0)return lt(cn(e));let s=o6(e);return s.length>0?t.onFailure(iK(s)):lt(e)},onSuccess:t.onSuccess})),lp=M(2,(e,t)=>lI(()=>{let s=sC(e),i=sO(s.length),n=0;return cV(lL({while:()=>n<s.length,body:()=>t(s[n],n),step:e=>{i[n++]=e}}),i)})),ld=M(2,(e,t)=>lI(()=>{let s=sC(e),i=0;return lL({while:()=>i<s.length,body:()=>t(s[i],i),step:()=>{i++}})})),lf=M(e=>"boolean"==typeof e[0]||cJ(e[0]),(e,t)=>cJ(e)?lr(e,e=>e?t.onTrue():t.onFalse()):e?t.onTrue():t.onFalse()),lm=lr(li,e=>lg(e)),lg=e=>lt(oQ(e)),lb=e=>{let t=new cB(e4);return t.effect_instruction_i0=oL(1),t.effect_instruction_i1=()=>e,t},lx=M(2,(e,t)=>lj(s=>lr(c7(s(e)),e=>hd(t,e)))),ly=M(2,(e,t)=>lr(e,e=>lT(()=>t(e)))),lv=M(2,(e,t)=>lh(e,{onFailure:e=>le(()=>t.onFailure(e)),onSuccess:e=>lT(()=>t.onSuccess(e))})),lw=M(2,(e,t)=>lu(e,{onFailure:e=>{let s=ce(e);switch(s._tag){case"Left":return le(()=>t(s.left));case"Right":return lt(s.right)}},onSuccess:lR})),lS=((e,t)=>lS(e,e=>uZ(e)?lz:t(e.effect_instruction_i0)),M(2,(e,t)=>lj(s=>lu(s(e),{onFailure:e=>{let s=u4(e);return lu(t(s),{onFailure:t=>u4(o0(e,t)),onSuccess:()=>s})},onSuccess:e=>{let s=hs(e);return lH(t(s),s)}})))),l_=M(2,(e,t)=>lS(e,he({onFailure:e=>o4(e)?cG(t(o7(e))):lz,onSuccess:()=>lz}))),lk=M(2,(e,t)=>lN(e,t,lR)),lO=e=>lE(e,j),lE=M(2,(e,t)=>lh(e,{onFailure:e=>c4(t(e)),onSuccess:lR})),lC=cW((e,t)=>lR(t.runtimeFlags)),lR=e=>{let t=new cH(e3);return t.effect_instruction_i0=e,t},lI=e=>{let t=new cB(eQ);return t.commit=e,t},lT=e=>{let t=new cB(e5);return t.effect_instruction_i0=e,t},lF=M(e=>3===e.length||2===e.length&&!(es(e[1])&&"onlyEffect"in e[1]),(e,t)=>lr(e,e=>{let s="function"==typeof t?t(e):t;return cJ(s)?cV(s,e):eu(s)?cQ(t=>{s.then(s=>t(lR(e)),e=>t(c9(new uY(e))))}):lR(e)})),lA=e=>cW(t=>{let s=$(t.getFiberRef(uS),t8(()=>t.scope()));return e(un(uS,tw(s)))}),lN=M(3,(e,t,s)=>lu(e,{onFailure:e=>o8(e).length>0?lt(si(cs(e))):t(),onSuccess:s})),lM=e=>{let t=new cB(e4);return t.effect_instruction_i0=o$(1),t.effect_instruction_i1=()=>e,t},lj=e=>cY(e,function(){let e=new cB(e4);return e.effect_instruction_i0=o$(1),e.effect_instruction_i1=e=>oT(e)?ey(()=>this.effect_instruction_i0(lb)):ey(()=>this.effect_instruction_i0(lM)),e}),lz=lR(void 0),lP=e=>{let t=new cB(e4);return t.effect_instruction_i0=e,t.effect_instruction_i1=void 0,t},lD=M(2,(e,t)=>lr(t,t=>t?$(e,ly(tw)):lR(t4()))),lL=e=>{let t=new cB(e6);return t.effect_instruction_i0=e.while,t.effect_instruction_i1=e.body,t.effect_instruction_i2=e.step,t},l$=M(2,(e,t)=>{let s=new cB(e4);return s.effect_instruction_i0=t,s.effect_instruction_i1=()=>e,s}),lU=e=>{let t=new cB(e9);return void 0!==e?.priority?ub(t,e.priority):t},lB=M(2,(e,t)=>lr(e,e=>ly(t,t=>[e,t]))),lq=M(2,(e,t)=>lr(e,e=>cV(t,e))),lH=M(2,(e,t)=>lr(e,()=>t)),lJ=M(3,(e,t,s)=>lr(e,e=>ly(t,t=>s(e,t)))),lW=(()=>{let e=setInterval(()=>{},0x80000000-1);return lT(()=>clearInterval(e))},e=>lr(li,t=>$(e,lK(t)))),lK=M(2,(e,t)=>lr(e.interruptAsFork(t),()=>e.await)),lV={_tag:"All",syslog:0,label:"ALL",ordinal:Number.MIN_SAFE_INTEGER,pipe(){return eY(this,arguments)}},lG={_tag:"Fatal",syslog:2,label:"FATAL",ordinal:5e4,pipe(){return eY(this,arguments)}},lY={_tag:"Error",syslog:3,label:"ERROR",ordinal:4e4,pipe(){return eY(this,arguments)}},lX={_tag:"Warning",syslog:4,label:"WARN",ordinal:3e4,pipe(){return eY(this,arguments)}},lQ={_tag:"Info",syslog:6,label:"INFO",ordinal:2e4,pipe(){return eY(this,arguments)}},lZ={_tag:"Debug",syslog:7,label:"DEBUG",ordinal:1e4,pipe(){return eY(this,arguments)}},l0={_tag:"Trace",syslog:7,label:"TRACE",ordinal:0,pipe(){return eY(this,arguments)}},l1={_tag:"None",syslog:7,label:"OFF",ordinal:Number.MAX_SAFE_INTEGER,pipe(){return eY(this,arguments)}},l2=[lV,l0,lZ,lQ,lX,lY,lG,l1],l3=Symbol.for("effect/FiberRef"),l5={_A:e=>e},l4=e=>cW(t=>hs(t.getFiberRef(e))),l6=M(2,(e,t)=>lr(l4(e),t)),l8=M(2,(e,t)=>l7(e,()=>[void 0,t])),l7=M(2,(e,t)=>cW(s=>{let[i,n]=t(s.getFiberRef(e));return s.setFiberRef(e,n),lR(i)})),l9=M(2,(e,t)=>l7(e,e=>[void 0,t(e)])),ue=Symbol.for("effect/RequestResolver"),ut={_A:e=>e,_R:e=>e};class us{constructor(e,t){this[ue]=ut,this.runAll=e,this.target=t}[ew](){return eA(this,this.target?eS(this.target):e_(this))}[eN](e){return this.target?ui(e)&&eM(this.target,e.target):this===e}identified(...e){return new us(this.runAll,iO(e))}pipe(){return eY(this,arguments)}}let ui=e=>ei(e,ue),un=M(3,(e,t,s)=>cK(lq(l4(t),l8(t,s)),()=>e,e=>l8(t,e))),ur=M(3,(e,t,s)=>l6(t,i=>un(e,t,s(i)))),ua=(e,t)=>uu(e,{differ:ox(),fork:t?.fork??j,join:t?.join}),uo=e=>{let t=og();return uu(e,{differ:t,fork:t.empty})},uc=e=>{let t=ob(ox());return uu(e,{differ:t,fork:t.empty})},ul=e=>{let t=om();return uu(e,{differ:t,fork:t.empty})},uu=(e,t)=>({...tc,[l3]:l5,initial:e,commit(){return l4(this)},diff:(e,s)=>t.differ.diff(e,s),combine:(e,s)=>t.differ.combine(e,s),patch:e=>s=>t.differ.patch(e,s),fork:t.fork,join:t.join??((e,t)=>t)}),uh=H(Symbol.for("effect/FiberRef/currentContext"),()=>ul(tD())),up=H(Symbol.for("effect/FiberRef/currentSchedulingPriority"),()=>ua(0)),ud=H(Symbol.for("effect/FiberRef/currentMaxOpsBeforeYield"),()=>ua(2048)),uf=H(Symbol.for("effect/FiberRef/currentLogAnnotation"),()=>ua(nZ())),um=H(Symbol.for("effect/FiberRef/currentLogLevel"),()=>ua(lQ)),ug=H(Symbol.for("effect/FiberRef/currentLogSpan"),()=>ua(ar())),ub=M(2,(e,t)=>un(e,up,t)),ux=H(Symbol.for("effect/FiberRef/currentConcurrency"),()=>ua("unbounded")),uy=H(Symbol.for("effect/FiberRef/currentRequestBatching"),()=>ua(!0)),uv=H(Symbol.for("effect/FiberRef/currentUnhandledErrorLogLevel"),()=>ua(tw(lZ))),uw=H(Symbol.for("effect/FiberRef/currentMetricLabels"),()=>uc(s4())),uS=H(Symbol.for("effect/FiberRef/currentForkScopeOverride"),()=>ua(t4(),{fork:()=>t4(),join:(e,t)=>e})),u_=H(Symbol.for("effect/FiberRef/currentInterruptedCause"),()=>ua(oG,{fork:()=>oG,join:(e,t)=>e})),uk=H(Symbol.for("effect/FiberRef/currentTracerEnabled"),()=>ua(!0)),uO=H(Symbol.for("effect/FiberRef/currentTracerTiming"),()=>ua(!0)),uE=H(Symbol.for("effect/FiberRef/currentTracerSpanAnnotations"),()=>ua(nZ())),uC=H(Symbol.for("effect/FiberRef/currentTracerSpanLinks"),()=>ua(iS())),uR=Symbol.for("effect/Scope"),uI=Symbol.for("effect/CloseableScope"),uT=(e,t)=>e.addFinalizer(()=>cG(t)),uF=(e,t)=>e.addFinalizer(t),uA=(e,t)=>e.close(t),uN=(e,t)=>e.fork(t),uM=M(2,(e,t)=>{let s=$(e,o9,sn(t));switch(s._tag){case"None":return $(o8(e),iW,t6({onNone:()=>{let t=sC(o7(e)).flatMap(e=>sC(rV(e)).map(e=>`#${e}`));return new u$(t?`Interrupted by fibers: ${t.join(", ")}`:void 0)},onSome:j}));case"Some":return s.value}}),uj=function(){class e extends globalThis.Error{commit(){return c9(this)}toJSON(){return{...this}}[eD](){return this.toString!==globalThis.Error.prototype.toString?this.stack?`${this.toString()}
${this.stack.split("\n").slice(1).join("\n")}`:this.toString():"Bun"in globalThis?cy(oY(this),{renderErrorCause:!0}):this}}return Object.assign(e.prototype,tl),e}(),uz=(e,t)=>{class s extends uj{constructor(...e){super(...e),this._tag=t}}return Object.assign(s.prototype,e),s.prototype.name=t,s},uP=Symbol.for("effect/Cause/errors/RuntimeException"),uD=uz({[uP]:uP},"RuntimeException"),uL=Symbol.for("effect/Cause/errors/InterruptedException"),u$=uz({[uL]:uL},"InterruptedException"),uU=e=>ei(e,uL),uB=Symbol.for("effect/Cause/errors/IllegalArgument"),uq=uz({[uB]:uB},"IllegalArgumentException"),uH=Symbol.for("effect/Cause/errors/NoSuchElement"),uJ=uz({[uH]:uH},"NoSuchElementException"),uW=Symbol.for("effect/Cause/errors/InvalidPubSubCapacityException"),uK=uz({[uW]:uW},"InvalidPubSubCapacityException"),uV=Symbol.for("effect/Cause/errors/Timeout"),uG=Symbol.for("effect/Cause/errors/UnknownException"),uY=function(){class e extends uj{constructor(e,t){super(t??"An unknown error occurred",{cause:e}),this._tag="UnknownException",this.cause=e,this.error=e}}return Object.assign(e.prototype,{[uG]:uG,name:"UnknownException"}),e}(),uX=e=>cJ(e)&&"_tag"in e&&("Success"===e._tag||"Failure"===e._tag),uQ=e=>"Failure"===e._tag,uZ=e=>"Success"===e._tag,u0=M(2,(e,t)=>{switch(e._tag){case eZ:return u4(e.effect_instruction_i0);case e3:return hs(t)}}),u1=e=>u0(e,void 0),u2=(e,t)=>ho(e,t?.parallel?oZ:o0),u3=e=>u4(oX(e)),u5=e=>u4(oY(e)),u4=e=>{let t=new cq(eZ);return t.effect_instruction_i0=e,t},u6=M(2,(e,t)=>{switch(e._tag){case eZ:return u4(e.effect_instruction_i0);case e3:return t(e.effect_instruction_i0)}}),u8=M(2,(e,t)=>{switch(e._tag){case eZ:return lR(u4(e.effect_instruction_i0));case e3:return c7(t(e.effect_instruction_i0))}}),u7=e=>u4(oQ(e)),u9=M(2,(e,t)=>{switch(e._tag){case eZ:return u4(e.effect_instruction_i0);case e3:return hs(t(e.effect_instruction_i0))}}),he=M(2,(e,{onFailure:t,onSuccess:s})=>{switch(e._tag){case eZ:return t(e.effect_instruction_i0);case e3:return s(e.effect_instruction_i0)}}),ht=M(2,(e,{onFailure:t,onSuccess:s})=>{switch(e._tag){case eZ:return t(e.effect_instruction_i0);case e3:return s(e.effect_instruction_i0)}}),hs=e=>{let t=new cH(e3);return t.effect_instruction_i0=e,t},hi=hs(void 0),hn=M(2,(e,t)=>ha(e,t,{onSuccess:(e,t)=>[e,t],onFailure:o0})),hr=M(2,(e,t)=>ha(e,t,{onSuccess:(e,t)=>t,onFailure:o0})),ha=M(3,(e,t,{onFailure:s,onSuccess:i})=>{switch(e._tag){case eZ:switch(t._tag){case e3:return u4(e.effect_instruction_i0);case eZ:return u4(s(e.effect_instruction_i0,t.effect_instruction_i0))}case e3:switch(t._tag){case e3:return hs(i(e.effect_instruction_i0,t.effect_instruction_i0));case eZ:return u4(t.effect_instruction_i0)}}}),ho=(e,t)=>{let s=iO(e);return iJ(s)?$(iQ(s),ia($(iK(s),u9(ik)),(e,s)=>$(e,ha(s,{onSuccess:(e,t)=>$(e,iM(t)),onFailure:t}))),u9(iR),u9(e=>iC(e)),tw):t4()},hc=e=>({...tc,[cT]:cF,state:rT(cA([])),commit(){return hh(this)},blockingOn:e}),hl=()=>lr(li,e=>hu(e)),hu=e=>lT(()=>hc(e)),hh=e=>cQ(t=>{let s=rA(e.state);switch(s._tag){case cI:return t(s.effect);case cR:return s.joiners.push(t),hx(e,t)}},e.blockingOn),hp=M(2,(e,t)=>lT(()=>{let s=rA(e.state);switch(s._tag){case cI:return!1;case cR:rN(e.state,cN(t));for(let e=0,i=s.joiners.length;e<i;e++)s.joiners[e](t);return!0}})),hd=M(2,(e,t)=>hp(e,t)),hf=((e,t)=>hp(e,c9(t)),M(2,(e,t)=>hp(e,lt(t)))),hm=M(2,(e,t)=>hp(e,lg(t))),hg=M(2,(e,t)=>hp(e,lR(t))),hb=(e,t)=>{let s=rA(e.state);if(s._tag===cR){rN(e.state,cN(t));for(let e=0,i=s.joiners.length;e<i;e++)s.joiners[e](t)}},hx=(e,t)=>lT(()=>{let s=rA(e.state);if(s._tag===cR){let e=s.joiners.indexOf(t);e>=0&&s.joiners.splice(e,1)}}),hy=cW(e=>hs(e.currentContext)),hv=()=>hy,hw=e=>lr(hv(),e),hS=M(2,(e,t)=>un(uh,t)(e)),h_=M(2,(e,t)=>ur(uh,e=>tj(e,t))(e)),hk=M(2,(e,t)=>hw(s=>hS(e,t(s)))),hO=e=>{let t=e.currentSpan;return void 0!==t&&"Span"===t._tag?tw(t):t4()},hE={_tag:"Span",spanId:"noop",traceId:"noop",name:"noop",sampled:!1,parent:t4(),context:tD(),status:{_tag:"Ended",startTime:BigInt(0),endTime:BigInt(0),exit:hi},attributes:new Map,links:[],kind:"internal",attribute(){},event(){},end(){}},hC=e=>{let t=Object.create(hE);return t.name=e,t},hR=Symbol.for("effect/Clock"),hI=tz("effect/Clock"),hT=0x80000000-1,hF={unsafeSchedule(e,t){let s=ny(t);if(s>hT)return D;let i=!1,n=setTimeout(()=>{i=!0,e()},s);return()=>(clearTimeout(n),!i)}},hA=function(){let e=BigInt(1e6);if("undefined"==typeof performance)return()=>BigInt(Date.now())*e;if("number"==typeof performance.timeOrigin&&0===performance.timeOrigin)return()=>BigInt(Math.round(1e6*performance.now()));let t=BigInt(Date.now())*e-BigInt(Math.round(1e6*performance.now()));return()=>t+BigInt(Math.round(1e6*performance.now()))}(),hN=function(){let e="object"==typeof process&&"hrtime"in process&&"function"==typeof process.hrtime.bigint?process.hrtime:void 0;if(!e)return hA;let t=hA()-e.bigint();return()=>t+e.bigint()}();class hM{unsafeCurrentTimeMillis(){return Date.now()}unsafeCurrentTimeNanos(){return hN()}scheduler(){return lR(hF)}sleep(e){return cQ(t=>cG(lT(hF.unsafeSchedule(()=>t(lz),e))))}constructor(){this[hR]=hR,this.currentTimeMillis=lT(()=>this.unsafeCurrentTimeMillis()),this.currentTimeNanos=lT(()=>this.unsafeCurrentTimeNanos())}}let hj=e=>Math.max(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))),2),hz=e=>e.replace(/[/\\^$*+?.()|[\]{}]/g,"\\$&"),hP="InvalidData",hD="MissingData",hL="SourceUnavailable",h$="Unsupported",hU=Symbol.for("effect/ConfigError"),hB={_tag:"ConfigError",[hU]:hU},hq=(e,t)=>{let s=Object.create(hB);return s._op="And",s.left=e,s.right=t,Object.defineProperty(s,"toString",{enumerable:!1,value(){return`${this.left} and ${this.right}`}}),s},hH=(e,t)=>{let s=Object.create(hB);return s._op="Or",s.left=e,s.right=t,Object.defineProperty(s,"toString",{enumerable:!1,value(){return`${this.left} or ${this.right}`}}),s},hJ=(e,t,s={pathDelim:"."})=>{let i=Object.create(hB);return i._op=hP,i.path=e,i.message=t,Object.defineProperty(i,"toString",{enumerable:!1,value(){let e=$(this.path,ip(s.pathDelim));return`(Invalid data at ${e}: "${this.message}")`}}),i},hW=(e,t,s={pathDelim:"."})=>{let i=Object.create(hB);return i._op=hD,i.path=e,i.message=t,Object.defineProperty(i,"toString",{enumerable:!1,value(){let e=$(this.path,ip(s.pathDelim));return`(Missing data at ${e}: "${this.message}")`}}),i},hK=(e,t,s,i={pathDelim:"."})=>{let n=Object.create(hB);return n._op=hL,n.path=e,n.message=t,n.cause=s,Object.defineProperty(n,"toString",{enumerable:!1,value(){let e=$(this.path,ip(i.pathDelim));return`(Source unavailable at ${e}: "${this.message}")`}}),n},hV=(e,t,s={pathDelim:"."})=>{let i=Object.create(hB);return i._op=h$,i.path=e,i.message=t,Object.defineProperty(i,"toString",{enumerable:!1,value(){let e=$(this.path,ip(s.pathDelim));return`(Unsupported operation at ${e}: "${this.message}")`}}),i},hG=M(2,(e,t)=>{switch(e._op){case"And":return hq(hG(e.left,t),hG(e.right,t));case"Or":return hH(hG(e.left,t),hG(e.right,t));case hP:return hJ([...t,...e.path],e.message);case hD:return hW([...t,...e.path],e.message);case hL:return hK([...t,...e.path],e.message,e.cause);case h$:return hV([...t,...e.path],e.message)}}),hY={andCase:(e,t,s)=>t&&s,orCase:(e,t,s)=>t&&s,invalidDataCase:D,missingDataCase:P,sourceUnavailableCase:D,unsupportedCase:D},hX=M(3,(e,t,s)=>{let i=[e],n=[];for(;i.length>0;){let e=i.pop();switch(e._op){case"And":i.push(e.right),i.push(e.left),n.push(tK({_op:"AndCase"}));break;case"Or":i.push(e.right),i.push(e.left),n.push(tK({_op:"OrCase"}));break;case hP:n.push(tV(s.invalidDataCase(t,e.path,e.message)));break;case hD:n.push(tV(s.missingDataCase(t,e.path,e.message)));break;case hL:n.push(tV(s.sourceUnavailableCase(t,e.path,e.message,e.cause)));break;case h$:n.push(tV(s.unsupportedCase(t,e.path,e.message)))}}let r=[];for(;n.length>0;){let e=n.pop();switch(e._op){case"Left":switch(e.left._op){case"AndCase":{let e=r.pop(),i=r.pop(),n=s.andCase(t,e,i);r.push(n);break}case"OrCase":{let e=r.pop(),i=r.pop(),n=s.orCase(t,e,i);r.push(n)}}break;case"Right":r.push(e.right)}}if(0===r.length)throw Error("BUG: ConfigError.reduceWithContext - please report an issue at https://github.com/Effect-TS/effect/issues");return r.pop()}),hQ={_tag:"Empty"},hZ=M(2,(e,t)=>({_tag:"AndThen",first:e,second:t})),h0=M(2,(e,t)=>hZ(e,{_tag:"MapName",f:t})),h1=M(2,(e,t)=>hZ(e,{_tag:"Nested",name:t})),h2=M(2,(e,t)=>hZ(e,{_tag:"Unnested",name:t})),h3=M(2,(e,t)=>{let s=aa(t),i=e;for(;ai(s);){let e=s.head;switch(e._tag){case"Empty":s=s.tail;break;case"AndThen":s=an(e.first,an(e.second,s.tail));break;case"MapName":i=s8(i,e.f),s=s.tail;break;case"Nested":i=sF(i,e.name),s=s.tail;break;case"Unnested":if(!$(sU(i),su(e.name)))return tK(hW(i,`Expected ${e.name} to be in path in ConfigProvider#unnested`));i=sJ(i),s=s.tail}}return tV(i)}),h5="Constant",h4="Fallback",h6="Lazy",h8="MapOrFail",h7="Nested",h9="Primitive",pe="ZipWith",pt=e=>e.toLowerCase(),ps=e=>e.toUpperCase(),pi=(e,t,s)=>t instanceof RegExp?e.replace(t,s):t.reduce((e,t)=>e.replace(t,s),e),pn=[/([a-z0-9])([A-Z])/g,/([A-Z])([A-Z][a-z])/g],pr=/[^A-Z0-9]+/gi,pa=(e,t={})=>{let{delimiter:s=" ",splitRegexp:i=pn,stripRegexp:n=pr,transform:r=pt}=t,a=pi(pi(e,i,"$1\0$2"),n,"\0"),o=0,c=a.length;for(;"\0"===a.charAt(o);)o++;for(;"\0"===a.charAt(c-1);)c--;return a.slice(o,c).split("\0").map(r).join(s)},po=(e,t)=>pa(e,{delimiter:"_",transform:ps,...t}),pc=(e,t)=>[...e,...t],pl=Symbol.for("effect/ConfigProvider"),pu=tz("effect/ConfigProvider"),ph=Symbol.for("effect/ConfigProviderFlat"),pp=e=>({[pl]:pl,pipe(){return eY(this,arguments)},...e}),pd=e=>({[ph]:ph,patch:e.patch,load:(t,s,i=!0)=>e.load(t,s,i),enumerateChildren:e.enumerateChildren}),pf=e=>pp({load:t=>lr(py(e,s4(),t,!1),e=>t6(sU(e),{onNone:()=>c9(hW(s4(),`Expected a single value having structure: ${t}`)),onSome:lR})),flattened:e}),pm=e=>{let{pathDelim:t,seqDelim:s}=Object.assign({},{pathDelim:"_",seqDelim:","},e),i=e=>$(e,ip(t)),n=e=>e.split(t),r=()=>"undefined"!=typeof process&&"env"in process&&"object"==typeof process.env?process.env:{};return pf(pd({load:(e,t,n=!0)=>{let a=i(e),o=r();return $(a in o?tw(o[a]):t4(),lw(()=>hW(e,`Expected ${a} to exist in the process context`)),lr(i=>pC(i,e,t,s,n)))},enumerateChildren:e=>lT(()=>rO(Object.keys(r()).map(e=>n(e.toUpperCase())).filter(t=>{for(let s=0;s<e.length;s++){let i=$(e,s$(s)),n=t[s];if(void 0===n||i!==n)return!1}return!0}).flatMap(t=>t.slice(e.length,e.length+1)))),patch:hQ}))},pg=(e,t)=>{let{pathDelim:s,seqDelim:i}=Object.assign({seqDelim:",",pathDelim:"."},t),n=e=>$(e,ip(s)),r=e=>e.split(s),a=pN(e,e=>r(e),n);return pf(pd({load:(e,t,s=!0)=>{let r=n(e);return $(a.has(r)?tw(a.get(r)):t4(),lw(()=>hW(e,`Expected ${r} to exist in the provided map`)),lr(n=>pC(n,e,t,i,s)))},enumerateChildren:e=>lT(()=>rO(sC(a.keys()).map(r).filter(t=>{for(let s=0;s<e.length;s++){let i=$(e,s$(s)),n=t[s];if(void 0===n||i!==n)return!1}return!0}).flatMap(t=>t.slice(e.length,e.length+1)))),patch:hQ}))},pb=(e,t,s,i)=>{let n=il(s.length,t=>t>=i.length?t4():tw([e(t),t+1])),r=il(i.length,e=>e>=s.length?t4():tw([t(e),e+1]));return[pc(s,n),pc(i,r)]},px=(e,t)=>{let s=t;if("Nested"===s._tag){let t=e.slice();for(;"Nested"===s._tag;)t.push(s.name),s=s.config;return t}return e},py=(e,t,s,i)=>{switch(s._tag){case h5:return lR(s6(s.value));case"Described":return lI(()=>py(e,t,s.config,i));case"Fail":return c9(hW(t,s.message));case h4:return $(lI(()=>py(e,t,s.first,i)),c0(n=>s.condition(n)?$(py(e,t,s.second,i),c0(e=>c9(hH(n,e)))):c9(n)));case h6:return lI(()=>py(e,t,s.config(),i));case h8:return lI(()=>$(py(e,t,s.original,i),lr(lp(e=>$(s.mapOrFail(e),lw(hG(px(t,s.original))))))));case h7:return lI(()=>py(e,pc(t,s6(s.name)),s.config,i));case h9:return $(h3(t,e.patch),lr(t=>$(e.load(t,s,i),lr(e=>{if(0===e.length){let e=$(sq(t),t8(()=>"<n/a>"));return c9(hW([],`Expected ${s.description} with name ${e}`))}return lR(e)}))));case"Sequence":return $(h3(t,e.patch),lr(i=>$(e.enumerateChildren(i),lr(pI),lr(i=>0===i.length?lI(()=>ly(py(e,t,s.config,!0),s6)):$(lp(i,i=>py(e,sA(t,`[${i}]`),s.config,!0)),ly(e=>{let t=s9(e);return 0===t.length?s6(s4()):s6(t)}))))));case"HashMap":return lI(()=>$(h3(t,e.patch),lr(t=>$(e.enumerateChildren(t),lr(n=>$(n,lp(n=>py(e,pc(t,s6(n)),s.valueConfig,i)),ly(e=>0===e.length?s6(nZ()):$(pR(e),s8(e=>r2(sX(sC(n),e)))))))))));case pe:return lI(()=>$(py(e,t,s.left,i),c8,lr(n=>$(py(e,t,s.right,i),c8,lr(e=>{if(tJ(n)&&tJ(e))return c9(hq(n.left,e.left));if(tJ(n)&&tW(e))return c9(n.left);if(tW(n)&&tJ(e))return c9(e.left);if(tW(n)&&tW(e)){let i=$(t,ip(".")),r=pv(t,i),[a,o]=pb(r,r,$(n.right,s8(tV)),$(e.right,s8(tV)));return $(a,sX(o),lp(([e,t])=>$(lB(e,t),ly(([e,t])=>s.zip(e,t)))))}throw Error("BUG: ConfigProvider.fromFlatLoop - please report an issue at https://github.com/Effect-TS/effect/issues")})))))}},pv=(e,t)=>s=>tK(hW(e,`The element at index ${s} in a sequence at path "${t}" was missing`)),pw=M(2,(e,t)=>pf(pS(e.flattened,t))),pS=(e,t)=>pd({load:(t,s,i=!0)=>e.load(t,s,i),enumerateChildren:t=>e.enumerateChildren(t),patch:h0(e.patch,t)}),p_=M(2,(e,t)=>pf(pd({load:(t,s)=>e.flattened.load(t,s,!0),enumerateChildren:t=>e.flattened.enumerateChildren(t),patch:h1(e.flattened.patch,t)}))),pk=((e,t)=>pf(pd({load:(t,s)=>e.flattened.load(t,s,!0),enumerateChildren:t=>e.flattened.enumerateChildren(t),patch:h2(e.flattened.patch,t)})),M(2,(e,t)=>pf(pO(e.flattened,()=>t().flattened)))),pO=(e,t)=>pd({load:(s,i,n)=>$(h3(s,e.patch),lr(t=>e.load(t,i,n)),c0(e=>$(lT(t),lr(t=>$(h3(s,t.patch),lr(e=>t.load(e,i,n)),c0(t=>c9(hH(e,t)))))))),enumerateChildren:s=>$(h3(s,e.patch),lr(t=>e.enumerateChildren(t)),c8,lr(e=>$(lT(t),lr(t=>$(h3(s,t.patch),lr(e=>t.enumerateChildren(e)),c8,lr(t=>{if(tJ(e)&&tJ(t))return c9(hq(e.left,t.left));if(tJ(e)&&tW(t))return lR(t.right);if(tW(e)&&tJ(t))return lR(e.right);if(tW(e)&&tW(t))return lR($(e.right,rS(t.right)));throw Error("BUG: ConfigProvider.orElseFlat - please report an issue at https://github.com/Effect-TS/effect/issues")})))))),patch:hQ}),pE=(e,t)=>e.split(RegExp(`\\s*${hz(t)}\\s*`)),pC=(e,t,s,i,n)=>n?$(pE(e,i),lp(e=>s.parse(e.trim())),lw(hG(t))):$(s.parse(e),lv({onFailure:hG(t),onSuccess:s6})),pR=e=>Object.keys(e[0]).map(t=>e.map(e=>e[t])),pI=e=>$(lp(e,pA),lv({onFailure:()=>s4(),onSuccess:sY(sm)}),c8,ly(tQ)),pT=/(^.+)(\[(\d+)\])$/,pF=/^(\[(\d+)\])$/,pA=e=>{let t=e.match(pF);if(null!==t){let e=t[2];return $(void 0!==e&&e.length>0?tw(e):t4(),sr(pj))}return t4()},pN=(e,t,s)=>{let i=new Map;for(let[n,r]of e){let e=$(t(n),s7(e=>t6(pM(e),{onNone:()=>s6(e),onSome:([e,t])=>sk(e,`[${t}]`)})));i.set(s(e),r)}return i},pM=e=>{let t=e.match(pT);if(null!==t){let e=t[1],s=t[3];return sa([void 0!==e&&e.length>0?tw(e):t4(),$(void 0!==s&&s.length>0?tw(s):t4(),sr(pj))])}return t4()},pj=e=>{let t=Number.parseInt(e);return Number.isNaN(t)?t4():tw(t)},pz=e=>({_tag:"KeyName",name:e}),pP=e=>({_tag:"KeyIndex",index:e}),pD=e=>{let t=[],s=0;for(;s<e.length;){let i=e[s];if("KeyName"===i._tag){if(s+1<e.length){let n=e[s+1];"KeyIndex"===n._tag?(t.push(`${i.name}[${n.index}]`),s+=2):(t.push(i.name),s+=1)}else t.push(i.name),s+=1}}return t},pL=e=>{let t=(e,t)=>"string"==typeof t?sk([e,t]):"number"==typeof t||"boolean"==typeof t?sk([e,String(t)]):sM(t)?s(e,t):"object"==typeof t&&null!==t?i(e,t):s4(),s=(e,s)=>sI(s,{onEmpty:()=>sk([e,"<nil>"]),onNonEmpty:s7((s,i)=>t(sA(e,pP(i)),s))}),i=(e,s)=>Object.entries(s).filter(([,e])=>ea(e)).flatMap(([s,i])=>{let n=sA(e,pz(s)),r=t(n,i);return sj(r)?sk([n,""]):r});return i(s4(),e)},p$=Symbol.for("effect/Console"),pU=tz("effect/Console"),pB={[p$]:p$,assert:(e,...t)=>lT(()=>{console.assert(e,...t)}),clear:lT(()=>{console.clear()}),count:e=>lT(()=>{console.count(e)}),countReset:e=>lT(()=>{console.countReset(e)}),debug:(...e)=>lT(()=>{console.debug(...e)}),dir:(e,t)=>lT(()=>{console.dir(e,t)}),dirxml:(...e)=>lT(()=>{console.dirxml(...e)}),error:(...e)=>lT(()=>{console.error(...e)}),group:e=>e?.collapsed?lT(()=>console.groupCollapsed(e?.label)):lT(()=>console.group(e?.label)),groupEnd:lT(()=>{console.groupEnd()}),info:(...e)=>lT(()=>{console.info(...e)}),log:(...e)=>lT(()=>{console.log(...e)}),table:(e,t)=>lT(()=>{console.table(e,t)}),time:e=>lT(()=>console.time(e)),timeEnd:e=>lT(()=>console.timeEnd(e)),timeLog:(e,...t)=>lT(()=>{console.timeLog(e,...t)}),trace:(...e)=>lT(()=>{console.trace(...e)}),warn:(...e)=>lT(()=>{console.warn(...e)}),unsafe:console},pq=Symbol.for("effect/Random"),pH=tz("effect/Random");class pJ{constructor(e){this[pq]=pq,this.seed=e,this.PRNG=new ed(e)}get next(){return lT(()=>this.PRNG.number())}get nextBoolean(){return ly(this.next,e=>e>.5)}get nextInt(){return lT(()=>this.PRNG.integer(Number.MAX_SAFE_INTEGER))}nextRange(e,t){return ly(this.next,s=>(t-e)*s+e)}nextIntBetween(e,t){return lT(()=>this.PRNG.integer(t-e)+e)}shuffle(e){return pW(e,e=>this.nextIntBetween(0,e))}}let pW=(e,t)=>lI(()=>$(lT(()=>Array.from(e)),lr(e=>{let s=[];for(let t=e.length;t>=2;t-=1)s.push(t);return $(s,ld(s=>$(t(s),ly(t=>pK(e,s-1,t)))),cV(iO(e)))}))),pK=(e,t,s)=>{let i=e[t];return e[t]=e[s],e[s]=i,e},pV=Symbol.for("effect/Tracer"),pG=tz("effect/Tracer"),pY=tz("effect/ParentSpan"),pX=function(){let e="abcdef0123456789",t=e.length;return function(s){let i="";for(let n=0;n<s;n++)i+=e.charAt(Math.floor(Math.random()*t));return i}}();class pQ{constructor(e,t,s,i,n,r){this._tag="Span",this.traceId="native",this.sampled=!0,this.events=[],this.name=e,this.parent=t,this.context=s,this.links=i,this.startTime=n,this.kind=r,this.status={_tag:"Started",startTime:n},this.attributes=new Map,this.traceId="Some"===t._tag?t.value.traceId:pX(32),this.spanId=pX(16)}end(e,t){this.status={_tag:"Ended",endTime:e,exit:t,startTime:this.status.startTime}}attribute(e,t){this.attributes.set(e,t)}event(e,t,s){this.events.push([e,t,s??{}])}}let pZ=e=>{if(e?.captureStackTrace===!1||e?.captureStackTrace!==void 0&&"boolean"!=typeof e.captureStackTrace)return e;let t=Error.stackTraceLimit;Error.stackTraceLimit=3;let s=Error();Error.stackTraceLimit=t;let i=!1;return{...e,captureStackTrace:()=>{if(!1!==i)return i;if(void 0!==s.stack){let e=s.stack.split("\n");if(void 0!==e[3])return i=e[3].trim()}}}},p0=$(tD(),tA(hI,new hM),tA(pU,pB),tA(pH,new pJ(eS(Math.random()))),tA(pu,pm()),tA(pG,{[pV]:pV,span:(e,t,s,i,n,r)=>new pQ(e,t,s,i,n,r),context:e=>e()})),p1=H(Symbol.for("effect/DefaultServices/currentServices"),()=>ul(p0)),p2=e=>cW(t=>e(t.currentDefaultServices)),p3=e=>p2(t=>e(t.unsafeMap.get(hI.key))),p5=p3(e=>e.currentTimeMillis),p4=e=>p2(t=>e(t.unsafeMap.get(pu.key))),p6=e=>p4(t=>t.load(e));g=e=>e.next,p2(e=>g(e.unsafeMap.get(pH.key)));let p8=e=>!e,p7=e=>lr(li,t=>hp(e,lg(t))),p9=e=>lT(()=>rA(e.state)._tag===cI),de=tu,dt=th;class ds extends de{}class di extends dt{}let dn="Sequential",dr="Parallel",da={_tag:dn},dc=e=>e._tag===dn,dl=e=>e._tag===dr,du={_tag:dr},dh=e=>({_tag:"ParallelN",parallelism:e});function dp(){return new df(new Map)}let dd=Symbol.for("effect/FiberRefs");class df{constructor(e){this[dd]=dd,this.locals=e}pipe(){return eY(this,arguments)}}let dm=(e,t,s,i=!1)=>{let n,r=t,a=s,o=i;for(;void 0===n;)if(sz(r)&&sz(a)){let e=sB(r)[0],t=sJ(r),s=sB(a)[0],i=sB(a)[1],c=sJ(a);e.startTimeMillis<s.startTimeMillis?(a=c,o=!0):e.startTimeMillis>s.startTimeMillis?r=t:e.id<s.id?(a=c,o=!0):e.id>s.id?r=t:n=[i,o]}else n=[e.initial,!0];return n},dg=M(3,(e,t,s)=>{let i=new Map(e.locals);return s.locals.forEach((e,s)=>{let n=e[0][1];if(!e[0][0][eN](t)){if(!i.has(s)){if(eM(n,s.initial))return;i.set(s,[[t,s.join(s.initial,n)]]);return}let r=i.get(s),[a,o]=dm(s,r,e);if(o){let e=s.diff(a,n),o=r[0][1],c=s.join(o,s.patch(e)(o));if(!eM(o,c)){let e;let n=r[0][0];e=n[eN](t)?[[n,c],...r.slice(1)]:[[t,c],...r],i.set(s,e)}}}}),new df(i)}),db=M(2,(e,t)=>{let s=new Map;return dx(e,s,t),new df(s)}),dx=(e,t,s)=>{e.locals.forEach((e,i)=>{let n=e[0][1],r=i.patch(i.fork)(n);eM(n,r)?t.set(i,e):t.set(i,[[s,r],...e])})},dy=M(2,(e,t)=>{let s=new Map(e.locals);return s.delete(t),new df(s)}),dv=M(2,(e,t)=>e.locals.has(t)?tw(sB(e.locals.get(t))[1]):t4()),dw=M(2,(e,t)=>$(dv(e,t),t8(()=>t.initial))),dS=M(2,(e,{fiberId:t,fiberRef:s,value:i})=>{if(0===e.locals.size)return new df(new Map([[s,[[t,i]]]]));let n=new Map(e.locals);return d_(n,t,s,i),new df(n)}),d_=(e,t,s,i)=>{let n;let r=e.get(s)??[];if(sz(r)){let[e,s]=sB(r);if(e[eN](t)){if(eM(s,i))return;n=[[t,i],...r.slice(1)]}else n=[[t,i],...r]}else n=[[t,i]];e.set(s,n)},dk=M(2,(e,{entries:t,forkAs:s})=>{if(0===e.locals.size)return new df(new Map(t));let i=new Map(e.locals);return void 0!==s&&dx(e,i,s),t.forEach(([e,t])=>{1===t.length?d_(i,t[0][0],e,t[0][1]):t.forEach(([t,s])=>{d_(i,t,e,s)})}),new df(i)}),dO="Empty",dE="Remove",dC="Update",dR="AndThen",dI={_tag:dO},dT=(e,t)=>{let s=new Map(e.locals),i=dI;for(let[e,n]of t.locals.entries()){let t=sB(n)[1],r=s.get(e);if(void 0!==r){let s=sB(r)[1];eM(s,t)||(i=dF({_tag:dC,fiberRef:e,patch:e.diff(s,t)})(i))}else i=dF({_tag:"Add",fiberRef:e,value:t})(i);s.delete(e)}for(let[e]of s.entries())i=dF({_tag:dE,fiberRef:e})(i);return i},dF=M(2,(e,t)=>({_tag:dR,first:e,second:t})),dA=M(3,(e,t,s)=>{let i=s,n=s6(e);for(;sz(n);){let e=sB(n),s=sJ(n);switch(e._tag){case dO:n=s;break;case"Add":i=dS(i,{fiberId:t,fiberRef:e.fiberRef,value:e.value}),n=s;break;case dE:i=dy(i,e.fiberRef),n=s;break;case dC:{let r=dw(i,e.fiberRef);i=dS(i,{fiberId:t,fiberRef:e.fiberRef,value:e.fiberRef.patch(e.patch)(r)}),n=s;break}case dR:n=sF(e.first)(sF(e.second)(s))}}return i}),dN="effect/FiberStatus",dM=Symbol.for(dN),dj="Done",dz="Running",dP="Suspended",dD=eR(`${dN}-${dj}`);class dL{[ew](){return dD}[eN](e){return dq(e)&&e._tag===dj}constructor(){this[dM]=dM,this._tag=dj}}class d${constructor(e){this[dM]=dM,this._tag=dz,this.runtimeFlags=e}[ew](){return $(eS(dN),ek(eS(this._tag)),ek(eS(this.runtimeFlags)),eA(this))}[eN](e){return dq(e)&&e._tag===dz&&this.runtimeFlags===e.runtimeFlags}}class dU{constructor(e,t){this[dM]=dM,this._tag=dP,this.runtimeFlags=e,this.blockingOn=t}[ew](){return $(eS(dN),ek(eS(this._tag)),ek(eS(this.runtimeFlags)),ek(eS(this.blockingOn)),eA(this))}[eN](e){return dq(e)&&e._tag===dP&&this.runtimeFlags===e.runtimeFlags&&eM(this.blockingOn,e.blockingOn)}}let dB=new dL,dq=e=>ei(e,dM),dH=e=>new d$(e),dJ=(e,t)=>new dU(e,t),dW=e=>e._tag===dj,dK=(b=$(sm,sg(e=>e.ordinal)),M(2,(e,t)=>1===b(e,t))),dV=e=>{switch(e){case"All":return lV;case"Debug":return lZ;case"Error":return lY;case"Fatal":return lG;case"Info":return lQ;case"Trace":return l0;case"None":return l1;case"Warning":return lX}},dG=Symbol.for("effect/Micro"),dY=Symbol.for("effect/Micro/runSymbol"),dX=e=>"object"==typeof e&&null!==e&&dG in e,dQ={...ta,_op:"Micro",[dG]:{_A:j,_E:j,_R:j},[Symbol.iterator](){return new cM(new eg(this))}},dZ=function(){function e(){}return e.prototype=dQ,e}(),d0=Symbol.for("effect/Micro/MicroCause"),d1={_E:j};class d2 extends globalThis.Error{constructor(e,t,s){let i,n,r;let a=`MicroCause.${e}`;if(t instanceof globalThis.Error){i=`(${a}) ${t.name}`;let e=(n=t.message).split("\n").length;r=t.stack?`(${a}) ${t.stack.split("\n").slice(0,e+3).join("\n")}`:`${i}: ${n}`}else i=a,n=eq(t,0),r=`${i}: ${n}`;s.length>0&&(r+=`
    ${s.join("\n    ")}`),super(n),this._tag=e,this.traces=s,this[d0]=d1,this.name=i,this.stack=r}pipe(){return eY(this,arguments)}toString(){return this.stack}[eD](){return this.stack}}class d3 extends d2{constructor(e,t=[]){super("Fail",e,t),this.error=e}}let d5=(e,t=[])=>new d3(e,t);class d4 extends d2{constructor(e,t=[]){super("Die",e,t),this.defect=e}}let d6=(e,t=[])=>new d4(e,t);class d8 extends d2{constructor(e=[]){super("Interrupt","interrupted",e)}}let d7=(e=[])=>new d8(e),d9=e=>"Fail"===e._tag,fe=M(2,(e,t)=>{let s=[...e.traces,t];switch(e._tag){case"Die":return d6(e.defect,s);case"Interrupt":return d7(s);case"Fail":return d5(e.error,s)}}),ft=tK(d7()),fs=e=>tK(d5(e)),fi=e=>tK(d6(e)),fn={[Symbol.for("effect/Micro/Env")]:{_R:j},pipe(){return eY(this,arguments)}},fr=e=>{let t=Object.create(fn);return t.refs=e,t},fa=()=>{let e=new AbortController,t=Object.create(null);return t[fg.key]=e,t[fb.key]=e.signal,t[fw.key]=new fp,fr(t)},fo=M(2,(e,t)=>t.key in e.refs?e.refs[t.key]:t.initial),fc=M(3,(e,t,s)=>{let i=Object.assign(Object.create(null),e.refs);return i[t.key]=s,fr(i)}),fl=M(2,(e,t)=>fr(t(Object.assign(Object.create(null),e.refs)))),fu=e=>fO((t,s)=>s(tV(fo(t,e)))),fh="setImmediate"in globalThis?globalThis.setImmediate:e=>setTimeout(e,0);class fp{scheduleTask(e,t){this.tasks.push(e),this.running||(this.running=!0,fh(this.afterScheduled))}runTasks(){let e=this.tasks;this.tasks=[];for(let t=0,s=e.length;t<s;t++)e[t]()}shouldYield(e){return!1}flush(){for(;this.tasks.length>0;)this.runTasks()}constructor(){this.tasks=[],this.running=!1,this.afterScheduled=()=>{this.running=!1,this.runTasks()}}}let fd=Symbol.for("effect/Micro/EnvRef"),ff={...dQ,[fd]:fd,[dY](e,t){fu(this)[dY](e,t)}},fm=(e,t)=>H(e,()=>{let s=Object.create(ff);return s.key=e,s.initial=t(),s}),fg=fm("effect/Micro/currentAbortController",()=>void 0),fb=fm("effect/Micro/currentAbortSignal",()=>void 0),fx=fm("effect/Micro/currentContext",()=>tD()),fy=fm("effect/Micro/currentMaxDepthBeforeYield",()=>2048),fv=fm("effect/Micro/currentInterruptible",()=>!0),fw=fm("effect/Micro/currentScheduler",()=>new fp),fS=H("effect/Micro/microDepthState",()=>({depth:0,maxDepthBeforeYield:fy.initial})),f_=e=>{let t=Object.create(dQ);return t[dY]=e,t},fk=(e,t)=>f_(function s(i,n){if(t&&!1!==i.refs[fv.key]&&i.refs[fb.key].aborted)return n(ft);fS.depth++,1===fS.depth&&(fS.maxDepthBeforeYield=fo(i,fy));let r=i.refs[fw.key];if(fS.depth>=fS.maxDepthBeforeYield||r.shouldYield(i))r.scheduleTask(()=>s(i,n),0);else try{e(i,n)}catch(e){n(fi(e))}fS.depth--}),fO=e=>fk(e,!0),fE=e=>fO(function(t,s){s(e)}),fC=e=>fE(tV(e)),fR=e=>fE(fs(e)),fI=e=>fE(fi(e)),fT=e=>fE(tK(e)),fF=e=>fO(function(t,s){s(tV(e()))}),fA=e=>fO(function(t,s){s("Right"===e._tag?e:fs(e.left))}),fN=e=>fO(function(t,s){e()[dY](t,s)}),fM=fC(void 0),fj=e=>fO(function(t,s){let i,n=!1,r=e.length>1?new AbortController:void 0,a=fo(t,fb);function o(){i?c(fY(fU(i,fE(ft)))):c(fE(ft)),void 0!==r&&r.abort()}function c(e){n||(n=!0,a.removeEventListener("abort",o),e[dY](t,s))}i=void 0===r?e(c):e(c,r.signal),n||a.addEventListener("abort",o)}),fz=e=>fj(function(t,s){e(s).then(e=>t(fC(e)),e=>t(fI(e)))}),fP=e=>fj(function(t,s){try{e.try(s).then(e=>t(fC(e)),s=>t(fR(e.catch(s))))}catch(s){t(fR(e.catch(s)))}}),fD=(...e)=>fO(function(t,s){let i;let n=1===e.length?e[0]():e[1].call(e[0]),r=!1;!function e(){r=!0;try{let a=!0;for(;a;){let o=n.next(i);if(o.done)return s(tV(o.value));a=!1,eb(o.value)[dY](t,function(t){"Left"===t._tag?s(t):(a=!0,i=t.right,r||e())})}}catch(e){s(fi(e))}r=!1}()}),fL=M(2,(e,t)=>fO(function(s,i){e[dY](s,function(e){i("Left"===e._tag?e:tV(t(e.right)))})})),f$=M(2,(e,t)=>fO(function(s,i){e[dY](s,function(e){if("Left"===e._tag)return i(e);t(e.right)[dY](s,i)})})),fU=M(2,(e,t)=>fO(function(s,i){e[dY](s,function(e){if("Left"===e._tag)return i(e);if(fo(s,fb).aborted)return i(ft);let n=dX(t)?t:"function"==typeof t?t(e.right):t;dX(n)?n[dY](s,i):i(tV(n))})})),fB=e=>fL(e,e=>void 0),fq=e=>fO(function(t,s){e[dY](t,function(e){s(tV(e))})}),fH=M(2,(e,t)=>fJ(e,P,t)),fJ=M(3,(e,t,s)=>fO(function(i,n){e[dY](i,function(e){"Right"!==e._tag&&t(e.left)?s(e.left)[dY](i,n):n(e)})})),fW=M(2,(e,t)=>fH(e,e=>d9(e)?t(e.error):fT(e))),fK=M(2,(e,t)=>fW(e,e=>fF(t))),fV=function(){let e=globalThis.Error.stackTraceLimit;globalThis.Error.stackTraceLimit=2;let t=new globalThis.Error;globalThis.Error.stackTraceLimit=e;let s=e=>s=>fk(function(i,n){s[dY](i,function(s){n("Left"===s._tag?tK(function(e,s){let i=t.stack;if(!i)return s;let n=i.split("\n")[2]?.trim().replace(/^at /,"");if(!n)return s;let r=n.match(/\((.*)\)$/);return fe(s,`at ${e} (${r?r[1]:n})`)}(e,s.left)):s)})},!1);return 2==arguments.length?s(arguments[1])(arguments[0]):s(arguments[0])};class fG{constructor(){this.state={_tag:"Open",finalizers:new Set},this[null]=null}unsafeAddFinalizer(e){"Open"===this.state._tag&&this.state.finalizers.add(e)}addFinalizer(e){return fN(()=>"Open"===this.state._tag?(this.state.finalizers.add(e),fM):e(this.state.exit))}unsafeRemoveFinalizer(e){"Open"===this.state._tag&&this.state.finalizers.delete(e)}close(e){return fN(()=>{if("Open"===this.state._tag){let t=Array.from(this.state.finalizers).reverse();return this.state={_tag:"Closed",exit:e},f$(fX(t,t=>fq(t(e))),e=>fB(fE(Either.all(e))))}return fM})}get fork(){return fF(()=>{let e=new fG;if("Closed"===this.state._tag)return e.state=this.state,e;function t(t){return e.close(t)}return this.state.finalizers.add(t),e.unsafeAddFinalizer(e=>fF(()=>this.unsafeRemoveFinalizer(t))),e})}}let fY=e=>fk(function(t,s){let i=fl(t,function(e){return e[fv.key]=!1,e[fb.key]=new AbortController().signal,e});e[dY](i,s)},!1),fX=(e,t,s)=>fO(function(i,n){let r;let a=s?.concurrency==="inherit"?fo(i,null):s?.concurrency??1,o="unbounded"===a?Number.POSITIVE_INFINITY:Math.max(1,a),[c,l]=function(e){let t=new AbortController,s=fo(e,fb);function i(){t.abort(),s.removeEventListener("abort",i)}return s.addEventListener("abort",i),[fl(e,function(e){return e[fg.key]=t,e[fb.key]=t.signal,e}),i]}(i),u=Array.from(e),h=u.length;if(0===h)return n(Either.right(s?.discard?void 0:[]));let p=s?.discard?void 0:Array(h),d=0,f=0,m=0,g=!1;!function e(){for(g=!0;f<o&&d<h;){let s=d,i=u[s];d++,f++;try{t(i,s)[dY](c,function(t){"Left"===t._tag?void 0===r&&(r=t,h=d,l()):void 0!==p&&(p[s]=t.right),m++,f--,m===h?n(r??Either.right(p)):!g&&f<o&&e()})}catch(e){r=fi(e),h=d,l()}}g=!1}()}),fQ=function(){class e extends globalThis.Error{[dY](e,t){t(fs(this))}toString(){return this.message?`${this.name}: ${this.message}`:this.name}toJSON(){return{...this}}[eD](){let e=this.stack;return e?`${this.toString()}
${e.split("\n").slice(1).join("\n")}`:this.toString()}}return Object.assign(e.prototype,dQ,to),e}(),fZ=class extends fQ{constructor(e){super(),e&&Object.assign(this,e)}},f0=e=>{class t extends fZ{constructor(...t){super(...t),this._tag=e}}return t.prototype.name=e,t},f1=Symbol.for("effect/Readable"),f2=Symbol.for("effect/Ref"),f3={_A:e=>e};class f5 extends ds{static{i=f1}commit(){return this.get}constructor(e){super(),this[f2]=f3,this[i]=f1,this.ref=e,this.get=lT(()=>rA(this.ref))}modify(e){return lT(()=>{let t=rA(this.ref),[s,i]=e(t);return t!==i&&rN(i)(this.ref),s})}}let f4=e=>new f5(rT(e)),f6=e=>lT(()=>f4(e)),f8=e=>e.get,f7=M(2,(e,t)=>e.modify(()=>[void 0,t])),f9=M(2,(e,t)=>e.modify(e=>[e,t])),me=M(2,(e,t)=>e.modify(t)),mt=M(2,(e,t)=>e.modify(e=>[void 0,t(e)]));class ms{scheduleTask(e,t){let s;let i=this.buckets.length,n=0;for(;n<i;n++)if(this.buckets[n][0]<=t)s=this.buckets[n];else break;s&&s[0]===t?s[1].push(e):n===i?this.buckets.push([t,[e]]):this.buckets.splice(n,0,[t,[e]])}constructor(){this.buckets=[]}}class mi{constructor(e){this.running=!1,this.tasks=new ms,this.maxNextTickBeforeTimer=e}starveInternal(e){let t=this.tasks.buckets;for(let[e,s]of(this.tasks.buckets=[],t))for(let e=0;e<s.length;e++)s[e]();0===this.tasks.buckets.length?this.running=!1:this.starve(e)}starve(e=0){e>=this.maxNextTickBeforeTimer?setTimeout(()=>this.starveInternal(0),0):Promise.resolve(void 0).then(()=>this.starveInternal(e+1))}shouldYield(e){return e.currentOpCount>e.getFiberRef(ud)&&e.getFiberRef(up)}scheduleTask(e,t){this.tasks.scheduleTask(e,t),this.running||(this.running=!0,this.starve())}}let mn=H(Symbol.for("effect/Scheduler/defaultScheduler"),()=>new mi(2048));class mr{scheduleTask(e,t){this.deferred?mn.scheduleTask(e,t):this.tasks.scheduleTask(e,t)}shouldYield(e){return e.currentOpCount>e.getFiberRef(ud)&&e.getFiberRef(up)}flush(){for(;this.tasks.buckets.length>0;){let e=this.tasks.buckets;for(let[t,s]of(this.tasks.buckets=[],e))for(let e=0;e<s.length;e++)s[e]()}this.deferred=!0}constructor(){this.tasks=new ms,this.deferred=!1}}let ma=H(Symbol.for("effect/FiberRef/currentScheduler"),()=>ua(mn)),mo=(e,t)=>({_tag:"Par",left:e,right:t}),mc=(e,t)=>({_tag:"Seq",left:e,right:t}),ml=e=>{let t=aa(e),s=ar();for(;;){let[e,i]=au(t,[mb(),ar()],([e,t],s)=>{let[i,n]=mu(s);return[my(e,i),ao(t,n)]});if(s=mh(s,e),as(i))return ah(s);t=i}throw Error("BUG: BlockedRequests.flatten - please report an issue at https://github.com/Effect-TS/effect/issues")},mu=e=>{let t=e,s=mb(),i=ar(),n=ar();for(;;)switch(t._tag){case"Empty":if(as(i))return[s,n];t=i.head,i=i.tail;break;case"Par":i=an(t.right,i),t=t.left;break;case"Seq":{let e=t.left,s=t.right;switch(e._tag){case"Empty":t=s;break;case"Par":{let i=e.left,n=e.right;t=mo(mc(i,s),mc(n,s));break}case"Seq":t=mc(e.left,mc(e.right,s));break;case"Single":t=e,n=an(s,n)}break}case"Single":if(s=mx(s,t),as(i))return[s,n];t=i.head,i=i.tail}throw Error("BUG: BlockedRequests.step - please report an issue at https://github.com/Effect-TS/effect/issues")},mh=(e,t)=>{if(as(e))return aa(mS(t));if(mv(t))return e;let s=mR(e.head),i=mw(t);return 1===s.length&&1===i.length&&eM(s[0],i[0])?an(mC(e.head,mS(t)),e.tail):an(mS(t),e)},mp=Symbol.for("effect/RequestBlock/Entry"),md={_R:e=>e},mf=Symbol.for("effect/RequestBlock/RequestBlockParallel"),mm={_R:e=>e};class mg{constructor(e){this[mf]=mm,this.map=e}}let mb=()=>new mg(nZ()),mx=(e,t)=>new mg(re(e.map,t.dataSource,e=>t9(sn(e,iN(t.blockedRequest)),()=>ik(t.blockedRequest)))),my=(e,t)=>new mg(rr(e.map,t.map,(e,t,s)=>n5(e,s,t6(n1(e,s),{onNone:()=>t,onSome:e=>iD(t,e)})))),mv=e=>r3(e.map),mw=e=>Array.from(n6(e.map)),mS=e=>mE(ri(e.map,e=>ik(e))),m_=Symbol.for("effect/RequestBlock/RequestBlockSequential"),mk={_R:e=>e};class mO{constructor(e){this[m_]=mk,this.map=e}}let mE=e=>new mO(e),mC=(e,t)=>new mO(rr(t.map,e.map,(e,t,s)=>n5(e,s,t6(n1(e,s),{onNone:()=>iS(),onSome:e=>iD(e,t)})))),mR=e=>Array.from(n6(e.map)),mI=e=>Array.from(e.map),mT=H(Symbol.for("effect/FiberRef/currentRequestMap"),()=>ua(new Map)),mF=(e,t,s,i)=>{switch(e){case void 0:return t();case"unbounded":return s();case"inherit":return l6(ux,e=>"unbounded"===e?s():e>1?i(e):t());default:return e>1?i(e):t()}},mA=(e,t,s)=>{switch(e){case void 0:return t();case"unbounded":return s();case"inherit":return l6(ux,e=>"unbounded"===e||e>1?s():t());default:return e>1?s():t()}},mN=e=>{let t=ni(e);return p3(e=>e.sleep(t))},mM=(e,t)=>({label:e,startTime:t}),mj=e=>t=>{let s=t.label.replace(/[\s="]/g,"_");return`${s}=${e-t.startTime}ms`},mz=e=>({_tag:"ExternalSpan",spanId:e.spanId,traceId:e.traceId,sampled:e.sampled??!0,context:e.context??tD()}),mP="effect/MetricLabel",mD=Symbol.for(mP);class mL{constructor(e,t){this[mD]=mD,this.key=e,this.value=t,this._hash=eR(mP+this.key+this.value)}[ew](){return this._hash}[eN](e){return mU(e)&&this.key===e.key&&this.value===e.value}pipe(){return eY(this,arguments)}}let m$=(e,t)=>new mL(e,t),mU=e=>ei(e,mD),mB=M(e=>cJ(e[0]),function(){let e=arguments;return ur(e[0],uf,"string"==typeof e[1]?n5(e[1],e[2]):t=>Object.entries(e[1]).reduce((e,[t,s])=>n5(e,t,s),t))}),mq=e=>ly(e,tw),mH=e=>{let t,s;return"function"==typeof e?t=e:(t=e.try,s=e.catch),lT(()=>{try{return t()}catch(e){throw cP(oY(s?s(e):new uY(e)))}})},mJ=M(2,(e,t)=>lu(e,{onFailure:e=>{let s=t(e);switch(s._tag){case"None":return lt(e);case"Some":return s.value}},onSuccess:lR})),mW=M(3,(e,t,s)=>c1(e,en(t),s)),mK=M(2,(e,t)=>{let s;return c1(e,e=>(s??=Object.keys(t),ei(e,"_tag")&&J(e._tag)&&s.includes(e._tag)),e=>t[e._tag](e))}),mV=e=>go(e,m1,dT),mG=e=>go(e,lB(m1,lC),([e,t],[s,i])=>[dT(e,s),oz(t,i)]),mY=M(3,(e,t,s)=>lr(e,e=>ly(s(e),s=>Object.assign({},e,{[t]:s})))),mX=M(2,(e,t)=>ly(e,e=>({[t]:e}))),mQ=((e,t)=>lI(()=>{let s;let i=e[Symbol.iterator](),n=[],r=lR(!1),a=0;for(;(s=i.next())&&!s.done;){let e=s.value,i=a++;r=lr(r,s=>s?(n.push(e),lR(!0)):t(e,i))}return ly(r,()=>n)}),M(3,(e,t,s)=>lr(e,e=>t(e)?lR(e):s(e)))),mZ=M(2,(e,t)=>lh(e,{onFailure:e=>lR(t.onFailure(e)),onSuccess:e=>lR(t.onSuccess(e))})),m0=e=>{let t=lr(lr(e,()=>lU()),()=>t);return t},m1=cW(e=>lR(e.getFiberRefs())),m2=e=>(...t)=>{let s;let i=se(e);for(let e=0,i=t.length;e<i;e++){let i=t[e];o1(i)&&(s=void 0!==s?o0(s,i):i,t=[...t.slice(0,e),...t.slice(e+1)],e--)}return void 0===s&&(s=oG),cW(e=>(e.log(t,s,i),lz))},m3=m2(),m5=m2(lZ),m4=m2(lQ),m6=m2(lX),m8=m2(lY),m7=M(2,(e,t)=>lr(p5,s=>ur(e,ug,ac(mM(t,s))))),m9=M(2,(e,t)=>lu(e,{onFailure:e=>ls(()=>t(e)),onSuccess:lR})),ge=e=>ly(e,e=>!e),gt=e=>ly(f6(!0),t=>cG(lD(e,f9(t,!1)))),gs=e=>gd((t,s)=>$(e,dA(t,s))),gi=M(3,(e,t,s)=>hw(i=>hS(e,tA(i,t,s)))),gn=M(3,(e,t,s)=>hw(i=>lr(s,s=>hS(e,$(i,tA(t,s)))))),gr=M(3,(e,t,s)=>sC(e).reduce((e,t,i)=>lr(e,e=>s(e,t,i)),lR(t))),ga=lR(t4()),go=M(3,(e,t,s)=>lr(t,i=>lr(e,e=>ly(t,t=>[s(i,t),e])))),gc=M(2,(e,{onFailure:t,onSuccess:s})=>lu(e,{onFailure:e=>{let s=ce(e);switch(s._tag){case"Left":return lH(t(s.left),lt(e));case"Right":return lt(e)}},onSuccess:e=>cV(s(e),e)})),gl=M(2,(e,t)=>lu(e,{onFailure:e=>{let s=ce(e);switch(s._tag){case"Left":return lH(t(s.left),lt(e));case"Right":return lt(e)}},onSuccess:lR})),gu=M(2,(e,t)=>lu(e,{onFailure:e=>lH(t(e),lt(e)),onSuccess:lR})),gh=e=>{let t,s;return("function"==typeof e?t=e:(t=e.try,s=e.catch),t.length>=1)?cQ((e,i)=>{try{t(i).then(t=>e(hs(t)),t=>e(s?le(()=>s(t)):c9(new uY(t))))}catch(t){e(s?le(()=>s(t)):c9(new uY(t)))}}):cQ(e=>{try{t().then(t=>e(hs(t)),t=>e(s?le(()=>s(t)):c9(new uY(t))))}catch(t){e(s?le(()=>s(t)):c9(new uY(t)))}})},gp=M(2,(e,t)=>lr(e,e=>mH({try:()=>t.try(e),catch:t.catch}))),gd=e=>cW(t=>(t.setFiberRefs(e(t.id(),t.getFiberRefs())),lz)),gf=M(2,(e,t)=>lI(()=>t()?ly(e,tw):lR(t4()))),gm=BigInt(0),gg=(e,t,s)=>{if(!1===e.getFiberRef(uk))return hC(t);let i=e.getFiberRef(uh),n=e.getFiberRef(p1),r=tN(n,pG),a=tN(n,hI),o=e.getFiberRef(uO),c=e.getFiberRefs(),l=dv(c,uE),u=dv(c,uC),h=s.parent?tw(s.parent):s.root?t4():tM(i,pY),p="Some"===u._tag?void 0!==s.links?[...iC(u.value),...s.links??[]]:iC(u.value):s.links??s4(),d=r.span(t,h,s.context??tD(),p,o?a.unsafeCurrentTimeNanos():gm,s.kind??"internal");return"function"==typeof s.captureStackTrace&&ck.set(d,s.captureStackTrace),"Some"===l._tag&&rn(l.value,(e,t)=>d.attribute(t,e)),void 0!==s.attributes&&Object.entries(s.attributes).forEach(([e,t])=>d.attribute(e,t)),d},gb=(e,t,s,i)=>lT(()=>{"Ended"!==e.status._tag&&(uQ(t)&&ck.has(e)&&e.attribute("code.stacktrace",ck.get(e)()),e.end(i?s.unsafeCurrentTimeNanos():gm,t))}),gx=M(2,(e,t)=>gi(e,pY,t)),gy=e=>$(e,u6(j)),gv="InterruptSignal",gw="Stateful",gS="Resume",g_="YieldNow",gk=e=>({_tag:gv,cause:e}),gO=e=>({_tag:gw,onFiber:e}),gE=e=>({_tag:gS,effect:e}),gC=()=>({_tag:g_}),gR=Symbol.for("effect/FiberScope");class gI{add(e,t){this.roots.add(t),t.addObserver(()=>{this.roots.delete(t)})}constructor(){this[gR]=gR,this.fiberId=rQ,this.roots=new Set}}class gT{constructor(e,t){this[gR]=gR,this.fiberId=e,this.parent=t}add(e,t){this.parent.tell(gO(e=>{e.addChild(t),t.addObserver(()=>{e.removeChild(t)})}))}}let gF=e=>new gT(e.id(),e),gA=H(Symbol.for("effect/FiberScope/Global"),()=>new gI),gN=Symbol.for("effect/Fiber"),gM={_E:e=>e,_A:e=>e},gj={[gN]:gM,pipe(){return eY(this,arguments)}},gz=Symbol.for("effect/Fiber"),gP=e=>e.await,gD=((e,t)=>e.interruptAsFork(t),e=>lq(lc(e.await),e.inheritAll)),gL=((e,t)=>gL(e,e=>lT(()=>t(e))),M(2,(e,t)=>({...tc,commit(){return gD(this)},...gj,id:()=>e.id(),await:lr(e.await,u8(t)),children:e.children,inheritAll:e.inheritAll,poll:lr(e.poll,e=>{switch(e._tag){case"None":return lR(t4());case"Some":return $(u8(e.value,t),ly(tw))}}),interruptAsFork:t=>e.interruptAsFork(t)})));(e,t)=>({...tc,commit(){return gD(this)},...gj,id:()=>rK(e.id(),t.id()),await:lJ(e.await,t.await,(e,t)=>uZ(e)?e:t),children:e.children,inheritAll:lH(t.inheritAll,e.inheritAll),poll:lJ(e.poll,t.poll,(e,t)=>{switch(e._tag){case"None":return t4();case"Some":return uZ(e.value)?e:t}}),interruptAsFork:s=>$(lK(e,s),lH($(t,lK(s))),cG)});let g$="effect/FiberCurrent",gU=Symbol.for("effect/Logger"),gB={_Message:e=>e,_Output:e=>e},gq=e=>({[gU]:gB,log:e,pipe(){return eY(this,arguments)}}),gH=M(2,(e,t)=>gq(s=>e.log({...s,message:t(s.message)}))),gJ=M(2,(e,t)=>gq(s=>e.log(t(s)))),gW=M(2,(e,t)=>gq(s=>t(s.logLevel)?tw(e.log(s)):t4())),gK=M(2,(e,t)=>gq(s=>t(e.log(s)))),gV=e=>({[gU]:gB,log:({message:t})=>e(t),pipe(){return eY(this,arguments)}}),gG=M(2,(e,t)=>gq(s=>[e.log(s),t.log(s)])),gY=M(2,(e,t)=>gK(gG(e,t),e=>e[0])),gX=M(2,(e,t)=>gK(gG(e,t),e=>e[1])),gQ=gq(({annotations:e,cause:t,date:s,fiberId:i,logLevel:n,message:r,spans:a})=>{let o=s.getTime(),c=`timestamp=${s.toISOString()} level=${n.label} fiber=${rY(i)}`,l=sR(r);for(let e=0;e<l.length;e++){let t=eq(l[e]);t.length>0&&(c+=" message=",c=g1(t,c))}if(null!=t&&"Empty"!==t._tag&&(c+=" cause=",c=g1(cy(t,{renderErrorCause:!0}),c)),ai(a)){c+=" ";let e=!0;for(let t of a)e?e=!1:c+=" ",c+=$(t,mj(o))}if(n8(e)>0){c+=" ";let t=!0;for(let[s,i]of e)t?t=!1:c+=" ",c+=g6(s),c+="=",c=g1(eq(i),c)}return c}),gZ=e=>`"${e.replace(/\\([\s\S])|(")/g,"\\$1$2")}"`,g0=/^[^\s"=]+$/,g1=(e,t)=>t+(e.match(g0)?e:gZ(e)),g2=gq(({annotations:e,cause:t,date:s,fiberId:i,logLevel:n,message:r,spans:a})=>{let o=s.getTime(),c=`timestamp=${s.toISOString()} level=${n.label} fiber=${rY(i)}`,l=sR(r);for(let e=0;e<l.length;e++){let t=eq(l[e],0);t.length>0&&(c+=" message=",c=g7(t,c))}if(null!=t&&"Empty"!==t._tag&&(c+=" cause=",c=g7(cy(t,{renderErrorCause:!0}),c)),ai(a)){c+=" ";let e=!0;for(let t of a)e?e=!1:c+=" ",c+=$(t,g9(o))}if(n8(e)>0){c+=" ";let t=!0;for(let[s,i]of e)t?t=!1:c+=" ",c+=g6(s),c+="=",c=g7(eq(i,0),c)}return c}),g3=gq(({annotations:e,cause:t,date:s,fiberId:i,logLevel:n,message:r,spans:a})=>{let o=s.getTime(),c={},l={};if(n8(e)>0)for(let[t,s]of e)c[t]=g5(s);if(ai(a))for(let e of a)l[e.label]=o-e.startTime;let u=sR(r);return{message:1===u.length?g5(u[0]):u.map(g5),logLevel:n.label,timestamp:s.toISOString(),cause:o3(t)?void 0:cy(t,{renderErrorCause:!0}),annotations:c,spans:l,fiberId:rY(i)}}),g5=e=>{switch(typeof e){case"bigint":case"function":case"symbol":return String(e);default:return eL(e)}},g4=gK(g3,eH),g6=e=>e.replace(/[\s="]/g,"_"),g8=e=>JSON.stringify(e),g7=(e,t)=>t+(e.match(g0)?e:g8(e)),g9=e=>t=>{let s=g6(t.label);return`${s}=${e-t.startTime}ms`},be=(e,...t)=>{let s="";for(let e=0;e<t.length;e++)s+=`\x1b[${t[e]}m`;return s+e+"\x1b[0m"},bt=(e,...t)=>e,bs={bold:"1",red:"31",green:"32",yellow:"33",blue:"34",cyan:"36",white:"37",gray:"90",black:"30",bgBrightRed:"101"},bi={None:[],All:[],Trace:[bs.gray],Debug:[bs.blue],Info:[bs.green],Warning:[bs.yellow],Error:[bs.red],Fatal:[bs.bgBrightRed,bs.black]},bn={None:"",All:"",Trace:"color:gray",Debug:"color:blue",Info:"color:green",Warning:"color:orange",Error:"color:red",Fatal:"background-color:red;color:white"},br=e=>`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}.${e.getMilliseconds().toString().padStart(3,"0")}`,ba="object"==typeof process&&null!==process&&"object"==typeof process.stdout&&null!==process.stdout,bo=ba&&!0===process.stdout.isTTY,bc=ba||"Deno"in globalThis,bl=e=>{let t=e?.mode??"auto",s="browser"===("auto"===t?bc?"tty":"browser":t),i="boolean"==typeof e?.colors?e.colors:bo||s,n=e?.formatDate??br;return s?bh({colors:i,formatDate:n}):bu({colors:i,formatDate:n,stderr:e?.stderr===!0})},bu=e=>{let t="object"==typeof process&&"isBun"in process&&!0===process.isBun,s=e.colors&&bo?be:bt;return gq(({annotations:i,cause:n,context:r,date:a,fiberId:o,logLevel:c,message:l,spans:u})=>{let h=tN(dw(r,p1),pU).unsafe,p=!0===e.stderr?h.error:h.log,d=sR(l),f=s(`[${e.formatDate(a)}]`,bs.white)+` ${s(c.label,...bi[c._tag])}`+` (${rY(o)})`;if(ai(u)){let e=g9(a.getTime());for(let t of u)f+=" "+e(t)}f+=":";let m=0;if(d.length>0){let e=g5(d[0]);"string"==typeof e&&(f+=" "+s(e,bs.bold,bs.cyan),m++)}if(p(f),t||h.group(),o3(n)||p(cy(n,{renderErrorCause:!0})),m<d.length)for(;m<d.length;m++)p(eG(d[m]));if(n8(i)>0)for(let[e,t]of i)p(s(`${e}:`,bs.bold,bs.white),eG(t));t||h.groupEnd()})},bh=e=>{let t=e.colors?"%c":"";return gq(({annotations:s,cause:i,context:n,date:r,fiberId:a,logLevel:o,message:c,spans:l})=>{let u=tN(dw(n,p1),pU).unsafe,h=sR(c),p=`${t}[${e.formatDate(r)}]`,d=[];if(e.colors&&d.push("color:gray"),p+=` ${t}${o.label}${t} (${rY(a)})`,e.colors&&d.push(bn[o._tag],""),ai(l)){let e=g9(r.getTime());for(let t of l)p+=" "+e(t)}p+=":";let f=0;if(h.length>0){let s=g5(h[0]);"string"==typeof s&&(p+=` ${t}${s}`,e.colors&&d.push("color:deepskyblue"),f++)}if(u.groupCollapsed(p,...d),o3(i)||u.error(cy(i,{renderErrorCause:!0})),f<h.length)for(;f<h.length;f++)u.log(eG(h[f]));if(n8(s)>0)for(let[t,i]of s){let s=eG(i);e.colors?u.log(`%c${t}:`,"color:gray",s):u.log(`${t}:`,s)}u.groupEnd()})},bp=H("effect/Logger/prettyLoggerDefault",()=>bl()),bd=Symbol.for("effect/MetricKeyType"),bf="effect/MetricKeyType/Counter",bm=Symbol.for(bf),bg=Symbol.for("effect/MetricKeyType/Frequency"),bb=Symbol.for("effect/MetricKeyType/Gauge"),bx="effect/MetricKeyType/Histogram",by=Symbol.for(bx),bv=Symbol.for("effect/MetricKeyType/Summary"),bw={_In:e=>e,_Out:e=>e};class bS{constructor(e,t){this[bd]=bw,this[bm]=bm,this.incremental=e,this.bigint=t,this._hash=eR(bf)}[ew](){return this._hash}[eN](e){return bO(e)}pipe(){return eY(this,arguments)}}class b_{constructor(e){this[bd]=bw,this[by]=by,this.boundaries=e,this._hash=$(eR(bx),ek(eS(this.boundaries)))}[ew](){return this._hash}[eN](e){return bR(e)&&eM(this.boundaries,e.boundaries)}pipe(){return eY(this,arguments)}}let bk=e=>new bS(e?.incremental??!1,e?.bigint??!1),bO=e=>ei(e,bm),bE=e=>ei(e,bg),bC=e=>ei(e,bb),bR=e=>ei(e,by),bI=e=>ei(e,bv),bT=Symbol.for("effect/MetricKey"),bF={_Type:e=>e},bA=t3(eM);class bN{constructor(e,t,s,i=[]){this[bT]=bF,this.name=e,this.keyType=t,this.description=s,this.tags=i,this._hash=$(eR(this.name+this.description),ek(eS(this.keyType)),ek(eF(this.tags)))}[ew](){return this._hash}[eN](e){return bM(e)&&this.name===e.name&&eM(this.keyType,e.keyType)&&eM(this.description,e.description)&&bA(this.tags,e.tags)}pipe(){return eY(this,arguments)}}let bM=e=>ei(e,bT),bj=(e,t)=>new bN(e,bk(t),se(t?.description)),bz=M(2,(e,t)=>0===t.length?e:new bN(e.name,e.keyType,e.description,s5(e.tags,t))),bP=Symbol.for("effect/MutableHashMap"),bD={[bP]:bP,[Symbol.iterator](){return new bL(this)},toString(){return e$(this.toJSON())},toJSON(){return{_id:"MutableHashMap",values:Array.from(this).map(eL)}},[eD](){return this.toJSON()},pipe(){return eY(this,arguments)}};class bL{constructor(e){this.self=e,this.referentialIterator=e.referential[Symbol.iterator]()}next(){if(void 0!==this.bucketIterator)return this.bucketIterator.next();let e=this.referentialIterator.next();return e.done?(this.bucketIterator=new b$(this.self.buckets.values()),this.next()):e}[Symbol.iterator](){return new bL(this.self)}}class b${constructor(e){this.backing=e}next(){if(void 0===this.currentBucket){let e=this.backing.next();if(e.done)return e;this.currentBucket=e.value[Symbol.iterator]()}let e=this.currentBucket.next();return e.done?(this.currentBucket=void 0,this.next()):e}}let bU=()=>{let e=Object.create(bD);return e.referential=new Map,e.buckets=new Map,e.bucketsSize=0,e},bB=M(2,(e,t)=>{if(!1===ez(t))return e.referential.has(t)?tw(e.referential.get(t)):t4();let s=t[ew](),i=e.buckets.get(s);return void 0===i?t4():bq(e,i,t)}),bq=(e,t,s,i=!1)=>{for(let n=0,r=t.length;n<r;n++)if(s[eN](t[n][0])){let s=t[n][1];return i&&(t.splice(n,1),e.bucketsSize--),tw(s)}return t4()},bH=M(2,(e,t)=>ty(bB(e,t))),bJ=M(3,(e,t,s)=>{if(!1===ez(t))return e.referential.set(t,s),e;let i=t[ew](),n=e.buckets.get(i);return void 0===n?e.buckets.set(i,[[t,s]]):(bW(e,n,t),n.push([t,s])),e.bucketsSize++,e}),bW=(e,t,s)=>{for(let i=0,n=t.length;i<n;i++)if(s[eN](t[i][0])){t.splice(i,1),e.bucketsSize--;return}},bK=M(2,(e,t)=>{if(!1===ez(t))return e.referential.delete(t),e;let s=t[ew](),i=e.buckets.get(s);return void 0===i||(bW(e,i,t),0===i.length&&e.buckets.delete(s)),e}),bV=e=>e.referential.size+e.bucketsSize,bG=Symbol.for("effect/MetricState"),bY="effect/MetricState/Counter",bX=Symbol.for(bY),bQ="effect/MetricState/Frequency",bZ=Symbol.for(bQ),b0="effect/MetricState/Gauge",b1=Symbol.for(b0),b2="effect/MetricState/Histogram",b3=Symbol.for(b2),b5="effect/MetricState/Summary",b4=Symbol.for(b5),b6={_A:e=>e};class b8{constructor(e){this[bG]=b6,this[bX]=bX,this.count=e}[ew](){return $(eS(bY),ek(eS(this.count)),eA(this))}[eN](e){return xc(e)&&this.count===e.count}pipe(){return eY(this,arguments)}}let b7=t3(eM);class b9{constructor(e){this[bG]=b6,this[bZ]=bZ,this.occurrences=e}[ew](){return $(eR(bQ),ek(eF(sC(this.occurrences.entries()))),eA(this))}[eN](e){return xl(e)&&b7(sC(this.occurrences.entries()),sC(e.occurrences.entries()))}pipe(){return eY(this,arguments)}}class xe{constructor(e){this[bG]=b6,this[b1]=b1,this.value=e}[ew](){return $(eS(b0),ek(eS(this.value)),eA(this))}[eN](e){return xu(e)&&this.value===e.value}pipe(){return eY(this,arguments)}}class xt{constructor(e,t,s,i,n){this[bG]=b6,this[b3]=b3,this.buckets=e,this.count=t,this.min=s,this.max=i,this.sum=n}[ew](){return $(eS(b2),ek(eS(this.buckets)),ek(eS(this.count)),ek(eS(this.min)),ek(eS(this.max)),ek(eS(this.sum)),eA(this))}[eN](e){return xh(e)&&eM(this.buckets,e.buckets)&&this.count===e.count&&this.min===e.min&&this.max===e.max&&this.sum===e.sum}pipe(){return eY(this,arguments)}}class xs{constructor(e,t,s,i,n,r){this[bG]=b6,this[b4]=b4,this.error=e,this.quantiles=t,this.count=s,this.min=i,this.max=n,this.sum=r}[ew](){return $(eS(b5),ek(eS(this.error)),ek(eS(this.quantiles)),ek(eS(this.count)),ek(eS(this.min)),ek(eS(this.max)),ek(eS(this.sum)),eA(this))}[eN](e){return xp(e)&&this.error===e.error&&eM(this.quantiles,e.quantiles)&&this.count===e.count&&this.min===e.min&&this.max===e.max&&this.sum===e.sum}pipe(){return eY(this,arguments)}}let xi=e=>new b8(e),xn=e=>new b9(e),xr=e=>new xe(e),xa=e=>new xt(e.buckets,e.count,e.min,e.max,e.sum),xo=e=>new xs(e.error,e.quantiles,e.count,e.min,e.max,e.sum),xc=e=>ei(e,bX),xl=e=>ei(e,bZ),xu=e=>ei(e,b1),xh=e=>ei(e,b3),xp=e=>ei(e,b4),xd=Symbol.for("effect/MetricHook"),xf={_In:e=>e,_Out:e=>e},xm=e=>({[xd]:xf,pipe(){return eY(this,arguments)},...e}),xg=BigInt(0),xb=e=>{let t=e.keyType.bigint?xg:0,s=e.keyType.incremental?e.keyType.bigint?e=>e>=xg:e=>e>=0:e=>!0,i=e=>{s(e)&&(t+=e)};return xm({get:()=>xi(t),update:i,modify:i})},xx=e=>{let t=new Map;for(let s of e.keyType.preregisteredWords)t.set(s,0);let s=e=>{let s=t.get(e)??0;t.set(e,s+1)};return xm({get:()=>xn(t),update:s,modify:s})},xy=(e,t)=>{let s=t;return xm({get:()=>xr(s),update:e=>{s=e},modify:e=>{s+=e}})},xv=e=>{let t=e.keyType.boundaries.values,s=t.length,i=new Uint32Array(s+1),n=new Float32Array(s),r=0,a=0,o=Number.MAX_VALUE,c=Number.MIN_VALUE;$(t,sY(sm),s8((e,t)=>{n[t]=e}));let l=e=>{let t=0,l=s;for(;t!==l;){let s=Math.floor(t+(l-t)/2);e<=n[s]?l=s:t=s,l===t+1&&(e<=n[t]?l=t:t=l)}i[t]=i[t]+1,r+=1,a+=e,e<o&&(o=e),e>c&&(c=e)},u=()=>{let e=sO(s),t=0;for(let r=0;r<s;r++){let s=n[r];t+=i[r],e[r]=[s,t]}return e};return xm({get:()=>xa({buckets:u(),count:r,min:o,max:c,sum:a}),update:l,modify:l})},xw=e=>{let{error:t,maxAge:s,maxSize:i,quantiles:n}=e.keyType,r=$(n,sY(sm)),a=sO(i),o=0,c=0,l=0,u=Number.MAX_VALUE,h=Number.MIN_VALUE,p=e=>{let n=[],o=0;for(;o!==i-1;){let t=a[o];if(null!=t){let[i,r]=t,a=nd(e-i);nR(a,nu)&&a<=s&&n.push(r)}o+=1}return xS(t,r,sY(n,sm))},d=(e,t)=>{i>0&&(a[(o+=1)%i]=[t,e]),c+=1,l+=e,e<u&&(u=e),e>h&&(h=e)};return xm({get:()=>xo({error:t,quantiles:p(Date.now()),count:c,min:u,max:h,sum:l}),update:([e,t])=>d(e,t),modify:([e,t])=>d(e,t)})},xS=(e,t,s)=>{let i=s.length;if(!sz(t))return s4();let n=t[0],r=t.slice(1),a=x_(e,i,t4(),0,n,s),o=s6(a);return r.forEach(t=>{o.push(x_(e,i,a.value,a.consumed,t,a.rest))}),s8(o,e=>[e.quantile,e.value])},x_=(e,t,s,i,n,r)=>{let a=e,o=t,c=s,l=i,u=n,h=r,p=e,d=t,f=s,m=i,g=n,b=r;for(;;){if(!sz(h))return{quantile:u,value:t4(),consumed:l,rest:[]};if(1===u)return{quantile:u,value:tw(sH(h)),consumed:l+h.length,rest:[]};let e=sK(h,e=>e<=h[0]),t=u*o,s=a/2*t,i=l+e[0].length,n=Math.abs(i-t);if(i<t-s){p=a,d=o,f=sU(h),m=i,g=u,b=e[1],a=p,o=d,c=f,l=m,u=g,h=b;continue}if(i>t+s)return{quantile:u,value:c,consumed:l,rest:h};switch(c._tag){case"None":p=a,d=o,f=sU(h),m=i,g=u,b=e[1],a=p,o=d,c=f,l=m,u=g,h=b;continue;case"Some":if(n<Math.abs(t-c.value)){p=a,d=o,f=sU(h),m=i,g=u,b=e[1],a=p,o=d,c=f,l=m,u=g,h=b;continue}return{quantile:u,value:tw(c.value),consumed:l,rest:h}}}throw Error("BUG: MetricHook.resolveQuantiles - please report an issue at https://github.com/Effect-TS/effect/issues")},xk=Symbol.for("effect/MetricPair"),xO={_Type:e=>e},xE=(e,t)=>({[xk]:xO,metricKey:e,metricState:t,pipe(){return eY(this,arguments)}}),xC=Symbol.for("effect/MetricRegistry");class xR{snapshot(){let e=[];for(let[t,s]of this.map)e.push(xE(t,s.get()));return e}get(e){let t=$(this.map,bB(e),st);if(null!=t)return t;if(bO(e.keyType))return this.getCounter(e);if(bC(e.keyType))return this.getGauge(e);if(bE(e.keyType))return this.getFrequency(e);if(bR(e.keyType))return this.getHistogram(e);if(bI(e.keyType))return this.getSummary(e);throw Error("BUG: MetricRegistry.get - unknown MetricKeyType - please report an issue at https://github.com/Effect-TS/effect/issues")}getCounter(e){let t=$(this.map,bB(e),st);if(null==t){let s=xb(e);$(this.map,bH(e))||$(this.map,bJ(e,s)),t=s}return t}getFrequency(e){let t=$(this.map,bB(e),st);if(null==t){let s=xx(e);$(this.map,bH(e))||$(this.map,bJ(e,s)),t=s}return t}getGauge(e){let t=$(this.map,bB(e),st);if(null==t){let s=xy(e,e.keyType.bigint?BigInt(0):0);$(this.map,bH(e))||$(this.map,bJ(e,s)),t=s}return t}getHistogram(e){let t=$(this.map,bB(e),st);if(null==t){let s=xv(e);$(this.map,bH(e))||$(this.map,bJ(e,s)),t=s}return t}getSummary(e){let t=$(this.map,bB(e),st);if(null==t){let s=xw(e);$(this.map,bH(e))||$(this.map,bJ(e,s)),t=s}return t}constructor(){this[xC]=xC,this.map=bU()}}let xI=()=>new xR,xT=Symbol.for("effect/Metric"),xF={_Type:e=>e,_In:e=>e,_Out:e=>e},xA=H(Symbol.for("effect/Metric/globalMetricRegistry"),()=>xI()),xN=function(e,t,s,i){let n=Object.assign(e=>lF(e,e=>xD(n,e)),{[xT]:xF,keyType:e,unsafeUpdate:t,unsafeValue:s,unsafeModify:i,register(){return this.unsafeValue([]),this},pipe(){return eY(this,arguments)}});return n},xM=(e,t)=>xj(bj(e,t)),xj=e=>{let t;let s=new WeakMap,i=i=>{if(0===i.length)return void 0!==t?t:t=xA.get(e);let n=s.get(i);return void 0!==n||(n=xA.get(bz(e,i)),s.set(i,n)),n};return xN(e.keyType,(e,t)=>i(t).update(e),e=>i(e).get(),(e,t)=>i(t).modify(e))},xz=M(3,(e,t,s)=>xP(e,[m$(t,s)])),xP=M(2,(e,t)=>xN(e.keyType,(s,i)=>e.unsafeUpdate(s,s5(t,i)),s=>e.unsafeValue(s5(t,s)),(s,i)=>e.unsafeModify(s,s5(t,i)))),xD=M(2,(e,t)=>l6(uw,s=>lT(()=>e.unsafeUpdate(t,s)))),xL="effect/MetricBoundaries",x$=Symbol.for(xL);class xU{constructor(e){this[x$]=x$,this.values=e,this._hash=$(eR(xL),ek(eF(this.values)))}[ew](){return this._hash}[eN](e){return xB(e)&&eM(this.values,e.values)}pipe(){return eY(this,arguments)}}let xB=e=>ei(e,x$),xq=e=>new xU($(e,sN(ik(Number.POSITIVE_INFINITY)),ih)),xH=M(2,(e,t)=>l6(mT,s=>lT(()=>{if(s.has(e)){let i=s.get(e);i.state.completed||(i.state.completed=!0,hb(i.result,t))}})));class xJ{addObserver(e){this.observers.add(e)}removeObserver(e){this.observers.delete(e)}increment(){this.count++,this.observers.forEach(e=>e(this.count))}decrement(){this.count--,this.observers.forEach(e=>e(this.count))}constructor(){this.count=0,this.observers=new Set,this.interrupted=!1}}let xW=Symbol.for("effect/Supervisor"),xK={_T:e=>e};class xV{constructor(e,t){this[xW]=xK,this.underlying=e,this.value0=t}get value(){return this.value0}onStart(e,t,s,i){this.underlying.onStart(e,t,s,i)}onEnd(e,t){this.underlying.onEnd(e,t)}onEffect(e,t){this.underlying.onEffect(e,t)}onSuspend(e){this.underlying.onSuspend(e)}onResume(e){this.underlying.onResume(e)}map(e){return new xV(this,$(this.value,ly(e)))}zip(e){return new xG(this,e)}}class xG{constructor(e,t){this._tag="Zip",this[xW]=xK,this.left=e,this.right=t}get value(){return lB(this.left.value,this.right.value)}onStart(e,t,s,i){this.left.onStart(e,t,s,i),this.right.onStart(e,t,s,i)}onEnd(e,t){this.left.onEnd(e,t),this.right.onEnd(e,t)}onEffect(e,t){this.left.onEffect(e,t),this.right.onEffect(e,t)}onSuspend(e){this.left.onSuspend(e),this.right.onSuspend(e)}onResume(e){this.left.onResume(e),this.right.onResume(e)}map(e){return new xV(this,$(this.value,ly(e)))}zip(e){return new xG(this,e)}}let xY=e=>ei(e,xW)&&en(e,"Zip");class xX{get value(){return lT(()=>Array.from(this.fibers))}onStart(e,t,s,i){this.fibers.add(i)}onEnd(e,t){this.fibers.delete(t)}onEffect(e,t){}onSuspend(e){}onResume(e){}map(e){return new xV(this,$(this.value,ly(e)))}zip(e){return new xG(this,e)}onRun(e,t){return e()}constructor(){this[xW]=xK,this.fibers=new Set}}class xQ{constructor(e){this[xW]=xK,this.effect=e}get value(){return this.effect}onStart(e,t,s,i){}onEnd(e,t){}onEffect(e,t){}onSuspend(e){}onResume(e){}map(e){return new xV(this,$(this.value,ly(e)))}zip(e){return new xG(this,e)}onRun(e,t){return e()}}let xZ=lT(()=>new xX),x0=e=>new xQ(e),x1=H("effect/Supervisor/none",()=>x0(lz)),x2="Empty",x3="AddSupervisor",x5="RemoveSupervisor",x4="AndThen",x6={_tag:x2},x8=(e,t)=>({_tag:x4,first:e,second:t}),x7=(e,t)=>{let s=e,i=t;for(;iJ(i);){let e=iK(i);switch(e._tag){case x2:i=iQ(i);break;case x3:s=s.zip(e.supervisor),i=iQ(i);break;case x5:s=x9(s,e.supervisor),i=iQ(i);break;case x4:i=iM(e.first)(iM(e.second)(iQ(i)))}}return s},x9=(e,t)=>eM(e,t)?x1:xY(e)?x9(e.left,t).zip(x9(e.right,t)):e,ye=e=>eM(e,x1)?rp():xY(e)?$(ye(e.left),rS(ye(e.right))):rE(e),yt=of({empty:x6,patch:(e,t)=>x7(t,ik(e)),combine:x8,diff:(e,t)=>{if(eM(e,t))return x6;let s=ye(e),i=ye(t),n=$(i,rw(s),rk(x6,(e,t)=>x8(e,{_tag:x3,supervisor:t}))),r=$(s,rw(i),rk(x6,(e,t)=>x8(e,{_tag:x5,supervisor:t})));return x8(n,r)}}),ys=xM("effect_fiber_started",{incremental:!0}),yi=xM("effect_fiber_active"),yn=xM("effect_fiber_successes",{incremental:!0}),yr=xM("effect_fiber_failures",{incremental:!0}),ya=xz(xj(new bN("effect_fiber_lifetimes",new b_((e=>$(sE(e.count-1,t=>e.start*Math.pow(e.factor,t)),iT,xq))({start:.5,factor:2,count:35})),se(x))),"time_unit","milliseconds"),yo="Continue",yc="Yield",yl={_E:e=>e,_A:e=>e},yu=e=>{throw Error(`BUG: FiberRuntime - ${eq(e)} - please report an issue at https://github.com/Effect-TS/effect/issues`)},yh=Symbol.for("effect/internal/fiberRuntime/YieldedOp"),yp=H("effect/internal/fiberRuntime/yieldedOpChannel",()=>({currentOp:null})),yd={[e1]:(e,t,s)=>ey(()=>t.effect_instruction_i1(s)),OnStep:(e,t,s)=>hs(hs(s)),[e2]:(e,t,s)=>ey(()=>t.effect_instruction_i2(s)),[te]:(e,t,s)=>(e.patchRuntimeFlags(e.currentRuntimeFlags,t.patch),oI(e.currentRuntimeFlags)&&e.isInterrupted())?u4(e.getInterruptedCause()):hs(s),[e6]:(e,t,s)=>(ey(()=>t.effect_instruction_i2(s)),ey(()=>t.effect_instruction_i0()))?(e.pushStack(t),ey(()=>t.effect_instruction_i1())):lz,[e8]:(e,t,s)=>{let i=ey(()=>t.effect_instruction_i0.next(s));return i.done?hs(i.value):(e.pushStack(t),eb(i.value))}},yf={[gv]:(e,t,s,i)=>(e.processNewInterruptSignal(i.cause),oI(t)?u4(i.cause):s),[gS]:(e,t,s,i)=>{throw Error("It is illegal to have multiple concurrent run loops in a single fiber")},[gw]:(e,t,s,i)=>(i.onFiber(e,dH(t)),s),[g_]:(e,t,s,i)=>lr(lU(),()=>s)},ym=e=>ld(ml(e),e=>yj(mI(e),([e,t])=>{let s=new Map,i=[];for(let e of t)for(let t of(i.push(iC(e)),e))s.set(t.request,t);let n=i.flat();return un(vr(e.runAll(i),n,()=>n.forEach(e=>{e.listeners.interrupted=!0})),mT,s)},!1,!1));class yg extends ds{static{n=gN,r=gz}constructor(e,t,s){if(super(),this[n]=gM,this[r]=yl,this._queue=[],this._children=null,this._observers=[],this._running=!1,this._stack=[],this._asyncInterruptor=null,this._asyncBlockingOn=null,this._exitValue=null,this._steps=[],this._isYielding=!1,this.currentOpCount=0,this.run=()=>{this.drainQueueOnCurrentThread()},this.currentRuntimeFlags=s,this._fiberId=e,this._fiberRefs=t,oM(s)){let e=this.getFiberRef(uw);ys.unsafeUpdate(1,e),yi.unsafeUpdate(1,e)}this.refreshRefCache()}commit(){return gD(this)}id(){return this._fiberId}resume(e){this.tell(gE(e))}get status(){return this.ask((e,t)=>t)}get runtimeFlags(){return this.ask((e,t)=>dW(t)?e.currentRuntimeFlags:t.runtimeFlags)}scope(){return gF(this)}get children(){return this.ask(e=>Array.from(e.getChildren()))}getChildren(){return null===this._children&&(this._children=new Set),this._children}getInterruptedCause(){return this.getFiberRef(u_)}fiberRefs(){return this.ask(e=>e.getFiberRefs())}ask(e){return lI(()=>{let t=hc(this._fiberId);return this.tell(gO((s,i)=>{hb(t,lT(()=>e(s,i)))})),hh(t)})}tell(e){this._queue.push(e),this._running||(this._running=!0,this.drainQueueLaterOnExecutor())}get await(){return cQ(e=>{let t=t=>e(lR(t));return this.tell(gO((e,s)=>{null!==e._exitValue?t(this._exitValue):e.addObserver(t)})),lT(()=>this.tell(gO((e,s)=>{e.removeObserver(t)})))},this.id())}get inheritAll(){return cW((e,t)=>{let s=e.id(),i=e.getFiberRefs(),n=t.runtimeFlags,r=dg(i,s,this.getFiberRefs());return e.setFiberRefs(r),lP($(oz(n,e.getFiberRef(y7)),ok(1),ok(16)))})}get poll(){return lT(()=>se(this._exitValue))}unsafePoll(){return this._exitValue}interruptAsFork(e){return lT(()=>this.tell(gk(oQ(e))))}unsafeInterruptAsFork(e){this.tell(gk(oQ(e)))}addObserver(e){null!==this._exitValue?e(this._exitValue):this._observers.push(e)}removeObserver(e){this._observers=this._observers.filter(t=>t!==e)}getFiberRefs(){return this.setFiberRef(y7,this.currentRuntimeFlags),this._fiberRefs}unsafeDeleteFiberRef(e){this._fiberRefs=dy(this._fiberRefs,e)}getFiberRef(e){return this._fiberRefs.locals.has(e)?this._fiberRefs.locals.get(e)[0][1]:e.initial}setFiberRef(e,t){this._fiberRefs=dS(this._fiberRefs,{fiberId:this._fiberId,fiberRef:e,value:t}),this.refreshRefCache()}refreshRefCache(){this.currentDefaultServices=this.getFiberRef(p1),this.currentTracer=this.currentDefaultServices.unsafeMap.get(pG.key),this.currentSupervisor=this.getFiberRef(y9),this.currentScheduler=this.getFiberRef(ma),this.currentContext=this.getFiberRef(uh),this.currentSpan=this.currentContext.unsafeMap.get(pY.key)}setFiberRefs(e){this._fiberRefs=e,this.refreshRefCache()}addChild(e){this.getChildren().add(e)}removeChild(e){this.getChildren().delete(e)}drainQueueOnCurrentThread(){let e=!0;for(;e;){let t=yo,s=globalThis[g$];globalThis[g$]=this;try{for(;t===yo;)t=0===this._queue.length?"Done":this.evaluateMessageWhileSuspended(this._queue.splice(0,1)[0])}finally{this._running=!1,globalThis[g$]=s}this._queue.length>0&&!this._running?(this._running=!0,t===yc?(this.drainQueueLaterOnExecutor(),e=!1):e=!0):e=!1}}drainQueueLaterOnExecutor(){this.currentScheduler.scheduleTask(this.run,this.getFiberRef(up))}drainQueueWhileRunning(e,t){let s=t;for(;this._queue.length>0;){let t=this._queue.splice(0,1)[0];s=yf[t._tag](this,e,s,t)}return s}isInterrupted(){return!o3(this.getFiberRef(u_))}addInterruptedCause(e){let t=this.getFiberRef(u_);this.setFiberRef(u_,o0(t,e))}processNewInterruptSignal(e){this.addInterruptedCause(e),this.sendInterruptSignalToAllChildren()}sendInterruptSignalToAllChildren(){if(null===this._children||0===this._children.size)return!1;let e=!1;for(let t of this._children)t.tell(gk(oQ(this.id()))),e=!0;return e}interruptAllChildren(){if(this.sendInterruptSignalToAllChildren()){let e=this._children.values();this._children=null;let t=!1;return lL({while:()=>!t,body:()=>{let s=e.next();return s.done?lT(()=>{t=!0}):cG(s.value.await)},step:()=>{}})}return null}reportExitValue(e){if(oM(this.currentRuntimeFlags)){let t=this.getFiberRef(uw),s=this.id().startTimeMillis,i=Date.now();switch(ya.unsafeUpdate(i-s,t),yi.unsafeUpdate(-1,t),e._tag){case e3:yn.unsafeUpdate(1,t);break;case eZ:yr.unsafeUpdate(1,t)}}if("Failure"===e._tag){let t=this.getFiberRef(uv);o4(e.cause)||"Some"!==t._tag||this.log("Fiber terminated with an unhandled error",e.cause,t)}}setExitValue(e){this._exitValue=e,this.reportExitValue(e);for(let t=this._observers.length-1;t>=0;t--)this._observers[t](e)}getLoggers(){return this.getFiberRef(yO)}log(e,t,s){let i=ty(s)?s.value:this.getFiberRef(um);if(dK(this.getFiberRef(yb),i))return;let n=this.getFiberRef(ug),r=this.getFiberRef(uf),a=this.getLoggers(),o=this.getFiberRefs();if(rC(a)>0){let s=new Date(tN(this.getFiberRef(p1),hI).unsafeCurrentTimeMillis());eV(o,()=>{for(let c of a)c.log({fiberId:this.id(),logLevel:i,message:e,cause:t,context:o,spans:n,annotations:r,date:s})})}}evaluateMessageWhileSuspended(e){switch(e._tag){case g_:return yc;case gv:return this.processNewInterruptSignal(e.cause),null!==this._asyncInterruptor&&(this._asyncInterruptor(u4(e.cause)),this._asyncInterruptor=null),yo;case gS:return this._asyncInterruptor=null,this._asyncBlockingOn=null,this.evaluateEffect(e.effect),yo;case gw:return e.onFiber(this,null!==this._exitValue?dB:dJ(this.currentRuntimeFlags,this._asyncBlockingOn)),yo;default:return yu(e)}}evaluateEffect(e){this.currentSupervisor.onResume(this);try{let t=oI(this.currentRuntimeFlags)&&this.isInterrupted()?u4(this.getInterruptedCause()):e;for(;null!==t;){let e=t,s=this.runLoop(e);if(s===yh){let e=yp.currentOp;yp.currentOp=null,e._op===e9?oC(this.currentRuntimeFlags)?(this.tell(gC()),this.tell(gE(hi)),t=null):t=hi:e._op===eX&&(t=null)}else{this.currentRuntimeFlags=$(this.currentRuntimeFlags,oR(16));let e=this.interruptAllChildren();null!==e?t=lr(e,()=>s):(0===this._queue.length?this.setExitValue(s):this.tell(gE(s)),t=null)}}}finally{this.currentSupervisor.onSuspend(this)}}start(e){if(this._running)this.tell(gE(e));else{this._running=!0;let t=globalThis[g$];globalThis[g$]=this;try{this.evaluateEffect(e)}finally{this._running=!1,globalThis[g$]=t,this._queue.length>0&&this.drainQueueLaterOnExecutor()}}}startFork(e){this.tell(gE(e))}patchRuntimeFlags(e,t){let s=oP(e,t);return globalThis[g$]=this,this.currentRuntimeFlags=s,s}initiateAsync(e,t){let s=!1,i=e=>{s||(s=!0,this.tell(gE(e)))};oI(e)&&(this._asyncInterruptor=i);try{t(i)}catch(e){i(lt(oX(e)))}}pushStack(e){this._stack.push(e),"OnStep"===e._op&&this._steps.push({refs:this.getFiberRefs(),flags:this.currentRuntimeFlags})}popStack(){let e=this._stack.pop();if(e)return"OnStep"===e._op&&this._steps.pop(),e}getNextSuccessCont(){let e=this.popStack();for(;e;){if(e._op!==e0)return e;e=this.popStack()}}getNextFailCont(){let e=this.popStack();for(;e;){if(e._op!==e1&&e._op!==e6&&e._op!==e8)return e;e=this.popStack()}}Tag(e){return lT(()=>tN(this.currentContext,e))}Left(e){return c9(e.left)}None(e){return c9(new uJ)}Right(e){return hs(e.right)}Some(e){return hs(e.value)}Micro(e){return cX(t=>{let s=fa().pipe(fc(fx,this.getFiberRef(uh))),i=t;return e[dY](s,e=>{if("Right"===e._tag)return i(hs(e.right));switch(e.left._tag){case"Interrupt":return i(u4(oQ(rQ)));case"Fail":return i(c9(e.left.error));case"Die":return i(c4(e.left.defect))}}),cQ(e=>{i=t=>{e(lz)},fo(s,fg).abort()})})}[e5](e){let t=ey(()=>e.effect_instruction_i0()),s=this.getNextSuccessCont();return void 0!==s?(s._op in yd||yu(s),yd[s._op](this,s,t)):(yp.currentOp=hs(t),yh)}[e3](e){let t=this.getNextSuccessCont();return void 0!==t?(t._op in yd||yu(t),yd[t._op](this,t,e.effect_instruction_i0)):(yp.currentOp=e,yh)}[eZ](e){let t=e.effect_instruction_i0,s=this.getNextFailCont();if(void 0===s)return yp.currentOp=u4(t),yh;switch(s._op){case e0:case e2:if(!(oI(this.currentRuntimeFlags)&&this.isInterrupted()))return ey(()=>s.effect_instruction_i1(t));return u4(ci(t));case"OnStep":if(!(oI(this.currentRuntimeFlags)&&this.isInterrupted()))return hs(u4(t));return u4(ci(t));case te:if(this.patchRuntimeFlags(this.currentRuntimeFlags,s.patch),oI(this.currentRuntimeFlags)&&this.isInterrupted())return u4(o0(t,this.getInterruptedCause()));return u4(t);default:yu(s)}}[e7](e){return ey(()=>e.effect_instruction_i0(this,dH(this.currentRuntimeFlags)))}Blocked(e){let t=this.getFiberRefs(),s=this.currentRuntimeFlags;if(this._steps.length>0){let i=[],n=this._steps[this._steps.length-1],r=this.popStack();for(;r&&"OnStep"!==r._op;)i.push(r),r=this.popStack();this.setFiberRefs(n.refs),this.currentRuntimeFlags=n.flags;let a=dT(n.refs,t),o=oz(n.flags,s);return hs(cD(e.effect_instruction_i0,cW(t=>{for(;i.length>0;)t.pushStack(i.pop());return t.setFiberRefs(dA(t.id(),t.getFiberRefs())(a)),t.currentRuntimeFlags=oP(o)(t.currentRuntimeFlags),e.effect_instruction_i1})))}return lj(t=>lr(yP(cL(e.effect_instruction_i0)),()=>t(e.effect_instruction_i1)))}RunBlocked(e){return ym(e.effect_instruction_i0)}[e4](e){let t=e.effect_instruction_i0,s=this.currentRuntimeFlags,i=oP(s,t);if(oI(i)&&this.isInterrupted())return u4(this.getInterruptedCause());if(this.patchRuntimeFlags(this.currentRuntimeFlags,t),!e.effect_instruction_i1)return hi;{let t=oz(i,s);return this.pushStack(new cU(t,e)),ey(()=>e.effect_instruction_i1(s))}}[e1](e){return this.pushStack(e),e.effect_instruction_i0}OnStep(e){return this.pushStack(e),e.effect_instruction_i0}[e0](e){return this.pushStack(e),e.effect_instruction_i0}[e2](e){return this.pushStack(e),e.effect_instruction_i0}[eX](e){return this._asyncBlockingOn=e.effect_instruction_i1,this.initiateAsync(this.currentRuntimeFlags,e.effect_instruction_i0),yp.currentOp=e,yh}[e9](e){return this._isYielding=!1,yp.currentOp=e,yh}[e6](e){let t=e.effect_instruction_i0,s=e.effect_instruction_i1;return t()?(this.pushStack(e),s()):hi}[e8](e){return yd[e8](this,e,void 0)}[eQ](e){return ey(()=>e.commit())}runLoop(e){let t=e;for(this.currentOpCount=0;;){if((2&this.currentRuntimeFlags)!=0&&this.currentSupervisor.onEffect(this,t),this._queue.length>0&&(t=this.drainQueueWhileRunning(this.currentRuntimeFlags,t)),!this._isYielding){this.currentOpCount+=1;let e=this.currentScheduler.shouldYield(this);if(!1!==e){this._isYielding=!0,this.currentOpCount=0;let s=t;t=lr(lU({priority:e}),()=>s)}}try{if((t=this.currentTracer.context(()=>U()!==t[c$]._V?c6(`Cannot execute an Effect versioned ${t[c$]._V} with a Runtime of version ${U()}`):this[t._op](t),this))===yh){let e=yp.currentOp;if(e._op===e9||e._op===eX)return yh;return yp.currentOp=null,e._op===e3||e._op===eZ?e:u4(oX(e))}}catch(e){t=(t===yh||ei(t,"_op"))&&t._op in this?cz(e)?u4(e.cause):uU(e)?u4(o0(oX(e),oQ(rQ))):c4(e):c6(`Not a valid effect: ${eq(t)}`)}}}}let yb=H("effect/FiberRef/currentMinimumLogLevel",()=>ua(dV("Info"))),yx=e=>gq(t=>{tN(dw(t.context,p1),pU).unsafe.log(e.log(t))}),yy=H(Symbol.for("effect/Logger/defaultLogger"),()=>yx(gQ)),yv=H(Symbol.for("effect/Logger/jsonLogger"),()=>yx(g4)),yw=H(Symbol.for("effect/Logger/logFmtLogger"),()=>yx(g2)),yS=H(Symbol.for("effect/Logger/prettyLogger"),()=>bp),y_=H(Symbol.for("effect/Logger/structuredLogger"),()=>yx(g3)),yk=H(Symbol.for("effect/Logger/tracerLogger"),()=>gq(({annotations:e,cause:t,context:s,fiberId:i,logLevel:n,message:r})=>{let a=tM(dw(s,uh),pY);if("None"===a._tag||"ExternalSpan"===a.value._tag)return;let o=tN(dw(s,p1),hI),c={};for(let[t,s]of e)c[t]=s;c["effect.fiberId"]=rY(i),c["effect.logLevel"]=n.label,null!==t&&"Empty"!==t._tag&&(c["effect.cause"]=cy(t,{renderErrorCause:!0})),a.value.event(eq(Array.isArray(r)?r[0]:r),o.unsafeCurrentTimeNanos(),c)})),yO=H(Symbol.for("effect/FiberRef/currentLoggers"),()=>uo(rE(yy,yk))),yE=M(3,(e,t,s)=>lr(yZ,i=>{let n=[],r=lI(()=>{if(0===n.length)return lz;let e=n;return n=[],s(e)});return lj(s=>$(mN(t),lH(r),m0,s,yP,lr(e=>uT(i,lW(e))),lH(yR(()=>r)),cV(gq(t=>{n.push(e.log(t))}))))})),yC=M(e=>cJ(e[0]),(e,t)=>lM(lF(e,e=>yR(s=>t(e,s))))),yR=e=>cW(t=>{let s=t.getFiberRefs(),i=t.currentRuntimeFlags;return lr(yZ,t=>uF(t,t=>cW(n=>{let r=n.getFiberRefs(),a=n.currentRuntimeFlags,o=dT(r,s),c=oz(a,i),l=dT(s,r);return n.setFiberRefs(dA(o,n.id(),s)),vn(l$(e(t),c),lT(()=>{n.setFiberRefs(dA(l,n.id(),n.getFiberRefs()))}))})))}),yI=(e=>ec(e[0])&&!cJ(e[0]),e=>{if(Array.isArray(e)||ec(e))return[e,t4()];let t=Object.keys(e),s=t.length;return[t.map(t=>e[t]),tw(e=>{let i={};for(let n=0;n<s;n++)i[t[n]]=e[n];return i})]}),yT=(e,t,s)=>{let i=[];for(let t of e)i.push(c8(t));return lr(yN(i,j,{concurrency:s?.concurrency,batching:s?.batching}),e=>{let i=t4(),n=e.length,r=Array(n),a=Array(n),o=!1;for(let t=0;t<n;t++){let s=e[t];"Left"===s._tag?(r[t]=tw(s.left),o=!0):(a[t]=s.right,r[t]=i)}return o?"Some"===t._tag?c9(t.value(r)):c9(r):s?.discard?lz:"Some"===t._tag?lR(t.value(a)):lR(a)})},yF=(e,t,s)=>{let i=[];for(let t of e)i.push(c8(t));return s?.discard?yN(i,j,{concurrency:s?.concurrency,batching:s?.batching,discard:!0}):ly(yN(i,j,{concurrency:s?.concurrency,batching:s?.batching}),e=>"Some"===t._tag?t.value(e):e)},yA=(e,t)=>{let[s,i]=yI(e);return t?.mode==="validate"?yT(s,i,t):t?.mode==="either"?yF(s,i,t):t?.discard!==!0&&"Some"===i._tag?ly(yN(s,j,t),i.value):yN(s,j,t)},yN=((e,t)=>Array.from({length:t},()=>e),M(e=>ec(e[0]),(e,t,s)=>cW(i=>{let n=s?.batching===!0||s?.batching==="inherit"&&i.getFiberRef(uy);return s?.discard?mF(s.concurrency,()=>yH(da,s?.concurrentFinalizers)(s=>n?yj(e,(e,i)=>s(t(e,i)),!0,!1,1):ld(e,(e,i)=>s(t(e,i)))),()=>yH(du,s?.concurrentFinalizers)(s=>yj(e,(e,i)=>s(t(e,i)),n,!1)),i=>yH(dh(i),s?.concurrentFinalizers)(s=>yj(e,(e,i)=>s(t(e,i)),n,!1,i))):mF(s?.concurrency,()=>yH(da,s?.concurrentFinalizers)(s=>n?yz(e,1,(e,i)=>s(t(e,i)),!0):lp(e,(e,i)=>s(t(e,i)))),()=>yH(du,s?.concurrentFinalizers)(s=>yM(e,(e,i)=>s(t(e,i)),n)),i=>yH(dh(i),s?.concurrentFinalizers)(s=>yz(e,i,(e,i)=>s(t(e,i)),n)))}))),yM=(e,t,s)=>lI(()=>{let i=sC(e),n=Array(i.length);return lH(yj(i,(e,s)=>lr(t(e,s),e=>lT(()=>n[s]=e)),s,!1),lR(n))}),yj=(e,t,s,i,n)=>lj(r=>lA(a=>cW(o=>{let c=Array.from(e).reverse(),l=c.length;if(0===l)return lz;let u=0,h=!1,p=n?Math.min(c.length,n):c.length,d=new Set,f=[],m=()=>d.forEach(e=>{e.currentScheduler.scheduleTask(()=>{e.unsafeInterruptAsFork(o.id())},0)}),g=[],b=[],x=[],y=()=>{let e=f.filter(({exit:e})=>"Failure"===e._tag).sort((e,t)=>e.index<t.index?-1:e.index===t.index?0:1).map(({exit:e})=>e);return 0===e.length&&e.push(hi),e},v=(e,t=!1)=>{let s=lM(a(e)),i=yL(s,o,o.currentRuntimeFlags,gA);return o.currentScheduler.scheduleTask(()=>{t&&i.unsafeInterruptAsFork(o.id()),i.resume(s)},0),i},w=()=>{i||(l-=c.length,c=[]),h=!0,m()},S=s?lo:c7,_=v(cQ(e=>{let i=(e,t)=>{"Blocked"===e._op?x.push(e):(f.push({index:t,exit:e}),"Failure"!==e._op||h||w())},a=()=>{if(c.length>0){let p=c.pop(),m=u++,w=()=>{let e=c.pop();return m=u++,lr(lU(),()=>lr(S(r(t(e,m))),_))},_=e=>c.length>0&&(i(e,m),c.length>0)?w():lR(e),k=v(lr(S(r(t(p,m))),_));g.push(k),d.add(k),h&&k.currentScheduler.scheduleTask(()=>{k.unsafeInterruptAsFork(o.id())},0),k.addObserver(t=>{let r;r="Failure"===t._op?t:t.effect_instruction_i0,b.push(k),d.delete(k),i(r,m),f.length===l?e(lR(t8(u2(y(),{parallel:!0}),()=>hi))):x.length+f.length===l?e(lR(cD(x.map(e=>e.effect_instruction_i0).reduce(mo),yj([t8(u2(y(),{parallel:!0}),()=>hi),...x.map(e=>e.effect_instruction_i1)],e=>e,s,!0,n)))):a()})}};for(let e=0;e<p;e++)a()}));return cG(lS(lc(r(gD(_))),he({onFailure:()=>{w();let e=x.length+1,t=Math.min("number"==typeof n?n:x.length,x.length),s=Array.from(x);return cQ(i=>{let n=[],r=0,a=0,o=(t,a)=>o=>{n[t]=o,++r===e&&i(si(u2(n,{parallel:!0}))),s.length>0&&a&&c()},c=()=>{v(s.pop(),!0).addObserver(o(a,!0)),a++};_.addObserver(o(a,!1)),a++;for(let e=0;e<t;e++)c()})},onSuccess:()=>lp(b,e=>e.inheritAll)})))}))),yz=(e,t,s,i)=>lI(()=>{let n=sC(e),r=Array(n.length);return lH(yj(n,(e,t)=>ly(s(e,t),e=>r[t]=e),i,!1,t),lR(r))}),yP=e=>yU(e,gA),yD=(e,t,s,i=null)=>{let n=y$(e,t,s,i);return n.resume(e),n},yL=(e,t,s,i=null)=>y$(e,t,s,i),y$=(e,t,s,i=null)=>{let n=r1(),r=db(t.getFiberRefs(),n),a=new yg(n,r,s),o=dw(r,uh),c=a.currentSupervisor;return c.onStart(o,e,tw(t),a),a.addObserver(e=>c.onEnd(e,a)),(null!==i?i:$(t.getFiberRef(uS),t8(()=>t.scope()))).add(s,a),a},yU=(e,t)=>cW((s,i)=>lR(yD(e,s,i.runtimeFlags,t))),yB=(e=>Y(e[2]),e=>hw(t=>t6(tM(t,yQ),{onNone:()=>e,onSome:t=>{switch(t.strategy._tag){case"Parallel":return e;case"Sequential":case"ParallelN":return lr(uN(t,du),t=>y5(e,t))}}}))),yq=e=>t=>hw(s=>t6(tM(s,yQ),{onNone:()=>t,onSome:s=>"ParallelN"===s.strategy._tag&&s.strategy.parallelism===e?t:lr(uN(s,dh(e)),e=>y5(t,e))})),yH=(e,t)=>s=>hw(i=>t6(tM(i,yQ),{onNone:()=>s(j),onSome:i=>{if(!0!==t)return s(j);{let t="Parallel"===e._tag?yB:"Sequential"===e._tag?yW:yq(e.parallelism);switch(i.strategy._tag){case"Parallel":return t(s(yB));case"Sequential":return t(s(yW));case"ParallelN":return t(s(yq(i.strategy.parallelism)))}}}})),yJ=e=>lr(yQ,e),yW=e=>hw(t=>t6(tM(t,yQ),{onNone:()=>e,onSome:t=>{switch(t.strategy._tag){case"Sequential":return e;case"Parallel":case"ParallelN":return lr(uN(t,da),t=>y5(e,t))}}})),yK=(e=>cJ(e[1]),e=>y8(p1,tA(pu,e))),yV=M(e=>cJ(e[1]),(e,t,s)=>yX(e,t,(e,t)=>[e,t],s)),yG=M(e=>cJ(e[1]),(e,t,s)=>s?.concurrent!==!0&&(s?.batching===void 0||!1===s.batching)?lq(e,t):yX(e,t,(e,t)=>e,s)),yY=M(e=>cJ(e[1]),(e,t,s)=>s?.concurrent!==!0&&(s?.batching===void 0||!1===s.batching)?lH(e,t):yX(e,t,(e,t)=>t,s)),yX=M(e=>cJ(e[1]),(e,t,s,i)=>ly(yA([e,t],{concurrency:i?.concurrent?2:1,batching:i?.batching,concurrentFinalizers:i?.concurrentFinalizers}),([e,t])=>s(e,t))),yQ=tz("effect/Scope"),yZ=yQ,y0=(e,t)=>{"Open"===e.state._tag&&e.state.finalizers.add(t)},y1={[uR]:uR,[uI]:uI,pipe(){return eY(this,arguments)},fork(e){return lT(()=>{let t=y2(e);if("Closed"===this.state._tag)return t.state=this.state,t;let s=e=>t.close(e);return this.state.finalizers.add(s),y0(t,e=>lT(()=>{"Open"===this.state._tag&&this.state.finalizers.delete(s)})),t})},close(e){return lI(()=>{if("Closed"===this.state._tag)return lz;let t=Array.from(this.state.finalizers.values()).reverse();return(this.state={_tag:"Closed",exit:e},0===t.length)?lz:dc(this.strategy)?$(lp(t,t=>c7(t(e))),lr(e=>$(u2(e),sn(u1),t8(()=>hi)))):dl(this.strategy)?$(yM(t,t=>c7(t(e)),!1),lr(e=>$(u2(e,{parallel:!0}),sn(u1),t8(()=>hi)))):$(yz(t,this.strategy.parallelism,t=>c7(t(e)),!1),lr(e=>$(u2(e,{parallel:!0}),sn(u1),t8(()=>hi))))})},addFinalizer(e){return lI(()=>"Closed"===this.state._tag?e(this.state.exit):(this.state.finalizers.add(e),lz))}},y2=(e=da)=>{let t=Object.create(y1);return t.strategy=e,t.state={_tag:"Open",finalizers:new Set},t},y3=(e=da)=>lT(()=>y2(e)),y5=M(2,(e,t)=>hk(e,tj(tF(yQ,t)))),y4=M(2,(e,t)=>$(e,y5(t),lS(e=>t.close(e)))),y6=M(2,(e,t)=>cG(yC(lr(l4(e),s=>cV(l8(e,t),s)),t=>l8(e,t)))),y8=M(2,(e,t)=>l6(e,s=>y6(e,t(s)))),y7=uu(oN,{differ:oD,fork:oD.empty}),y9=uu(x1,{differ:yt,fork:x6}),ve=M(3,(e,t,s)=>vs(e,t,{onSelfWin:(e,t)=>lr(e.await,i=>{switch(i._tag){case e3:return lr(e.inheritAll,()=>s.onSelfDone(i,t));case eZ:return s.onSelfDone(i,t)}}),onOtherWin:(e,t)=>lr(e.await,i=>{switch(i._tag){case e3:return lr(e.inheritAll,()=>s.onOtherDone(i,t));case eZ:return s.onOtherDone(i,t)}})})),vt=M(2,(e,t)=>ln(s=>ve(e,t,{onSelfDone:(e,t)=>ht(e,{onFailure:e=>$(gD(t),m9(t=>oZ(e,t))),onSuccess:e=>$(t,lK(s),cV(e))}),onOtherDone:(e,t)=>ht(e,{onFailure:e=>$(gD(t),m9(t=>oZ(t,e))),onSuccess:e=>$(t,lK(s),cV(e))})}))),vs=M(3,(e,t,s)=>cW((i,n)=>{let r=n.runtimeFlags,a=rT(!0),o=y$(e,i,r,s.selfScope),c=y$(t,i,r,s.otherScope);return cQ(i=>{o.addObserver(()=>vi(o,c,s.onSelfWin,a,i)),c.addObserver(()=>vi(c,o,s.onOtherWin,a,i)),o.startFork(e),c.startFork(t)},rW(o.id(),c.id()))})),vi=(e,t,s,i,n)=>{rF(!0,!1)(i)&&n(s(e,t))},vn=M(2,(e,t)=>lj(s=>lu(s(e),{onFailure:e=>lu(t,{onFailure:t=>lt(o0(e,t)),onSuccess:()=>lt(e)}),onSuccess:e=>cV(t,e)}))),vr=(e,t,s)=>ln(i=>lr(lr(yP(lb(e)),e=>cQ(i=>{let n=t.map(e=>e.listeners.count),r=()=>{n.every(e=>0===e)&&t.every(e=>"Pending"===e.result.state.current._tag||!!("Done"===e.result.state.current._tag&&uX(e.result.state.current.effect)&&"Failure"===e.result.state.current.effect._tag&&o5(e.result.state.current.effect.cause)))&&(a.forEach(e=>e()),s?.(),i(lW(e)))};e.addObserver(e=>{a.forEach(e=>e()),i(e)});let a=t.map((e,t)=>{let s=e=>{n[t]=e,r()};return e.listeners.addObserver(s),()=>e.listeners.removeObserver(s)});return r(),lT(()=>{a.forEach(e=>e())})})),()=>lI(()=>ld(t.flatMap(e=>e.state.completed?[]:[e]),e=>xH(e.request,u7(i))))));class va{constructor(e,t=!1){this.s=e,this.stripped=t,this.index=0,this.length=e.length}next(){if(this.done)return{done:!0,value:void 0};let e=this.index;for(;!this.done&&!vo(this.s[this.index]);)this.index=this.index+1;let t=this.index;if(!this.done){let e=this.s[this.index];this.index=this.index+1,!this.done&&vc(e,this.s[this.index])&&(this.index=this.index+1),this.stripped||(t=this.index)}return{done:!1,value:this.s.substring(e,t)}}[Symbol.iterator](){return new va(this.s,this.stripped)}get done(){return this.index>=this.length}}let vo=e=>{let t=e.charCodeAt(0);return 13===t||10===t},vc=(e,t)=>13===e.charCodeAt(0)&&10===t.charCodeAt(0),vl=((e,t)=>vu(e.minutes,t.minutes)&&vu(e.hours,t.hours)&&vu(e.days,t.days)&&vu(e.months,t.months)&&vu(e.weekdays,t.weekdays),t3((e,t)=>e===t)),vu=(e,t)=>vl(sC(e),sC(t)),vh=Symbol.for("effect/ScheduleInterval"),vp={[vh]:vh,startMillis:0,endMillis:0},vd=(e,t)=>e>t?vp:{[vh]:vh,startMillis:e,endMillis:t},vf=M(2,(e,t)=>vm(e,t)===e),vm=M(2,(e,t)=>e.endMillis<=t.startMillis?e:t.endMillis<=e.startMillis?t:e.startMillis<t.startMillis?e:t.startMillis<e.startMillis?t:e.endMillis<=t.endMillis?e:t),vg=M(2,(e,t)=>vd(Math.max(e.startMillis,t.startMillis),Math.min(e.endMillis,t.endMillis))),vb=e=>e.startMillis>=e.endMillis,vx=e=>nd(e.endMillis-e.startMillis),vy=e=>vd(e,Number.POSITIVE_INFINITY),vv=Symbol.for("effect/ScheduleIntervals"),vw=e=>({[vv]:vv,intervals:e}),vS=M(2,(e,t)=>iJ(t.intervals)?iJ(e.intervals)?iK(e.intervals).startMillis<iK(t.intervals).startMillis?v_(iQ(e.intervals),t.intervals,iK(e.intervals),iS()):v_(e.intervals,iQ(t.intervals),iK(t.intervals),iS()):t:e),v_=(e,t,s,i)=>{let n=e,r=t,a=s,o=i;for(;iJ(n)||iJ(r);)if(!iJ(n)&&iJ(r))a.endMillis<iK(r).startMillis?(o=$(o,iM(a)),a=iK(r)):a=vd(a.startMillis,iK(r).endMillis),r=iQ(r),n=iS();else if(iJ(n)&&iH(r))a.endMillis<iK(n).startMillis?(o=$(o,iM(a)),a=iK(n)):a=vd(a.startMillis,iK(n).endMillis),r=iS(),n=iQ(n);else if(iJ(n)&&iJ(r))iK(n).startMillis<iK(r).startMillis?(a.endMillis<iK(n).startMillis?(o=$(o,iM(a)),a=iK(n)):a=vd(a.startMillis,iK(n).endMillis),n=iQ(n)):(a.endMillis<iK(r).startMillis?(o=$(o,iM(a)),a=iK(r)):a=vd(a.startMillis,iK(r).endMillis),r=iQ(r));else throw Error(eh("Intervals.unionLoop"));return vw($(o,iM(a),iR))},vk=M(2,(e,t)=>vO(e.intervals,t.intervals,iS())),vO=(e,t,s)=>{let i=e,n=t,r=s;for(;iJ(i)&&iJ(n);){let e=$(iK(i),vg(iK(n))),t=vb(e)?r:$(r,iM(e));$(iK(i),vf(iK(n)))?i=iQ(i):n=iQ(n),r=t}return vw(iR(r))},vE=e=>$(e.intervals,iW,t8(()=>vp)).startMillis,vC=M(2,(e,t)=>vE(e)<vE(t)),vR=((e,t)=>vC(e,t)?t:e,e=>$(e.intervals,iW,t8(()=>vp)).endMillis),vI=e=>iJ(e.intervals),vT="Continue",vF="Done",vA=e=>({_tag:vT,intervals:e}),vN=e=>({_tag:vT,intervals:vw(ik(e))}),vM={_tag:vF},vj=e=>e._tag===vT,vz=e=>e._tag===vF,vP=Symbol.for("effect/Schedule"),vD=e=>ei(e,vP),vL=Symbol.for("effect/ScheduleDriver"),v$={_Out:e=>e,_In:e=>e,_R:e=>e},vU={_Out:e=>e,_In:e=>e,_R:e=>e};class vB{constructor(e,t){this[vP]=v$,this.initial=e,this.step=t}pipe(){return eY(this,arguments)}}class vq{constructor(e,t){this[vL]=vU,this.schedule=e,this.ref=t}get state(){return ly(f8(this.ref),e=>e[1])}get last(){return lr(f8(this.ref),([e,t])=>{switch(e._tag){case"None":return le(()=>new uJ);case"Some":return lR(e.value)}})}get reset(){return f7(this.ref,[t4(),this.schedule.initial])}next(e){return $(ly(f8(this.ref),e=>e[1]),lr(t=>$(p5,lr(s=>$(lI(()=>this.schedule.step(s,e,t)),lr(([e,t,i])=>{let n=f7(this.ref,[tw(t),e]);if(vz(i))return lH(n,c9(t4()));let r=vE(i.intervals)-s;return r<=0?cV(n,t):$(n,lH(mN(nd(r))),cV(t))}))))))}}let vH=(e,t)=>new vB(e,t),vJ=((e,t)=>vJ(e,e=>lT(()=>t(e))),M(2,(e,t)=>v1(e,(e,s)=>ly(t(e),e=>nE(s,ni(e)))))),vW=((e,t)=>vH([e.initial,t.initial,!0],(s,i,n)=>n[2]?lr(e.step(s,i,n[0]),([e,r,a])=>vz(a)?ly(t.step(s,i,n[1]),([t,s,i])=>[[e,t,!1],tV(s),i]):lR([[e,n[1],!0],tK(r),a])):ly(t.step(s,i,n[1]),([e,t,s])=>[[n[0],e,!1],tV(t),s])),M(2,(e,t)=>vK(e,(e,s)=>lT(()=>t(e,s))))),vK=M(2,(e,t)=>vH(e.initial,(s,i,n)=>lr(e.step(s,i,n),([e,s,n])=>vz(n)?lR([e,s,vM]):ly(t(i,s),t=>t?[e,s,n]:[e,s,vM])))),vV=((e,t)=>vV(e,e=>lT(()=>t(e))),M(2,(e,t)=>vH(e.initial,(s,i,n)=>lr(t(i),t=>e.step(s,t,n))))),vG=((e,t)=>v1(e,(e,s)=>t(s)),e=>$(f6([t4(),e.initial]),ly(t=>new vq(e,t)))),vY=M(2,(e,t)=>vX(e,t,vk)),vX=M(3,(e,t,s)=>vH([e.initial,t.initial],(i,n,r)=>$(lJ(e.step(i,n,r[0]),t.step(i,n,r[1]),(e,t)=>[e,t]),lr(([[i,r,a],[o,c,l]])=>vj(a)&&vj(l)?vQ(e,t,n,i,r,a.intervals,o,c,l.intervals,s):lR([[i,o],[r,c],vM]))))),vQ=(e,t,s,i,n,r,a,o,c,l)=>{let u=l(r,c);return vI(u)?lR([[i,a],[n,o],vA(u)]):$(r,vC(c))?lr(e.step(vR(r),s,i),([i,n,r])=>vz(r)?lR([[i,a],[n,o],vM]):vQ(e,t,s,i,n,r.intervals,a,o,c,l)):lr(t.step(vR(c),s,a),([a,o,c])=>vz(c)?lR([[i,a],[n,o],vM]):vQ(e,t,s,i,n,r,a,o,c.intervals,l))},vZ=M(2,(e,t)=>v0(e,e=>lT(()=>t(e)))),v0=M(2,(e,t)=>vH(e.initial,(s,i,n)=>lr(e.step(s,i,n),([e,s,i])=>ly(t(s),t=>[e,t,i])))),v1=M(2,(e,t)=>vH(e.initial,(s,i,n)=>lr(e.step(s,i,n),([e,i,n])=>{if(vz(n))return lR([e,i,n]);let r=n.intervals;return ly(t(i,vx(vd(s,vE(r)))),t=>{let n=ni(t),a=vE(r),o=s+ny(n),c=o-a;return[e,i,vN(vd(o,Math.max(0,vR(r)+c)))]})}))),v2=e=>vH(e.initial,(t,s,i)=>$(e.step(t,s,i),ly(([e,t,i])=>[e,s,i]))),v3=e=>v8(wp,t=>t<e),v5=((e,t,s)=>vH([e.initial,t],(t,i,[n,r])=>lr(e.step(t,i,n),([e,t,i])=>vz(i)?lR([[e,r],r,i]):ly(s(r,t),t=>[[e,t],r,i]))),M(3,(e,t,s)=>vH([e.initial,t.initial],(i,n,r)=>lJ(e.step(i,n,r[0]),t.step(i,n,r[1]),([e,t,i],[n,r,a])=>{if(vz(i)&&vz(a))return[[e,n],[t,r],vM];if(vz(i)&&vj(a))return[[e,n],[t,r],vA(a.intervals)];if(vj(i)&&vz(a))return[[e,n],[t,r],vA(i.intervals)];if(vj(i)&&vj(a))return[[e,n],[t,r],vA(s(i.intervals,a.intervals))];throw Error("BUG: Schedule.unionWith - please report an issue at https://github.com/Effect-TS/effect/issues")})))),v4=M(2,(e,t)=>vK(e,(e,s)=>ge(t(e)))),v6=M(2,(e,t)=>vK(e,(e,s)=>t(e))),v8=M(2,(e,t)=>vW(e,(e,s)=>t(s))),v7=((e,t)=>vZ(vY(e,t),e=>e[0]),Symbol.for("effect/Schedule/ScheduleDefect"));class v9{constructor(e){this.error=e,this[v7]=v7}}let we=e=>ei(e,v7),wt=e=>c0(e,e=>c4(new v9(e))),ws=e=>cZ(e,e=>t6(ch(e,e=>o2(e)&&we(e.defect)?tw(e.defect):t4()),{onNone:()=>lt(e),onSome:e=>c9(e.error)})),wi=M(2,(e,t)=>wr(e,t,(e,t)=>c9(e))),wn=M(2,(e,t)=>{if(vD(t))return wi(e,t);let s=t.schedule??v2(wp),i=t.while?v6(s,e=>{let s=t.while(e);return"boolean"==typeof s?lR(s):wt(s)}):s,n=t.until?v4(i,e=>{let s=t.until(e);return"boolean"==typeof s?lR(s):wt(s)}):i;return ws(wi(e,t.times?vY(n,v3(t.times)).pipe(vZ(e=>e[0])):n))}),wr=M(3,(e,t,s)=>lr(vG(t),t=>lh(e,{onFailure:e=>s(e,t4()),onSuccess:i=>wa(e,t,s,i)}))),wa=(e,t,s,i)=>lh(t.next(i),{onFailure:()=>lO(t.last),onSuccess:i=>lh(e,{onFailure:e=>s(e,tw(i)),onSuccess:i=>wa(e,t,s,i)})}),wo=M(2,(e,t)=>wc(e,t,(e,t)=>c9(e))),wc=((e,t)=>{if(vD(t))return wo(e,t);let s=t.schedule??wp,i=t.while?v6(s,e=>{let s=t.while(e);return"boolean"==typeof s?lR(s):wt(s)}):s,n=t.until?v4(i,e=>{let s=t.until(e);return"boolean"==typeof s?lR(s):wt(s)}):i;return ws(wo(e,t.times?vY(n,v3(t.times)):n))},M(3,(e,t,s)=>lr(vG(t),t=>wl(e,t,s)))),wl=(e,t,s)=>c0(e,i=>lh(t.next(i),{onFailure:()=>$(t.last,lO,lr(e=>s(i,e))),onSuccess:()=>wl(e,t,s)})),wu=((e,t)=>wu(e,void 0,t),M(3,(e,t,s)=>lr(vG(s),s=>wh(e,t,s)))),wh=(e,t,s)=>lh(s.next(t),{onFailure:()=>lO(s.last),onSuccess:()=>lr(e,t=>wh(e,t,s))}),wp=(y=e=>e+1,vH(0,(e,t,s)=>lT(()=>[y(s),s,vN(vy(e))])));class wd{constructor(e){this.waiters=new Set,this.taken=0,this.take=e=>cQ(t=>{if(this.free<e){let s=()=>{this.free<e||(this.waiters.delete(s),this.taken+=e,t(lR(e)))};return this.waiters.add(s),lT(()=>{this.waiters.delete(s)})}return this.taken+=e,t(lR(e))}),this.updateTaken=e=>cW(t=>(this.taken=e(this.taken),this.waiters.size>0&&t.getFiberRef(ma).scheduleTask(()=>{let e=this.waiters.values(),t=e.next();for(;!1===t.done&&this.free>0;)t.value(),t=e.next()},t.getFiberRef(up)),lR(this.free))),this.release=e=>this.updateTaken(t=>t-e),this.releaseAll=this.updateTaken(e=>0),this.withPermits=e=>t=>lj(s=>lr(s(this.take(e)),e=>vn(s(t),this.release(e)))),this.withPermitsIfAvailable=e=>t=>lj(s=>lI(()=>this.free<e?ga:(this.taken+=e,vn(s(mq(t)),this.release(e))))),this.permits=e}get free(){return this.permits-this.taken}}let wf=e=>new wd(e),wm=((e,t)=>{let s=ni(t);return lr(hv(),t=>ly(wC(t4()),i=>[hS(wg(e,s,i),t),wb(i)]))},(e,t,s)=>{let i=ny(ni(t));return $(hl(),lF(t=>lx(e,t)),ly(e=>tw([s+i,e])))}),wg=(e,t,s)=>lj(i=>$(p3(e=>e.currentTimeMillis),lr(i=>wI(s,s=>{switch(s._tag){case"None":return tw(wm(e,t,i));case"Some":{let[n]=s.value;return n-i<=0?tw(wm(e,t,i)):t4()}}})),lr(e=>tx(e)?c6("BUG: Effect.cachedInvalidate - please report an issue at https://github.com/Effect-TS/effect/issues"):i(hh(e.value[1]))))),wb=e=>f7(e,t4()),wx=((e,t)=>lr(xZ,s=>$(ww(e,s),vn(lr(s.value,t)))),M(2,(e,t)=>lj(s=>lr(t.fork(da),t=>$(s(e),lS(e=>t.close(e)),yP,lF(e=>t.addFinalizer(()=>ln(t=>eM(t,e.id())?lz:cG(lW(e)))))))))),wy=e=>yJ(t=>wx(e,t)),wv=M(2,(e,t)=>$(c7(e),vt(c7(t)),e=>lc(e))),ww=M(2,(e,t)=>ur(y9,e=>e.zip(t))(e)),wS=((e,{duration:t,onTimeout:s})=>lc(w_(e,{onTimeout:()=>le(s),onSuccess:lR,duration:t})),M(2,(e,{duration:t,onTimeout:s})=>lc(w_(e,{onTimeout:()=>ls(s),onSuccess:lR,duration:t})))),w_=M(2,(e,{duration:t,onSuccess:s,onTimeout:i})=>ln(n=>vs(e,lb(mN(t)),{onSelfWin:(e,t)=>lr(e.await,i=>"Success"===i._tag?lr(e.inheritAll,()=>cV(lK(t,n),s(i.value))):lr(lK(t,n),()=>u4(i.cause))),onOtherWin:(e,t)=>lr(e.await,s=>"Success"===s._tag?lr(e.inheritAll,()=>cV(lK(t,n),i())):lr(lK(t,n),()=>u4(s.cause))),otherScope:gA}))),wk=Symbol.for("effect/Ref/SynchronizedRef"),wO={_A:e=>e};class wE extends ds{static{a=f2,o=f1}constructor(e,t){super(),this[wk]=wO,this[a]=f3,this[o]=f1,this.ref=e,this.withLock=t,this.get=f8(this.ref)}commit(){return this.get}modify(e){return this.modifyEffect(t=>lR(e(t)))}modifyEffect(e){return this.withLock($(lr(f8(this.ref),e),lr(([e,t])=>cV(f7(this.ref,t),e))))}}let wC=e=>lT(()=>wR(e)),wR=e=>new wE(f4(e),wf(1).withPermits(1)),wI=M(2,(e,t)=>e.modifyEffect(e=>{let s=t(e);switch(s._tag){case"None":return lR([e,e]);case"Some":return ly(s.value,e=>[e,e])}})),wT=((e,t,s)=>({...tc,commit(){return gD(this)},[gN]:gM,id:()=>$(e.id(),rK(t.id())),await:$(e.await,lc,yX(lc(t.await),s,{concurrent:!0}),c7),children:e.children,inheritAll:lH(t.inheritAll,e.inheritAll),poll:lJ(e.poll,t.poll,(e,t)=>$(e,sr(e=>$(t,sn(t=>ha(e,t,{onSuccess:s,onFailure:oZ})))))),interruptAsFork:s=>lH(e.interruptAsFork(s),t.interruptAsFork(s)),pipe(){return eY(this,arguments)}}),e=>e._tag===oU),wF=e=>cg(e,{onEmpty:tw(oG),onFail:e=>$(e,sn(oY)),onDie:e=>tw(oX(e)),onInterrupt:e=>tw(oQ(e)),onSequential:(e,t)=>ty(e)&&ty(t)?tw(o0(e.value,t.value)):tx(e)&&ty(t)?tw(t.value):ty(e)&&tx(t)?tw(e.value):t4(),onParallel:(e,t)=>ty(e)&&ty(t)?tw(oZ(e.value,t.value)):tx(e)&&ty(t)?tw(t.value):ty(e)&&tx(t)?tw(e.value):t4()}),wA=e=>uM(j)(e),wN=e=>ei(e,uH),wM=e=>ei(e,uP),wj=Symbol.for("effect/ManagedRuntime"),wz="Fresh",wP="ProvideMerge",wD=e=>e.inheritAll,wL=e=>e.poll,w$=e=>(t,s)=>{let i=r1(),n=[[uh,[[i,e.context]]]];s?.scheduler&&n.push([ma,[[i,s.scheduler]]]);let r=dk(e.fiberRefs,{entries:n,forkAs:i});s?.updateRefs&&(r=s.updateRefs(r,i));let a=new yg(i,r,e.runtimeFlags),o=t;s?.scope&&(o=lr(uN(s.scope,da),e=>lH(uT(e,ln(e=>eM(e,a.id())?lz:lK(a,e))),lS(t,t=>uA(e,t)))));let c=a.currentSupervisor;return c!==x1&&(c.onStart(e.context,o,t4(),a),a.addObserver(e=>c.onEnd(e,a))),gA.add(e.runtimeFlags,a),s?.immediate===!1?a.resume(o):a.start(o),a},wU=e=>(t,s={})=>{let i=w$(e)(t,s);return s.onExit&&i.addObserver(e=>{s.onExit(e)}),(t,s)=>wU(e)($(i,lK(t??rQ)),{...s,onExit:s?.onExit?e=>s.onExit(gy(e)):void 0})},wB=e=>t=>{let s=wY(e)(t);if("Failure"!==s._tag)return s.effect_instruction_i0;throw wV(s.effect_instruction_i0)};class wq extends Error{constructor(e){super(`Fiber #${e.id().id} cannot be resolved synchronously. This is caused by using runSync on an effect that performs async work`),this._tag="AsyncFiberException",this.fiber=e,this.name=this._tag,this.stack=this.message}}let wH=e=>{let t=Error.stackTraceLimit;Error.stackTraceLimit=0;let s=new wq(e);return Error.stackTraceLimit=t,s},wJ=Symbol.for("effect/Runtime/FiberFailure"),wW=Symbol.for("effect/Runtime/FiberFailure/Cause");class wK extends Error{constructor(e){super(),this[wJ]=wJ,this[wW]=e;let t=cC(e);if(t.length>0){let e=t[0];this.name=e.name,this.message=e.message,this.stack=e.stack}this.name=`(FiberFailure) ${this.name}`,(void 0===this.message||0===this.message.length)&&(this.message="An error has occurred")}toJSON(){return{_id:"FiberFailure",cause:this[wW].toJSON()}}toString(){return"(FiberFailure) "+(this.stack??this.message)}[eD](){return this.toString()}}let wV=e=>{let t=Error.stackTraceLimit;Error.stackTraceLimit=0;let s=new wK(e);return Error.stackTraceLimit=t,s},wG=e=>{switch(e._op){case"Failure":case"Success":return e;case"Left":return u5(e.left);case"Right":return hs(e.right);case"Some":return hs(e.value);case"None":return u5(uJ())}},wY=e=>t=>{let s=wG(t);if(s)return s;let i=new mr,n=w$(e)(t,{scheduler:i});return i.flush(),n.unsafePoll()||u3(c5(wH(n),hO(n)))},wX=e=>(t,s)=>wQ(e)(t,s).then(e=>{switch(e._tag){case e3:return e.effect_instruction_i0;case eZ:throw wV(e.effect_instruction_i0)}}),wQ=e=>(t,s)=>new Promise(i=>{let n=wG(t);n&&i(n);let r=w$(e)(t);r.addObserver(e=>{i(e)}),s?.signal!==void 0&&(s.signal.aborted?r.unsafeInterruptAsFork(r.id()):s.signal.addEventListener("abort",()=>{r.unsafeInterruptAsFork(r.id())},{once:!0}))});class wZ{constructor(e,t,s){this.context=e,this.runtimeFlags=t,this.fiberRefs=s}pipe(){return eY(this,arguments)}}let w0=e=>new wZ(e.context,e.runtimeFlags,e.fiberRefs),w1=()=>cW((e,t)=>lR(new wZ(e.getFiberRef(uh),t.runtimeFlags,e.getFiberRefs()))),w2=oA(1,32,4),w3=w0({context:tD(),runtimeFlags:w2,fiberRefs:dp()}),w5=((e,t)=>w0({context:e.context,runtimeFlags:t(e.runtimeFlags),fiberRefs:e.fiberRefs}),w$(w3)),w4=wX(w3),w6=wQ(w3),w8=wB(w3),w7=wY(w3),w9=M(2,(e,t)=>e.modifyEffect(t)),Se=Symbol.for("effect/Layer"),St={[Se]:{_RIn:e=>e,_E:e=>e,_ROut:e=>e},pipe(){return eY(this,arguments)}},Ss=Symbol.for("effect/Layer/MemoMap"),Si=e=>ei(e,Se),Sn=e=>e._op_layer===wz;class Sr{constructor(e){this.ref=e,this[Ss]=Ss}getOrElseMemoize(e,t){return $(w9(this.ref,s=>{let i=s.get(e);if(void 0!==i){let[e,n]=i;return lR([$(e,lr(([e,t])=>$(gs(e),cV(t))),lS(he({onFailure:()=>lz,onSuccess:()=>uF(t,n)}))),s])}return $(f6(0),lr(i=>$(hl(),lr(n=>$(f6(()=>lz),ly(r=>{let a=lj(a=>$(y3(),lr(o=>$(a(lr(Su(e,o,!0),e=>mV(e(this)))),c7,lr(a=>{switch(a._tag){case eZ:return $(hf(n,a.effect_instruction_i0),lH(uA(o,a)),lH(lt(a.effect_instruction_i0)));case e3:return $(f7(r,e=>$(uA(o,e),lD(me(i,e=>[1===e,e-1])),cG)),lH(mt(i,e=>e+1)),lH(uF(t,t=>$(lT(()=>s.delete(e)),lH(f8(r)),lr(e=>e(t))))),lH(hg(n,a.effect_instruction_i0)),cV(a.effect_instruction_i0[1]))}}))))),o=[$(hh(n),lS(ht({onFailure:()=>lz,onSuccess:()=>mt(i,e=>e+1)}))),e=>$(f8(r),lr(t=>t(e)))];return[a,Sn(e)?s:s.set(e,o)]}))))))}),lc)}}let Sa=lI(()=>ly(wC(new Map),e=>new Sr(e))),So=()=>new Sr(wR(new Map)),Sc=M(2,(e,t)=>lr(Sa,s=>lr(Su(e,t),e=>e(s)))),Sl=M(3,(e,t,s)=>lr(Su(e,s),e=>e(t))),Su=(e,t,s=!1)=>{switch(e._op_layer){case"Locally":return lT(()=>s=>e.f(s.getOrElseMemoize(e.self,t)));case"ExtendScope":return lT(()=>t=>yJ(s=>t.getOrElseMemoize(e.layer,s)));case"Fold":return lT(()=>s=>$(s.getOrElseMemoize(e.layer,t),lu({onFailure:i=>s.getOrElseMemoize(e.failureK(i),t),onSuccess:i=>s.getOrElseMemoize(e.successK(i),t)})));case"Fresh":return lT(()=>s=>$(e.layer,Sc(t)));case"FromEffect":return s?lT(()=>t=>e.effect):lT(()=>s=>s.getOrElseMemoize(e,t));case"Provide":return lT(()=>s=>$(s.getOrElseMemoize(e.first,t),lr(i=>$(s.getOrElseMemoize(e.second,t),hS(i)))));case"Scoped":return s?lT(()=>s=>y5(e.effect,t)):lT(()=>s=>s.getOrElseMemoize(e,t));case"Suspend":return lT(()=>s=>s.getOrElseMemoize(e.evaluate(),t));case"ProvideMerge":return lT(()=>s=>$(s.getOrElseMemoize(e.first,t),lJ(s.getOrElseMemoize(e.second,t),e.zipK)));case"ZipWith":return lT(()=>s=>$(s.getOrElseMemoize(e.first,t),yX(s.getOrElseMemoize(e.second,t),e.zipK,{concurrent:!0})))}},Sh=((e,t)=>Sx(e,{onFailure:t,onSuccess:SO}),()=>Sg(hv())),Sp=e=>Sd(oY(e)),Sd=e=>Sg(lt(e)),Sf=M(2,(e,t)=>Sx(e,{onFailure:Sp,onSuccess:t})),Sm=M(2,(e,t)=>{let s=tP(e),i=s?e:t;return Sg(ly(s?t:e,e=>tF(i,e)))});function Sg(e){let t=Object.create(St);return t._op_layer="FromEffect",t.effect=e,t}(e,t)=>{let s=Object.create(St);return s._op_layer="Locally",s.self=e,s.f=t,s};let Sb=M(2,(e,{onFailure:t,onSuccess:s})=>{let i=Object.create(St);return i._op_layer="Fold",i.layer=e,i.failureK=t,i.successK=s,i}),Sx=M(2,(e,{onFailure:t,onSuccess:s})=>Sb(e,{onFailure:e=>{let s=ce(e);switch(s._tag){case"Left":return t(s.left);case"Right":return Sd(s.right)}},onSuccess:s})),Sy=M(2,(e,t)=>ST(e,t,(e,t)=>tj(e,t))),Sv=(...e)=>{let t=e[0];for(let s=1;s<e.length;s++)t=Sy(t,e[s]);return t},Sw=M(2,(e,t)=>{let s=tP(e),i=s?e:t;return S_(ly(s?t:e,e=>tF(i,e)))}),SS=e=>S_($(e,cV(tD()))),S_=e=>{let t=Object.create(St);return t._op_layer="Scoped",t.effect=e,t},Sk=M(2,(e,t)=>{let s=tP(e);return Sg(lR(tF(s?e:t,s?t:e)))}),SO=e=>Sg(lR(e)),SE=e=>{let t=Object.create(St);return t._op_layer="Suspend",t.evaluate=e,t},SC=M(2,(e,t)=>lr(yJ(s=>Sl(e,t,s)),e=>$(w1(),hS(e)))),SR=M(2,(e,t)=>SE(()=>{let s=Object.create(St);return s._op_layer="Provide",s.first=Object.create(St,{_op_layer:{value:wP,enumerable:!0},first:{value:Sh(),enumerable:!0},second:{value:Array.isArray(t)?Sv(...t):t},zipK:{value:(e,t)=>$(e,tj(t))}}),s.second=e,s})),SI=M(2,(e,t)=>{let s=Object.create(St);return s._op_layer=wP,s.first=t,s.second=SR(e,t),s.zipK=(e,t)=>$(e,tj(t)),s}),ST=M(3,(e,t,s)=>SE(()=>{let i=Object.create(St);return i._op_layer="ZipWith",i.first=e,i.second=t,i.zipK=s,i})),SF=e=>{let t=tz("effect/Layer/unwrapEffect/Layer.Layer<R1, E1, A>");return Sf(Sm(t,e),e=>tN(e,t))},SA=e=>{let t=tz("effect/Layer/unwrapScoped/Layer.Layer<R1, E1, A>");return Sf(Sw(t,e),e=>tN(e,t))},SN=M(2,(e,t)=>cK(y3(),s=>lr(Sc(t,s),t=>h_(e,t)),(e,t)=>uA(e,t))),SM=M(2,(e,t)=>{let s=dT(w3.fiberRefs,t.fiberRefs),i=oz(w3.runtimeFlags,t.runtimeFlags);return lj(n=>cW(r=>{let a=r.getFiberRef(uh),o=r.getFiberRefs(),c=dA(r.id(),o)(s),l=r.currentRuntimeFlags,u=oP(i)(l),h=dT(c,o),p=oz(u,l);return r.setFiberRefs(c),r.currentRuntimeFlags=u,vn(h_(n(e),tj(a,t.context)),cW(e=>(e.setFiberRefs(dA(e.id(),e.getFiberRefs())(h)),e.currentRuntimeFlags=oP(p)(e.currentRuntimeFlags),lz)))}))}),Sj=M(2,(e,t)=>Array.isArray(t)?SN(e,Sv(...t)):Si(t)?SN(e,t):tI(t)?h_(e,t):wj in t?lr(t.runtimeEffect,t=>SM(e,t)):SM(e,t)),Sz=Symbol.for("effect/MutableList"),SP={[Sz]:Sz,[Symbol.iterator](){let e=!1,t=this.head;return{next(){if(e)return this.return();if(null==t)return e=!0,this.return();let s=t.value;return t=t.next,{done:e,value:s}},return:t=>(e||(e=!0),{done:!0,value:t})}},toString(){return e$(this.toJSON())},toJSON(){return{_id:"MutableList",values:Array.from(this).map(eL)}},[eD](){return this.toJSON()},pipe(){return eY(this,arguments)}},SD=e=>({value:e,removed:!1,prev:void 0,next:void 0}),SL=()=>{let e=Object.create(SP);return e.head=void 0,e.tail=void 0,e._length=0,e},S$=e=>0===SU(e),SU=e=>e._length,SB=M(2,(e,t)=>{let s=SD(t);return void 0===e.head&&(e.head=s),void 0===e.tail||(e.tail.next=s,s.prev=e.tail),e.tail=s,e._length+=1,e}),Sq=e=>{let t=e.head;if(void 0!==t)return SH(e,t),t.value},SH=(e,t)=>{!t.removed&&(t.removed=!0,void 0!==t.prev&&void 0!==t.next?(t.prev.next=t.next,t.next.prev=t.prev):void 0!==t.prev?(e.tail=t.prev,t.prev.next=void 0):void 0!==t.next?(e.head=t.next,t.next.prev=void 0):(e.tail=void 0,e.head=void 0),e._length>0&&(e._length-=1))},SJ=Symbol.for("effect/MutableQueue"),SW=Symbol.for("effect/mutable/MutableQueue/Empty"),SK={[SJ]:SJ,[Symbol.iterator](){return Array.from(this.queue)[Symbol.iterator]()},toString(){return e$(this.toJSON())},toJSON(){return{_id:"MutableQueue",values:Array.from(this).map(eL)}},[eD](){return this.toJSON()},pipe(){return eY(this,arguments)}},SV=e=>{let t=Object.create(SK);return t.queue=SL(),t.capacity=e,t},SG=e=>SV(e),SY=()=>SV(void 0),SX=e=>SU(e.queue),SQ=e=>S$(e.queue),SZ=e=>void 0===e.capacity?1/0:e.capacity,S0=M(2,(e,t)=>{let s=SU(e.queue);return(void 0===e.capacity||s!==e.capacity)&&(SB(t)(e.queue),!0)}),S1=M(2,(e,t)=>{let s;let i=t[Symbol.iterator](),n=iS(),r=!0;for(;r&&(s=i.next())&&!s.done;)r=S0(s.value)(e);for(;null!=s&&!s.done;)n=iM(s.value)(n),s=i.next();return iR(n)}),S2=M(2,(e,t)=>S$(e.queue)?t:Sq(e.queue)),S3=M(2,(e,t)=>{let s=iS(),i=0;for(;i<t;){let t=S2(SW)(e);if(t===SW)break;s=iM(t)(s),i+=1}return iR(s)}),S5=(e,t,s,i)=>ag({_tag:"Complete",key:e,exit:t,entryStats:s,timeToLiveMillis:i}),S4=(e,t)=>ag({_tag:"Pending",key:e,deferred:t}),S6=(e,t)=>ag({_tag:"Refreshing",deferred:e,complete:t}),S8=Symbol.for("effect/Cache/MapKey");class S7{constructor(e){this[S8]=S8,this.previous=void 0,this.next=void 0,this.current=e}[ew](){return $(eS(this.current),ek(eS(this.previous)),ek(eS(this.next)),eA(this))}[eN](e){return this===e||_e(e)&&eM(this.current,e.current)&&eM(this.previous,e.previous)&&eM(this.next,e.next)}}let S9=e=>new S7(e),_e=e=>ei(e,S8);class _t{add(e){if(e!==this.tail){if(void 0===this.tail)this.head=e,this.tail=e;else{let t=e.previous,s=e.next;void 0!==s&&(e.next=void 0,void 0!==t?(t.next=s,s.previous=t):(this.head=s,this.head.previous=void 0)),this.tail.next=e,e.previous=this.tail,this.tail=e}}}remove(){let e=this.head;if(void 0!==e){let t=e.next;void 0!==t?(e.next=void 0,this.head=t,this.head.previous=void 0):(this.head=void 0,this.tail=void 0)}return e}constructor(){this.head=void 0,this.tail=void 0}}let _s=()=>new _t,_i=(e,t,s,i,n,r)=>({map:e,keys:t,accesses:s,updating:i,hits:n,misses:r}),_n=()=>_i(bU(),_s(),SY(),rT(!1),0,0),_r=Symbol.for("effect/Cache"),_a={_Key:e=>e,_Error:e=>e,_Value:e=>e},_o=Symbol.for("effect/ConsumerCache"),_c={_Key:e=>e,_Error:e=>e,_Value:e=>e},_l=e=>e,_u=e=>({loadedMillis:e});class _h{constructor(e,t,s,i,n){this[_r]=_a,this[_o]=_c,this.capacity=e,this.context=t,this.fiberId=s,this.lookup=i,this.timeToLive=n,this.cacheState=_n()}get(e){return ly(this.getEither(e),tQ)}get cacheStats(){return lT(()=>_l({hits:this.cacheState.hits,misses:this.cacheState.misses,size:bV(this.cacheState.map)}))}getOption(e){return lI(()=>t6(bB(this.cacheState.map,e),{onNone:()=>{let t=S9(e);return this.trackAccess(t),this.trackMiss(),lR(t4())},onSome:e=>this.resolveMapValue(e)}))}getOptionComplete(e){return lI(()=>t6(bB(this.cacheState.map,e),{onNone:()=>{let t=S9(e);return this.trackAccess(t),this.trackMiss(),lR(t4())},onSome:e=>this.resolveMapValue(e,!0)}))}contains(e){return lT(()=>bH(this.cacheState.map,e))}entryStats(e){return lT(()=>{let t=bB(this.cacheState.map,e);if(ty(t))switch(t.value._tag){case"Complete":return tw(_u(t.value.entryStats.loadedMillis));case"Pending":break;case"Refreshing":return tw(_u(t.value.complete.entryStats.loadedMillis))}return t4()})}getEither(e){return lI(()=>{let t,s;let i=st(bB(this.cacheState.map,e));return(void 0===i&&(s=hc(this.fiberId),t=S9(e),bH(this.cacheState.map,e)?i=st(bB(this.cacheState.map,e)):bJ(this.cacheState.map,e,S4(t,s))),void 0===i)?(this.trackAccess(t),this.trackMiss(),ly(this.lookupValueOf(e,s),tV)):lr(this.resolveMapValue(i),t6({onNone:()=>this.getEither(e),onSome:e=>lR(tK(e))}))})}invalidate(e){return lT(()=>{bK(this.cacheState.map,e)})}invalidateWhen(e,t){return lT(()=>{let s=bB(this.cacheState.map,e);ty(s)&&"Complete"===s.value._tag&&"Success"===s.value.exit._tag&&t(s.value.exit.value)&&bK(this.cacheState.map,e)})}get invalidateAll(){return lT(()=>{this.cacheState.map=bU()})}refresh(e){return p3(t=>lI(()=>{let s=hc(this.fiberId),i=st(bB(this.cacheState.map,e));if(void 0===i&&(bH(this.cacheState.map,e)?i=st(bB(this.cacheState.map,e)):bJ(this.cacheState.map,e,S4(S9(e),s))),void 0===i)return cG(this.lookupValueOf(e,s));switch(i._tag){case"Complete":if(this.hasExpired(t,i.timeToLiveMillis))return eM(st(bB(this.cacheState.map,e)),i)&&bK(this.cacheState.map,e),cG(this.get(e));return $(this.lookupValueOf(e,s),gf(()=>{if(eM(st(bB(this.cacheState.map,e)),i)){let t=S6(s,i);return bJ(this.cacheState.map,e,t),!0}return!1}),cG);case"Pending":case"Refreshing":return hh(i.deferred)}}))}set(e,t){return p3(s=>lT(()=>{let i=s.unsafeCurrentTimeMillis(),n=hs(t),r=S5(S9(e),n,_u(i),i+ny(ni(this.timeToLive(n))));bJ(this.cacheState.map,e,r)}))}get size(){return lT(()=>bV(this.cacheState.map))}get values(){return lT(()=>{let e=[];for(let t of this.cacheState.map)"Complete"===t[1]._tag&&"Success"===t[1].exit._tag&&e.push(t[1].exit.value);return e})}get entries(){return lT(()=>{let e=[];for(let t of this.cacheState.map)"Complete"===t[1]._tag&&"Success"===t[1].exit._tag&&e.push([t[0],t[1].exit.value]);return e})}get keys(){return lT(()=>{let e=[];for(let t of this.cacheState.map)"Complete"===t[1]._tag&&"Success"===t[1].exit._tag&&e.push(t[0]);return e})}resolveMapValue(e,t=!1){return p3(s=>{switch(e._tag){case"Complete":if(this.trackAccess(e.key),this.hasExpired(s,e.timeToLiveMillis))return bK(this.cacheState.map,e.key.current),lR(t4());return this.trackHit(),ly(e.exit,tw);case"Pending":if(this.trackAccess(e.key),this.trackHit(),t)return lR(t4());return ly(hh(e.deferred),tw);case"Refreshing":if(this.trackAccess(e.complete.key),this.trackHit(),this.hasExpired(s,e.complete.timeToLiveMillis)){if(t)return lR(t4());return ly(hh(e.deferred),tw)}return ly(e.complete.exit,tw)}})}trackHit(){this.cacheState.hits=this.cacheState.hits+1}trackMiss(){this.cacheState.misses=this.cacheState.misses+1}trackAccess(e){if(S0(this.cacheState.accesses,e),rF(this.cacheState.updating,!1,!0)){let e=!0;for(;e;){let t=S2(this.cacheState.accesses,SW);t===SW?e=!1:this.cacheState.keys.add(t)}let t=bV(this.cacheState.map);for(e=t>this.capacity;e;){let s=this.cacheState.keys.remove();void 0!==s?bH(this.cacheState.map,s.current)&&(bK(this.cacheState.map,s.current),t-=1,e=t>this.capacity):e=!1}rN(this.cacheState.updating,!1)}}hasExpired(e,t){return e.unsafeCurrentTimeMillis()>t}lookupValueOf(e,t){return p3(s=>lI(()=>$(this.lookup(e),hS(this.context),c7,lr(i=>{let n=s.unsafeCurrentTimeMillis(),r=_u(n),a=S5(S9(e),i,r,n+ny(ni(this.timeToLive(i))));return bJ(this.cacheState.map,e,a),lH(hd(t,i),i)}),l_(()=>lH(p7(t),lT(()=>{bK(this.cacheState.map,e)}))))))}}let _p=(e,t,s)=>new _h(e,tD(),rq,t,e=>ni(s(e))),_d=(()=>ua(_p(65536,()=>ly(hl(),e=>({listeners:new xJ,handle:e})),()=>nf(60))),e=>$(hl(),lr(t=>$(mG(e),lx(t),gt,ly(e=>lH(e,$(hh(t),lr(([e,t])=>cV(lB(gs(e[0]),lP(e[1])),t))))))))),_f=function(){let e=1==arguments.length?arguments[0]:arguments[1].bind(arguments[0]);return lI(()=>{let t=new cB(e8);return t.effect_instruction_i0=e($),t})},_m=e=>e.length>=1?cQ((t,s)=>{try{e(s).then(e=>t(hs(e)),e=>t(u3(e)))}catch(e){t(u3(e))}}):cQ(t=>{try{e().then(e=>t(hs(e)),e=>t(u3(e)))}catch(e){t(u3(e))}}),_g=e=>mZ(e,{onFailure:L,onSuccess:L}),_b=e=>lu(e,{onFailure:e=>m5(e,"An error was silently ignored because it is not anticipated to be useful"),onSuccess:()=>lz}),_x=e=>lr(y3(),t=>y4(e,t)),_y=(e,...t)=>m2(e)(...t),_v=e=>lT(()=>wf(e)),_w=M(2,(e,t)=>yX(e,t,(e,t)=>e(t))),_S=(e,...t)=>{let s=pZ(1===t.length?void 0:t[0]),i=t[t.length-1];return cW(t=>{let n=gg(t,e,s),r=t.getFiberRef(uO),a=tN(t.getFiberRef(p1),hI);return lS(i(n),e=>gb(n,e,a,r))})},__=Symbol.for("effect/QueueEnqueue"),_k=Symbol.for("effect/QueueDequeue"),_O=Symbol.for("effect/QueueStrategy"),_E=Symbol.for("effect/BackingQueue"),_C={_A:e=>e},_R={_A:e=>e},_I={_In:e=>e},_T={_Out:e=>e};class _F extends ds{constructor(e,t,s,i,n){super(),this[__]=_I,this[_k]=_T,this.queue=e,this.takers=t,this.shutdownHook=s,this.shutdownFlag=i,this.strategy=n}pipe(){return eY(this,arguments)}commit(){return this.take}capacity(){return this.queue.capacity()}get size(){return lI(()=>c0(this.unsafeSize(),()=>lm))}unsafeSize(){return rA(this.shutdownFlag)?t4():tw(this.queue.length()-SX(this.takers)+this.strategy.surplusSize())}get isEmpty(){return ly(this.size,e=>e<=0)}get isFull(){return ly(this.size,e=>e>=this.capacity())}get shutdown(){return lM(cW(e=>($(this.shutdownFlag,rN(!0)),$(yj(_X(this.takers),t=>hm(t,e.id()),!1,!1),lH(this.strategy.shutdown),lD(hg(this.shutdownHook,void 0)),cG))))}get isShutdown(){return lT(()=>rA(this.shutdownFlag))}get awaitShutdown(){return hh(this.shutdownHook)}isActive(){return!rA(this.shutdownFlag)}unsafeOffer(e){let t;if(rA(this.shutdownFlag))return!1;if(0===this.queue.length()){let s=$(this.takers,S2(SW));s!==SW?(_G(s,e),t=!0):t=!1}else t=!1;if(t)return!0;let s=this.queue.offer(e);return _0(this.strategy,this.queue,this.takers),s}offer(e){return lI(()=>{let t;if(rA(this.shutdownFlag))return lm;if(0===this.queue.length()){let s=$(this.takers,S2(SW));s!==SW?(_G(s,e),t=!0):t=!1}else t=!1;if(t)return lR(!0);let s=this.queue.offer(e);return _0(this.strategy,this.queue,this.takers),s?lR(!0):this.strategy.handleSurplus([e],this.queue,this.takers,this.shutdownFlag)})}offerAll(e){return lI(()=>{if(rA(this.shutdownFlag))return lm;let t=sC(e),s=0===this.queue.length()?sC(_Q(this.takers,t.length)):s4,[i,n]=$(t,s0(s.length));for(let e=0;e<s.length;e++)_G(s[e],i[e]);if(0===n.length)return lR(!0);let r=this.queue.offerAll(n);return _0(this.strategy,this.queue,this.takers),iH(r)?lR(!0):this.strategy.handleSurplus(r,this.queue,this.takers,this.shutdownFlag)})}get take(){return cW(e=>{if(rA(this.shutdownFlag))return lm;let t=this.queue.poll(SW);if(t!==SW)return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),lR(t);{let t=hc(e.id());return $(lI(()=>($(this.takers,S0(t)),_0(this.strategy,this.queue,this.takers),rA(this.shutdownFlag)?lm:hh(t))),l_(()=>lT(()=>_Z(this.takers,t))))}})}get takeAll(){return lI(()=>rA(this.shutdownFlag)?lm:lT(()=>{let e=this.queue.pollUpTo(Number.POSITIVE_INFINITY);return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),iO(e)}))}takeUpTo(e){return lI(()=>rA(this.shutdownFlag)?lm:lT(()=>{let t=this.queue.pollUpTo(e);return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),iO(t)}))}takeBetween(e,t){return lI(()=>_A(this,e,t,iS()))}}let _A=(e,t,s,i)=>s<t?lR(i):$(_$(e,s),lr(n=>{let r=t-n.length;return 1===r?$(_L(e),ly(e=>$(i,iD(n),iN(e)))):r>1?$(_L(e),lr(t=>_A(e,r-1,s-n.length-1,$(i,iD(n),iN(t))))):lR($(i,iD(n)))})),_N=(e,t,s,i,n)=>new _F(e,t,s,i,n),_M=(e,t)=>$(hl(),ly(s=>_N(e,SY(),s,rT(!1),t)));class _j{constructor(e){this[_E]=_R,this.mutable=e}poll(e){return S2(this.mutable,e)}pollUpTo(e){return S3(this.mutable,e)}offerAll(e){return S1(this.mutable,e)}offer(e){return S0(this.mutable,e)}capacity(){return SZ(this.mutable)}length(){return SX(this.mutable)}}let _z=e=>new _j(e),_P=M(2,(e,t)=>e.offer(t)),_D=M(2,(e,t)=>e.offerAll(t)),_L=e=>e.take,_$=M(2,(e,t)=>e.takeUpTo(t)),_U=M(3,(e,t,s)=>e.takeBetween(t,s)),_B=M(2,(e,t)=>e.takeBetween(t,t)),_q=()=>new _W,_H=()=>new _K,_J=()=>new _V;class _W{surplusSize(){return SX(this.putters)}onCompleteTakersWithEmptyQueue(e){for(;!SQ(this.putters)&&!SQ(e);){let t=S2(e,void 0),s=S2(this.putters,void 0);s[2]&&_G(s[1],!0),_G(t,s[0])}}get shutdown(){return $(li,lr(e=>$(lT(()=>_X(this.putters)),lr(t=>yj(t,([t,s,i])=>i?$(hm(s,e),cG):lz,!1,!1)))))}handleSurplus(e,t,s,i){return cW(n=>{let r=hc(n.id());return $(lI(()=>(this.unsafeOffer(e,r),this.unsafeOnQueueEmptySpace(t,s),_0(this,t,s),rA(i)?lm:hh(r))),l_(()=>lT(()=>this.unsafeRemove(r))))})}unsafeOnQueueEmptySpace(e,t){let s=!0;for(;s&&(e.capacity()===Number.POSITIVE_INFINITY||e.length()<e.capacity());){let i=$(this.putters,S2(SW));if(i===SW)s=!1;else{let s=e.offer(i[0]);s&&i[2]?_G(i[1],!0):s||_Y(this.putters,$(_X(this.putters),iM(i))),_0(this,e,t)}}}unsafeOffer(e,t){let s=sC(e);for(let e=0;e<s.length;e++){let i=s[e];e===s.length-1?$(this.putters,S0([i,t,!0])):$(this.putters,S0([i,t,!1]))}}unsafeRemove(e){_Y(this.putters,$(_X(this.putters),i$(([,t])=>t!==e)))}constructor(){this[_O]=_C,this.putters=SY()}}class _K{surplusSize(){return 0}get shutdown(){return lz}onCompleteTakersWithEmptyQueue(){}handleSurplus(e,t,s,i){return lR(!1)}unsafeOnQueueEmptySpace(e,t){}constructor(){this[_O]=_C}}class _V{surplusSize(){return 0}get shutdown(){return lz}onCompleteTakersWithEmptyQueue(){}handleSurplus(e,t,s,i){return lT(()=>(this.unsafeOffer(t,e),_0(this,t,s),!0))}unsafeOnQueueEmptySpace(e,t){}unsafeOffer(e,t){let s;let i=t[Symbol.iterator](),n=!0;for(;!(s=i.next()).done&&n;){if(0===e.capacity())return;e.poll(SW),n=e.offer(s.value)}}constructor(){this[_O]=_C}}let _G=(e,t)=>hb(e,lR(t)),_Y=(e,t)=>$(e,S1(t)),_X=e=>$(e,S3(Number.POSITIVE_INFINITY)),_Q=(e,t)=>$(e,S3(t)),_Z=(e,t)=>{_Y(e,$(_X(e),i$(e=>t!==e)))},_0=(e,t,s)=>{let i=!0;for(;i&&0!==t.length();){let n=$(s,S2(SW));if(n!==SW){let r=t.poll(SW);r!==SW?(_G(n,r),e.unsafeOnQueueEmptySpace(t,s)):_Y(s,$(_X(s),iM(n))),i=!0}else i=!1}i&&0===t.length()&&!SQ(s)&&e.onCompleteTakersWithEmptyQueue(s)},_1=e=>$(lT(()=>SG(e)),lr(e=>_M(_z(e),_q()))),_2=e=>$(lT(()=>SG(e)),lr(e=>_M(_z(e),_H()))),_3=e=>$(lT(()=>SG(e)),lr(e=>_M(_z(e),_J()))),_5=()=>$(lT(()=>SY()),lr(e=>_M(_z(e),_H()))),_4=e=>e.capacity(),_6=e=>e.size,_8=e=>e.isEmpty,_7=e=>e.isFull,_9=e=>e.isShutdown,ke=e=>e.awaitShutdown,kt=e=>e.shutdown,ks=e=>ly(e.takeUpTo(1),iW),ki=e=>e.takeAll,kn=M(2,(e,t)=>un(yb,t)(e)),kr=e=>SS(y8(yO,ry(e))),ka=e=>SF(ly(e,kr)),ko=e=>SA(ly(e,kr)),kc=e=>SS(y8(yO,rv(e))),kl=M(2,(e,t)=>Sf(kc(e),()=>kr(t))),ku=M(2,(e,t)=>Sf(kc(e),()=>ka(t))),kh=M(2,(e,t)=>Sf(kc(e),()=>ko(t))),kp=e=>yJ(t=>Sc(e,t)),kd=e=>Sg(ly(e,()=>tD())),kf=e=>SS(yK(e)),km=Symbol.for("effect/PubSub/AbsentValue"),kg=(e,t)=>s=>{s.has(e)||s.set(e,new Set),s.get(e).add(t)},kb=(e,t)=>s=>{if(!s.has(e))return;let i=s.get(e);i.delete(t),0===i.size&&s.delete(e)},kx=e=>{let t="number"==typeof e?{capacity:e}:e;kj(t.capacity);let s=t.replay&&t.replay>0?new kV(Math.ceil(t.replay)):void 0;return 1===t.capacity?new kE(s):hj(t.capacity)===t.capacity?new kk(t.capacity,s):new kS(t.capacity,s)},ky=e=>new kR(e?.replay?new kV(e.replay):void 0),kv=(e,t,s)=>ly(hl(),i=>kw(e,t,e.subscribe(),SY(),i,rT(!1),s)),kw=(e,t,s,i,n,r,a)=>new kT(e,t,s,i,n,r,a,e.replayWindow());class kS{constructor(e,t){this.publisherIndex=0,this.subscriberCount=0,this.subscribersIndex=0,this.capacity=e,this.replayBuffer=t,this.array=Array.from({length:e}),this.subscribers=Array.from({length:e})}replayWindow(){return this.replayBuffer?new kG(this.replayBuffer):kY}isEmpty(){return this.publisherIndex===this.subscribersIndex}isFull(){return this.publisherIndex===this.subscribersIndex+this.capacity}size(){return this.publisherIndex-this.subscribersIndex}publish(e){if(this.isFull())return!1;if(0!==this.subscriberCount){let t=this.publisherIndex%this.capacity;this.array[t]=e,this.subscribers[t]=this.subscriberCount,this.publisherIndex+=1}return this.replayBuffer&&this.replayBuffer.offer(e),!0}publishAll(e){if(0===this.subscriberCount)return this.replayBuffer&&this.replayBuffer.offerAll(e),iS();let t=iO(e),s=t.length,i=this.publisherIndex-this.subscribersIndex,n=Math.min(s,this.capacity-i);if(0===n)return t;let r=0,a=this.publisherIndex+n;for(;this.publisherIndex!==a;){let e=iA(t,r++),s=this.publisherIndex%this.capacity;this.array[s]=e,this.subscribers[s]=this.subscriberCount,this.publisherIndex+=1,this.replayBuffer&&this.replayBuffer.offer(e)}return iz(t,r)}slide(){if(this.subscribersIndex!==this.publisherIndex){let e=this.subscribersIndex%this.capacity;this.array[e]=km,this.subscribers[e]=0,this.subscribersIndex+=1}this.replayBuffer&&this.replayBuffer.slide()}subscribe(){return this.subscriberCount+=1,new k_(this,this.publisherIndex,!1)}}class k_{constructor(e,t,s){this.self=e,this.subscriberIndex=t,this.unsubscribed=s}isEmpty(){return this.unsubscribed||this.self.publisherIndex===this.subscriberIndex||this.self.publisherIndex===this.self.subscribersIndex}size(){return this.unsubscribed?0:this.self.publisherIndex-Math.max(this.subscriberIndex,this.self.subscribersIndex)}poll(e){if(this.unsubscribed)return e;if(this.subscriberIndex=Math.max(this.subscriberIndex,this.self.subscribersIndex),this.subscriberIndex!==this.self.publisherIndex){let e=this.subscriberIndex%this.self.capacity,t=this.self.array[e];return this.self.subscribers[e]-=1,0===this.self.subscribers[e]&&(this.self.array[e]=km,this.self.subscribersIndex+=1),this.subscriberIndex+=1,t}return e}pollUpTo(e){if(this.unsubscribed)return iS();this.subscriberIndex=Math.max(this.subscriberIndex,this.self.subscribersIndex);let t=Math.min(e,this.self.publisherIndex-this.subscriberIndex);if(t<=0)return iS();let s=[],i=this.subscriberIndex+t;for(;this.subscriberIndex!==i;){let e=this.subscriberIndex%this.self.capacity,t=this.self.array[e];this.self.subscribers[e]-=1,0===this.self.subscribers[e]&&(this.self.array[e]=km,this.self.subscribersIndex+=1),s.push(t),this.subscriberIndex+=1}return iO(s)}unsubscribe(){if(!this.unsubscribed)for(this.unsubscribed=!0,this.self.subscriberCount-=1,this.subscriberIndex=Math.max(this.subscriberIndex,this.self.subscribersIndex);this.subscriberIndex!==this.self.publisherIndex;){let e=this.subscriberIndex%this.self.capacity;this.self.subscribers[e]-=1,0===this.self.subscribers[e]&&(this.self.array[e]=km,this.self.subscribersIndex+=1),this.subscriberIndex+=1}}}class kk{constructor(e,t){this.publisherIndex=0,this.subscriberCount=0,this.subscribersIndex=0,this.capacity=e,this.replayBuffer=t,this.array=Array.from({length:e}),this.mask=e-1,this.subscribers=Array.from({length:e})}replayWindow(){return this.replayBuffer?new kG(this.replayBuffer):kY}isEmpty(){return this.publisherIndex===this.subscribersIndex}isFull(){return this.publisherIndex===this.subscribersIndex+this.capacity}size(){return this.publisherIndex-this.subscribersIndex}publish(e){if(this.isFull())return!1;if(0!==this.subscriberCount){let t=this.publisherIndex&this.mask;this.array[t]=e,this.subscribers[t]=this.subscriberCount,this.publisherIndex+=1}return this.replayBuffer&&this.replayBuffer.offer(e),!0}publishAll(e){if(0===this.subscriberCount)return this.replayBuffer&&this.replayBuffer.offerAll(e),iS();let t=iO(e),s=t.length,i=this.publisherIndex-this.subscribersIndex,n=Math.min(s,this.capacity-i);if(0===n)return t;let r=0,a=this.publisherIndex+n;for(;this.publisherIndex!==a;){let e=iA(t,r++),s=this.publisherIndex&this.mask;this.array[s]=e,this.subscribers[s]=this.subscriberCount,this.publisherIndex+=1,this.replayBuffer&&this.replayBuffer.offer(e)}return iz(t,r)}slide(){if(this.subscribersIndex!==this.publisherIndex){let e=this.subscribersIndex&this.mask;this.array[e]=km,this.subscribers[e]=0,this.subscribersIndex+=1}this.replayBuffer&&this.replayBuffer.slide()}subscribe(){return this.subscriberCount+=1,new kO(this,this.publisherIndex,!1)}}class kO{constructor(e,t,s){this.self=e,this.subscriberIndex=t,this.unsubscribed=s}isEmpty(){return this.unsubscribed||this.self.publisherIndex===this.subscriberIndex||this.self.publisherIndex===this.self.subscribersIndex}size(){return this.unsubscribed?0:this.self.publisherIndex-Math.max(this.subscriberIndex,this.self.subscribersIndex)}poll(e){if(this.unsubscribed)return e;if(this.subscriberIndex=Math.max(this.subscriberIndex,this.self.subscribersIndex),this.subscriberIndex!==this.self.publisherIndex){let e=this.subscriberIndex&this.self.mask,t=this.self.array[e];return this.self.subscribers[e]-=1,0===this.self.subscribers[e]&&(this.self.array[e]=km,this.self.subscribersIndex+=1),this.subscriberIndex+=1,t}return e}pollUpTo(e){if(this.unsubscribed)return iS();this.subscriberIndex=Math.max(this.subscriberIndex,this.self.subscribersIndex);let t=Math.min(e,this.self.publisherIndex-this.subscriberIndex);if(t<=0)return iS();let s=[],i=this.subscriberIndex+t;for(;this.subscriberIndex!==i;){let e=this.subscriberIndex&this.self.mask,t=this.self.array[e];this.self.subscribers[e]-=1,0===this.self.subscribers[e]&&(this.self.array[e]=km,this.self.subscribersIndex+=1),s.push(t),this.subscriberIndex+=1}return iO(s)}unsubscribe(){if(!this.unsubscribed)for(this.unsubscribed=!0,this.self.subscriberCount-=1,this.subscriberIndex=Math.max(this.subscriberIndex,this.self.subscribersIndex);this.subscriberIndex!==this.self.publisherIndex;){let e=this.subscriberIndex&this.self.mask;this.self.subscribers[e]-=1,0===this.self.subscribers[e]&&(this.self.array[e]=km,this.self.subscribersIndex+=1),this.subscriberIndex+=1}}}class kE{constructor(e){this.publisherIndex=0,this.subscriberCount=0,this.subscribers=0,this.value=km,this.capacity=1,this.replayBuffer=e}replayWindow(){return this.replayBuffer?new kG(this.replayBuffer):kY}pipe(){return eY(this,arguments)}isEmpty(){return 0===this.subscribers}isFull(){return!this.isEmpty()}size(){return this.isEmpty()?0:1}publish(e){return!this.isFull()&&(0!==this.subscriberCount&&(this.value=e,this.subscribers=this.subscriberCount,this.publisherIndex+=1),this.replayBuffer&&this.replayBuffer.offer(e),!0)}publishAll(e){if(0===this.subscriberCount)return this.replayBuffer&&this.replayBuffer.offerAll(e),iS();let t=iO(e);return iH(t)?t:this.publish(iK(t))?iz(t,1):t}slide(){this.isFull()&&(this.subscribers=0,this.value=km),this.replayBuffer&&this.replayBuffer.slide()}subscribe(){return this.subscriberCount+=1,new kC(this,this.publisherIndex,!1)}}class kC{constructor(e,t,s){this.self=e,this.subscriberIndex=t,this.unsubscribed=s}isEmpty(){return this.unsubscribed||0===this.self.subscribers||this.subscriberIndex===this.self.publisherIndex}size(){return this.isEmpty()?0:1}poll(e){if(this.isEmpty())return e;let t=this.self.value;return this.self.subscribers-=1,0===this.self.subscribers&&(this.self.value=km),this.subscriberIndex+=1,t}pollUpTo(e){if(this.isEmpty()||e<1)return iS();let t=this.self.value;return this.self.subscribers-=1,0===this.self.subscribers&&(this.self.value=km),this.subscriberIndex+=1,ik(t)}unsubscribe(){this.unsubscribed||(this.unsubscribed=!0,this.self.subscriberCount-=1,this.subscriberIndex===this.self.publisherIndex||(this.self.subscribers-=1,0!==this.self.subscribers||(this.self.value=km)))}}class kR{constructor(e){this.publisherHead={value:km,subscribers:0,next:null},this.publisherTail=this.publisherHead,this.publisherIndex=0,this.subscribersIndex=0,this.capacity=Number.MAX_SAFE_INTEGER,this.replayBuffer=e}replayWindow(){return this.replayBuffer?new kG(this.replayBuffer):kY}isEmpty(){return this.publisherHead===this.publisherTail}isFull(){return!1}size(){return this.publisherIndex-this.subscribersIndex}publish(e){let t=this.publisherTail.subscribers;return 0!==t&&(this.publisherTail.next={value:e,subscribers:t,next:null},this.publisherTail=this.publisherTail.next,this.publisherIndex+=1),this.replayBuffer&&this.replayBuffer.offer(e),!0}publishAll(e){if(0!==this.publisherTail.subscribers)for(let t of e)this.publish(t);else this.replayBuffer&&this.replayBuffer.offerAll(e);return iS()}slide(){this.publisherHead!==this.publisherTail&&(this.publisherHead=this.publisherHead.next,this.publisherHead.value=km,this.subscribersIndex+=1),this.replayBuffer&&this.replayBuffer.slide()}subscribe(){return this.publisherTail.subscribers+=1,new kI(this,this.publisherTail,this.publisherIndex,!1)}}class kI{constructor(e,t,s,i){this.self=e,this.subscriberHead=t,this.subscriberIndex=s,this.unsubscribed=i}isEmpty(){if(this.unsubscribed)return!0;let e=!0,t=!0;for(;t;)this.subscriberHead===this.self.publisherTail?t=!1:this.subscriberHead.next.value!==km?(e=!1,t=!1):(this.subscriberHead=this.subscriberHead.next,this.subscriberIndex+=1);return e}size(){return this.unsubscribed?0:this.self.publisherIndex-Math.max(this.subscriberIndex,this.self.subscribersIndex)}poll(e){if(this.unsubscribed)return e;let t=!0,s=e;for(;t;)if(this.subscriberHead===this.self.publisherTail)t=!1;else{let e=this.subscriberHead.next.value;e!==km&&(s=e,this.subscriberHead.subscribers-=1,0===this.subscriberHead.subscribers&&(this.self.publisherHead=this.self.publisherHead.next,this.self.publisherHead.value=km,this.self.subscribersIndex+=1),t=!1),this.subscriberHead=this.subscriberHead.next,this.subscriberIndex+=1}return s}pollUpTo(e){let t=[],s=0;for(;s!==e;){let i=this.poll(km);i===km?s=e:(t.push(i),s+=1)}return iO(t)}unsubscribe(){if(!this.unsubscribed)for(this.unsubscribed=!0,this.self.publisherTail.subscribers-=1;this.subscriberHead!==this.self.publisherTail;)this.subscriberHead.next.value!==km&&(this.subscriberHead.subscribers-=1,0===this.subscriberHead.subscribers&&(this.self.publisherHead=this.self.publisherHead.next,this.self.publisherHead.value=km,this.self.subscribersIndex+=1)),this.subscriberHead=this.subscriberHead.next}}class kT extends ds{static{c=_k}constructor(e,t,s,i,n,r,a,o){super(),this[c]=_T,this.pubsub=e,this.subscribers=t,this.subscription=s,this.pollers=i,this.shutdownHook=n,this.shutdownFlag=r,this.strategy=a,this.replayWindow=o}commit(){return this.take}pipe(){return eY(this,arguments)}capacity(){return this.pubsub.capacity}isActive(){return!rA(this.shutdownFlag)}get size(){return lI(()=>rA(this.shutdownFlag)?lm:lR(this.subscription.size()+this.replayWindow.remaining))}unsafeSize(){return rA(this.shutdownFlag)?t4():tw(this.subscription.size()+this.replayWindow.remaining)}get isFull(){return lI(()=>rA(this.shutdownFlag)?lm:lR(this.subscription.size()===this.capacity()))}get isEmpty(){return ly(this.size,e=>0===e)}get shutdown(){return lM(cW(e=>(rN(this.shutdownFlag,!0),$(yM(kD(this.pollers),t=>hm(t,e.id()),!1),lH(lT(()=>{this.subscribers.delete(this.subscription),this.subscription.unsubscribe(),this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers)})),lD(hg(this.shutdownHook,void 0)),cG))))}get isShutdown(){return lT(()=>rA(this.shutdownFlag))}get awaitShutdown(){return hh(this.shutdownHook)}get take(){return cW(e=>{if(rA(this.shutdownFlag))return lm;if(this.replayWindow.remaining>0)return lR(this.replayWindow.take());let t=SQ(this.pollers)?this.subscription.poll(SW):SW;if(t!==SW)return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),lR(t);{let t=hc(e.id());return $(lI(()=>($(this.pollers,S0(t)),$(this.subscribers,kg(this.subscription,this.pollers)),this.strategy.unsafeCompletePollers(this.pubsub,this.subscribers,this.subscription,this.pollers),rA(this.shutdownFlag)?lm:hh(t))),l_(()=>lT(()=>kB(this.pollers,t))))}})}get takeAll(){return lI(()=>{if(rA(this.shutdownFlag))return lm;let e=SQ(this.pollers)?kL(this.subscription):iS();return(this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),this.replayWindow.remaining>0)?lR(iD(this.replayWindow.takeAll(),e)):lR(e)})}takeUpTo(e){return lI(()=>{let t;if(rA(this.shutdownFlag))return lm;if(this.replayWindow.remaining>=e)return lR(this.replayWindow.takeN(e));this.replayWindow.remaining>0&&(t=this.replayWindow.takeAll(),e-=t.length);let s=SQ(this.pollers)?k$(this.subscription,e):iS();return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),t?lR(iD(t,s)):lR(s)})}takeBetween(e,t){return lI(()=>kF(this,e,t,iS()))}}let kF=(e,t,s,i)=>s<t?lR(i):$(e.takeUpTo(s),lr(n=>{let r=t-n.length;return 1===r?$(e.take,ly(e=>$(i,iD(n),iN(e)))):r>1?$(e.take,lr(t=>kF(e,r-1,s-n.length-1,$(i,iD(n),iN(t))))):lR($(i,iD(n)))}));class kA{static{l=__,u=_k}constructor(e,t,s,i,n,r){this[l]=_I,this[u]=_T,this.pubsub=e,this.subscribers=t,this.scope=s,this.shutdownHook=i,this.shutdownFlag=n,this.strategy=r}capacity(){return this.pubsub.capacity}get size(){return lI(()=>rA(this.shutdownFlag)?lm:lT(()=>this.pubsub.size()))}unsafeSize(){return rA(this.shutdownFlag)?t4():tw(this.pubsub.size())}get isFull(){return ly(this.size,e=>e===this.capacity())}get isEmpty(){return ly(this.size,e=>0===e)}get awaitShutdown(){return hh(this.shutdownHook)}get isShutdown(){return lT(()=>rA(this.shutdownFlag))}get shutdown(){return lM(cW(e=>($(this.shutdownFlag,rN(!0)),$(this.scope.close(u7(e.id())),lH(this.strategy.shutdown),lD(hg(this.shutdownHook,void 0)),cG))))}publish(e){return lI(()=>rA(this.shutdownFlag)?lm:this.pubsub.publish(e)?(this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),lR(!0)):this.strategy.handleSurplus(this.pubsub,this.subscribers,ik(e),this.shutdownFlag))}isActive(){return!rA(this.shutdownFlag)}unsafeOffer(e){return!rA(this.shutdownFlag)&&!!this.pubsub.publish(e)&&(this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),!0)}publishAll(e){return lI(()=>{if(rA(this.shutdownFlag))return lm;let t=kU(this.pubsub,e);return(this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),iH(t))?lR(!0):this.strategy.handleSurplus(this.pubsub,this.subscribers,t,this.shutdownFlag)})}get subscribe(){return ly(yC(lF(yA([this.scope.fork(da),kv(this.pubsub,this.subscribers,this.strategy)]),e=>e[0].addFinalizer(()=>e[1].shutdown)),(e,t)=>e[0].close(t)),e=>e[1])}offer(e){return this.publish(e)}offerAll(e){return this.publishAll(e)}pipe(){return eY(this,arguments)}}let kN=(e,t)=>lr(y3(),s=>ly(hl(),i=>kM(e,new Map,s,i,rT(!1),t))),kM=(e,t,s,i,n,r)=>new kA(e,t,s,i,n,r),kj=e=>{if(e<=0)throw new uK(`Cannot construct PubSub with capacity of ${e}`)},kz=(e,t)=>{hb(e,lR(t))},kP=(e,t)=>$(e,S1(t)),kD=e=>$(e,S3(Number.POSITIVE_INFINITY)),kL=e=>e.pollUpTo(Number.POSITIVE_INFINITY),k$=(e,t)=>e.pollUpTo(t),kU=(e,t)=>e.publishAll(t),kB=(e,t)=>{kP(e,$(kD(e),i$(e=>e!==t)))};class kq{get shutdown(){return lr(li,e=>lr(lT(()=>kD(this.publishers)),t=>yj(t,([t,s,i])=>i?$(hm(s,e),cG):lz,!1,!1)))}handleSurplus(e,t,s,i){return cW(n=>{let r=hc(n.id());return $(lI(()=>(this.unsafeOffer(s,r),this.unsafeOnPubSubEmptySpace(e,t),this.unsafeCompleteSubscribers(e,t),rA(i)?lm:hh(r))),l_(()=>lT(()=>this.unsafeRemove(r))))})}unsafeOnPubSubEmptySpace(e,t){let s=!0;for(;s&&!e.isFull();){let i=$(this.publishers,S2(SW));if(i===SW)s=!1;else{let s=e.publish(i[0]);s&&i[2]?kz(i[1],!0):s||kP(this.publishers,$(kD(this.publishers),iM(i))),this.unsafeCompleteSubscribers(e,t)}}}unsafeCompletePollers(e,t,s,i){return kW(this,e,t,s,i)}unsafeCompleteSubscribers(e,t){return kK(this,e,t)}unsafeOffer(e,t){let s=e[Symbol.iterator](),i=s.next();if(!i.done)for(;;){let e=i.value;if((i=s.next()).done){$(this.publishers,S0([e,t,!0]));break}$(this.publishers,S0([e,t,!1]))}}unsafeRemove(e){kP(this.publishers,$(kD(this.publishers),i$(([t,s])=>s!==e)))}constructor(){this.publishers=SY()}}class kH{get shutdown(){return lz}handleSurplus(e,t,s,i){return lR(!1)}unsafeOnPubSubEmptySpace(e,t){}unsafeCompletePollers(e,t,s,i){return kW(this,e,t,s,i)}unsafeCompleteSubscribers(e,t){return kK(this,e,t)}}class kJ{get shutdown(){return lz}handleSurplus(e,t,s,i){return lT(()=>(this.unsafeSlidingPublish(e,s),this.unsafeCompleteSubscribers(e,t),!0))}unsafeOnPubSubEmptySpace(e,t){}unsafeCompletePollers(e,t,s,i){return kW(this,e,t,s,i)}unsafeCompleteSubscribers(e,t){return kK(this,e,t)}unsafeSlidingPublish(e,t){let s=t[Symbol.iterator](),i=s.next();if(!i.done&&e.capacity>0){let t=i.value,n=!0;for(;n;){e.slide();let r=e.publish(t);r&&(i=s.next())&&!i.done?t=i.value:r&&(n=!1)}}}}let kW=(e,t,s,i,n)=>{let r=!0;for(;r&&!i.isEmpty();){let a=$(n,S2(SW));if(a===SW)$(s,kb(i,n)),SQ(n)?r=!1:$(s,kg(i,n));else{let r=i.poll(SW);r===SW?kP(n,$(kD(n),iM(a))):(kz(a,r),e.unsafeOnPubSubEmptySpace(t,s))}}},kK=(e,t,s)=>{for(let[i,n]of s)for(let r of n)e.unsafeCompletePollers(t,s,i,r)};class kV{constructor(e){this.head={value:km,next:null},this.tail=this.head,this.size=0,this.index=0,this.capacity=e}slide(){this.index++}offer(e){this.tail.value=e,this.tail.next={value:km,next:null},this.tail=this.tail.next,this.size===this.capacity?this.head=this.head.next:this.size+=1}offerAll(e){for(let t of e)this.offer(t)}}class kG{constructor(e){this.buffer=e,this.index=e.index,this.remaining=e.size,this.head=e.head}fastForward(){for(;this.index<this.buffer.index;)this.head=this.head.next,this.index++}take(){if(0===this.remaining)return;this.index<this.buffer.index&&this.fastForward(),this.remaining--;let e=this.head.value;return this.head=this.head.next,e}takeN(e){if(0===this.remaining)return iS();this.index<this.buffer.index&&this.fastForward();let t=Math.min(e,this.remaining),s=Array(t);for(let e=0;e<t;e++){let t=this.head.value;this.head=this.head.next,s[e]=t}return this.remaining-=t,iT(s)}takeAll(){return this.takeN(this.remaining)}}let kY={remaining:0,take:()=>void 0,takeN:()=>iS(),takeAll:()=>iS()},kX=e=>lI(()=>kN(kx(e),new kq)),kQ=e=>lI(()=>kN(kx(e),new kH)),kZ=e=>lI(()=>kN(kx(e),new kJ)),k0=e=>lI(()=>kN(ky(e),new kH)),k1=e=>e.shutdown,k2=e=>e.subscribe,k3="Continue",k5=Symbol.for("effect/ChannelChildExecutorDecision"),k4={[k5]:k5},k6=e=>{let t=Object.create(k4);return t._tag=k3,t},k8="ContinuationK",k7=Symbol.for("effect/ChannelContinuation"),k9={_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutDone:e=>e,_OutErr2:e=>e,_OutElem:e=>e,_OutDone2:e=>e};class Oe{constructor(e,t){this._tag=k8,this[k7]=k9,this.onSuccess=e,this.onHalt=t}onExit(e){return uQ(e)?this.onHalt(e.cause):this.onSuccess(e.value)}}class Ot{constructor(e){this._tag="ContinuationFinalizer",this[k7]=k9,this.finalizer=e}}let Os="PullAfterNext",Oi={[Symbol.for("effect/ChannelUpstreamPullStrategy")]:{_A:e=>e}},On=e=>{let t=Object.create(Oi);return t._tag=Os,t.emitSeparator=e,t},Or="BracketOut",Oa="Bridge",Oo="ConcatAll",Oc="Emit",Ol="Ensuring",Ou="Fail",Oh="Fold",Op="FromEffect",Od="PipeTo",Of="Provide",Om="Read",Og="Succeed",Ob="SucceedNow",Ox="Suspend",Oy=Symbol.for("effect/Channel"),Ov={[Oy]:{_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutElem:e=>e,_OutDone:e=>e},pipe(){return eY(this,arguments)}},Ow=e=>ei(e,Oy)||cJ(e),OS=M(2,(e,t)=>{let s=Object.create(Ov);return s._tag=Or,s.acquire=()=>e,s.finalizer=t,s}),O_=M(2,(e,t)=>{let s=Object.create(Ov);return s._tag=Oh,s.channel=e,s.k=new Oe(O$,t),s}),Ok=e=>OB(()=>{let t=[];return ON(Oz(e,OO(t)),e=>Oq(()=>[iO(t),e]))}),OO=e=>OD({onInput:t=>ON(Oq(()=>{e.push(t)}),()=>OO(e)),onFailure:OT,onDone:OU}),OE=(e,t,s)=>{let i=Object.create(Ov);return i._tag=Oo,i.combineInners=t,i.combineAll=s,i.onPull=()=>On(t4()),i.onEmit=()=>k6,i.value=()=>e,i.k=j,i},OC=M(4,(e,t,s,i)=>{let n=Object.create(Ov);return n._tag=Oo,n.combineInners=s,n.combineAll=i,n.onPull=()=>On(t4()),n.onEmit=()=>k6,n.value=()=>e,n.k=t,n}),OR=M(2,(e,t)=>{let s=Object.create(Ov);return s._tag=Oa,s.input=t,s.channel=e,s}),OI=M(2,(e,t)=>{let s=Object.create(Ov);return s._tag=Ol,s.channel=e,s.finalizer=t,s}),OT=e=>OF(oY(e)),OF=e=>OA(()=>e),OA=e=>{let t=Object.create(Ov);return t._tag=Ou,t.error=e,t},ON=M(2,(e,t)=>{let s=Object.create(Ov);return s._tag=Oh,s.channel=e,s.k=new Oe(t,OF),s}),OM=M(2,(e,t)=>{let s=Object.create(Ov);return s._tag=Oh,s.channel=e,s.k=new Oe(t.onSuccess,t.onFailure),s}),Oj=e=>{let t=Object.create(Ov);return t._tag=Op,t.effect=()=>e,t},Oz=M(2,(e,t)=>{let s=Object.create(Ov);return s._tag=Od,s.left=()=>e,s.right=()=>t,s}),OP=M(2,(e,t)=>{let s=Object.create(Ov);return s._tag=Of,s.context=()=>t,s.inner=e,s}),OD=e=>OL({onInput:e.onInput,onFailure:t=>tX(ce(t),{onLeft:e.onFailure,onRight:OF}),onDone:e.onDone}),OL=e=>{let t=Object.create(Ov);return t._tag=Om,t.more=e.onInput,t.done=new Oe(e.onDone,e.onFailure),t},O$=e=>Oq(()=>e),OU=e=>{let t=Object.create(Ov);return t._tag=Ob,t.terminal=e,t},OB=e=>{let t=Object.create(Ov);return t._tag=Ox,t.channel=e,t},Oq=e=>{let t=Object.create(Ov);return t._tag=Og,t.evaluate=e,t},OH=OU(void 0),OJ=e=>{let t=Object.create(Ov);return t._tag=Oc,t.out=e,t},OW="Done",OK="Emit",OV="FromEffect",OG="Read",OY={[Symbol.for("effect/ChannelState")]:{_E:e=>e,_R:e=>e}},OX=()=>{let e=Object.create(OY);return e._tag=OW,e},OQ=()=>{let e=Object.create(OY);return e._tag=OK,e},OZ=e=>{let t=Object.create(OY);return t._tag=OV,t.effect=e,t},O0=(e,t,s,i)=>{let n=Object.create(OY);return n._tag=OG,n.upstream=e,n.onEffect=t,n.onEmit=s,n.onDone=i,n},O1=e=>e._tag===OV,O2=e=>O1(e)?e.effect:lz,O3=e=>O1(e)?_g(e.effect):void 0,O5="PullFromChild",O4="PullFromUpstream",O6="DrainChildExecutors",O8="Emit";class O7{constructor(e,t,s){this._tag=O5,this.childExecutor=e,this.parentSubexecutor=t,this.onEmit=s}close(e){let t=this.childExecutor.close(e),s=this.parentSubexecutor.close(e);return void 0!==t&&void 0!==s?yX(c7(t),c7(s),(e,t)=>$(e,hr(t))):void 0!==t?t:void 0!==s?s:void 0}enqueuePullFromChild(e){return this}}class O9{constructor(e,t,s,i,n,r,a,o){this._tag=O4,this.upstreamExecutor=e,this.createChild=t,this.lastDone=s,this.activeChildExecutors=i,this.combineChildResults=n,this.combineWithChildResult=r,this.onPull=a,this.onEmit=o}close(e){let t=this.upstreamExecutor.close(e);return[...this.activeChildExecutors.map(t=>void 0!==t?t.childExecutor.close(e):void 0),t].reduce((e,t)=>void 0!==e&&void 0!==t?yX(e,c7(t),(e,t)=>hr(e,t)):void 0!==e?e:void 0!==t?c7(t):void 0,void 0)}enqueuePullFromChild(e){return new O9(this.upstreamExecutor,this.createChild,this.lastDone,[...this.activeChildExecutors,e],this.combineChildResults,this.combineWithChildResult,this.onPull,this.onEmit)}}class Ee{constructor(e,t,s,i,n,r,a){this._tag=O6,this.upstreamExecutor=e,this.lastDone=t,this.activeChildExecutors=s,this.upstreamDone=i,this.combineChildResults=n,this.combineWithChildResult=r,this.onPull=a}close(e){let t=this.upstreamExecutor.close(e);return[...this.activeChildExecutors.map(t=>void 0!==t?t.childExecutor.close(e):void 0),t].reduce((e,t)=>void 0!==e&&void 0!==t?yX(e,c7(t),(e,t)=>hr(e,t)):void 0!==e?e:void 0!==t?c7(t):void 0,void 0)}enqueuePullFromChild(e){return new Ee(this.upstreamExecutor,this.lastDone,[...this.activeChildExecutors,e],this.upstreamDone,this.combineChildResults,this.combineWithChildResult,this.onPull)}}class Et{constructor(e,t){this._tag=O8,this.value=e,this.next=t}close(e){return this.next.close(e)}enqueuePullFromChild(e){return this}}let Es={[Symbol.for("effect/ChannelUpstreamPullRequest")]:{_A:e=>e}},Ei=e=>{let t=Object.create(Es);return t._tag="Pulled",t.value=e,t},En=e=>{let t=Object.create(Es);return t._tag="NoUpstream",t.activeDownstreamCount=e,t};class Er{constructor(e,t,s){this._activeSubexecutor=void 0,this._cancelled=void 0,this._closeLastSubstream=void 0,this._done=void 0,this._doneStack=[],this._emitted=void 0,this._input=void 0,this._inProgressFinalizer=void 0,this._currentChannel=e,this._executeCloseLastSubstream=s,this._providedEnv=t}run(){let e;for(;void 0===e;)if(void 0!==this._cancelled)e=this.processCancellation();else if(void 0!==this._activeSubexecutor)e=this.runSubexecutor();else try{if(void 0===this._currentChannel)e=OX();else switch(cJ(this._currentChannel)&&(this._currentChannel=Oj(this._currentChannel)),this._currentChannel._tag){case Or:e=this.runBracketOut(this._currentChannel);break;case Oa:{let t=this._currentChannel.input;if(this._currentChannel=this._currentChannel.channel,void 0!==this._input){let s=this._input;this._input=void 0;let i=()=>lr(t.awaitRead(),()=>lI(()=>{let e=s.run();switch(e._tag){case OW:return he(s.getDone(),{onFailure:e=>t.error(e),onSuccess:e=>t.done(e)});case OK:return lr(t.emit(s.getEmit()),()=>i());case OV:return lu(e.effect,{onFailure:e=>t.error(e),onSuccess:()=>i()});case OG:return Ec(e,()=>i(),e=>t.error(e))}}));e=OZ(lr(yP(lb(i())),e=>lT(()=>this.addFinalizer(t=>lr(lW(e),()=>lI(()=>{let e=this.restorePipe(t,s);return void 0!==e?e:lz}))))))}break}case Oo:{let e=new Er(this._currentChannel.value(),this._providedEnv,e=>lT(()=>{let t=void 0===this._closeLastSubstream?lz:this._closeLastSubstream;this._closeLastSubstream=$(t,yY(e))}));e._input=this._input;let t=this._currentChannel;this._activeSubexecutor=new O9(e,e=>t.k(e),void 0,[],(e,s)=>t.combineInners(e,s),(e,s)=>t.combineAll(e,s),e=>t.onPull(e),e=>t.onEmit(e)),this._closeLastSubstream=void 0,this._currentChannel=void 0;break}case Oc:this._emitted=this._currentChannel.out,this._currentChannel=void 0!==this._activeSubexecutor?void 0:OH,e=OQ();break;case Ol:this.runEnsuring(this._currentChannel);break;case Ou:e=this.doneHalt(this._currentChannel.error());break;case Oh:this._doneStack.push(this._currentChannel.k),this._currentChannel=this._currentChannel.channel;break;case Op:{let t=void 0===this._providedEnv?this._currentChannel.effect():$(this._currentChannel.effect(),Sj(this._providedEnv));e=OZ(lu(t,{onFailure:e=>{let t=this.doneHalt(e);return void 0!==t&&O1(t)?t.effect:lz},onSuccess:e=>{let t=this.doneSucceed(e);return void 0!==t&&O1(t)?t.effect:lz}}));break}case Od:{let e=this._input,t=new Er(this._currentChannel.left(),this._providedEnv,e=>this._executeCloseLastSubstream(e));t._input=e,this._input=t,this.addFinalizer(t=>{let s=this.restorePipe(t,e);return void 0!==s?s:lz}),this._currentChannel=this._currentChannel.right();break}case Of:{let e=this._providedEnv;this._providedEnv=this._currentChannel.context(),this._currentChannel=this._currentChannel.inner,this.addFinalizer(()=>lT(()=>{this._providedEnv=e}));break}case Om:{let t=this._currentChannel;e=O0(this._input,j,e=>{try{this._currentChannel=t.more(e)}catch(e){this._currentChannel=t.done.onExit(u3(e))}},e=>{let s=e=>t.done.onExit(e);this._currentChannel=s(e)});break}case Og:e=this.doneSucceed(this._currentChannel.evaluate());break;case Ob:e=this.doneSucceed(this._currentChannel.terminal);break;case Ox:this._currentChannel=this._currentChannel.channel();break;default:this._currentChannel._tag}}catch(e){this._currentChannel=OF(oX(e))}return e}getDone(){return this._done}getEmit(){return this._emitted}cancelWith(e){this._cancelled=e}clearInProgressFinalizer(){this._inProgressFinalizer=void 0}storeInProgressFinalizer(e){this._inProgressFinalizer=e}popAllFinalizers(e){let t=[],s=this._doneStack.pop();for(;s;)"ContinuationFinalizer"===s._tag&&t.push(s.finalizer),s=this._doneStack.pop();let i=0===t.length?lz:Eo(t,e);return this.storeInProgressFinalizer(i),i}popNextFinalizers(){let e=[];for(;0!==this._doneStack.length;){let t=this._doneStack[this._doneStack.length-1];if(t._tag===k8)break;e.push(t),this._doneStack.pop()}return e}restorePipe(e,t){let s=this._input;return(this._input=t,void 0!==s)?s.close(e):lz}close(e){let t,s;let i=this._inProgressFinalizer;void 0!==i&&(t=$(i,vn(lT(()=>this.clearInProgressFinalizer()))));let n=this.popAllFinalizers(e);void 0!==n&&(s=$(n,vn(lT(()=>this.clearInProgressFinalizer()))));let r=void 0===this._activeSubexecutor?void 0:this._activeSubexecutor.close(e);if(void 0!==r||void 0!==t||void 0!==s)return $(c7(Ea(r)),yV(c7(Ea(t))),yV(c7(Ea(s))),ly(([[e,t],s])=>$(e,hr(t),hr(s))),lM,lr(e=>lI(()=>e)))}doneSucceed(e){if(0===this._doneStack.length)return this._done=hs(e),this._currentChannel=void 0,OX();let t=this._doneStack[this._doneStack.length-1];if(t._tag===k8){this._doneStack.pop(),this._currentChannel=t.onSuccess(e);return}let s=this.popNextFinalizers();if(0===this._doneStack.length)return this._doneStack=s.reverse(),this._done=hs(e),this._currentChannel=void 0,OX();let i=Eo(s.map(e=>e.finalizer),hs(e));return this.storeInProgressFinalizer(i),OZ($(i,vn(lT(()=>this.clearInProgressFinalizer())),lM,lr(()=>lT(()=>this.doneSucceed(e)))))}doneHalt(e){if(0===this._doneStack.length)return this._done=u4(e),this._currentChannel=void 0,OX();let t=this._doneStack[this._doneStack.length-1];if(t._tag===k8){this._doneStack.pop(),this._currentChannel=t.onHalt(e);return}let s=this.popNextFinalizers();if(0===this._doneStack.length)return this._doneStack=s.reverse(),this._done=u4(e),this._currentChannel=void 0,OX();let i=Eo(s.map(e=>e.finalizer),u4(e));return this.storeInProgressFinalizer(i),OZ($(i,vn(lT(()=>this.clearInProgressFinalizer())),lM,lr(()=>lT(()=>this.doneHalt(e)))))}processCancellation(){return this._currentChannel=void 0,this._done=this._cancelled,this._cancelled=void 0,OX()}runBracketOut(e){return OZ(lM(lu(this.provide(e.acquire()),{onFailure:e=>lT(()=>{this._currentChannel=OF(e)}),onSuccess:t=>lT(()=>{this.addFinalizer(s=>this.provide(e.finalizer(t,s))),this._currentChannel=OJ(t)})})))}provide(e){return void 0===this._providedEnv?e:$(e,Sj(this._providedEnv))}runEnsuring(e){this.addFinalizer(e.finalizer),this._currentChannel=e.channel}addFinalizer(e){this._doneStack.push(new Ot(e))}runSubexecutor(){let e=this._activeSubexecutor;switch(e._tag){case O5:return this.pullFromChild(e.childExecutor,e.parentSubexecutor,e.onEmit,e);case O4:return this.pullFromUpstream(e);case O6:return this.drainChildExecutors(e);case O8:return this._emitted=e.value,this._activeSubexecutor=e.next,OQ()}}replaceSubexecutor(e){this._currentChannel=void 0,this._activeSubexecutor=e}finishWithExit(e){let t=he(e,{onFailure:e=>this.doneHalt(e),onSuccess:e=>this.doneSucceed(e)});return this._activeSubexecutor=void 0,void 0===t?lz:O2(t)}finishSubexecutorWithCloseEffect(e,...t){this.addFinalizer(()=>$(t,yN(t=>$(lT(()=>t(e)),lr(e=>void 0!==e?e:lz)),{discard:!0})));let s=$(e,he({onFailure:e=>this.doneHalt(e),onSuccess:e=>this.doneSucceed(e)}));return this._activeSubexecutor=void 0,s}applyUpstreamPullStrategy(e,t,s){switch(s._tag){case Os:{let i=!e||t.some(e=>void 0!==e);return[s.emitSeparator,i?[void 0,...t]:t]}case"PullAfterAllEnqueued":{let i=!e||t.some(e=>void 0!==e);return[s.emitSeparator,i?[...t,void 0]:t]}}}pullFromChild(e,t,s,i){return O0(e,j,n=>{let r=s(n);switch(r._tag){case k3:break;case"Close":this.finishWithDoneValue(e,t,r.value);break;case"Yield":{let e=t.enqueuePullFromChild(i);this.replaceSubexecutor(e)}}this._activeSubexecutor=new Et(n,this._activeSubexecutor)},he({onFailure:s=>{let i=this.handleSubexecutorFailure(e,t,s);return void 0===i?void 0:O3(i)},onSuccess:s=>{this.finishWithDoneValue(e,t,s)}}))}finishWithDoneValue(e,t,s){switch(t._tag){case O4:{let i=new O9(t.upstreamExecutor,t.createChild,void 0!==t.lastDone?t.combineChildResults(t.lastDone,s):s,t.activeChildExecutors,t.combineChildResults,t.combineWithChildResult,t.onPull,t.onEmit);this._closeLastSubstream=e.close(hs(s)),this.replaceSubexecutor(i);break}case O6:{let i=new Ee(t.upstreamExecutor,void 0!==t.lastDone?t.combineChildResults(t.lastDone,s):s,t.activeChildExecutors,t.upstreamDone,t.combineChildResults,t.combineWithChildResult,t.onPull);this._closeLastSubstream=e.close(hs(s)),this.replaceSubexecutor(i)}}}handleSubexecutorFailure(e,t,s){return this.finishSubexecutorWithCloseEffect(u4(s),e=>t.close(e),t=>e.close(t))}pullFromUpstream(e){if(0===e.activeChildExecutors.length)return this.performPullFromUpstream(e);let t=e.activeChildExecutors[0],s=new O9(e.upstreamExecutor,e.createChild,e.lastDone,e.activeChildExecutors.slice(1),e.combineChildResults,e.combineWithChildResult,e.onPull,e.onEmit);if(void 0===t)return this.performPullFromUpstream(s);this.replaceSubexecutor(new O7(t.childExecutor,s,t.onEmit))}performPullFromUpstream(e){return O0(e.upstreamExecutor,e=>{let t=void 0===this._closeLastSubstream?lz:this._closeLastSubstream;return this._closeLastSubstream=void 0,$(this._executeCloseLastSubstream(t),yY(e))},t=>{if(void 0!==this._closeLastSubstream){let s=this._closeLastSubstream;return this._closeLastSubstream=void 0,$(this._executeCloseLastSubstream(s),ly(()=>{let s=new Er(e.createChild(t),this._providedEnv,this._executeCloseLastSubstream);s._input=this._input;let[i,n]=this.applyUpstreamPullStrategy(!1,e.activeChildExecutors,e.onPull(Ei(t)));this._activeSubexecutor=new O7(s,new O9(e.upstreamExecutor,e.createChild,e.lastDone,n,e.combineChildResults,e.combineWithChildResult,e.onPull,e.onEmit),e.onEmit),ty(i)&&(this._activeSubexecutor=new Et(i.value,this._activeSubexecutor))}))}let s=new Er(e.createChild(t),this._providedEnv,this._executeCloseLastSubstream);s._input=this._input;let[i,n]=this.applyUpstreamPullStrategy(!1,e.activeChildExecutors,e.onPull(Ei(t)));this._activeSubexecutor=new O7(s,new O9(e.upstreamExecutor,e.createChild,e.lastDone,n,e.combineChildResults,e.combineWithChildResult,e.onPull,e.onEmit),e.onEmit),ty(i)&&(this._activeSubexecutor=new Et(i.value,this._activeSubexecutor))},t=>{if(e.activeChildExecutors.some(e=>void 0!==e)){let t=new Ee(e.upstreamExecutor,e.lastDone,[void 0,...e.activeChildExecutors],e.upstreamExecutor.getDone(),e.combineChildResults,e.combineWithChildResult,e.onPull);if(void 0!==this._closeLastSubstream){let e=this._closeLastSubstream;return this._closeLastSubstream=void 0,$(this._executeCloseLastSubstream(e),ly(()=>this.replaceSubexecutor(t)))}return void this.replaceSubexecutor(t)}let s=this._closeLastSubstream,i=this.finishSubexecutorWithCloseEffect($(t,u9(t=>e.combineWithChildResult(e.lastDone,t))),()=>s,t=>e.upstreamExecutor.close(t));return void 0===i?void 0:O3(i)})}drainChildExecutors(e){if(0===e.activeChildExecutors.length){let t=this._closeLastSubstream;return void 0!==t&&this.addFinalizer(()=>lR(t)),this.finishSubexecutorWithCloseEffect(e.upstreamDone,()=>t,t=>e.upstreamExecutor.close(t))}let t=e.activeChildExecutors[0],s=e.activeChildExecutors.slice(1);if(void 0===t){let[t,i]=this.applyUpstreamPullStrategy(!0,s,e.onPull(En(s.reduce((e,t)=>void 0!==t?e+1:e,0))));return(this.replaceSubexecutor(new Ee(e.upstreamExecutor,e.lastDone,i,e.upstreamDone,e.combineChildResults,e.combineWithChildResult,e.onPull)),ty(t))?(this._emitted=t.value,OQ()):void 0}let i=new Ee(e.upstreamExecutor,e.lastDone,s,e.upstreamDone,e.combineChildResults,e.combineWithChildResult,e.onPull);this.replaceSubexecutor(new O7(t.childExecutor,i,t.onEmit))}}let Ea=e=>void 0!==e?e:lz,Eo=(e,t)=>$(yN(e,e=>c7(e(t))),ly(e=>$(u2(e),t8(()=>hi))),lr(e=>lI(()=>e))),Ec=(e,t,s)=>{let i=[e],n=()=>{let e=i.pop();if(void 0===e||void 0===e.upstream)return c6("Unexpected end of input for channel execution");let r=e.upstream.run();switch(r._tag){case OK:{let r=e.onEmit(e.upstream.getEmit());if(0===i.length){if(void 0===r)return lI(t);return $(r,lu({onFailure:s,onSuccess:t}))}if(void 0===r)return lI(()=>n());return $(r,lu({onFailure:s,onSuccess:()=>n()}))}case OW:{let r=e.onDone(e.upstream.getDone());if(0===i.length){if(void 0===r)return lI(t);return $(r,lu({onFailure:s,onSuccess:t}))}if(void 0===r)return lI(()=>n());return $(r,lu({onFailure:s,onSuccess:()=>n()}))}case OV:return i.push(e),$(e.onEffect(r.effect),cZ(t=>lI(()=>{let s=e.onDone(u4(t));return void 0===s?lz:s})),lu({onFailure:s,onSuccess:()=>n()}));case OG:return i.push(e),i.push(r),lI(()=>n())}};return n()},El=e=>$(Eu(e),_x),Eu=e=>{let t=(t,s,i)=>cK(lT(()=>new Er(e,void 0,j)),e=>lI(()=>$(Eh(e.run(),e),lx(t),yY(hh(t)),yG(hh(s)))),(e,t)=>{let s=e.close(t);return void 0===s?lz:gu(s,e=>uT(i,lt(e)))});return lj(e=>lr(yZ,s=>$(yA([uN(s,da),hl(),hl()]),lr(([i,n,r])=>$(wy(e(t(n,r,i))),lr(t=>$(uT(s,hg(r,void 0).pipe(yY(lU()))),yY(e(hh(n))),yG(wD(t)))))))))},Eh=(e,t)=>{switch(e._tag){case OV:return $(e.effect,lr(()=>Eh(t.run(),t)));case OK:return Eh(t.run(),t);case OW:return lI(()=>t.getDone());case OG:return Ec(e,()=>Eh(t.run(),t),lt)}},Ep="Done",Ed={[Symbol.for("effect/ChannelMergeDecision")]:{_R:e=>e,_E0:e=>e,_Z0:e=>e,_E:e=>e,_Z:e=>e}},Ef=e=>{let t=Object.create(Ed);return t._tag=Ep,t.effect=e,t},Em=e=>{let t=Object.create(Ed);return t._tag="Await",t.f=e,t},Eg="BothRunning",Eb="LeftDone",Ex="RightDone",Ey=Symbol.for("effect/ChannelMergeState"),Ev={[Ey]:Ey},Ew=(e,t)=>{let s=Object.create(Ev);return s._tag=Eg,s.left=e,s.right=t,s},ES=e=>{let t=Object.create(Ev);return t._tag=Eb,t.f=e,t},E_=e=>{let t=Object.create(Ev);return t._tag=Ex,t.f=e,t},Ek="BackPressure",EO="BufferSliding",EE=Symbol.for("effect/ChannelMergeStrategy"),EC={[EE]:EE},ER=e=>{let t=Object.create(EC);return t._tag=Ek,t},EI=e=>{let t=Object.create(EC);return t._tag=EO,t},ET=M(2,(e,{onBackPressure:t,onBufferSliding:s})=>{switch(e._tag){case Ek:return t();case EO:return s()}}),EF="Empty",EA="Emit",EN="Error",EM="Done",Ej=e=>({_tag:EF,notifyProducer:e}),Ez=e=>({_tag:EA,notifyConsumers:e}),EP=e=>({_tag:EN,cause:e}),ED=e=>({_tag:EM,done:e});class EL{constructor(e){this.ref=e}awaitRead(){return lc(me(this.ref,e=>e._tag===EF?[hh(e.notifyProducer),e]:[lz,e]))}get close(){return ln(e=>this.error(oQ(e)))}done(e){return lc(me(this.ref,t=>{switch(t._tag){case EF:return[hh(t.notifyProducer),t];case EA:return[yN(t.notifyConsumers,t=>hg(t,tK(e)),{discard:!0}),ED(e)];case EN:case EM:return[lm,t]}}))}emit(e){return lr(hl(),t=>lc(me(this.ref,s=>{switch(s._tag){case EF:return[hh(s.notifyProducer),s];case EA:{let i=s.notifyConsumers[0],n=s.notifyConsumers.slice(1);if(void 0!==i)return[hg(i,tV(e)),0===n.length?Ej(t):Ez(n)];throw Error("Bug: Channel.SingleProducerAsyncInput.emit - Queue was empty! please report an issue at https://github.com/Effect-TS/effect/issues")}case EN:case EM:return[lm,s]}})))}error(e){return lc(me(this.ref,t=>{switch(t._tag){case EF:return[hh(t.notifyProducer),t];case EA:return[yN(t.notifyConsumers,t=>hf(t,e),{discard:!0}),EP(e)];case EN:case EM:return[lm,t]}}))}get take(){return this.takeWith(e=>u4(ca(e,tK)),e=>hs(e),e=>u5(tV(e)))}takeWith(e,t,s){return lr(hl(),i=>lc(me(this.ref,n=>{switch(n._tag){case EF:return[yY(hg(n.notifyProducer,void 0),ll(hh(i),{onFailure:e,onSuccess:tX({onLeft:s,onRight:t})})),Ez([i])];case EA:return[ll(hh(i),{onFailure:e,onSuccess:tX({onLeft:s,onRight:t})}),Ez([...n.notifyConsumers,i])];case EN:return[lR(e(n.cause)),n];case EM:return[lR(s(n.done)),n]}})))}}let E$=()=>$(hl(),lr(e=>f6(Ej(e))),ly(e=>new EL(e))),EU=M(2,(e,t)=>E5(e,()=>t)),EB=M(2,(e,t)=>O_(e,e=>tX(ce(e),{onLeft:t,onRight:OF}))),Eq=M(2,(e,t)=>OC(e,t,()=>void 0,()=>void 0)),EH=e=>OD({onInput:t=>ON(Oq(()=>{e.push(t)}),()=>EH(e)),onFailure:OT,onDone:O$}),EJ=e=>{let t=OL({onInput:()=>t,onFailure:OF,onDone:O$});return Oz(e,t)},EW=M(2,(e,t)=>OI(e,()=>t)),EK=()=>Oj(hv()),EV=e=>ON(EK(),e),EG=e=>ON(e,j),EY=M(2,(e,t)=>OM(e,{onFailure:e=>{let s=ce(e);switch(s._tag){case"Left":return t.onFailure(s.left);case"Right":return OF(s.right)}},onSuccess:t.onSuccess})),EX=e=>Cf(e.takeWith(OF,t=>ON(OJ(t),()=>EX(e)),O$)),EQ=e=>ly(k2(e),EZ),EZ=e=>OB(()=>E0(e)),E0=e=>$(Oj(_L(e)),ON(tX({onLeft:he({onFailure:OF,onSuccess:OU}),onRight:t=>ON(OJ(t),()=>E0(e))}))),E1=()=>OD({onInput:e=>ON(OJ(e),()=>E1()),onFailure:OT,onDone:OU}),E2=M(2,(e,t)=>Cn(e,{other:Oj(t),onSelfDone:e=>Ef(lI(()=>e)),onOtherDone:e=>Ef(lI(()=>e))})),E3=M(2,(e,t)=>E2(e,hh(t))),E5=M(2,(e,t)=>ON(e,e=>Oq(()=>t(e)))),E4=M(2,(e,t)=>ON(e,e=>Oj(t(e)))),E6=M(2,(e,t)=>E8(e,ca(t))),E8=M(2,(e,t)=>O_(e,e=>OF(t(e)))),E7=M(2,(e,t)=>{let s=OD({onInput:e=>ON(OJ(t(e)),()=>s),onFailure:OT,onDone:OU});return Oz(e,s)}),E9=M(2,(e,t)=>{let s=OL({onInput:e=>$(Oj(t(e)),ON(OJ),ON(()=>s)),onFailure:OF,onDone:OU});return Oz(e,s)}),Ce=M(3,(e,t,s)=>$(_f(function*(i){let n=yield*i(yC(_1(s),e=>kt(e))),r=yield*i(hl()),a=s===Number.POSITIVE_INFINITY?e=>j:(yield*i(_v(s))).withPermits,o=yield*i(Cu(e));return yield*i(lu(o,{onFailure:e=>_P(n,lt(e)),onSuccess:e=>tX(e,{onLeft:e=>yY(lb(a(s)(lz)),cG(_P(n,lR(tK(e))))),onRight:e=>_f(function*(s){let i=yield*s(hl()),o=yield*s(hl());yield*s(cG(_P(n,ly(hh(i),tV)))),yield*s(hg(o,void 0),yY($(lj(s=>$(c7(s(hh(r))),wv(c7(s(t(e)))),lr(e=>lI(()=>e)))),gu(e=>hf(r,e)),lx(i))),a(1),wy),yield*s(hh(o))})})}),m0,lb,wy),n}),ly(e=>{let t=Cf(ll(lc(_L(e)),{onFailure:OF,onSuccess:tX({onLeft:OU,onRight:e=>ON(OJ(e),()=>t)})}));return t}),Cm)),Ct=e=>t=>Cs(e)(t,L),Cs=({bufferSize:e=16,concurrency:t,mergeStrategy:s=ER()})=>(i,n)=>$(_f(function*(r){let a="unbounded"===t?Number.MAX_SAFE_INTEGER:t,o=yield*r(E$()),c=EX(o),l=yield*r(yC(_1(e),e=>kt(e))),u=yield*r(yC(_5(),e=>kt(e))),h=yield*r(f6(t4())),p=yield*r(hl()),d=(yield*r(_v(a))).withPermits,f=yield*r(Cu(i)),m=e=>$(lr(e,tX({onLeft:e=>lR(tw(e)),onRight:e=>cV(_P(l,lR(tV(e))),t4())})),wn({until:e=>ty(e)}),lr(e=>mt(h,t6({onNone:()=>tw(e.value),onSome:t=>tw(n(t,e.value))}))),cZ(e=>o5(e)?lt(e):$(_P(l,lt(e)),yY(hg(p,void 0)),cG)));return yield*r(lu(f,{onFailure:e=>$(_P(l,lt(e)),yY(lR(!1))),onSuccess:tX({onLeft:e=>ve(lb(hh(p)),lb(d(a)(lz)),{onSelfDone:(e,t)=>cV(lW(t),!1),onOtherDone:(t,s)=>yY(lW(s),$(f8(h),lr(t6({onNone:()=>_P(l,lR(tK(e))),onSome:t=>_P(l,lR(tK(n(t,e))))})),cV(!1)))}),onRight:e=>ET(s,{onBackPressure:()=>_f(function*(t){let s=yield*t(hl()),i=$(c,Oz(e),Cu,lr(e=>vt(m(e),lb(hh(p)))),_x);return yield*t(hg(s,void 0),yY(i),d(1),wy),yield*t(hh(s)),!(yield*t(p9(p)))}),onBufferSliding:()=>_f(function*(t){let s=yield*t(hl()),i=yield*t(hl()),n=yield*t(_6(u));yield*t(_L(u),lr(e=>hg(e,void 0)),gf(()=>n>=a)),yield*t(_P(u,s));let r=$(c,Oz(e),Cu,lr(e=>$(m(e),vt(lb(hh(p))),vt(lb(hh(s))))),_x);return yield*t(hg(i,void 0),yY(r),d(1),wy),yield*t(hh(i)),!(yield*t(p9(p)))})})})}),wn({while:e=>e}),wy),[l,o]}),ly(([e,t])=>{let s=$(_L(e),lc,ll({onFailure:OF,onSuccess:tX({onLeft:OU,onRight:e=>ON(OJ(e),()=>s)})}),Cf);return OR(s,t)}),Cm),Ci=M(3,(e,t,s)=>Ct(s)(E7(e,t))),Cn=M(2,(e,t)=>Cm(lr(E$(),s=>{let i=EX(s);return ly(yA([Cu(Oz(i,e)),Cu(Oz(i,t.other)),yZ]),([e,i,n])=>{let r=(e,t,s)=>(i,r,o)=>{let c=e=>e._tag===Ep?lR(Oj(yY(lW(t),e.effect))):ly(gP(t),he({onFailure:t=>Oj(e.f(u4(t))),onSuccess:tX({onLeft:t=>Oj(e.f(hs(t))),onRight:t=>Cv(OJ(t),a(o(e.f)))})}));return he(e,{onFailure:e=>c(i(u4(e))),onSuccess:tX({onLeft:e=>c(i(hs(e))),onRight:e=>lR(ON(OJ(e),()=>ON(Oj(wx(lb(s),n)),e=>a(r(e,t)))))})})},a=s=>{switch(s._tag){case Eg:return Cf(ve(lb(gD(s.left)),lb(gD(s.right)),{onSelfDone:(i,n)=>yY(lW(n),r(i,s.right,e)(t.onSelfDone,Ew,e=>ES(e))),onOtherDone:(e,n)=>yY(lW(n),r(e,s.left,i)(t.onOtherDone,(e,t)=>Ew(t,e),e=>E_(e)))}));case Eb:return Cf(ly(c7(i),he({onFailure:e=>Oj(s.f(u4(e))),onSuccess:tX({onLeft:e=>Oj(s.f(hs(e))),onRight:e=>ON(OJ(e),()=>a(ES(s.f)))})})));case Ex:return Cf(ly(c7(e),he({onFailure:e=>Oj(s.f(u4(e))),onSuccess:tX({onLeft:e=>Oj(s.f(hs(e))),onRight:e=>ON(OJ(e),()=>a(E_(s.f)))})})))}};return $(Oj(yX(wx(lb(e),n),wx(lb(i),n),(e,t)=>Ew(e,t))),ON(a),OR(s))})}))),Cr=((e,t)=>EB(e,e=>{throw t(e)}),M(2,(e,t)=>EB(e,t))),Ca=M(2,(e,t)=>OB(()=>{let s;let i=OD({onInput:e=>ON(OJ(e),()=>i),onFailure:e=>OF(oX(s=CS(e))),onDone:OU}),n=OL({onInput:e=>$(OJ(e),ON(()=>n)),onFailure:e=>o2(e)&&C_(e.defect)&&eM(e.defect,s)?OT(e.defect.error):OF(e),onDone:OU});return Oz(Oz(Oz(e,i),t),n)})),Co=e=>El(EJ(e)),Cc=e=>Cf(lj(t=>ly(y3(),s=>OS(gu(t(y5(e,s)),e=>uA(s,u4(e))),(e,t)=>uA(s,t))))),Cl=e=>Cp(e),Cu=e=>ly(yC(lT(()=>new Er(e,void 0,j)),(e,t)=>{let s=e.close(t);return void 0===s?lz:s}),e=>lI(()=>Ch(e.run(),e))),Ch=(e,t)=>{switch(e._tag){case OW:return he(t.getDone(),{onFailure:lt,onSuccess:e=>lR(tK(e))});case OK:return lR(tV(t.getEmit()));case OV:return $(e.effect,lr(()=>Ch(t.run(),t)));case OG:return Ec(e,()=>Ch(t.run(),t),e=>lt(e))}},Cp=e=>OB(()=>Cd(e)),Cd=e=>OL({onInput:t=>ON(Oj(_P(e,tV(t))),()=>Cd(e)),onFailure:t=>Oj($(_P(e,tK(u4(t))))),onDone:t=>Oj($(_P(e,tK(hs(t)))))}),Cf=e=>EG(Oj(e)),Cm=e=>OE(Cc(e),(e,t)=>e,(e,t)=>e),Cg=(...e)=>Cb(iO(e)),Cb=e=>Cx(0,e.length,e),Cx=(e,t,s)=>e===t?OH:$(OJ($(s,iA(e))),ON(()=>Cx(e+1,t,s))),Cy=M(e=>Ow(e[1]),(e,t,s)=>s?.concurrent?Cn(e,{other:t,onSelfDone:e=>Em(t=>lI(()=>hn(e,t))),onOtherDone:e=>Em(t=>lI(()=>hn(t,e)))}):ON(e,e=>E5(t,t=>[e,t]))),Cv=M(e=>Ow(e[1]),(e,t,s)=>s?.concurrent?E5(Cy(e,t,{concurrent:!0}),e=>e[1]):ON(e,()=>t)),Cw=Symbol.for("effect/Channel/ChannelException"),CS=e=>({_tag:"ChannelException",[Cw]:Cw,error:e}),C_=e=>ei(e,Cw),Ck=Symbol.for("effect/RcRef"),CO={_tag:"Empty"},CE={_A:j,_E:j};class CC extends ds{static{h=f1}constructor(e,t,s,i){super(),this[Ck]=CE,this[h]=f1,this.state=CO,this.semaphore=wf(1),this.acquire=e,this.context=t,this.scope=s,this.idleTimeToLive=i,this.get=CR(this)}commit(){return this.get}}let CR=e=>lj(t=>lI(()=>{switch(e.state._tag){case"Closed":return lm;case"Acquired":return e.state.refCount++,e.state.fiber?cV(lW(e.state.fiber),e.state):lR(e.state);case"Empty":return y3().pipe(mX("scope"),mY("value",({scope:s})=>t(un(e.acquire,uh,tA(e.context,yQ,s)))),ly(({scope:t,value:s})=>{let i={_tag:"Acquired",value:s,scope:t,fiber:void 0,refCount:1};return e.state=i,i}))}})).pipe(e.semaphore.withPermits(1),mX("state"),mY("scope",()=>yQ),lF(({scope:t,state:s})=>t.addFinalizer(()=>lI(()=>(s.refCount--,s.refCount>0)?lz:void 0===e.idleTimeToLive?(e.state=CO,uA(s.scope,hi)):mN(e.idleTimeToLive).pipe(lb,lH(lI(()=>"Acquired"===e.state._tag&&0===e.state.refCount?(e.state=CO,uA(s.scope,hi)):lz)),vn(lT(()=>{s.fiber=void 0})),wx(e.scope),lF(e=>{s.fiber=e}),e.semaphore.withPermits(1))))),ly(({state:e})=>e.value)),CI={_tag:"Left"},CT={_tag:"Right"},CF={_tag:"Both"},CA={_tag:"Either"},CN=e=>{switch(e){case"left":return CI;case"right":return CT;case"both":return CF;case"either":return CA;default:return e}},CM=Symbol.for("effect/Sink"),Cj={_A:e=>e,_In:e=>e,_L:e=>e,_E:e=>e,_R:e=>e};class Cz{constructor(e){this[CM]=Cj,this.channel=e}pipe(){return eY(this,arguments)}}let CP=e=>ei(e,CM),CD=e=>new Cz(OB(()=>C4(e()))),CL=((e,t)=>$(e,CL(iG(t))),M(2,(e,t)=>{let s=OD({onInput:e=>$(OJ(t(e)),ON(()=>s)),onFailure:OT,onDone:O$});return new Cz($(s,Oz(C4(e))))})),C$=M(2,(e,t)=>{let s=OD({onInput:e=>$(Oj(t(e)),ON(OJ),ON(()=>s)),onFailure:OT,onDone:O$});return new Cz($(s,Ca(C4(e))))}),CU=new Cz(EJ(E1())),CB=e=>new Cz(OT(e)),Cq=(e,t,s)=>CD(()=>new Cz(CH(e,t,s))),CH=(e,t,s)=>t(e)?OD({onInput:i=>{let[n,r]=CJ(e,i,t,s,0,i.length);return iJ(r)?$(OJ(r),EU(n)):CH(n,t,s)},onFailure:OT,onDone:()=>OU(e)}):OU(e),CJ=(e,t,s,i,n,r)=>{if(n===r)return[e,iS()];let a=i(e,$(t,iA(n)));return s(a)?CJ(a,t,s,i,n+1,r):[a,$(t,iz(n+1))]},CW=M(2,(e,t)=>new Cz($(C4(e),Ok,EY({onFailure:e=>C4(t.onFailure(e)),onSuccess:([e,s])=>OB(()=>{let i={ref:$(e,i$(iJ))},n=$(Oq(()=>{let e=i.ref;return i.ref=iS(),e}),ON(e=>Cb(e)));return ON(Ok($(n,Cv(E1()),Oz(C4(t.onSuccess(s))))),([e,t])=>$(O$(i.ref),ON(Cb),Cv(Cb(e)),EU(t)))})})))),CK=(e,t,s)=>t(e)?OD({onInput:i=>CK(s(e,i),t,s),onFailure:OT,onDone:()=>OU(e)}):OU(e),CV=(e,t,s)=>CD(()=>new Cz(CG(e,t,s))),CG=(e,t,s)=>t(e)?OD({onInput:i=>$(Oj(CY(e,i,t,s)),ON(([e,i])=>$(i,t6({onNone:()=>CG(e,t,s),onSome:t=>$(OJ(t),EU(e))})))),onFailure:OT,onDone:()=>OU(e)}):OU(e),CY=(e,t,s,i)=>CX(e,t,0,t.length,s,i),CX=(e,t,s,i,n,r)=>s===i?lR([e,t4()]):$(r(e,$(t,iA(s))),lr(e=>n(e)?CX(e,t,s+1,i,n,r):lR([e,tw($(t,iz(s+1)))]))),CQ=M(2,(e,t)=>CW(e,{onFailure:CB,onSuccess:t})),CZ=e=>{let t=OL({onInput:s=>$(Oj(yN(s,t=>e(t),{discard:!0})),ON(()=>t)),onFailure:OF,onDone:()=>OH});return new Cz(t)},C0=e=>{let t=OL({onInput:s=>$(Oj(e(s)),ON(()=>t)),onFailure:OF,onDone:()=>OH});return new Cz(t)},C1=e=>new Cz(Oj(e)),C2=(e,t)=>t?.shutdown?C6(ly(yC(lR(e),kt),C2)):C0(t=>$(_D(e,t))),C3=M(2,(e,t)=>new Cz($(C4(e),E5(t)))),C5=((e,t)=>new Cz($(C4(e),E4(t))),M(2,(e,t)=>C6(_f(function*(s){let i=yield*s(kX(t?.capacity??16)),n=yield*s(EQ(i)),r=yield*s(EQ(i)),a=Cl(i),o=$(n,Oz(C4(e)),Cn({other:$(r,Oz(C4(t.other))),onSelfDone:t.onSelfDone,onOtherDone:t.onOtherDone}));return new Cz(Cn(a,{other:o,onSelfDone:e=>Em(e=>lI(()=>e)),onOtherDone:e=>Ef(lI(()=>e))}))})))),C4=((e,t,s)=>new Cz($(Oj(t),ON(i=>$(e,C4,ON(e=>$(Oj(t),E5(t=>[e,s(i,t)]))))))),e=>cJ(e)?C4(C1(e)):e.channel),C6=e=>new Cz(Cm($(e,ly(e=>C4(e))))),C8=(e=>CP(e[1]),M(e=>CP(e[1]),(e,t,s,i)=>i?.concurrent?C5(e,{other:t,onSelfDone:he({onFailure:e=>Ef(lt(e)),onSuccess:e=>Em(he({onFailure:lt,onSuccess:t=>lR(s(e,t))}))}),onOtherDone:he({onFailure:e=>Ef(lt(e)),onSuccess:e=>Em(he({onFailure:lt,onSuccess:t=>lR(s(t,e))}))})}):CQ(e,e=>C3(t,t=>s(e,t))))),C7="WithSTMRuntime",C9="OnFailure",Re="OnRetry",Rt="OnSuccess",Rs="Sync",Ri="Succeed",Rn="Retry",Rr="Fail",Ra="Interrupt",Ro="Fail",Rc="Interrupt",Rl="Succeed",Ru="Retry",Rh="Done",Rp="Suspend";class Rd{constructor(e){this.value=e}}let Rf=(e,t)=>({ref:e,isNew:t,isChanged:!1,expected:e.versioned,newValue:e.versioned.value}),Rm=e=>e.newValue,Rg=(e,t)=>{e.isChanged=!0,e.newValue=t},Rb=e=>{e.ref.versioned=new Rd(e.newValue)},Rx=e=>e.ref.versioned!==e.expected,Ry=e=>e.isChanged,Rv="Invalid",Rw="ReadWrite",RS=e=>{for(let t of e)Rb(t[1])},R_=e=>{let t="ReadOnly";for(let[,s]of e)if((t=Rx(s)?Rv:Ry(s)?Rw:t)===Rv)break;return t},Rk=e=>{let t=new Map;for(let[,s]of e){for(let e of s.ref.todos)t.set(e[0],e[1]);s.ref.todos=new Map}return t},RO=e=>{for(let[t,s]of Array.from(e.entries()).sort((e,t)=>e[0]-t[0]))s()},RE=(e,t,s)=>{let i=!1;for(let[,n]of t)n.ref.todos.has(e)||(n.ref.todos.set(e,s),i=!0);return i},RC="Done",RR="Interrupted",RI="Running",RT="effect/STM/State",RF=Symbol.for(RT),RA=e=>ei(e,RF),RN=e=>e._tag===RI,RM=e=>e._tag===RC,Rj=e=>({[RF]:RF,_tag:RC,exit:e,[ew](){return $(eS(RT),ek(eS(RC)),ek(eS(e)),eA(this))},[eN]:t=>RA(t)&&t._tag===RC&&eM(e,t.exit)}),Rz=$(eS(RT),ek(eS(RR)),ek(eS("interrupted"))),RP={[RF]:RF,_tag:RR,[ew]:()=>Rz,[eN]:e=>RA(e)&&e._tag===RR},RD=$(eS(RT),ek(eS(RI)),ek(eS("running"))),RL={[RF]:RF,_tag:RI,[ew]:()=>RD,[eN]:e=>RA(e)&&e._tag===RI},R$=e=>{switch(e._tag){case Ro:return Rj(u5(e.error));case"Die":return Rj(u3(e.defect));case Rc:return Rj(u7(e.fiberId));case Rl:return Rj(hs(e.value));case Ru:throw Error("BUG: STM.STMState.fromTExit - please report an issue at https://github.com/Effect-TS/effect/issues")}},RU="effect/TExit",RB=Symbol.for(RU),Rq={_A:e=>e,_E:e=>e},RH=e=>ei(e,RB),RJ=e=>e._tag===Rl,RW=e=>e._tag===Ru,RK=e=>({[RB]:Rq,_tag:Ro,error:e,[ew](){return $(eS(RU),ek(eS(Ro)),ek(eS(e)),eA(this))},[eN]:t=>RH(t)&&t._tag===Ro&&eM(e,t.error)}),RV=e=>({[RB]:Rq,_tag:"Die",defect:e,[ew](){return $(eS(RU),ek(eS("Die")),ek(eS(e)),eA(this))},[eN]:t=>RH(t)&&"Die"===t._tag&&eM(e,t.defect)}),RG=e=>({[RB]:Rq,_tag:Rc,fiberId:e,[ew](){return $(eS(RU),ek(eS(Rc)),ek(eS(e)),eA(this))},[eN]:t=>RH(t)&&t._tag===Rc&&eM(e,t.fiberId)}),RY=e=>({[RB]:Rq,_tag:Rl,value:e,[ew](){return $(eS(RU),ek(eS(Rl)),ek(eS(e)),eA(this))},[eN]:t=>RH(t)&&t._tag===Rl&&eM(e,t.value)}),RX=$(eS(RU),ek(eS(Ru)),ek(eS("retry"))),RQ={[RB]:Rq,_tag:Ru,[ew]:()=>RX,[eN]:e=>RH(e)&&RW(e)},RZ=e=>({_tag:Rh,exit:e}),R0=e=>({_tag:Rp,journal:e}),R1={ref:0},R2=()=>{let e=R1.ref+1;return R1.ref=e,e},R3=Symbol.for("effect/STM"),R5={_R:e=>e,_E:e=>e,_A:e=>e};class R4{get[R3](){return R5}constructor(e){this._op=eQ,this.effect_instruction_i1=void 0,this.effect_instruction_i2=void 0,this.effect_instruction_i0=e,this[c$]=tr,this[ts]=R5,this[CM]=R5,this[Oy]=R5}[eN](e){return this===e}[ew](){return eA(this,e_(this))}[Symbol.iterator](){return new cM(new eg(this))}commit(){return R6(this,L,L)}pipe(){return eY(this,arguments)}}let R6=(e,t,s)=>cW(i=>{let n=i.id(),r=i.getFiberRef(uh),a=i.getFiberRef(ma),o=i.getFiberRef(up),c=R7(n,e,r,a,o);switch(c._tag){case Rh:return t(c.exit),c.exit;case Rp:{let i=R2(),c={value:RL},l=cQ(t=>R9(n,e,i,c,r,a,o,t));return lj(e=>$(e(l),cZ(e=>{let i=c.value;return(RN(i)&&(c.value=RP),RM(i=c.value))?(t(i.exit),i.exit):(s(),lt(e))})))}}}),R8=(e,t,s,i,n,r)=>{let a=new Map,o=new Is(t,a,e,i).run(),c=R_(a);if(c===Rw)RS(a);else if(c===Rv)throw Error("BUG: STM.TryCommit.tryCommit - please report an issue at https://github.com/Effect-TS/effect/issues");switch(o._tag){case Rl:return s.value=R$(o),Ie(hs(o.value),a,n,r);case Ro:return s.value=R$(o),Ie(u4(oY(o.error)),a,n,r);case"Die":return s.value=R$(o),Ie(u4(oX(o.defect)),a,n,r);case Rc:return s.value=R$(o),Ie(u4(oQ(e)),a,n,r);case Ru:return R0(a)}},R7=(e,t,s,i,n)=>{let r=new Map,a=new Is(t,r,e,s).run(),o=R_(r);if(o===Rw&&RJ(a))RS(r);else if(o===Rv)throw Error("BUG: STM.TryCommit.tryCommitSync - please report an issue at https://github.com/Effect-TS/effect/issues");switch(a._tag){case Rl:return Ie(hs(a.value),r,i,n);case Ro:return Ie(u4(oY(a.error)),r,i,n);case"Die":return Ie(u4(oX(a.defect)),r,i,n);case Rc:return Ie(u4(oQ(e)),r,i,n);case Ru:return R0(r)}},R9=(e,t,s,i,n,r,a,o)=>{if(RN(i.value)){let c=R8(e,t,i,n,r,a);switch(c._tag){case Rh:It(c.exit,o);break;case Rp:RE(s,c.journal,()=>R9(e,t,s,i,n,r,a,o))}}},Ie=(e,t,s,i)=>{let n=Rk(t);return n.size>0&&s.scheduleTask(()=>RO(n),i),RZ(e)},It=(e,t)=>{t(e)};class Is{constructor(e,t,s,i){this.contStack=[],this.self=e,this.journal=t,this.fiberId=s,this.env=i}getEnv(){return this.env}pushStack(e){this.contStack.push(e)}popStack(){return this.contStack.pop()}nextSuccess(){let e=this.popStack();for(;void 0!==e&&e.effect_instruction_i0!==Rt;)e=this.popStack();return e}nextFailure(){let e=this.popStack();for(;void 0!==e&&e.effect_instruction_i0!==C9;)e=this.popStack();return e}nextRetry(){let e=this.popStack();for(;void 0!==e&&e.effect_instruction_i0!==Re;)e=this.popStack();return e}run(){let e,t=this.self;for(;void 0===e&&void 0!==t;)try{let s=t;if(s)switch(s._op){case"Tag":t=Ia((e,t,i)=>tN(i,s));break;case"Left":t=Ic(s.left);break;case"None":t=Ic(new uJ);break;case"Right":t=Ig(s.right);break;case"Some":t=Ig(s.value);break;case"Commit":switch(s.effect_instruction_i0){case"Die":e=RV(ey(()=>s.effect_instruction_i1()));break;case Rr:{let i=this.nextFailure();void 0===i?e=RK(ey(()=>s.effect_instruction_i1())):t=ey(()=>i.effect_instruction_i2(ey(()=>s.effect_instruction_i1())));break}case Rn:{let s=this.nextRetry();void 0===s?e=RQ:t=ey(()=>s.effect_instruction_i2());break}case Ra:e=RG(this.fiberId);break;case C7:t=ey(()=>s.effect_instruction_i1(this));break;case Rt:case C9:case Re:this.pushStack(s),t=s.effect_instruction_i1;break;case"Provide":{let e=this.env;this.env=ey(()=>s.effect_instruction_i2(e)),t=$(s.effect_instruction_i1,Io(Ib(()=>this.env=e)));break}case Ri:{let i=s.effect_instruction_i1,n=this.nextSuccess();void 0===n?e=RY(i):t=ey(()=>n.effect_instruction_i2(i));break}case Rs:{let i=ey(()=>s.effect_instruction_i1()),n=this.nextSuccess();void 0===n?e=RY(i):t=ey(()=>n.effect_instruction_i2(i))}}}}catch(e){t=In(e)}return e}}let Ii=M(2,(e,t)=>{let s=new R4(C9);return s.effect_instruction_i1=e,s.effect_instruction_i2=t,s}),In=e=>Ir(()=>e),Ir=e=>{let t=new R4("Die");return t.effect_instruction_i1=e,t},Ia=e=>Ip(t=>Ig(e(t.journal,t.fiberId,t.getEnv()))),Io=M(2,(e,t)=>Ih(e,{onFailure:e=>Ix(t,Ic(e)),onSuccess:e=>Ix(t,Ig(e))})),Ic=e=>Il(()=>e),Il=e=>{let t=new R4(Rr);return t.effect_instruction_i1=e,t},Iu=M(2,(e,t)=>{let s=new R4(Rt);return s.effect_instruction_i1=e,s.effect_instruction_i2=t,s}),Ih=M(2,(e,{onFailure:t,onSuccess:s})=>$(e,If(tV),Ii(e=>$(t(e),If(tK))),Iu(e=>{switch(e._tag){case"Left":return Ig(e.left);case"Right":return s(e.right)}}))),Ip=e=>{let t=new R4(C7);return t.effect_instruction_i1=e,t},Id=e=>{let t=new R4(Ra);return t.effect_instruction_i1=e,t},If=M(2,(e,t)=>$(e,Iu(e=>Ib(()=>t(e))))),Im=new R4(Rn),Ig=e=>{let t=new R4(Ri);return t.effect_instruction_i1=e,t},Ib=e=>{let t=new R4(Rs);return t.effect_instruction_i1=e,t},Ix=M(2,(e,t)=>$(e,Iu(()=>t))),Iy=M(3,(e,t,s)=>$(e,Iu(e=>$(t,If(t=>s(e,t)))))),Iv=((e,t)=>$(e,If(()=>t)),e=>Iu(e,j)),Iw=M(e=>ec(e[0]),(e,t,s)=>s?.discard?$(Ib(()=>e[Symbol.iterator]()),Iu(e=>{let s=IS(()=>{let i=e.next();return i.done?I_:$(t(i.value),Iu(()=>s))});return s})):IS(()=>sC(e).reduce((e,s)=>Iy(e,t(s),(e,t)=>(e.push(t),e)),Ig([])))),IS=e=>Iv(Ib(e)),I_=Ig(void 0),Ik=Symbol.for("effect/TRef"),IO={_A:e=>e};class IE{constructor(e){this[Ik]=IO,this.versioned=new Rd(e),this.todos=new Map}modify(e){return Ia(t=>{let s=IC(this,t),[i,n]=e(Rm(s));return Rg(s,n),i})}pipe(){return eY(this,arguments)}}let IC=(e,t)=>{if(t.has(e))return t.get(e);let s=Rf(e,!1);return t.set(e,s),s},IR=M(2,(e,t)=>Rm(IC(e,t))),II=M(3,(e,t,s)=>{Rg(IC(e,s),t)}),IT=Symbol.for("effect/TQueue/TEnqueue"),IF=Symbol.for("effect/TQueue/TDequeue"),IA={_Out:e=>e},IN={_In:e=>e},IM=((e,t,s)=>IS(()=>{let i=(t,s,n)=>s<t?Ig(n):$(e.takeUpTo(s),Iu(r=>{let a=t-r.length;return 1===a?$(e.take,If(e=>$(n,iD(iT(r)),iN(e)))):a>1?$(e.take,Iu(e=>i(a-1,s-r.length-1,$(n,iD(iT(r)),iN(e))))):Ig($(n,iD(iT(r))))}));return If(i(t,s,iS()),e=>Array.from(e))}),Symbol.for("effect/TPubSub")),Ij=Symbol.for("effect/TPubSub/AbsentValue"),Iz=(e,t,s)=>({head:e,subscribers:t,tail:s});class IP{static{p=IT}constructor(e,t,s,i,n,r,a){this[IM]={_A:e=>e},this[p]=IN,this.isShutdown=Ia(e=>void 0===IR(this.publisherTail,e)),this.awaitShutdown=Iu(this.isShutdown,e=>e?I_:Im),this.size=Ip(e=>void 0===IR(this.publisherTail,e.journal)?Id(e.fiberId):Ig(IR(this.pubsubSize,e.journal))),this.isEmpty=If(this.size,e=>0===e),this.isFull=If(this.size,e=>e===this.capacity()),this.shutdown=Ia(e=>{void 0!==IR(this.publisherTail,e)&&(II(this.publisherTail,void 0,e),r_(IR(this.subscribers,e),t=>{II(t,void 0,e)}),II(this.subscribers,rp(),e))}),this.pubsubSize=e,this.publisherHead=t,this.publisherTail=s,this.requestedCapacity=i,this.strategy=n,this.subscriberCount=r,this.subscribers=a}capacity(){return this.requestedCapacity}offer(e){return Ip(t=>{let s=IR(this.publisherTail,t.journal);if(void 0===s)return Id(t.fiberId);let i=IR(this.subscriberCount,t.journal);if(0===i)return Ig(!0);let n=IR(this.pubsubSize,t.journal);if(n<this.requestedCapacity){let r=new IE(void 0);return II(s,Iz(e,i,r),t.journal),II(this.publisherTail,r,t.journal),II(this.pubsubSize,n+1,t.journal),Ig(!0)}switch(this.strategy._tag){case"BackPressure":return Im;case"Dropping":return Ig(!1);case"Sliding":{if(this.requestedCapacity>0){let e=IR(this.publisherHead,t.journal),s=!0;for(;s;){let i=IR(e,t.journal);if(void 0===i)return Im;let n=i.head,r=i.tail;n!==Ij?(II(e,Iz(Ij,i.subscribers,i.tail),t.journal),II(this.publisherHead,r,t.journal),s=!1):e=r}}let n=new IE(void 0);return II(s,Iz(e,i,n),t.journal),II(this.publisherTail,n,t.journal),Ig(!0)}}})}offerAll(e){return If(Iw(e,e=>this.offer(e)),ic(j))}}class ID{static{d=IF}constructor(e,t,s,i,n,r){this[IM]=IM,this[d]=IA,this.isShutdown=Ia(e=>void 0===IR(this.subscriberHead,e)),this.awaitShutdown=Iu(this.isShutdown,e=>e?I_:Im),this.size=Ip(e=>{let t=IR(this.subscriberHead,e.journal);if(void 0===t)return Id(e.fiberId);let s=!0,i=0;for(;s;){let n=IR(t,e.journal);void 0===n?s=!1:(n.head!==Ij&&(i+=1)>=Number.MAX_SAFE_INTEGER&&(s=!1),t=n.tail)}return Ig(i)}),this.isEmpty=If(this.size,e=>0===e),this.isFull=If(this.size,e=>e===this.capacity()),this.peek=Ip(e=>{let t=IR(this.subscriberHead,e.journal);if(void 0===t)return Id(e.fiberId);let s=Ij,i=!0;for(;i;){let n=IR(t,e.journal);if(void 0===n)return Im;let r=n.head,a=n.tail;r!==Ij?(s=r,i=!1):t=a}return Ig(s)}),this.peekOption=Ip(e=>{let t=IR(this.subscriberHead,e.journal);if(void 0===t)return Id(e.fiberId);let s=t4(),i=!0;for(;i;){let n=IR(t,e.journal);if(void 0===n)s=t4(),i=!1;else{let e=n.head,r=n.tail;e!==Ij?(s=tw(e),i=!1):t=r}}return Ig(s)}),this.shutdown=Ia(e=>{let t=IR(this.subscriberHead,e);if(void 0!==t){II(this.subscriberHead,void 0,e);let s=!0;for(;s;){let i=IR(t,e);if(void 0===i)s=!1;else{let s=i.head,n=i.tail;if(s!==Ij){let r=i.subscribers;if(1===r){let s=IR(this.pubsubSize,e);II(t,Iz(Ij,0,n),e),II(this.publisherHead,n,e),II(this.pubsubSize,s-1,e)}else II(t,Iz(s,r-1,n),e)}t=n}}let i=IR(this.subscriberCount,e);II(this.subscriberCount,i-1,e),II(this.subscribers,rv(IR(this.subscribers,e),this.subscriberHead),e)}}),this.take=Ip(e=>{let t=IR(this.subscriberHead,e.journal);if(void 0===t)return Id(e.fiberId);let s=Ij,i=!0;for(;i;){let n=IR(t,e.journal);if(void 0===n)return Im;let r=n.head,a=n.tail;if(r!==Ij){let o=n.subscribers;if(1===o){let s=IR(this.pubsubSize,e.journal);II(t,Iz(Ij,0,a),e.journal),II(this.publisherHead,a,e.journal),II(this.pubsubSize,s-1,e.journal)}else II(t,Iz(r,o-1,a),e.journal);II(this.subscriberHead,a,e.journal),s=r,i=!1}else t=a}return Ig(s)}),this.takeAll=this.takeUpTo(Number.POSITIVE_INFINITY),this.pubsubSize=e,this.publisherHead=t,this.requestedCapacity=s,this.subscriberHead=i,this.subscriberCount=n,this.subscribers=r}capacity(){return this.requestedCapacity}takeUpTo(e){return Ip(t=>{let s=IR(this.subscriberHead,t.journal);if(void 0===s)return Id(t.fiberId);let i=[],n=0;for(;n!==e;){let r=IR(s,t.journal);if(void 0===r)n=e;else{let e=r.head,a=r.tail;if(e!==Ij){let o=r.subscribers;if(1===o){let e=IR(this.pubsubSize,t.journal);II(s,Iz(Ij,0,a),t.journal),II(this.publisherHead,a,t.journal),II(this.pubsubSize,e-1,t.journal)}else II(s,Iz(e,o-1,a),t.journal);i.push(e),n+=1}s=a}}return II(this.subscriberHead,s,t.journal),Ig(i)})}}class IL{constructor(e){this.size=0,this.current=0,this.capacity=e,this.array=Array.from({length:e},L)}head(){return se(this.array[this.current])}lastOrNull(){if(0===this.size)return;let e=0===this.current?this.array.length-1:this.current-1;return this.array[e]??void 0}put(e){this.array[this.current]=e,this.increment()}dropLast(){this.size>0&&(this.decrement(),this.array[this.current]=void 0)}toChunk(){let e=this.current-this.size;return iO(e<0?[...this.array.slice(this.capacity+e,this.capacity),...this.array.slice(0,this.current)]:this.array.slice(e,this.current))}increment(){this.size<this.capacity&&(this.size+=1),this.current=(this.current+1)%this.capacity}decrement(){this.size-=1,this.current>0?this.current-=1:this.current=this.capacity-1}}let I$=Symbol.for("effect/Stream/Handoff"),IU="Empty",IB="Full",Iq=e=>({_tag:IU,notifyConsumer:e}),IH=(e,t)=>({_tag:IB,value:e,notifyProducer:t}),IJ=(e,t)=>s=>{switch(s._tag){case IU:return e(s.notifyConsumer);case IB:return t(s.value,s.notifyProducer)}},IW={_A:e=>e},IK=()=>$(hl(),lr(e=>f6(Iq(e))),ly(e=>({[I$]:IW,ref:e}))),IV=M(2,(e,t)=>lr(hl(),s=>lc(me(e.ref,i=>$(i,IJ(e=>[yY(hg(e,void 0),hh(s)),IH(t,s)],(s,n)=>[lr(hh(n),()=>$(e,IV(t))),i])))))),IG=e=>lr(hl(),t=>lc(me(e.ref,s=>$(s,IJ(t=>[lr(hh(t),()=>IG(e)),s],(e,s)=>[cV(hg(s,void 0),e),Iq(t)]))))),IY="Emit",IX="Halt",IQ=e=>({_tag:IY,elements:e}),IZ=e=>({_tag:IX,cause:e}),I0=e=>({_tag:"End",reason:e}),I1=()=>c9(t4()),I2=e=>lw(lt(e),tw),I3="ScheduleEnd",I5="UpstreamEnd",I4={_tag:I3},I6={_tag:I5},I8="DrainLeft",I7="DrainRight",I9="PullBoth",Te="PullLeft",Tt="PullRight",Ts={_tag:I8},Ti={_tag:I7},Tn={_tag:I9},Tr=e=>({_tag:Te,rightChunk:e}),Ta=e=>({_tag:Tt,leftChunk:e}),To="PullBoth",Tc="PullLet",Tl="PullRight",Tu={_tag:To},Th=e=>({_tag:Tc,rightChunk:e}),Tp=e=>({_tag:Tl,leftChunk:e}),Td=Symbol.for("effect/Take"),Tf={_A:e=>e,_E:e=>e};class Tm{constructor(e){this[Td]=Tf,this.exit=e}pipe(){return eY(this,arguments)}}let Tg=e=>new Tm(hs(e)),Tb=e=>lI(()=>e.exit),Tx=new Tm(u5(t4())),Ty=e=>new Tm(u4($(e,ca(tw)))),Tv=M(2,(e,{onEnd:t,onFailure:s,onSuccess:i})=>he(e.exit,{onFailure:e=>t6(wF(e),{onNone:t,onSome:s}),onSuccess:i})),Tw=e=>new Tm(hs(ik(e))),TS=Symbol.for("effect/Stream"),T_={_R:e=>e,_E:e=>e,_A:e=>e};class Tk{constructor(e){this[TS]=T_,this.channel=e}pipe(){return eY(this,arguments)}}let TO=e=>ei(e,TS)||cJ(e),TE=4096,TC=((e,t,s)=>TW(TC(e,t,s),e=>tX(e,{onLeft:t4,onRight:tw})),M(3,(e,t,s)=>$(T3(yA([IK(),f6(I4),f6(iS()),vG(s),f6(!1),f6(!1)])),TK(([s,i,n,r,a,o])=>{let c=OL({onInput:e=>ON(Oj($(s,IV(IQ(e)),gf(()=>iJ(e)))),()=>c),onFailure:e=>Oj(IV(s,IZ(e))),onDone:()=>Oj(IV(s,I0(I6)))}),l=$(f9(n,iS()),lr(e=>iJ(e)?$(f7(a,!0),yY(lR($(OJ(e),ON(()=>l))))):$(IG(s),ly(e=>{switch(e._tag){case IY:return $(Oj(f7(a,!0)),Cv(OJ(e.elements)),Cv(Oj(f8(o))),ON(e=>e?OH:l));case IX:return OF(e.cause);case"End":if(e.reason._tag===I3)return $(f8(a),ly(e=>e?Oj($(f7(i,I4),yY(f7(o,!0)))):$(Oj($(f7(i,I4),yY(f7(o,!0)))),ON(()=>l))),Cf);return $(f7(i,e.reason),yY(f7(o,!0)),Oj)}}))),Cf),u=e=>r.next(e),h=(e,r,c)=>{let p=$(f7(a,!1),yY(f7(o,!1)),yY($(l,Ca(C4(t)),Ok,El,wx(c)))),d=(e,t,s)=>$(f7(n,iq(e)),yY(ly(f8(i),e=>{switch(e._tag){case I3:return $(yA([f8(a),p,$(u(tw(t)),wx(c))]),ly(([e,i,n])=>{let r=$(s,t6({onNone:()=>ik(tV(t)),onSome:e=>i_(tV(t),tK(e))}));return e?$(OJ(r),ON(()=>h(i,n,c))):h(i,n,c)}),Cf);case I5:return $(f8(a),ly(e=>e?OJ(ik(tV(t))):OH),Cf)}})),Cf);return Cf(ve(gD(e),gD(r),{onSelfDone:(e,t)=>$(lW(r),yY($(lI(()=>e),ly(([e,t])=>d(e,t,t4()))))),onOtherDone:(t,i)=>lu(lI(()=>t),{onFailure:t=>tX(ce(t),{onLeft:()=>$(s,IV(I0(I4)),yP,yY($(gD(e),ly(([e,t])=>d(e,t,t4()))))),onRight:t=>$(s,IV(IZ(t)),yP,yY($(gD(e),ly(([e,t])=>d(e,t,t4())))))}),onSuccess:t=>$(s,IV(I0(I4)),yP,yY($(gD(e),ly(([e,s])=>d(e,s,tw(t))))))})}))};return FP($(e,T1,Oz(c),El,wy,yY($(l,Ca(C4(t)),Ok,El,wy,lr(e=>$(wy(u(t4())),lr(t=>$(yZ,ly(s=>new Tk(h(e,t,s)))))))))))})))),TR=M(2,(e,t)=>TI(e,e=>tX(ce(e),{onLeft:t,onRight:TJ}))),TI=M(2,(e,t)=>new Tk($(T1(e),O_(e=>T1(t(e)))))),TT=M(2,(e,t)=>$(e,TI(e=>$(t(e),t8(()=>TJ(e)))))),TF=e=>c0(mq(e),e=>"None"===e._tag?ga:c9(e.value)),TA=M(4,(e,t,s,i)=>{let n=(e,t)=>Cv(Oj(IG(t)),OL({onInput:s=>ON(Oj($(e,IV(Tg(s)))),()=>n(e,t)),onFailure:t=>Oj(IV(e,Ty(t))),onDone:()=>Oj(IV(e,Tx))}));return new Tk($(yA([IK(),IK(),IK(),IK()]),lF(([t,s,i])=>$(T1(e),Oz(n(t,i)),Eu,wy)),lF(([e,s,i,r])=>$(T1(t),Oz(n(s,r)),Eu,wy)),ly(([e,t,n,r])=>{let a=$(n,IV(void 0),yY($(IG(e),lr(Tb)))),o=$(r,IV(void 0),yY($(IG(t),lr(Tb))));return T1(Fj(s,e=>lr(i(e,a,o),TF)))}),Cm))}),TN=M(2,(e,t)=>new Tk($(T1(e),Cv(T1(t))))),TM=((e,t)=>TK(e,()=>t),e=>T3(c4(e))),Tj=M(2,(e,t)=>$(hl(),lr(s=>$(e,TD({maximumLag:t.maximumLag,decide:e=>lr(hh(s),t=>t(e))}),lr(e=>$(yA(iG(i3(0,t.size-1),t=>ly(e,([e,s])=>[[e,t],s]))),ly(iT),lr(e=>{let[i,n]=io(e,[new Map,iS()],([e,t],[s,i])=>[e.set(s[0],s[1]),$(t,iM(i))]);return $(hg(s,e=>ly(t.decide(e),e=>t=>$(e(i.get(t))))),cV(Array.from(n)))}))))))),Tz={ref:0},TP=()=>{let e=Tz.ref;return Tz.ref=e+1,e},TD=M(2,(e,t)=>TL(e,t.maximumLag,t.decide,()=>lz)),TL=M(4,(e,t,s,i)=>$(yC(f6(new Map),(e,t)=>$(f8(e),lr(e=>$(e.values(),yN(kt))))),lr(n=>_f(function*(r){let a=yield*r(_v(1)),o=yield*r(f6($(_1(t),lr(e=>{let t=TP();return $(mt(n,s=>s.set(t,e)),cV([t,e]))})))),c=e=>a.withPermits(1)($(f7(o,$(_1(1),lF(t=>_P(t,e)),lr(e=>{let t=TP();return $(mt(n,s=>s.set(t,e)),cV(s_(t,e)))}))),yY($(f8(n),lr(t=>$(iO(t.values()),yN(t=>$(_P(t,e),mJ(e=>o5(e)?tw(lz):t4()))))))),yY(i(e)),cG));return yield*r(e,Fw(e=>$(s(e),lr(t=>$(f8(n),lr(s=>$(s.entries(),gr(iS(),(s,[i,n])=>t(i)?$(_P(n,hs(e)),lu({onFailure:e=>o5(e)?lR($(s,iM(i))):lt(e),onSuccess:()=>lR(s)})):lR(s)),lr(e=>iJ(e)?$(mt(n,t=>{for(let s of e)t.delete(s);return t})):lz))))),cG)),lu({onFailure:e=>c(u4($(e,ca(tw)))),onSuccess:()=>c(u5(t4()))}),wy),a.withPermits(1)(lc(f8(o)))})))),T$=((e,t)=>{let s=e=>OD({onInput:t=>{let i=$(t,iz(e)),n=Math.max(0,e-t.length);return iH(t)||n>0?s(n):$(OJ(i),Cv(E1()))},onFailure:OT,onDone:()=>OH});return new Tk($(T1(e),Ca(s(t))))},new Tk(OH)),TU=M(2,(e,t)=>new Tk($(T1(e),EW(t)))),TB=()=>T3(hv()),Tq=e=>$(TB(),TK(e)),TH=e=>T5(c9(tw(e))),TJ=e=>T3(lt(e)),TW=M(2,(e,t)=>Fs(e,iL(t))),TK=M(e=>TO(e[0]),(e,t,s)=>{let i=s?.bufferSize??16;return s?.switch?TV(s?.concurrency,()=>TG(e,1,i,t),s=>TG(e,s,i,t)):TV(s?.concurrency,()=>new Tk(Eq(T1(e),e=>$(e,iG(e=>T1(t(e))),ia(OH,(e,t)=>$(e,Cv(t)))))),i=>new Tk($(T1(e),Eq(Cb),Ci(e=>T1(t(e)),s))))}),TV=(e,t,s)=>{switch(e){case void 0:return t();case"unbounded":return s(Number.MAX_SAFE_INTEGER);default:return e>1?s(e):t()}},TG=M(4,(e,t,s,i)=>new Tk($(T1(e),Eq(Cb),Ci(e=>T1(i(e)),{concurrency:t,mergeStrategy:EI(),bufferSize:s})))),TY=M(e=>TO(e[0]),(e,t)=>TK(e,j,t)),TX=e=>{let t=OL({onInput:e=>ON(Cb(e),()=>t),onFailure:OF,onDone:()=>OH});return new Tk($(T1(e),Oz(t)))},TQ=e=>{let t=(e,t)=>{let[s,i]=$(e,iX(e=>!uZ(e))),n=$(iW(i),t6({onNone:()=>t,onSome:he({onFailure:e=>t6(wF(e),{onNone:()=>OH,onSome:OF}),onSuccess:()=>OH})}));return $(OJ($(s,iL(e=>uZ(e)?tw(e.value):t4()))),ON(()=>n))},s=OL({onInput:e=>t(e,s),onFailure:e=>OF(e),onDone:()=>OH});return new Tk($(T1(e),Oz(s)))},TZ=e=>TX(TQ($(e,Fe(e=>e.exit)))),T0=e=>new Tk(e),T1=e=>{if("channel"in e)return e.channel;if(cJ(e))return T1(T3(e));throw TypeError("Expected a Stream.")},T2=e=>new Tk(iH(e)?OH:OJ(e)),T3=e=>$(e,lw(tw),T5),T5=e=>new Tk(Cf(mZ(e,{onFailure:t6({onNone:()=>OH,onSome:OT}),onSuccess:e=>OJ(ik(e))}))),T4=(e,t)=>{let s=t?.maxChunkSize??TE;if(t?.scoped){let i=ly(k2(e),e=>T9(e,{maxChunkSize:s,shutdown:!0}));return t.shutdown?ly(i,TU(k1(e))):i}let i=TK(FE(k2(e)),e=>T9(e,{maxChunkSize:s}));return t?.shutdown?TU(i,k1(e)):i},T6=e=>FC(()=>iv(e)?T2(e):T8(e[Symbol.iterator]())),T8=(e,t=TE)=>$(lT(()=>{let s=[],i=e=>$(lT(()=>{let n=e.next();if(1===t)return n.done?OH:$(OJ(ik(n.value)),ON(()=>i(e)));s=[];let r=0;for(;!1===n.done&&(s.push(n.value),!((r+=1)>=t));)n=e.next();return r>0?$(OJ(iT(s)),ON(()=>i(e))):OH}),Cf);return new Tk(i(e))}),Fz),T7=e=>$(e,ly(Fm),FP),T9=(e,t)=>$(_U(e,1,t?.maxChunkSize??TE),cZ(t=>$(_9(e),lr(e=>e&&o5(t)?I1():I2(t)))),Fm,t?.shutdown?TU(kt(e)):j),Fe=((e,t)=>{let s=e=>$(wL(e),ly(t6({onNone:()=>OD({onInput:t=>ON(OJ(t),()=>s(e)),onFailure:OT,onDone:()=>OH}),onSome:he({onFailure:OF,onSuccess:()=>OH})})),Cf);return new Tk($(wy(t),ly(t=>$(T1(e),Oz(s(t)))),Cm))},M(2,(e,t)=>new Tk($(T1(e),E7(iG(t)))))),Ft=M(3,(e,t,s)=>FC(()=>{let i=e=>OD({onInput:t=>$(lI(()=>{let n=[],r=e=>lT(()=>{n.push(e)});return $(t,gr(e,(e,t)=>$(s(e,t),lr(([e,t])=>$(r(t),cV(e))))),mZ({onFailure:e=>0!==n.length?Cv(OJ(iT(n)),OT(e)):OT(e),onSuccess:e=>ON(OJ(iT(n)),()=>i(e))}))}),Cf),onFailure:OT,onDone:()=>OH});return new Tk($(T1(e),Ca(i(t))))})),Fs=M(2,(e,t)=>new Tk($(T1(e),E7(t)))),Fi=((e,t)=>$(e,Fs(iU(t))),M(2,(e,t)=>{let s=e=>{let i=e.next();return i.done?OL({onInput:e=>s(e[Symbol.iterator]()),onFailure:OF,onDone:O$}):Cf(ly(t(i.value),t=>ON(OJ(ik(t)),()=>s(e))))};return new Tk($(T1(e),Oz(OB(()=>s(iS()[Symbol.iterator]())))))})),Fn=M(3,(e,t,s)=>new Tk($(T1(e),Eq(Cb),Ce(s,t),E7(ik)))),Fr=M(2,(e,t)=>new Tk($(T1(e),E6(t)))),Fa=(e=>TO(e[1]),M(2,(e,t)=>Fo(e,t,{onSelf:tK,onOther:tV}))),Fo=M(3,(e,t,s)=>{let i=s.haltStrategy?CN(s.haltStrategy):CF,n=e=>t=>e||!uZ(t)?Ef(lI(()=>t)):Em(e=>lI(()=>e));return new Tk(Cn(T1(Fe(e,s.onSelf)),{other:T1(Fe(t,s.onOther)),onSelfDone:n("Either"===i._tag||"Left"===i._tag),onOtherDone:n("Either"===i._tag||"Right"===i._tag)}))}),Fc=((e,t)=>new Tk($(T1(e),Cr(()=>T1(t())))),M(2,(e,t)=>{let s=OD({onInput:e=>iH(e)?OB(()=>s):$(OJ(e),Cv(E1())),onFailure:OT,onDone:()=>OB(()=>T1(t()))});return new Tk($(T1(e),Oz(s)))})),Fl=(e=>"function"==typeof e[1],M(2,(e,t)=>new Tk(Oz(T1(e),t)))),Fu=M(2,(e,t)=>new Tk($(T1(e),OP(t)))),Fh=((e,t)=>new Tk(Cm($(kp(t),ly(t=>$(T1(e),OP(t)))))),M(3,(e,t,s)=>Tq(i=>TK(s,s=>$(e,Fu(tA(i,t,s))))))),Fp=((e,t)=>Tq(s=>$(e,Fu(t(s)))),M(2,(e,t)=>FC(()=>{let s=Math.max(t,1),i=Fd(new Ff(s),s);return new Tk($(T1(e),Oz(i)))}))),Fd=(e,t)=>OL({onInput:s=>{if(s.length===t&&e.isEmpty())return ON(OJ(s),()=>Fd(e,t));if(s.length>0){let i;let n=[],r=0;for(;r<s.length;){for(;r<s.length&&void 0===i;)i=e.write($(s,iA(r))),r+=1;void 0!==i&&(n.push(i),i=void 0)}return ON(Cg(...n),()=>Fd(e,t))}return OB(()=>Fd(e,t))},onFailure:t=>Cv(e.emitIfNotEmpty(),OF(t)),onDone:()=>e.emitIfNotEmpty()});class Ff{constructor(e){this.builder=[],this.pos=0,this.n=e}isEmpty(){return 0===this.pos}write(e){if(this.builder.push(e),this.pos+=1,this.pos===this.n){let e=iT(this.builder);return this.builder=[],this.pos=0,e}}emitIfNotEmpty(){return 0!==this.pos?OJ(iT(this.builder)):OH}}let Fm=e=>Fj(e,e=>$(ly(e,t=>tw([t,e])),c0(t6({onNone:()=>lR(t4()),onSome:c9})))),Fg=e=>Fm($(e,ly(ik))),Fb=((e,t)=>Fb(e,t,{onElement:e=>tV(e),onSchedule:tK}),M(3,(e,t,s)=>$(vG(t),ly(t=>{let i=$(t.last,lO,ly(s.onSchedule)),n=$(e,Fe(s.onElement),T1),r=Cf(mZ(t.next(void 0),{onFailure:()=>OH,onSuccess:()=>$(n,Cv($(i,ly(e=>$(OJ(ik(e)),ON(()=>r))),Cf)))}));return new Tk($(n,Cv(r)))}),Fz))),Fx=M(2,(e,t)=>$(T1(e),Ca(C4(t)),Co)),Fy=M(3,(e,t,s)=>$(e,Fv(t,P,s),_x)),Fv=((e,t,s,i)=>$(e,FO(Cq(t,s,i))),M(4,(e,t,s,i)=>$(e,FO(CV(t,s,i))))),Fw=M(2,(e,t)=>$(e,FO(CZ(t)))),FS=M(2,(e,t)=>$(e,Fk(t))),F_=((e,t)=>$(e,Fk(t),_x),M(2,(e,t)=>{let s=OL({onInput:e=>ON(Oj(_D(t,iG(e,hs))),()=>s),onFailure:e=>Oj(_P(t,u4(ca(e,tw)))),onDone:()=>Oj(_P(t,u5(t4())))});return $(Oz(T1(e),s),EJ,Eu,cG)})),Fk=M(2,(e,t)=>{let s=OL({onInput:e=>ON(OJ(Tg(e)),()=>s),onFailure:e=>OJ(Ty(e)),onDone:()=>OJ(Tx)});return $(Oz(T1(e),s),E9(e=>_P(t,e)),EJ,Eu,cG)}),FO=M(2,(e,t)=>$(T1(e),Ca(C4(t)),EJ,Eu)),FE=((e,t)=>$(e,Ft(t4(),(e,s)=>{switch(e._tag){case"None":return lR([tw(s),s]);case"Some":return $(t(e.value,s),ly(e=>[tw(e),e]))}})),e=>new Tk(EW(Cc($(e,ly(ik))),lz))),FC=((e,t,s)=>t<=0||s<=0?TM(new uq("Invalid bounds - `chunkSize` and `stepSize` must be greater than zero")):new Tk(OB(()=>{let i=new IL(t),n=(e,n)=>{if(e<t){let e=i.toChunk();return $(OJ(iH(e)?iS():ik(e)),ON(()=>n))}let r=e-(e-t)%s;if(r===e)return n;let a=$(i.toChunk(),iZ(e-(r-t+s)));return $(OJ(iH(a)?iS():ik(a)),ON(()=>n))},r=e=>OL({onInput:n=>ON(OJ(iL(n,(n,r)=>{i.put(n);let a=e+r+1;return a<t||(a-t)%s>0?t4():tw(i.toChunk())})),()=>r(e+n.length)),onFailure:t=>n(e,OF(t)),onDone:()=>n(e,OH)});return $(T1(e),Oz(r(0)))})),e=>new Tk(OB(()=>T1(e())))),FR=((e,t)=>{let s=OD({onInput:e=>{let i=$(e,i0(t));return i.length===e.length?$(OJ(i),ON(()=>s)):OJ(i)},onFailure:OT,onDone:O$});return new Tk($(T1(e),Ca(s)))},(e,t,s,i,n)=>{let r=(e,a)=>OL({onInput:o=>$(t(o),yV(p5),ly(([t,c])=>{let l=e+(c-a)/ny(i)*s,u=s+n<0?Number.POSITIVE_INFINITY:s+n,h=(l<0?u:Math.min(l,u))-t,p=nd(Math.max(0,(h>=0?0:-h/s)*ny(i)));return nC(p,nu)?$(Oj(mN(p)),Cv(OJ(o)),ON(()=>r(h,c))):ON(OJ(o),()=>r(h,c))}),Cf),onFailure:OF,onDone:()=>OH}),a=$(p5,ly(e=>r(s,e)),Cf);return new Tk($(T1(e),Ca(a)))}),FI=M(3,(e,t,s)=>$(FA(e),ly(wS({onTimeout:()=>ca(t(),tw),duration:s})),T7)),FT=((e,t,s)=>{let i=new uD("Stream Timeout");return $(e,FI(()=>oX(i),t),TT(e=>o2(e)&&wM(e.defect)&&void 0!==e.defect.message&&"Stream Timeout"===e.defect.message?tw(s):t4()))},e=>{if("number"==typeof e)return kX(e);if("unbounded"===e.capacity)return k0({replay:e.replay});switch(e.strategy){case"dropping":return kQ(e);case"sliding":return kZ(e);default:return kX(e)}}),FF=M(2,(e,t)=>$(yC(FT(t),e=>k1(e)),lF(t=>$(e,FS(t),wy)))),FA=e=>ly(Cu(T1(e)),e=>$(e,lw(tw),lr(tX({onLeft:()=>c9(t4()),onRight:lR})))),FN=(e=>TO(e[0]),M(e=>TO(e[0]),(e,t)=>ly(w1(),s=>FM(e,s,t)))),FM=M(e=>TO(e[0]),(e,t,s)=>{let i,n;let r=wB(t),a=w$(t);return new ReadableStream({start(t){n=r(y3());let s=$(FA(e),y5(n),r,lr(e=>iH(e)?s:lR(e)));i=$(s,lF(e=>lT(()=>{iG(e,e=>{t.enqueue(e)})})),gu(()=>uA(n,hi)),mK({None:()=>lT(()=>{t.close()}),Some:e=>lT(()=>{t.error(e.value)})}),cG)},pull:()=>new Promise(e=>{a(i,{scope:n}).addObserver(t=>e())}),cancel:()=>new Promise(e=>{a(uA(n,hi)).addObserver(t=>e())})},s?.strategy)}),Fj=(e,t)=>FC(()=>{let s=e=>Cf(ly(t(e),t6({onNone:()=>OH,onSome:([e,t])=>ON(OJ(e),()=>s(t))})));return new Tk(s(e))}),Fz=e=>TY(T3(e)),FP=e=>TY(FE(e)),FD=((e,t)=>$(T3(t),TK(t=>t?e:T$)),M(3,(e,t,s)=>{let i=(e,t,s)=>{switch(e._tag){case To:return $(TF(t),yV(TF(s),{concurrent:!0}),lh({onFailure:e=>lR(u5(tw(e))),onSuccess:([e,r])=>ty(e)&&ty(r)?iH(e.value)&&iH(r.value)?i(Tu,t,s):iH(e.value)?i(Th(r.value),t,s):iH(r.value)?i(Tp(e.value),t,s):lR(hs(n(e.value,r.value))):lR(u5(t4()))}));case Tc:return lh(t,{onFailure:e=>lR(u5(e)),onSuccess:r=>iH(r)?i(Th(e.rightChunk),t,s):iH(e.rightChunk)?i(Tp(r),t,s):lR(hs(n(r,e.rightChunk)))});case Tl:return lh(s,{onFailure:e=>lR(u5(e)),onSuccess:r=>iH(r)?i(Tp(e.leftChunk),t,s):iH(e.leftChunk)?i(Th(r),t,s):lR(hs(n(e.leftChunk,r)))})}},n=(e,t)=>{let[i,n]=s(e,t);switch(n._tag){case"Left":if(iH(n.left))return[i,Tu];return[i,Tp(n.left)];case"Right":if(iH(n.right))return[i,Tu];return[i,Th(n.right)]}};return $(e,TA(t,Tu,i))})),FL=(e,t,s)=>e.length>t.length?[$(e,ij(t.length),i1(t,s)),tK($(e,iz(t.length)))]:[$(e,i1($(t,ij(e.length)),s)),tV($(t,iz(e.length)))],F$=M(e=>TO(e[0]),(e,t="utf-8")=>FC(()=>{let s=new TextDecoder(t);return Fe(e,e=>s.decode(e))})),FU=Symbol.for("effect/GroupBy"),FB={_R:e=>e,_E:e=>e,_K:e=>e,_V:e=>e},Fq=e=>ei(e,FU),FH=M(e=>Fq(e[0]),(e,t,s)=>TK(e.grouped,([e,s])=>t(e,TZ(T9(s,{shutdown:!0}))),{concurrency:"unbounded",bufferSize:s?.bufferSize??16})),FJ=e=>({[FU]:FB,pipe(){return eY(this,arguments)},grouped:e}),FW=M(e=>"function"!=typeof e[0],(e,t,s)=>s?.key?FH(FV(e,s.key,{bufferSize:s.bufferSize}),(e,s)=>Fi(s,t)):TV(s?.concurrency,()=>Fi(e,t),i=>s?.unordered?TK(e,e=>T3(t(e)),{concurrency:i}):Fn(e,i,t)));class FK extends ds{static{f=_k}constructor(e,t){super(),this[f]={_Out:e=>e},this.dequeue=e,this.f=t}capacity(){return _4(this.dequeue)}get size(){return _6(this.dequeue)}unsafeSize(){return this.dequeue.unsafeSize()}get awaitShutdown(){return ke(this.dequeue)}isActive(){return this.dequeue.isActive()}get isShutdown(){return _9(this.dequeue)}get shutdown(){return kt(this.dequeue)}get isFull(){return _7(this.dequeue)}get isEmpty(){return _8(this.dequeue)}get take(){return $(_L(this.dequeue),ly(e=>this.f(e)))}get takeAll(){return $(ki(this.dequeue),ly(iG(e=>this.f(e))))}takeUpTo(e){return $(_$(this.dequeue,e),ly(iG(e=>this.f(e))))}takeBetween(e,t){return $(_U(this.dequeue,e,t),ly(iG(e=>this.f(e))))}takeN(e){return $(_B(this.dequeue,e),ly(iG(e=>this.f(e))))}poll(){return $(ks(this.dequeue),ly(sn(e=>this.f(e))))}pipe(){return eY(this,arguments)}commit(){return this.take}}let FV=M(e=>"function"!=typeof e[0],(e,t,s)=>{let i=(e,n)=>OL({onInput:r=>ON(Oj(yN(FG(r,t),([t,i])=>{let r=e.get(t);return void 0===r?$(_1(s?.bufferSize??16),lr(s=>$(lT(()=>{e.set(t,s)}),yY(_P(n,Tw([t,s]))),yY($(_P(s,Tg(i)),mJ(e=>o4(e)?tw(lz):t4())))))):mJ(_P(r,Tg(i)),e=>o4(e)?tw(lz):t4())},{discard:!0})),()=>i(e,n)),onFailure:e=>Oj(_P(n,Ty(e))),onDone:()=>$(Oj($(yN(e.entries(),([e,t])=>$(_P(t,Tx),mJ(e=>o4(e)?tw(lz):t4())),{discard:!0}),yY(_P(n,Tx)))))});return FJ(FP($(lT(()=>new Map),lr(t=>$(yC(_5(),e=>kt(e)),lr(s=>$(e,T1,Oz(i(t,s)),EJ,Eu,wy,cV(TZ(T9(s,{shutdown:!0}))))))))))}),FG=M(2,(e,t)=>{let s;let i=[],n=e[Symbol.iterator](),r=new Map;for(;(s=n.next())&&!s.done;){let e=s.value,n=t(e);if(r.has(n))r.get(n).push(e);else{let t=[e];i.push([n,t]),r.set(n,t)}}return iT(i.map(e=>[e[0],iT(e[1])]))}),FY=(...e)=>{let t=1===e.length?e[0].evaluate:e[0],s=1===e.length?e[0].onError:e[1],i=1===e.length&&!0===e[0].releaseLockOnEnd;return FP(ly(yC(lT(()=>t().getReader()),e=>i?lT(()=>e.releaseLock()):_m(()=>e.cancel())),e=>Fg(lr(gh({try:()=>e.read(),catch:e=>tw(s(e))}),({done:e,value:t})=>e?c9(t4()):lR(t)))))},FX=e=>$(e,Fx(CU)),FQ=function(){let e=Symbol.for("effect/Data/Error/plainArgs");return class extends uj{constructor(t){super(t?.message,t?.cause?{cause:t.cause}:void 0),t&&(Object.assign(this,t),Object.defineProperty(this,e,{value:t,enumerable:!1}))}toJSON(){return{...this[e],...this}}}}(),FZ=e=>{class t extends FQ{constructor(...t){super(...t),this._tag=e}}return t.prototype.name=e,t},F0=Symbol.for("@effect/platform/Error/PlatformErrorTypeId"),F1=(v="BadArgument",e=>ag({[F0]:F0,_tag:v,...e})),F2=(e,t)=>{class s extends FQ{constructor(...e){super(...e),this._tag=t}}return s.prototype[e]=e,s.prototype.name=t,s},F3=Symbol.for("@effect/platform/HttpClientError");class F5 extends F2(F3,"RequestError"){get methodAndUrl(){return`${this.request.method} ${this.request.url}`}get message(){return this.description?`${this.reason}: ${this.description} (${this.methodAndUrl})`:`${this.reason} error (${this.methodAndUrl})`}}class F4 extends F2(F3,"ResponseError"){get methodAndUrl(){return`${this.request.method} ${this.request.url}`}get message(){let e=`${this.response.status} ${this.methodAndUrl}`;return this.description?`${this.reason}: ${this.description} (${e})`:`${this.reason} error (${e})`}}let F6=Symbol.for("@effect/platform/Cookies"),F8=e=>ei(e,F6),F7=Symbol.for("@effect/platform/Cookies/Cookie"),F9=Symbol.for("@effect/platform/Cookies/CookieError");class Ae extends F2(F9,"CookieError"){get message(){return this.reason}}let At={[F6]:F6,...eU,toJSON(){return{_id:"@effect/platform/Cookies",cookies:sv(this.cookies,e=>e.toJSON())}},pipe(){return eY(this,arguments)}},As=e=>{let t=Object.create(At);return t.cookies=e,t},Ai=e=>{let t={};for(let s of e)t[s.name]=s;return As(t)},An=e=>{let t=[];for(let s of"string"==typeof e?[e]:e){let e=function(e){let t=e.split(";").map(e=>e.trim()).filter(e=>""!==e);if(0===t.length)return t4();let s=t[0].indexOf("=");if(-1===s)return t4();let i=t[0].slice(0,s);if(!Ao.test(i))return t4();let n=t[0].slice(s+1),r=Af(n);if(1===t.length)return tw(Object.assign(Object.create(Ac),{name:i,value:r,valueEncoded:n}));let a={};for(let e=1;e<t.length;e++){let s=t[e],i=s.indexOf("="),n=-1===i?s:s.slice(0,i).trim(),r=-1===i?void 0:s.slice(i+1).trim();switch(n.toLowerCase()){case"domain":{if(void 0===r)break;let e=r.trim().replace(/^\./,"");e&&(a.domain=e);break}case"expires":{if(void 0===r)break;let e=new Date(r);isNaN(e.getTime())||(a.expires=e);break}case"max-age":{if(void 0===r)break;let e=parseInt(r,10);isNaN(e)||(a.maxAge=nf(e));break}case"path":if(void 0===r)break;"/"===r[0]&&(a.path=r);break;case"priority":if(void 0===r)break;switch(r.toLowerCase()){case"low":a.priority="low";break;case"medium":a.priority="medium";break;case"high":a.priority="high"}break;case"httponly":a.httpOnly=!0;break;case"secure":a.secure=!0;break;case"partitioned":a.partitioned=!0;break;case"samesite":if(void 0===r)break;switch(r.toLowerCase()){case"lax":a.sameSite="lax";break;case"strict":a.sameSite="strict";break;case"none":a.sameSite="none"}}}return tw(Object.assign(Object.create(Ac),{name:i,value:r,valueEncoded:n,options:Object.keys(a).length>0?a:void 0}))}(s.trim());ty(e)&&t.push(e.value)}return Ai(t)},Ar=Ai([]),Aa=e=>sb(e.cookies),Ao=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,Ac={[F7]:F7,...eU,toJSON(){return{_id:"@effect/platform/Cookies/Cookie",name:this.name,value:this.value,options:this.options}}};function Al(e,t,s){if(!Ao.test(e))return tK(new Ae({reason:"InvalidName"}));let i=encodeURIComponent(t);if(i&&!Ao.test(i))return tK(new Ae({reason:"InvalidValue"}));if(void 0!==s){if(void 0!==s.domain&&!Ao.test(s.domain))return tK(new Ae({reason:"InvalidDomain"}));if(void 0!==s.path&&!Ao.test(s.path))return tK(new Ae({reason:"InvalidPath"}));if(void 0!==s.maxAge&&!nl(ni(s.maxAge)))return tK(new Ae({reason:"InfinityMaxAge"}))}return tV(Object.assign(Object.create(Ac),{name:e,value:t,valueEncoded:i,options:s}))}let Au=(e,t,s)=>t0(Al(e,t,s)),Ah=((e,t)=>As({...e.cookies,...t.cookies}),M(2,(e,t)=>{let s={...e.cookies};for(let[e,i,n]of t){let t=Al(e,i,n);if(tJ(t))return t;s[e]=t.right}return tV(As(s))}));function Ap(e){let t=e.name+"="+e.valueEncoded;if(void 0===e.options)return t;let s=e.options;if(void 0!==s.maxAge&&(t+="; Max-Age="+Math.trunc(nv(s.maxAge))),void 0!==s.domain&&(t+="; Domain="+s.domain),void 0!==s.path&&(t+="; Path="+s.path),void 0!==s.priority)switch(s.priority){case"low":t+="; Priority=Low";break;case"medium":t+="; Priority=Medium";break;case"high":t+="; Priority=High"}if(void 0!==s.expires&&(t+="; Expires="+s.expires.toUTCString()),s.httpOnly&&(t+="; HttpOnly"),s.secure&&(t+="; Secure"),s.partitioned&&(t+="; Partitioned"),void 0!==s.sameSite)switch(s.sameSite){case"lax":t+="; SameSite=Lax";break;case"strict":t+="; SameSite=Strict";break;case"none":t+="; SameSite=None"}return t}let Ad=e=>Object.values(e.cookies).map(Ap),Af=e=>{try{return decodeURIComponent(e)}catch(t){return e}},Am="effect/Redacted",Ag=H("effect/Redacted/redactedRegistry",()=>new WeakMap),Ab=Symbol.for(Am),Ax={[Ab]:{_A:e=>e},pipe(){return eY(this,arguments)},toString:()=>"<redacted>",toJSON:()=>"<redacted>",[eD]:()=>"<redacted>",[ew](){return $(eS(Am),ek(eS(Ag.get(this))),eA(this))},[eN](e){return Ay(e)&&eM(Ag.get(this),Ag.get(e))}},Ay=e=>ei(e,Ab),Av=e=>{let t=Object.create(Ax);return Ag.set(t,e),t},Aw=e=>{if(Ag.has(e))return Ag.get(e);throw Error("Unable to get redacted value")},AS=e=>t1((t,s)=>e(Aw(t),Aw(s))),A_=Symbol.for("effect/BigDecimal"),Ak={[A_]:A_,[ew](){let e=AF(this);return $(eS(e.value),ek(eC(e.scale)),eA(this))},[eN](e){return AO(e)&&AM(this,e)},toString(){return`BigDecimal(${Aj(this)})`},toJSON(){return{_id:"BigDecimal",value:String(this.value),scale:this.scale}},[eD](){return this.toJSON()},pipe(){return eY(this,arguments)}},AO=e=>ei(e,A_),AE=(e,t)=>{let s=Object.create(Ak);return s.value=e,s.scale=t,s},AC=(e,t)=>{if(e!==AR&&e%AI===AR)throw RangeError("Value must be normalized");let s=AE(e,t);return s.normalized=s,s},AR=BigInt(0),AI=BigInt(10),AT=AC(AR,0),AF=e=>{if(void 0===e.normalized){if(e.value===AR)e.normalized=AT;else{let t=`${e.value}`,s=0;for(let e=t.length-1;e>=0;e--)if("0"===t[e])s++;else break;0===s&&(e.normalized=e);let i=BigInt(t.substring(0,t.length-s)),n=e.scale-s;e.normalized=AC(i,n)}}return e.normalized},AA=M(2,(e,t)=>t>e.scale?AE(e.value*AI**BigInt(t-e.scale),t):t<e.scale?AE(e.value/AI**BigInt(e.scale-t),t):e),AN=t1((e,t)=>e.scale>t.scale?AA(t,e.scale).value===e.value:e.scale<t.scale?AA(e,t.scale).value===t.value:e.value===t.value),AM=M(2,(e,t)=>AN(e,t)),Aj=e=>{let t,s;let i=e.value<AR,n=i?`${e.value}`.substring(1):`${e.value}`;if(e.scale>=n.length)t="0",s="0".repeat(e.scale-n.length)+n;else{let i=n.length-e.scale;if(i>n.length){let e=i-n.length;t=`${n}${"0".repeat(e)}`,s=""}else s=n.slice(i),t=n.slice(0,i)}let r=""===s?t:`${t}.${s}`;return i?`-${r}`:r},Az=e=>hX(e,void 0,hY),AP=Symbol.for("effect/Config"),AD={...tc,[AP]:{_A:e=>e},commit(){return p6(this)}},AL=M(2,(e,t)=>AU(e,e=>tV(t(e)))),A$=M(2,(e,t)=>AU(e,e=>{try{return tV(t(e))}catch(e){return tK(hJ([],e instanceof Error?e.message:`${e}`))}})),AU=M(2,(e,t)=>{let s=Object.create(AD);return s._tag=h8,s.original=e,s.mapOrFail=t,s}),AB=M(2,(e,t)=>{let s=Object.create(AD);return s._tag=h7,s.name=t,s.config=e,s}),Aq=M(2,(e,t)=>{let s=Object.create(AD);return s._tag=h4,s.first=e,s.second=AV(t),s.condition=P,s}),AH=M(2,(e,t)=>{let s=Object.create(AD);return s._tag=h4,s.first=e,s.second=AV(t.orElse),s.condition=t.if,s}),AJ=(e,t)=>{let s=Object.create(AD);return s._tag=h9,s.description=e,s.parse=t,s},AW=e=>{let t=AJ("a text property",tV);return void 0===e?t:AB(t,e)},AK=e=>{let t=Object.create(AD);return t._tag=h5,t.value=e,t.parse=()=>tV(e),t},AV=e=>{let t=Object.create(AD);return t._tag=h6,t.config=e,t},AG=M(2,(e,t)=>AH(e,{orElse:()=>AK(t),if:Az})),AY=((e,t,s)=>{let i=Object.create(AD);return i._tag=pe,i.left=e,i.right=t,i.zip=s,i},Symbol.for("effect/DateTime")),AX=Symbol.for("effect/DateTime/TimeZone"),AQ={[AY]:AY,pipe(){return eY(this,arguments)},[eD](){return this.toString()},toJSON(){return Nt(this).toJSON()}},AZ={...AQ,_tag:"Utc",[ew](){return eA(this,eC(this.epochMillis))},[eN](e){return A4(e)&&"Utc"===e._tag&&this.epochMillis===e.epochMillis},toString(){return`DateTime.Utc(${Nt(this).toJSON()})`}},A0={...AQ,_tag:"Zoned",[ew](){return $(eC(this.epochMillis),ek(eS(this.zone)),eA(this))},[eN](e){return A4(e)&&"Zoned"===e._tag&&this.epochMillis===e.epochMillis&&eM(this.zone,e.zone)},toString(){return`DateTime.Zoned(${Nu(this)})`}},A1={[AX]:AX,[eD](){return this.toString()}},A2={...A1,_tag:"Named",[ew](){return eA(this,eR(`Named:${this.id}`))},[eN](e){return A6(e)&&"Named"===e._tag&&this.id===e.id},toString(){return`TimeZone.Named(${this.id})`},toJSON(){return{_id:"TimeZone",_tag:"Named",id:this.id}}},A3={...A1,_tag:"Offset",[ew](){return eA(this,eR(`Offset:${this.offset}`))},[eN](e){return A6(e)&&"Offset"===e._tag&&this.offset===e.offset},toString(){return`TimeZone.Offset(${Nn(this.offset)})`},toJSON(){return{_id:"TimeZone",_tag:"Offset",offset:this.offset}}},A5=(e,t,s)=>{let i=Object.create(A0);return i.epochMillis=e,i.zone=t,i.partsUtc=s,i},A4=e=>ei(e,AY),A6=e=>ei(e,AX),A8=e=>{let t=Object.create(AZ);return t.epochMillis=e,t},A7=H("effect/DateTime/validZoneCache",()=>new Map),A9={day:"numeric",month:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"longOffset",fractionalSecondDigits:3,hourCycle:"h23"},Ne=e=>{let t=e.resolvedOptions().timeZone;if(A7.has(t))return A7.get(t);let s=Object.create(A2);return s.id=t,s.format=e,A7.set(t,s),s},Nt=(e=>{if(A7.has(e))return A7.get(e);try{return Ne(new Intl.DateTimeFormat("en-US",{...A9,timeZone:e}))}catch(t){throw new uq(`Invalid time zone: ${e}`)}},e=>new Date(e.epochMillis)),Ns=e=>{if("Utc"===e._tag)return new Date(e.epochMillis);if("Offset"===e.zone._tag)return new Date(e.epochMillis+e.zone.offset);if(void 0!==e.adjustedEpochMillis)return new Date(e.adjustedEpochMillis);let t=e.zone.format.formatToParts(e.epochMillis).filter(e=>"literal"!==e.type),s=new Date(0);return s.setUTCFullYear(Number(t[2].value),Number(t[0].value)-1,Number(t[1].value)),s.setUTCHours(Number(t[3].value),Number(t[4].value),Number(t[5].value),Number(t[6].value)),e.adjustedEpochMillis=s.getTime(),s},Ni=e=>Ns(e).getTime()-Na(e),Nn=e=>{let t=Math.abs(e),s=Math.floor(t/36e5),i=Math.round(t%36e5/6e4);return`${e<0?"-":"+"}${String(s).padStart(2,"0")}:${String(i).padStart(2,"0")}`},Nr=e=>Nn(Ni(e)),Na=e=>e.epochMillis,No=/([+-])(\d{2}):(\d{2})$/,Nc=e=>{let t=No.exec(e);if(null===t)return null;let[,s,i,n]=t;return("+"===s?1:-1)*(60*Number(i)+Number(n))*6e4},Nl=e=>{let t=Ns(e);return"Utc"===e._tag?t.toISOString():`${t.toISOString().slice(0,-1)}${Nr(e)}`},Nu=e=>"Offset"===e.zone._tag?Nl(e):`${Nl(e)}[${e.zone.id}]`,Nh=Symbol.for("effect/Encoding/errors/Decode"),Np=(e,t)=>{let s={_tag:"DecodeException",[Nh]:Nh,input:e};return J(t)&&(s.message=t),s},Nd=new TextEncoder,Nf=e=>{let t;let s=e.length,i="";for(t=2;t<s;t+=3)i+=Nx[e[t-2]>>2],i+=Nx[(3&e[t-2])<<4|e[t-1]>>4],i+=Nx[(15&e[t-1])<<2|e[t]>>6],i+=Nx[63&e[t]];return t===s+1&&(i+=Nx[e[t-2]>>2],i+=Nx[(3&e[t-2])<<4],i+="=="),t===s&&(i+=Nx[e[t-2]>>2],i+=Nx[(3&e[t-2])<<4|e[t-1]>>4],i+=Nx[(15&e[t-1])<<2],i+="="),i},Nm=e=>{let t=Ng(e),s=t.length;if(s%4!=0)return tK(Np(t,`Length must be a multiple of 4, but is ${s}`));let i=t.indexOf("=");if(-1!==i&&(i<s-2||i===s-2&&"="!==t[s-1]))return tK(Np(t,"Found a '=' character, but it is not at the end"));try{let e=t.endsWith("==")?2:t.endsWith("=")?1:0,i=new Uint8Array(s/4*3-e);for(let e=0,n=0;e<s;e+=4,n+=3){let s=Nb(t.charCodeAt(e))<<18|Nb(t.charCodeAt(e+1))<<12|Nb(t.charCodeAt(e+2))<<6|Nb(t.charCodeAt(e+3));i[n]=s>>16,i[n+1]=s>>8&255,i[n+2]=255&s}return tV(i)}catch(e){return tK(Np(t,e instanceof Error?e.message:"Invalid input"))}},Ng=e=>e.replace(/[\n\r]/g,"");function Nb(e){if(e>=Ny.length)throw TypeError(`Invalid character ${String.fromCharCode(e)}`);let t=Ny[e];if(255===t)throw TypeError(`Invalid character ${String.fromCharCode(e)}`);return t}let Nx=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],Ny=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,62,255,255,255,63,52,53,54,55,56,57,58,59,60,61,255,255,255,0,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255,255,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],Nv=e=>{let t="";for(let s=0;s<e.length;++s)t+=NS[e[s]];return t},Nw=e=>{let t=new TextEncoder().encode(e);if(t.length%2!=0)return tK(Np(e,`Length must be a multiple of 2, but is ${t.length}`));try{let e=t.length/2,s=new Uint8Array(e);for(let i=0;i<e;i++){let e=N_(t[2*i]),n=N_(t[2*i+1]);s[i]=e<<4|n}return tV(s)}catch(t){return tK(Np(e,t instanceof Error?t.message:"Invalid input"))}},NS=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],N_=e=>{if(48<=e&&e<=57)return e-48;if(97<=e&&e<=102)return e-97+10;if(65<=e&&e<=70)return e-65+10;throw TypeError("Invalid input")},Nk=e=>"string"==typeof e?Nv(Nd.encode(e)):Nv(e),NO=e=>Nw(e),NE=(e,t)=>{switch(t._tag){case"StringKeyword":case"TemplateLiteral":return Object.keys(e);case"SymbolKeyword":return Object.getOwnPropertySymbols(e);case"Refinement":return NE(e,t.from)}},NC=e=>Object.keys(e).concat(Object.getOwnPropertySymbols(e)),NR=e=>{let t,s=!1;return()=>(s||(t=e(),s=!0),t)},NI=e=>{try{return e.toISOString()}catch(t){return String(e)}},NT=e=>{if(J(e))return JSON.stringify(e);if(W(e)||null==e||K(e)||G(e))return String(e);if(eo(e))return NI(e);if(V(e))return String(e)+"n";if(!sM(e)&&ei(e,"toString")&&Y(e.toString)&&e.toString!==Object.prototype.toString)return e.toString();try{if(JSON.stringify(e),sM(e))return`[${e.map(NT).join(",")}]`;return`{${NC(e).map(t=>`${J(t)?JSON.stringify(t):String(t)}:${NT(e[t])}`).join(",")}}`}catch(t){return String(e)}},NF=e=>"string"==typeof e?JSON.stringify(e):String(e),NA=e=>Array.isArray(e),NN=e=>!Array.isArray(e),NM=e=>`[${NF(e)}]`,Nj=e=>NA(e)?e.map(NM).join(""):NM(e),Nz=(e,t,s,i)=>{let n=e;return s&&sz(s)&&(n+=`
at path: ${Nj(s)}`),void 0!==t&&(n+=`
details: ${t}`),i&&(n+=`
schema (${i._tag}): ${i}`),n},NP=(e,t,s)=>Nz("Unsupported schema or overlapping types",`cannot extend ${e} with ${t}`,s),ND=e=>Nz("Unsupported key schema",void 0,void 0,e),NL=e=>Nz("Unsupported literal",`literal value: ${NT(e)}`),N$=e=>Nz("Duplicate index signature",`${e} index signature`),NU=Nz("Unsupported index signature parameter","An index signature parameter type must be `string`, `symbol`, a template literal type or a refinement of the previous types"),NB=Nz("Invalid element","A required element cannot follow an optional element. ts(1257)"),Nq=e=>Nz("Duplicate property signature transformation",`Duplicate key ${NT(e)}`),NH=e=>Nz("Duplicate property signature",`Duplicate key ${NT(e)}`),NJ=Symbol.for("effect/schema/GreaterThanOrEqualTo"),NW=Symbol.for("effect/schema/Int"),NK=Symbol.for("effect/schema/MinLength"),NV=Symbol.for("effect/annotation/SchemaId"),NG=Symbol.for("effect/annotation/Message"),NY=Symbol.for("effect/annotation/MissingMessage"),NX=Symbol.for("effect/annotation/Identifier"),NQ=Symbol.for("effect/annotation/Title"),NZ=Symbol.for("effect/annotation/Description"),N0=Symbol.for("effect/annotation/Examples"),N1=Symbol.for("effect/annotation/Default"),N2=Symbol.for("effect/annotation/JSONSchema"),N3=Symbol.for("effect/annotation/Arbitrary"),N5=Symbol.for("effect/annotation/Pretty"),N4=Symbol.for("effect/annotation/Equivalence"),N6=Symbol.for("effect/annotation/Documentation"),N8=Symbol.for("effect/annotation/Concurrency"),N7=Symbol.for("effect/annotation/Batching"),N9=Symbol.for("effect/annotation/ParseIssueTitle"),Me=Symbol.for("effect/annotation/ParseOptions"),Mt=Symbol.for("effect/annotation/DecodingFallback"),Ms=Symbol.for("effect/annotation/Surrogate"),Mi=Symbol.for("effect/annotation/StableFilter"),Mn=M(2,(e,t)=>Object.prototype.hasOwnProperty.call(e.annotations,t)?tw(e.annotations[t]):t4()),Mr=Mn(NG),Ma=Mn(NY),Mo=Mn(NQ),Mc=Mn(NX),Ml=Mn(NZ),Mu=Mn(N8),Mh=Mn(N7),Mp=Mn(N9),Md=Mn(Me),Mf=Mn(Mt),Mm=Mn(Ms),Mg=Mn(Mi),Mb=e=>sh(Mg(e),e=>!0===e),Mx=Symbol.for("effect/annotation/JSONIdentifier"),My=Mn(Mx),Mv=e=>t7(My(e),()=>Mc(e)),Mw=Symbol.for("effect/schema/ParseJson");class MS{constructor(e,t,s,i={}){this._tag="Declaration",this.typeParameters=e,this.decodeUnknown=t,this.encodeUnknown=s,this.annotations=i}toString(){return t8(jT(this),()=>"<declaration schema>")}toJSON(){return{_tag:this._tag,typeParameters:this.typeParameters.map(e=>e.toJSON()),annotations:jE(this.annotations)}}}let M_=e=>t=>t._tag===e;class Mk{constructor(e,t={}){this._tag="Literal",this.literal=e,this.annotations=t}toString(){return t8(jT(this),()=>NT(this.literal))}toJSON(){return{_tag:this._tag,literal:V(this.literal)?String(this.literal):this.literal,annotations:jE(this.annotations)}}}let MO=M_("Literal"),ME=new Mk(null);class MC{constructor(e,t={}){this._tag="UniqueSymbol",this.symbol=e,this.annotations=t}toString(){return t8(jT(this),()=>NT(this.symbol))}toJSON(){return{_tag:this._tag,symbol:String(this.symbol),annotations:jE(this.annotations)}}}class MR{constructor(e={}){this._tag="UndefinedKeyword",this.annotations=e}toString(){return jI(this)}toJSON(){return{_tag:this._tag,annotations:jE(this.annotations)}}}let MI=new MR({[NQ]:"undefined"});class MT{constructor(e={}){this._tag="NeverKeyword",this.annotations=e}toString(){return jI(this)}toJSON(){return{_tag:this._tag,annotations:jE(this.annotations)}}}let MF=new MT({[NQ]:"never"});class MA{constructor(e={}){this._tag="UnknownKeyword",this.annotations=e}toString(){return jI(this)}toJSON(){return{_tag:this._tag,annotations:jE(this.annotations)}}}let MN=new MA({[NQ]:"unknown"});class MM{constructor(e={}){this._tag="AnyKeyword",this.annotations=e}toString(){return jI(this)}toJSON(){return{_tag:this._tag,annotations:jE(this.annotations)}}}let Mj=new MM({[NQ]:"any"});class Mz{constructor(e={}){this._tag="StringKeyword",this.annotations=e}toString(){return jI(this)}toJSON(){return{_tag:this._tag,annotations:jE(this.annotations)}}}let MP=new Mz({[NQ]:"string",[NZ]:"a string"}),MD=M_("StringKeyword");class ML{constructor(e={}){this._tag="NumberKeyword",this.annotations=e}toString(){return jI(this)}toJSON(){return{_tag:this._tag,annotations:jE(this.annotations)}}}let M$=new ML({[NQ]:"number",[NZ]:"a number"}),MU=M_("NumberKeyword");class MB{constructor(e={}){this._tag="BooleanKeyword",this.annotations=e}toString(){return jI(this)}toJSON(){return{_tag:this._tag,annotations:jE(this.annotations)}}}let Mq=new MB({[NQ]:"boolean",[NZ]:"a boolean"}),MH=M_("BooleanKeyword");class MJ{constructor(e={}){this._tag="BigIntKeyword",this.annotations=e}toString(){return jI(this)}toJSON(){return{_tag:this._tag,annotations:jE(this.annotations)}}}let MW=M_("SymbolKeyword");class MK{constructor(e,t={}){this.type=e,this.annotations=t}toJSON(){return{type:this.type.toJSON(),annotations:jE(this.annotations)}}toString(){return String(this.type)}}class MV extends MK{constructor(e,t,s={}){super(e,s),this.isOptional=t}toJSON(){return{type:this.type.toJSON(),isOptional:this.isOptional,annotations:jE(this.annotations)}}toString(){return String(this.type)+(this.isOptional?"?":"")}}let MG=e=>e.map(e=>e.type);class MY{constructor(e,t,s,i={}){this._tag="TupleType",this.elements=e,this.rest=t,this.isReadonly=s,this.annotations=i;let n=!1,r=!1;for(let t of e)if(t.isOptional)n=!0;else if(n){r=!0;break}if(r||n&&t.length>1)throw Error(NB)}toString(){return t8(jT(this),()=>MX(this))}toJSON(){return{_tag:this._tag,elements:this.elements.map(e=>e.toJSON()),rest:this.rest.map(e=>e.toJSON()),isReadonly:this.isReadonly,annotations:jE(this.annotations)}}}let MX=e=>{let t=e.elements.map(String).join(", ");return sT(e.rest,{onEmpty:()=>`readonly [${t}]`,onNonEmpty:(s,i)=>{let n=String(s),r=n.includes(" | ")?`(${n})`:n;if(i.length>0){let s=i.map(String).join(", ");return e.elements.length>0?`readonly [${t}, ...${r}[], ${s}]`:`readonly [...${r}[], ${s}]`}return e.elements.length>0?`readonly [${t}, ...${r}[]]`:`ReadonlyArray<${n}>`}})};class MQ extends MV{constructor(e,t,s,i,n){super(t,s,n),this.name=e,this.isReadonly=i}toString(){return(this.isReadonly?"readonly ":"")+String(this.name)+(this.isOptional?"?":"")+": "+this.type}toJSON(){return{name:String(this.name),type:this.type.toJSON(),isOptional:this.isOptional,isReadonly:this.isReadonly,annotations:jE(this.annotations)}}}let MZ=e=>{switch(e._tag){case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":return!0;case"Refinement":return MZ(e.from)}return!1};class M0{constructor(e,t,s){if(this.type=t,this.isReadonly=s,MZ(e))this.parameter=e;else throw Error(NU)}toString(){return(this.isReadonly?"readonly ":"")+`[x: ${this.parameter}]: ${this.type}`}toJSON(){return{parameter:this.parameter.toJSON(),type:this.type.toJSON(),isReadonly:this.isReadonly}}}class M1{constructor(e,t,s={}){this._tag="TypeLiteral",this.annotations=s;let i={};for(let t=0;t<e.length;t++){let s=e[t].name;if(Object.prototype.hasOwnProperty.call(i,s))throw Error(NH(s));i[s]=null}let n={string:!1,symbol:!1};for(let e=0;e<t.length;e++){let s=jC(t[e].parameter);if(MD(s)){if(n.string)throw Error(N$("string"));n.string=!0}else if(MW(s)){if(n.symbol)throw Error(N$("symbol"));n.symbol=!0}}this.propertySignatures=e,this.indexSignatures=t}toString(){return t8(jT(this),()=>M3(this))}toJSON(){return{_tag:this._tag,propertySignatures:this.propertySignatures.map(e=>e.toJSON()),indexSignatures:this.indexSignatures.map(e=>e.toJSON()),annotations:jE(this.annotations)}}}let M2=e=>e.map(String).join("; "),M3=e=>{if(e.propertySignatures.length>0){let t=e.propertySignatures.map(String).join("; ");return e.indexSignatures.length>0?`{ ${t}; ${M2(e.indexSignatures)} }`:`{ ${t} }`}return e.indexSignatures.length>0?`{ ${M2(e.indexSignatures)} }`:"{}"},M5=M_("TypeLiteral"),M4=sY(sg(sm,e=>{switch(e._tag){case"AnyKeyword":return 0;case"UnknownKeyword":return 1;case"ObjectKeyword":return 2;case"StringKeyword":case"NumberKeyword":case"BooleanKeyword":case"BigIntKeyword":case"SymbolKeyword":return 3}return 4})),M6={string:"StringKeyword",number:"NumberKeyword",boolean:"BooleanKeyword",bigint:"BigIntKeyword"},M8=e=>s7(e,e=>js(e)?M8(e.types):[e]),M7=e=>{let t=M4(e),s=[],i={},n=[];for(let e of t)switch(e._tag){case"NeverKeyword":break;case"AnyKeyword":return[Mj];case"UnknownKeyword":return[MN];case"ObjectKeyword":case"UndefinedKeyword":case"VoidKeyword":case"StringKeyword":case"NumberKeyword":case"BooleanKeyword":case"BigIntKeyword":case"SymbolKeyword":i[e._tag]||(i[e._tag]=e,s.push(e));break;case"Literal":{let t=typeof e.literal;switch(t){case"string":case"number":case"bigint":case"boolean":i[M6[t]]||n.includes(e.literal)||(n.push(e.literal),s.push(e));break;case"object":n.includes(e.literal)||(n.push(e.literal),s.push(e))}break}case"UniqueSymbol":i.SymbolKeyword||n.includes(e.symbol)||(n.push(e.symbol),s.push(e));break;case"TupleType":i.ObjectKeyword||s.push(e);break;case"TypeLiteral":0===e.propertySignatures.length&&0===e.indexSignatures.length?i["{}"]||(i["{}"]=e,s.push(e)):i.ObjectKeyword||s.push(e);break;default:s.push(e)}return s};class M9{static{this.make=(e,t)=>jt(e)?new M9(e,t):1===e.length?e[0]:MF}static{this.unify=(e,t)=>M9.make(M7(M8(e)),t)}constructor(e,t={}){this._tag="Union",this.types=e,this.annotations=t}toString(){return t8(jT(this),()=>this.types.map(String).join(" | "))}toJSON(){return{_tag:this._tag,types:this.types.map(e=>e.toJSON()),annotations:jE(this.annotations)}}}let je=(e,t)=>e.map(t),jt=e=>e.length>1,js=M_("Union"),ji=H(Symbol.for("effect/Schema/AST/toJSONMemoMap"),()=>new WeakMap);class jn{constructor(e,t={}){this._tag="Suspend",this.f=e,this.annotations=t,this.f=NR(e)}toString(){return jT(this).pipe(t7(()=>sr(ss(this.f)(),e=>jT(e))),t8(()=>"<suspended schema>"))}toJSON(){let e=this.f(),t=ji.get(e);return t||(ji.set(e,{_tag:this._tag}),t={_tag:this._tag,ast:e.toJSON(),annotations:jE(this.annotations)},ji.set(e,t)),t}}class jr{constructor(e,t,s={}){this._tag="Refinement",this.from=e,this.filter=t,this.annotations=s}toString(){return t8(jT(this),()=>`{ ${this.from} | filter }`)}toJSON(){return{_tag:this._tag,from:this.from.toJSON(),annotations:jE(this.annotations)}}}let ja=M_("Refinement"),jo={};class jc{constructor(e,t,s,i={}){this._tag="Transformation",this.from=e,this.to=t,this.transformation=s,this.annotations=i}toString(){return t8(jT(this),()=>`(${String(this.from)} <-> ${String(this.to)})`)}toJSON(){return{_tag:this._tag,from:this.from.toJSON(),to:this.to.toJSON(),annotations:jE(this.annotations)}}}let jl=M_("Transformation");class ju{constructor(e,t){this._tag="FinalTransformation",this.decode=e,this.encode=t}}class jh{constructor(){this._tag="ComposeTransformation"}}let jp=new jh;class jd{constructor(e,t,s,i){this.from=e,this.to=t,this.decode=s,this.encode=i}}class jf{constructor(e){this._tag="TypeLiteralTransformation",this.propertySignatureTransformations=e;let t={},s={};for(let i of e){let e=i.from;if(t[e])throw Error(Nq(e));t[e]=!0;let n=i.to;if(s[n])throw Error(Nq(n));s[n]=!0}}}let jm=e=>"TypeLiteralTransformation"===e._tag,jg=(e,t)=>{let s=Object.getOwnPropertyDescriptors(e);return s.annotations.value={...e.annotations,...t},Object.create(Object.getPrototypeOf(e),s)},jb=e=>{let t=`^${hz(e.head)}`;for(let s of e.spans)MD(s.type)?t+=".*":MU(s.type)&&(t+="[+-]?\\d*\\.?\\d+(?:[Ee][+-]?\\d+)?"),t+=hz(s.literal);return new RegExp(t+="$")},jx=e=>{switch(e._tag){case"TupleType":{let t=!1,s=[];for(let i of e.elements)i.isOptional&&(t=!0),s.push(i.type);return t&&s.push(MI),s=s.concat(MG(e.rest)),M9.make(s)}case"Refinement":return jx(e.from);case"Union":return M9.make(e.types.map(jx));case"Suspend":return jx(e.f())}throw Error(errors_.getASTUnsupportedSchema(e))},jy=(e,t)=>{let s=[],i=[],n=e=>{switch(e._tag){case"NeverKeyword":break;case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":case"Refinement":i.push(new M0(e,t,!0));break;case"Literal":if(J(e.literal)||W(e.literal))s.push(new MQ(e.literal,t,!1,!0));else throw Error(NL(e.literal));break;case"Enums":for(let[i,n]of e.enums)s.push(new MQ(n,t,!1,!0));break;case"UniqueSymbol":s.push(new MQ(e.symbol,t,!1,!0));break;case"Union":e.types.forEach(n);break;default:throw Error(ND(e))}};return n(e),{propertySignatures:s,indexSignatures:i}},jv=e=>{switch(e._tag){case"TupleType":return!1===e.isReadonly?e:new MY(e.elements,e.rest,!1,e.annotations);case"TypeLiteral":{let t=j_(e.propertySignatures,e=>!1===e.isReadonly?e:new MQ(e.name,e.type,e.isOptional,!1,e.annotations)),s=j_(e.indexSignatures,e=>!1===e.isReadonly?e:new M0(e.parameter,e.type,!1));return t===e.propertySignatures&&s===e.indexSignatures?e:new M1(t,s,e.annotations)}case"Union":{let t=j_(e.types,jv);return t===e.types?e:M9.make(t,e.annotations)}case"Suspend":return new jn(()=>jv(e.f()),e.annotations);case"Refinement":{let t=jv(e.from);return t===e.from?e:new jr(t,e.filter,e.annotations)}case"Transformation":{let t=jv(e.from),s=jv(e.to);return t===e.from&&s===e.to?e:new jc(t,s,e.transformation,e.annotations)}}return e},jw=e=>{switch(e._tag){case"Declaration":{let t=j_(e.typeParameters,jw);return t===e.typeParameters?e:new MS(t,e.decodeUnknown,e.encodeUnknown,e.annotations)}case"TupleType":{let t=j_(e.elements,e=>{let t=jw(e.type);return t===e.type?e:new MV(t,e.isOptional)}),s=MG(e.rest),i=j_(s,jw);return t===e.elements&&i===s?e:new MY(t,i.map(e=>new MK(e)),e.isReadonly,e.annotations)}case"TypeLiteral":{let t=j_(e.propertySignatures,e=>{let t=jw(e.type);return t===e.type?e:new MQ(e.name,t,e.isOptional,e.isReadonly)}),s=j_(e.indexSignatures,e=>{let t=jw(e.type);return t===e.type?e:new M0(e.parameter,t,e.isReadonly)});return t===e.propertySignatures&&s===e.indexSignatures?e:new M1(t,s,e.annotations)}case"Union":{let t=j_(e.types,jw);return t===e.types?e:M9.make(t,e.annotations)}case"Suspend":return new jn(()=>jw(e.f()),e.annotations);case"Refinement":{let t=jw(e.from);return t===e.from?e:new jr(t,e.filter,e.annotations)}case"Transformation":return jw(e.to)}return e},jS=e=>t6(Mv(e),{onNone:()=>void 0,onSome:e=>({[Mx]:e})});function j_(e,t){let s=!1,i=sO(e.length);for(let n=0;n<e.length;n++){let r=e[n],a=t(r);a!==r&&(s=!0),i[n]=a}return s?i:e}let jk=(e,t)=>{switch(e._tag){case"Declaration":{let s=j_(e.typeParameters,e=>jk(e,t));return s===e.typeParameters?e:new MS(s,e.decodeUnknown,e.encodeUnknown,e.annotations)}case"TupleType":{let s=j_(e.elements,e=>{let s=jk(e.type,t);return s===e.type?e:new MV(s,e.isOptional)}),i=MG(e.rest),n=j_(i,e=>jk(e,t));return s===e.elements&&n===i?e:new MY(s,n.map(e=>new MK(e)),e.isReadonly,jS(e))}case"TypeLiteral":{let s=j_(e.propertySignatures,e=>{let s=jk(e.type,t);return s===e.type?e:new MQ(e.name,s,e.isOptional,e.isReadonly)}),i=j_(e.indexSignatures,e=>{let s=jk(e.type,t);return s===e.type?e:new M0(e.parameter,s,e.isReadonly)});return s===e.propertySignatures&&i===e.indexSignatures?e:new M1(s,i,jS(e))}case"Union":{let s=j_(e.types,e=>jk(e,t));return s===e.types?e:M9.make(s,jS(e))}case"Suspend":return new jn(()=>jk(e.f(),t),jS(e));case"Refinement":{let s=jk(e.from,t);if(t){if(s===e.from)return e;if(!jl(e.from)&&Mb(e))return new jr(s,e.filter)}return s}case"Transformation":return jk(e.from,t)}return e},jO=e=>jk(e,!1),jE=e=>{let t={};for(let s of Object.getOwnPropertySymbols(e))t[String(s)]=e[s];return t},jC=e=>{switch(e._tag){case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":return e;case"Refinement":return jC(e.from)}},jR=(e,t)=>new jc(e,t,jp),jI=e=>t8(jT(e),()=>e._tag),jT=e=>Mc(e).pipe(t7(()=>Mo(e)),t7(()=>Ml(e)));class jF{constructor(e,t,s){this._tag="Pointer",this.path=e,this.actual=t,this.issue=s}}class jA{constructor(e,t){this._tag="Unexpected",this.actual=e,this.message=t}}class jN{constructor(e,t){this._tag="Missing",this.actual=void 0,this.ast=e,this.message=t}}class jM{constructor(e,t,s,i){this._tag="Composite",this.ast=e,this.actual=t,this.issues=s,this.output=i}}class jj{constructor(e,t,s,i){this._tag="Refinement",this.ast=e,this.actual=t,this.kind=s,this.issue=i}}class jz{constructor(e,t,s,i){this._tag="Transformation",this.ast=e,this.actual=t,this.kind=s,this.issue=i}}class jP{constructor(e,t,s){this._tag="Type",this.ast=e,this.actual=t,this.message=s}}class jD{constructor(e,t,s){this._tag="Forbidden",this.ast=e,this.actual=t,this.message=s}}let jL=Symbol.for("effect/Schema/ParseErrorTypeId"),j$=e=>ei(e,jL);class jU extends FZ("ParseError"){get message(){return this.toString()}toString(){return zu.formatIssueSync(this.issue)}toJSON(){return{_id:"ParseError",message:this.toString()}}[eD](){return this.toJSON()}constructor(...e){super(...e),this[jL]=jL}}let jB=e=>new jU({issue:e}),jq=e=>{if(Y(e))try{return tV(e())}catch(e){return tK(e)}else try{return tV(e.try())}catch(t){return tK(e.catch(t))}},jH=M(2,(e,t)=>"Left"===e._tag?e:"Right"===e._tag?t(e.right):lr(e,t)),jJ=M(2,(e,t)=>"Left"===e._tag?e:"Right"===e._tag?tV(t(e.right)):ly(e,t)),jW=M(2,(e,t)=>"Left"===e._tag?tK(t(e.left)):"Right"===e._tag?e:lw(e,t)),jK=e=>{if("Left"===e._tag||"Right"===e._tag)return e},jV=M(2,(e,t)=>"Left"===e._tag?tK(t.onFailure(e.left)):"Right"===e._tag?tV(t.onSuccess(e.right)):lv(e,t)),jG=M(2,(e,t)=>"Left"===e._tag?t(e.left):"Right"===e._tag?e:c0(e,t)),jY=(e,t)=>void 0===t||W(t)?e:void 0===e?t:{...e,...t},jX=(e,t,s)=>{let i=j8(e,t);return(e,t)=>i(e,jY(s,t))},jQ=(e,t,s)=>{let i=jX(e,t,s);return(e,t)=>tZ(i(e,t),jB)},jZ=(e,t,s)=>{let i=j8(e,t);return(e,t)=>i(e,{...jY(s,t),isEffectAllowed:!0})},j0=(e,t)=>jX(e.ast,!0,t),j1=(e,t)=>jZ(e.ast,!0,t),j2=(e,t)=>jZ(e.ast,!1,t),j3=(e,t)=>jQ(jw(e.ast),!0,t),j5=(e,t)=>{let s=j8(jw(e.ast),!0);return(e,i)=>tW(s(e,{exact:!0,...jY(t,i)}))},j4=H(Symbol.for("effect/Schema/Parser/decodeMemoMap"),()=>new WeakMap),j6=H(Symbol.for("effect/Schema/Parser/encodeMemoMap"),()=>new WeakMap),j8=(e,t)=>{let s=t?j4:j6,i=s.get(e);if(i)return i;let n=ze(e,t),r=Md(e),a=ty(r)?(e,t)=>n(e,jY(t,r.value)):n,o=Mf(e),c=t&&ty(o)?(t,s)=>zr(jG(a(t,s),o.value),e,t,s):a;return s.set(e,c),c},j7=e=>st(Mu(e)),j9=e=>st(Mh(e)),ze=(e,t)=>{switch(e._tag){case"Refinement":if(t){let t=j8(e.from,!0);return(s,i)=>{i=i??jo;let n=i?.errors==="all";return zr(jH(jG(t(s,i),t=>{let r=new jj(e,s,"From",t);return n&&Mb(e)?t6(e.filter(s,i,e),{onNone:()=>tK(r),onSome:t=>tK(new jM(e,s,[r,new jj(e,s,"Predicate",t)]))}):tK(r)}),t=>t6(e.filter(t,i,e),{onNone:()=>tV(t),onSome:t=>tK(new jj(e,s,"Predicate",t))})),e,s,i)}}{let t=j8(jw(e),!0),s=j8(zn(e.from),!1);return(i,n)=>zr(jH(t(i,n),e=>s(e,n)),e,i,n)}case"Transformation":{let s=zc(e.transformation,t),i=t?j8(e.from,!0):j8(e.to,!1),n=t?j8(e.to,!0):j8(e.from,!1);return(r,a)=>zr(jH(jW(i(r,a),s=>new jz(e,r,t?"Encoded":"Type",s)),i=>jH(jW(s(i,a??jo,e,r),t=>new jz(e,r,"Transformation",t)),s=>jW(n(s,a),s=>new jz(e,r,t?"Type":"Encoded",s)))),e,r,a)}case"Declaration":{let s=t?e.decodeUnknown(...e.typeParameters):e.encodeUnknown(...e.typeParameters);return(t,i)=>zr(s(t,i??jo,e),e,t,i)}case"Literal":return zt(e,t=>t===e.literal);case"UniqueSymbol":return zt(e,t=>t===e.symbol);case"UndefinedKeyword":return zt(e,X);case"NeverKeyword":return zt(e,ee);case"UnknownKeyword":case"AnyKeyword":case"VoidKeyword":return tV;case"StringKeyword":return zt(e,J);case"NumberKeyword":return zt(e,W);case"BooleanKeyword":return zt(e,K);case"BigIntKeyword":return zt(e,V);case"SymbolKeyword":return zt(e,G);case"ObjectKeyword":return zt(e,es);case"Enums":return zt(e,t=>e.enums.some(([e,s])=>s===t));case"TemplateLiteral":{let t=jb(e);return zt(e,e=>J(e)&&t.test(e))}case"TupleType":{let s=e.elements.map(e=>j8(e.type,t)),i=e.rest.map(e=>j8(e.type,t)),n=e.elements.filter(e=>!e.isOptional);e.rest.length>0&&(n=n.concat(e.rest.slice(1)));let r=n.length,a=e.elements.length>0?e.elements.map((e,t)=>t).join(" | "):"never",o=j7(e),c=j9(e);return(t,l)=>{let u;if(!sM(t))return tK(new jP(e,t));let h=l?.errors==="all",p=[],d=0,f=[],m=t.length;for(let s=m;s<=r-1;s++){let i=new jF(s,t,new jN(n[s-m]));if(!h)return tK(new jM(e,t,i,f));p.push([d++,i])}if(0===e.rest.length)for(let s=e.elements.length;s<=m-1;s++){let i=new jF(s,t,new jA(t[s],`is unexpected, expected: ${a}`));if(!h)return tK(new jM(e,t,i,f));p.push([d++,i])}let g=0;for(;g<s.length;g++)if(m<g+1){if(e.elements[g].isOptional)continue}else{let i=(0,s[g])(t[g],l),n=jK(i);if(n){if(tJ(n)){let s=new jF(g,t,n.left);if(!h)return tK(new jM(e,t,s,zo(f)));p.push([d++,s]);continue}f.push([d++,n.right])}else{let s=d++,n=g;u||(u=[]),u.push(({es:r,output:a})=>lr(c8(i),i=>{if(tJ(i)){let o=new jF(n,t,i.left);return h?(r.push([s,o]),lz):tK(new jM(e,t,o,zo(a)))}return a.push([s,i.right]),lz}))}}if(sz(i)){let[s,...n]=i;for(;g<m-n.length;g++){let i=s(t[g],l),n=jK(i);if(n){if(tJ(n)){let s=new jF(g,t,n.left);if(!h)return tK(new jM(e,t,s,zo(f)));p.push([d++,s]);continue}f.push([d++,n.right])}else{let s=d++,n=g;u||(u=[]),u.push(({es:r,output:a})=>lr(c8(i),i=>{if(!tJ(i))return a.push([s,i.right]),lz;{let o=new jF(n,t,i.left);return h?(r.push([s,o]),lz):tK(new jM(e,t,o,zo(a)))}}))}}for(let s=0;s<n.length;s++)if(!(m<(g+=s)+1)){let i=n[s](t[g],l),r=jK(i);if(r){if(tJ(r)){let s=new jF(g,t,r.left);if(!h)return tK(new jM(e,t,s,zo(f)));p.push([d++,s]);continue}f.push([d++,r.right])}else{let s=d++,n=g;u||(u=[]),u.push(({es:r,output:a})=>lr(c8(i),i=>{if(tJ(i)){let o=new jF(n,t,i.left);return h?(r.push([s,o]),lz):tK(new jM(e,t,o,zo(a)))}return a.push([s,i.right]),lz}))}}}let b=({es:s,output:i})=>t5(s)?tK(new jM(e,t,zo(s),zo(i))):tV(zo(i));if(u&&u.length>0){let e=u;return lI(()=>{let t={es:s2(p),output:s2(f)};return lr(yN(e,e=>e(t),{concurrency:o,batching:c,discard:!0}),()=>b(t))})}return b({output:f,es:p})}}case"TypeLiteral":{if(0===e.propertySignatures.length&&0===e.indexSignatures.length)return zt(e,ea);let s=[],i={},n=[];for(let r of e.propertySignatures)s.push([j8(r.type,t),r]),i[r.name]=null,n.push(r.name);let r=e.indexSignatures.map(e=>[j8(e.parameter,t),j8(e.type,t),e.parameter]),a=M9.make(e.indexSignatures.map(e=>e.parameter).concat(n.map(e=>G(e)?new MC(e):new Mk(e)))),o=j8(a,t),c=j7(e),l=j9(e);return(t,u)=>{let h,p;if(!el(t))return tK(new jP(e,t));let d=u?.errors==="all",f=[],m=0,g=u?.onExcessProperty==="error",b=u?.onExcessProperty==="preserve",x={};if(g||b){for(let s of h=NC(t))if(tJ(jK(o(s,u)))){if(g){let i=new jF(s,t,new jA(t[s],`is unexpected, expected: ${String(a)}`));if(!d)return tK(new jM(e,t,i,x));f.push([m++,i]);continue}x[s]=t[s]}}let y=u?.exact===!0;for(let i=0;i<s.length;i++){let n=s[i][1],r=n.name,a=Object.prototype.hasOwnProperty.call(t,r);if(!a){if(n.isOptional)continue;if(y){let s=new jF(r,t,new jN(n));if(!d)return tK(new jM(e,t,s,x));f.push([m++,s]);continue}}let o=(0,s[i][0])(t[r],u),c=jK(o);if(c){if(tJ(c)){let s=new jF(r,t,a?c.left:new jN(n));if(!d)return tK(new jM(e,t,s,x));f.push([m++,s]);continue}x[r]=c.right}else{let s=m++;p||(p=[]),p.push(({es:i,output:c})=>lr(c8(o),o=>{if(tJ(o)){let l=new jF(r,t,a?o.left:new jN(n));return d?(i.push([s,l]),lz):tK(new jM(e,t,l,c))}return c[r]=o.right,lz}))}}for(let s=0;s<r.length;s++){let n=r[s],a=n[0],o=n[1];for(let s of NE(t,n[2])){let n=jK(a(s,u));if(n&&tW(n)){let n=o(t[s],u),r=jK(n);if(r){if(tJ(r)){let i=new jF(s,t,r.left);if(!d)return tK(new jM(e,t,i,x));f.push([m++,i]);continue}Object.prototype.hasOwnProperty.call(i,s)||(x[s]=r.right)}else{let r=m++,a=s;p||(p=[]),p.push(({es:o,output:c})=>lr(c8(n),n=>{if(!tJ(n))return Object.prototype.hasOwnProperty.call(i,s)||(c[s]=n.right),lz;{let s=new jF(a,t,n.left);return d?(o.push([r,s]),lz):tK(new jM(e,t,s,c))}}))}}}}let v=({es:s,output:i})=>{if(t5(s))return tK(new jM(e,t,zo(s),i));if(u?.propertyOrder==="original"){let e=h||NC(t);for(let t of n)-1===e.indexOf(t)&&e.push(t);let s={};for(let t of e)Object.prototype.hasOwnProperty.call(i,t)&&(s[t]=i[t]);return tV(s)}return tV(i)};if(p&&p.length>0){let e=p;return lI(()=>{let t={es:s2(f),output:Object.assign({},x)};return lr(yN(e,e=>e(t),{concurrency:c,batching:l,discard:!0}),()=>v(t))})}return v({es:f,output:x})}}case"Union":{let s=zi(e.types,t),i=NC(s.keys),n=i.length,r=new Map;for(let s=0;s<e.types.length;s++)r.set(e.types[s],j8(e.types[s],t));let a=j7(e)??1,o=j9(e);return(t,c)=>{let l;let u=[],h=0,p=[];if(n>0){if(et(t))for(let e=0;e<n;e++){let n=i[e],r=s.keys[n].buckets;if(Object.prototype.hasOwnProperty.call(t,n)){let e=String(t[n]);if(Object.prototype.hasOwnProperty.call(r,e))p=p.concat(r[e]);else{let e=M9.make(s.keys[n].literals);u.push([h++,new jM(new M1([new MQ(n,e,!1,!0)],[]),t,new jF(n,t,new jP(e,t[n])))])}}else{let e=M9.make(s.keys[n].literals),i=new MQ(n,e,!1,!0);u.push([h++,new jM(new M1([i],[]),t,new jF(n,t,new jN(i)))])}}else u.push([h++,new jP(e,t)])}s.otherwise.length>0&&(p=p.concat(s.otherwise));for(let e=0;e<p.length;e++){let s=p[e],i=r.get(s)(t,c),n=l&&0!==l.length?void 0:jK(i);if(n){if(tW(n))return n;u.push([h++,n.left])}else{let e=h++;l||(l=[]),l.push(t=>lI(()=>"finalResult"in t?lz:lr(c8(i),s=>(tW(s)?t.finalResult=s:t.es.push([e,s.left]),lz))))}}let d=s=>t5(s)?1===s.length&&"Type"===s[0][1]._tag?tK(s[0][1]):tK(new jM(e,t,zo(s))):tK(new jP(e,t));if(l&&l.length>0){let e=l;return lI(()=>{let t={es:s2(u)};return lr(yN(e,e=>e(t),{concurrency:a,batching:o,discard:!0}),()=>"finalResult"in t?t.finalResult:d(t.es))})}return d(u)}}case"Suspend":{let s=NR(()=>j8(jg(e.f(),e.annotations),t));return(e,t)=>s()(e,t)}}},zt=(e,t)=>s=>t(s)?tV(s):tK(new jP(e,s)),zs=(e,t)=>{switch(e._tag){case"Declaration":{let s=Mm(e);if(ty(s))return zs(s.value,t);break}case"TypeLiteral":{let s=[];for(let i=0;i<e.propertySignatures.length;i++){let n=e.propertySignatures[i],r=t?jO(n.type):jw(n.type);MO(r)&&!n.isOptional&&s.push([n.name,r])}return s}case"TupleType":{let s=[];for(let i=0;i<e.elements.length;i++){let n=e.elements[i],r=t?jO(n.type):jw(n.type);MO(r)&&!n.isOptional&&s.push([i,r])}return s}case"Refinement":return zs(e.from,t);case"Suspend":return zs(e.f(),t);case"Transformation":return zs(t?e.from:e.to,t)}return[]},zi=(e,t)=>{let s={},i=[];for(let n=0;n<e.length;n++){let r=e[n],a=zs(r,t);if(a.length>0)for(let e=0;e<a.length;e++){let[t,i]=a[e],n=String(i.literal);s[t]=s[t]||{buckets:{},literals:[]};let o=s[t].buckets;if(Object.prototype.hasOwnProperty.call(o,n)){if(e<a.length-1)continue;o[n].push(r),s[t].literals.push(i)}else{o[n]=[r],s[t].literals.push(i);break}}else i.push(r)}return{keys:s,otherwise:i}},zn=e=>ja(e)?zn(e.from):e,zr=(e,t,s,i)=>{let n=jK(e);if(n)return n;if(i?.isEffectAllowed===!0)return e;try{return w8(c8(e))}catch(e){return tK(new jD(t,s,"cannot be be resolved synchronously, this is caused by using runSync on an effect that performs async work"))}},za=([e],[t])=>e>t?1:e<t?-1:0;function zo(e){return e.sort(za).map(e=>e[1])}let zc=(e,t)=>{switch(e._tag){case"FinalTransformation":return t?e.decode:e.encode;case"ComposeTransformation":return tV;case"TypeLiteralTransformation":return s=>{let i=tV(s);for(let s of e.propertySignatureTransformations){let[e,n]=t?[s.from,s.to]:[s.to,s.from],r=t?s.decode:s.encode;i=jJ(i,t=>{let s=r(Object.prototype.hasOwnProperty.call(t,e)?tw(t[e]):t4());return delete t[e],ty(s)&&(t[n]=s.value),t})}return i}}},zl=(e,t=[])=>({value:e,forest:t}),zu={formatIssue:e=>ly(zI(e),zh),formatIssueSync:e=>w8(zu.formatIssue(e)),formatError:e=>zu.formatIssue(e.issue),formatErrorSync:e=>zu.formatIssueSync(e.issue)},zh=e=>e.value+zp("\n",e.forest),zp=(e,t)=>{let s,i="",n=t.length;for(let r=0;r<n;r++){s=t[r];let a=r===n-1;i+=e+(a?"":"")+" "+s.value,i+=zp(e+(n>1&&!a?"  ":"   "),s.forest)}return i},zd=e=>{switch(e){case"Encoded":return"Encoded side transformation failure";case"Transformation":return"Transformation process failure";case"Type":return"Type side transformation failure"}},zf=e=>{switch(e){case"From":return"From side refinement failure";case"Predicate":return"Predicate refinement failure"}},zm=e=>"ast"in e?tw(e.ast):t4(),zg=e=>zm(e).pipe(sr(Mr),lr(t=>{let s=t(e);return J(s)?lR({message:s,override:!1}):cJ(s)?ly(s,e=>({message:e,override:!1})):J(s.message)?lR({message:s.message,override:s.override}):ly(s.message,e=>({message:e,override:s.override}))})),zb=e=>t=>t._tag===e,zx=zb("Composite"),zy=zb("Refinement"),zv=zb("Transformation"),zw=e=>zg(e).pipe(lr(t=>!t.override&&(zx(e)||zy(e)&&"From"===e.kind||zv(e)&&"Transformation"!==e.kind)?zv(e)||zy(e)?zw(e.issue):t4():lR(t.message))),zS=e=>zm(e).pipe(sr(Mp),so(t=>se(t(e)))),z_=e=>zw(e).pipe(lk(()=>zS(e)),c0(()=>lR(e.message??`Expected ${String(e.ast)}, actual ${NT(e.actual)}`))),zk=e=>t8(zS(e),()=>String(e.ast)),zO=e=>e.message??"is forbidden",zE=e=>e.message??"is unexpected",zC=e=>Ma(e.ast).pipe(lr(e=>{let t=e();return J(t)?lR(t):t}),c0(()=>lR(e.message??"is missing"))),zR=(e,t)=>lh(zw(e),{onFailure:t,onSuccess:e=>lR(zl(e))}),zI=e=>{switch(e._tag){case"Type":return ly(z_(e),zl);case"Forbidden":return lR(zl(zk(e),[zl(zO(e))]));case"Unexpected":return lR(zl(zE(e)));case"Missing":return ly(zC(e),zl);case"Transformation":return zR(e,()=>ly(zI(e.issue),t=>zl(zk(e),[zl(zd(e.kind),[t])])));case"Refinement":return zR(e,()=>ly(zI(e.issue),t=>zl(zk(e),[zl(zf(e.kind),[t])])));case"Pointer":return ly(zI(e.issue),t=>zl(Nj(e.path),[t]));case"Composite":{let t=zk(e);return zR(e,()=>NA(e.issues)?ly(yN(e.issues,zI),e=>zl(t,e)):ly(zI(e.issues),e=>zl(t,[e])))}}},zT=e=>lR([e]),zF=M(e=>es(e[0]),(e,...t)=>{let s={};for(let i of t)i in e&&(s[i]=e[i]);return s}),zA=M(e=>es(e[0]),(e,...t)=>{let s={...e};for(let e of t)delete s[e];return s}),zN=Symbol.for("effect/Schema"),zM=e=>class{static{this[zN]=zj}static{this.ast=e}static annotations(e){return zM(zD(this.ast,e))}static pipe(){return eY(this,arguments)}static toString(){return String(e)}constructor(){this[zN]=zj}},zj={_A:e=>e,_I:e=>e,_R:e=>e},zz={schemaId:NV,message:NG,missingMessage:NY,identifier:NX,title:NQ,description:NZ,examples:N0,default:N1,documentation:N6,jsonSchema:N2,arbitrary:N3,pretty:N5,equivalence:N4,concurrency:N8,batching:N7,parseIssueTitle:N9,parseOptions:Me,decodingFallback:Mt},zP=e=>{if(!e)return{};let t={...e};for(let s in zz)s in e&&(t[zz[s]]=e[s],delete t[s]);return t},zD=(e,t)=>jg(e,zP(t)),zL=e=>String(e.ast),z$=e=>zM(jO(e.ast)),zU=e=>zM(jw(e.ast)),zB=(e,t)=>{let s=j1(e,t);return(e,t)=>jW(s(e,t),jB)},zq=(e,t)=>{let s=zB(e,t);return(e,t)=>w4(s(e,t))},zH=(e,t)=>{let s=j0(e,t);return(e,t)=>tG(s(e,t),jB)},zJ=e=>ei(e,zN)&&es(e[zN]),zW=e=>jt(e)?M9.make(je(e,e=>new Mk(e))):new Mk(e[0]),zK=(e,t=zW(e))=>class extends zM(t){static annotations(e){return zK(this.literals,zD(this.ast,e))}static{this.literals=[...e]}};function zV(...e){return sz(e)?zK(e):z1}let zG=e=>{switch(e._tag){case"Literal":return[String(e.literal)];case"NumberKeyword":case"StringKeyword":return[new AST.TemplateLiteral("",[new AST.TemplateLiteralSpan(e,"")])];case"Union":return array_.flatMap(e.types,zG)}throw Error(errors_.getSchemaUnsupportedLiteralSpanErrorMessage(e))},zY=(e,t,s)=>zM(new MS(e.map(e=>e.ast),(...e)=>t.decode(...e.map(zM)),(...e)=>t.encode(...e.map(zM)),zP(s))),zX=(e,t)=>{let s=()=>(t,s,i)=>e(t)?tV(t):tK(new jP(i,t));return zM(new MS([],s,s,zP(t)))},zQ=function(){if(Array.isArray(arguments[0])){let e=arguments[0],t=arguments[1],s=arguments[2];return zY(e,t,s)}let e=arguments[0],t=arguments[1];return zX(e,t)};class zZ extends zM(MI){}class z0 extends zM(ME){}class z1 extends zM(MF){}class z2 extends zM(MN){}class z3 extends zM(MP){}class z5 extends zM(M$){}class z4 extends zM(Mq){}let z6=e=>M9.make(e.map(e=>e.ast)),z8=(e,t=z6(e))=>class extends zM(t){static annotations(e){return z8(this.members,zD(this.ast,e))}static{this.members=[...e]}};function z7(...e){return jt(e)?z8(e):sz(e)?e[0]:z1}let z9=e=>z7(e,z0),Pe=e=>z7(e,zZ),Pt=e=>z7(e,z0,zZ),Ps=(e,t)=>new MY(e.map(e=>zJ(e)?new MV(e.ast,!1):e.ast),t.map(e=>zJ(e)?new MK(e.ast):e.ast),!0),Pi=(e,t,s=Ps(e,t))=>class extends zM(s){static annotations(e){return Pi(this.elements,this.rest,zD(this.ast,e))}static{this.elements=[...e]}static{this.rest=[...t]}},Pn=(e,t)=>class extends Pi([],[e],t){static annotations(e){return Pn(this.value,zD(this.ast,e))}static{this.value=e}},Pr=e=>Pn(e),Pa=(e,t)=>class extends Pi([e],[e],t){static annotations(e){return Pa(this.value,zD(this.ast,e))}static{this.value=e}},Po=e=>e?'"?:"':'":"';class Pc extends MV{constructor(e,t,s,i,n){super(e,t,i),this._tag="PropertySignatureDeclaration",this.isReadonly=s,this.defaultValue=n}toString(){let e=Po(this.isOptional),t=String(this.type);return`PropertySignature<${e}, ${t}, never, ${e}, ${t}>`}}class Pl extends MV{constructor(e,t,s,i,n){super(e,t,i),this.isReadonly=s,this.fromKey=n}}class Pu extends MV{constructor(e,t,s,i,n){super(e,t,i),this.isReadonly=s,this.defaultValue=n}}let Ph=e=>void 0===e?"never":J(e)?JSON.stringify(e):String(e);class Pp{constructor(e,t,s,i){this._tag="PropertySignatureTransformation",this.from=e,this.to=t,this.decode=s,this.encode=i}toString(){return`PropertySignature<${Po(this.to.isOptional)}, ${this.to.type}, ${Ph(this.from.fromKey)}, ${Po(this.from.isOptional)}, ${this.from.type}>`}}let Pd=(e,t)=>{switch(e._tag){case"PropertySignatureDeclaration":return new Pc(e.type,e.isOptional,e.isReadonly,{...e.annotations,...t},e.defaultValue);case"PropertySignatureTransformation":return new Pp(new Pl(e.from.type,e.from.isOptional,e.from.isReadonly,e.from.annotations),new Pu(e.to.type,e.to.isOptional,e.to.isReadonly,{...e.to.annotations,...t},e.to.defaultValue),e.decode,e.encode)}},Pf=Symbol.for("effect/PropertySignature"),Pm=e=>ei(e,Pf);class Pg{constructor(e){this[Pf]=null,this.ast=e}pipe(){return eY(this,arguments)}annotations(e){return new Pg(Pd(this.ast,zP(e)))}toString(){return String(this.ast)}}let Pb=e=>new Pg(e);class Px extends Pg{constructor(e,t){super(e),this.from=t}annotations(e){return new Px(Pd(this.ast,zP(e)),this.from)}}let Py=M(2,(e,t)=>{let s=e.ast;switch(s._tag){case"PropertySignatureDeclaration":return Pb(new Pc(s.type,s.isOptional,s.isReadonly,s.annotations,t));case"PropertySignatureTransformation":return Pb(new Pp(s.from,new Pu(s.to.type,s.to.isOptional,s.to.isReadonly,s.to.annotations,t),s.decode,s.encode))}}),Pv=(e,t,s)=>Pb(new Pp(new Pl(e.ast,!0,!0,{},void 0),new Pu(t.ast,!1,!0,{},void 0),e=>tw(s.decode(e)),sr(s.encode))),Pw=(e,t,s)=>Pb(new Pp(new Pl(e.ast,!0,!0,{},void 0),new Pu(t.ast,!0,!0,{},void 0),s.decode,s.encode)),PS=(e,t)=>{let s=t?.exact,i=t?.default,n=t?.nullable,r=t?.as=="Option",a=t?.onNoneEncoding?t7(t.onNoneEncoding):j;return s?i?n?Py(Pv(z9(e),zU(e),{decode:t6({onNone:i,onSome:e=>null===e?i():e}),encode:tw}),i).ast:Py(Pv(e,zU(e),{decode:t6({onNone:i,onSome:j}),encode:tw}),i).ast:r?n?Pv(z9(e),Dt(zU(e)),{decode:sc(Z),encode:a}).ast:Pv(e,Dt(zU(e)),{decode:j,encode:j}).ast:n?Pw(z9(e),zU(e),{decode:sc(Z),encode:j}).ast:new Pc(e.ast,!0,!0,{},void 0):i?n?Py(Pv(Pt(e),zU(e),{decode:t6({onNone:i,onSome:e=>null==e?i():e}),encode:tw}),i).ast:Py(Pv(Pe(e),zU(e),{decode:t6({onNone:i,onSome:e=>void 0===e?i():e}),encode:tw}),i).ast:r?n?Pv(Pt(e),Dt(zU(e)),{decode:sc(e=>null!=e),encode:a}).ast:Pv(Pe(e),Dt(zU(e)),{decode:sc(Q),encode:a}).ast:n?Pw(Pt(e),Pe(zU(e)),{decode:sc(Z),encode:j}).ast:new Pc(Pe(e).ast,!0,!0,{},void 0)},P_=e=>new Px(new Pc(e.ast===MI||e.ast===MF?MI:Pe(e).ast,!0,!0,{},void 0),e),Pk=M(e=>zJ(e[0]),(e,t)=>new Px(PS(e,t),e)),PO=(e,t)=>{let s=NC(e),i=[];if(s.length>0){let n=[],r=[],a=[];for(let t=0;t<s.length;t++){let o=s[t],c=e[o];if(Pm(c)){let e=c.ast;switch(e._tag){case"PropertySignatureDeclaration":{let t=e.type,s=e.isOptional,a=e.annotations;n.push(new MQ(o,t,s,!0)),r.push(new MQ(o,jw(t),s,!0,a)),i.push(new MQ(o,t,s,!0,a));break}case"PropertySignatureTransformation":{let t=e.from.fromKey??o;n.push(new MQ(t,e.from.type,e.from.isOptional,!0,e.from.annotations)),r.push(new MQ(o,e.to.type,e.to.isOptional,!0,e.to.annotations)),a.push(new jd(t,o,e.decode,e.encode))}}}else n.push(new MQ(o,c.ast,!1,!0)),r.push(new MQ(o,jw(c.ast),!1,!0)),i.push(new MQ(o,c.ast,!1,!0))}if(sz(a)){let e=[],s=[];for(let i of t){let{indexSignatures:t,propertySignatures:a}=jy(i.key.ast,i.value.ast);a.forEach(e=>{n.push(e),r.push(new MQ(e.name,jw(e.type),e.isOptional,e.isReadonly,e.annotations))}),t.forEach(t=>{e.push(t),s.push(new M0(t.parameter,jw(t.type),t.isReadonly))})}return new jc(new M1(n,e,{[NQ]:"Struct (Encoded side)"}),new M1(r,s,{[NQ]:"Struct (Type side)"}),new jf(a))}}let n=[];for(let e of t){let{indexSignatures:t,propertySignatures:s}=jy(e.key.ast,e.value.ast);s.forEach(e=>i.push(e)),t.forEach(e=>n.push(e))}return new M1(i,n)},PE=(e,t)=>{for(let s of NC(e)){let i=e[s];if(void 0===t[s]&&Pm(i)){let e=i.ast,n="PropertySignatureDeclaration"===e._tag?e.defaultValue:e.to.defaultValue;void 0!==n&&(t[s]=n())}}return t},PC=(e,t,s=PO(e,t))=>class extends zM(s){static annotations(e){return PC(this.fields,this.records,zD(this.ast,e))}static{this.fields={...e}}static{this.records=[...t]}static{this.make=(t,s)=>{let i=PE(e,{...t});return Du(s)?i:j3(this)(i)}}static pick(...t){return PR(zF(e,...t))}static omit(...t){return PR(zA(e,...t))}};function PR(e,...t){return PC(e,t)}let PI=(e,t,s)=>class extends PC({},[{key:e,value:t}],s){static annotations(s){return PI(e,t,zD(this.ast,s))}static{this.key=e}static{this.value=t}},PT=e=>PI(e.key,e.value),PF=(e,t,s)=>{if(M5(e)&&M5(t)){let i=[...e.propertySignatures];for(let e of t.propertySignatures){let t=e.name,n=i.findIndex(e=>e.name===t);if(-1===n)i.push(e);else{let{isOptional:r,type:a}=i[n];i[n]=new MQ(t,PM(a,e.type,s.concat(t)),r,!0)}}return new M1(i,e.indexSignatures.concat(t.indexSignatures))}throw Error(NP(e,t,s))},PA=(w=[NX],e=>{let t={...e.annotations};for(let e of w)delete t[e];return t}),PN=(e,t)=>t.map(t=>new jr(t,e.filter,PA(e))),PM=(e,t,s)=>M9.make(Pz([e],[t],s)),Pj=e=>js(e)?e.types:[e],Pz=(e,t,s)=>s7(e,e=>s7(t,t=>{switch(t._tag){case"Literal":if(J(t.literal)&&MD(e)||W(t.literal)&&MU(e)||K(t.literal)&&MH(e))return[t];break;case"StringKeyword":if(t===MP){if(MD(e)||MO(e)&&J(e.literal))return[e];if(ja(e))return PN(e,Pz(Pj(e.from),[t],s))}else if(e===MP)return[t];break;case"NumberKeyword":if(t===M$){if(MU(e)||MO(e)&&W(e.literal))return[e];if(ja(e))return PN(e,Pz(Pj(e.from),[t],s))}else if(e===M$)return[t];break;case"BooleanKeyword":if(t===Mq){if(MH(e)||MO(e)&&K(e.literal))return[e];if(ja(e))return PN(e,Pz(Pj(e.from),[t],s))}else if(e===Mq)return[t];break;case"Union":return Pz(Pj(e),t.types,s);case"Suspend":return[new jn(()=>PM(e,t.f(),s))];case"Refinement":return PN(t,Pz(Pj(e),Pj(t.from),s));case"TypeLiteral":switch(e._tag){case"Union":return Pz(e.types,[t],s);case"Suspend":return[new jn(()=>PM(e.f(),t,s))];case"Refinement":return PN(e,Pz(Pj(e.from),[t],s));case"TypeLiteral":return[PF(e,t,s)];case"Transformation":if(jm(e.transformation))return[new jc(PF(e.from,t,s),PF(e.to,jw(t),s),new jf(e.transformation.propertySignatureTransformations))]}break;case"Transformation":if(jm(t.transformation))switch(e._tag){case"Union":return Pz(e.types,[t],s);case"Suspend":return[new jn(()=>PM(e.f(),t,s))];case"Refinement":return PN(e,Pz(Pj(e.from),[t],s));case"TypeLiteral":return[new jc(PF(e,t.from,s),PF(jw(e),t.to,s),new jf(t.transformation.propertySignatureTransformations))];case"Transformation":if(jm(e.transformation))return[new jc(PF(e.from,t.from,s),PF(e.to,t.to,s),new jf(t.transformation.propertySignatureTransformations.concat(e.transformation.propertySignatureTransformations)))]}}throw Error(NP(e,t,s))})),PP=M(2,(e,t)=>zM(PM(e.ast,t.ast,[]))),PD=M(e=>zJ(e[1]),(e,t)=>zM(jR(e.ast,t.ast))),PL=e=>zM(new jn(()=>e().ast)),P$=Symbol.for("effect/SchemaId/Refine"),PU=(e,t,s)=>class extends zM(s){static annotations(e){return PU(this.from,this.filter,zD(this.ast,e))}static{this[P$]=e}static{this.from=e}static{this.filter=t}static{this.make=(e,t)=>Du(t)?e:j3(this)(e)}},PB=(e,t,s)=>{if(K(e))return e?t4():tw(new jP(t,s));if(J(e))return tw(new jP(t,s,e));if(void 0!==e){if("_tag"in e)return tw(e);let i=new jP(t,s,e.message);return tw(sz(e.path)?new jF(e.path,s,i):i)}return t4()},Pq=(e,t,s)=>{if(NN(e))return PB(e,t,s);if(sz(e)){let i=ie(e,e=>PB(e,t,s));if(sz(i))return tw(1===i.length?i[0]:new jM(t,s,i))}return t4()};function PH(e,t){return s=>{function i(t,s,i){return Pq(e(t,s,i),i,t)}let n=new jr(s.ast,i,zP(t));return PU(s,i,n)}}let PJ=(e,t,s)=>class extends zM(s){static annotations(e){return PJ(this.from,this.to,zD(this.ast,e))}static{this.from=e}static{this.to=t}},PW=M(e=>zJ(e[0])&&zJ(e[1]),(e,t,s)=>PJ(e,t,new jc(e.ast,t.ast,new ju(s.decode,s.encode)))),PK=M(e=>zJ(e[0])&&zJ(e[1]),(e,t,s)=>PW(e,t,{strict:!0,decode:(e,t,i,n)=>tV(s.decode(e,n)),encode:(e,t,i,n)=>tV(s.encode(e,n))})),PV=Symbol.for("effect/SchemaId/Trimmed"),PG=Symbol.for("effect/SchemaId/StartsWith"),PY=z3.annotations({[NX]:"JsonString",[NQ]:"JsonString",[NZ]:"a JSON string"}),PX=e=>PW(PY,z2,{strict:!0,decode:(t,s,i)=>jq({try:()=>JSON.parse(t,e?.reviver),catch:e=>new jP(i,t,e.message)}),encode:(t,s,i)=>jq({try:()=>JSON.stringify(t,e?.replacer,e?.space),catch:e=>new jP(i,t,e.message)})}).annotations({schemaId:Mw}),PQ=(e,t)=>zJ(e)?PD(PQ(t),e):PX(e),PZ=e=>t=>t.pipe(PH(e=>Number.isSafeInteger(e),{schemaId:NW,title:"integer",description:"an integer",jsonSchema:{type:"integer"},...e}));class P0 extends z5.pipe(PZ({identifier:"Int",title:"Int"})){}let P1=e=>t=>e(t).map(Av),P2=(e,t,s,i)=>jV(e,{onFailure:e=>new jM(s,i,e),onSuccess:t}),P3=e=>(t,s,i)=>Ay(t)?P2(e(Aw(t),s),Av,i,t):tK(new jP(i,t)),P5=e=>zQ([e],{decode:e=>P3(j1(e)),encode:e=>P3(j2(e))},{description:"Redacted(<redacted>)",pretty:()=>()=>"Redacted(<redacted>)",arbitrary:P1,equivalence:AS}),P4=zQ(e=>e instanceof Uint8Array,{identifier:"Uint8ArrayFromSelf",pretty:()=>e=>`new Uint8Array(${JSON.stringify(Array.from(e))})`,arbitrary:()=>e=>e.uint8Array(),equivalence:()=>t3(eM)}),P6=(S="Uint8ArrayFromBase64",_=e=>Nm(e),k=e=>"string"==typeof e?Nf(Nd.encode(e)):Nf(e),PW(z3.annotations({description:"a string that will be parsed into a Uint8Array"}),P4,{strict:!0,decode:(e,t,s)=>tG(_(e),t=>new jP(s,e,t.message)),encode:e=>tV(k(e))}).annotations({identifier:S})),P8=e=>"None"===e._tag?t4():tw(e.value),P7=(e,t)=>s=>s.oneof(t,s.record({_tag:s.constant("None")}),s.record({_tag:s.constant("Some"),value:e(s)})).map(P8),P9=e=>t6({onNone:()=>"none()",onSome:t=>`some(${e(t)})`}),De=e=>(t,s,i)=>tb(t)?tx(t)?tV(t4()):P2(e(t.value,s),tw,i,t):tK(new jP(i,t)),Dt=e=>zQ([e],{decode:e=>De(j1(e)),encode:e=>De(j2(e))},{description:`Option<${zL(e)}>`,pretty:P9,arbitrary:P7,equivalence:sl}),Ds=e=>zJ(e)||Pm(e),Di=e=>NC(e).every(t=>Ds(e[t])),Dn=e=>"fields"in e?e.fields:Dn(e[P$]),Dr=e=>Di(e)?PR(e):zJ(e)?e:PR(Dn(e)),Da=e=>Di(e)?e:Dn(e),Do=e=>(t,s)=>Dp({kind:"Class",identifier:e,schema:Dr(t),fields:Da(t),Base:am,annotations:s}),Dc=(e,t)=>{let s={...e};for(let i of NC(t)){if(i in e)throw Error(NH(i));s[i]=t[i]}return s},Dl=(e,t)=>tx(Mo(e.ast))?e.annotations({title:t}):e,Du=e=>K(e)?e:e?.disableValidation??!1,Dh=H("effect/Schema/astCache",()=>new WeakMap),Dp=({Base:e,annotations:t,disableToString:s,fields:i,identifier:n,kind:r,schema:a})=>{let o=Symbol.for(`effect/Schema/${r}/${n}`),c=Dl(a,`${n} (Constructor)`),l=Dl(a,`${n} (Encoded side)`),u=Dl(zU(a),`${n} (Type side)`),h=e=>ei(e,o)&&j5(u)(e),p=class extends e{constructor(e={},t=!1){e={...e},"Class"!==r&&delete e._tag,e=PE(i,e),Du(t)||(e=j3(c)(e)),super(e,!0)}static{this[zN]=zj}static get ast(){if(Dh.has(this))return Dh.get(this);let e=PK(l,zQ([u],{decode:()=>(e,t,s)=>e instanceof this||h(e)?tV(e):tK(new jP(s,e)),encode:()=>(e,t)=>e instanceof this?tV(e):jJ(j2(u)(e,t),e=>new this(e,!0))},{identifier:n,title:n,description:`an instance of ${n}`,pretty:e=>t=>`${n}(${e(t)})`,arbitrary:e=>t=>e(t).map(e=>new this(e)),equivalence:j,[Ms]:u.ast,...t}),{strict:!0,decode:e=>new this(e,!0),encode:j}).annotations({[Ms]:a.ast});return Dh.set(this,e.ast),e.ast}static pipe(){return eY(this,arguments)}static annotations(e){return zM(this.ast).annotations(e)}static toString(){return`(${String(l)} <-> ${n})`}static make(...e){return new this(...e)}static{this.fields={...i}}static{this.identifier=n}static extend(e){return(t,s)=>{let n=Da(t),o=Dr(t),c=Dc(i,n);return Dp({kind:r,identifier:e,schema:PP(a,o),fields:c,Base:this,annotations:s})}}static transformOrFail(e){return(t,s,n)=>{let o=Dc(i,t);return Dp({kind:r,identifier:e,schema:PW(a,zU(PR(o)),s),fields:o,Base:this,annotations:n})}}static transformOrFailFrom(e){return(t,s,n)=>{let o=Dc(i,t);return Dp({kind:r,identifier:e,schema:PW(z$(a),PR(o),s),fields:o,Base:this,annotations:n})}}get[o](){return o}};return!0!==s&&Object.defineProperty(p.prototype,"toString",{value(){return`${n}({ ${NC(i).map(e=>`${NF(e)}: ${NT(this[e])}`).join(", ")} })`},configurable:!0}),p},Dd=z7(PR({_tag:zV("None")}).annotations({identifier:"FiberIdNoneEncoded"}),PR({_tag:zV("Runtime"),id:P0.annotations({title:"id",description:"id"}),startTimeMillis:P0.annotations({title:"startTimeMillis",description:"startTimeMillis"})}).annotations({identifier:"FiberIdRuntimeEncoded"}),PR({_tag:zV("Composite"),left:PL(()=>Dd),right:PL(()=>Dd)}).annotations({identifier:"FiberIdCompositeEncoded"})).annotations({identifier:"FiberIdEncoded"}),Df=e=>e.letrec(t=>({None:e.record({_tag:e.constant("None")}),Runtime:e.record({_tag:e.constant("Runtime"),id:e.integer(),startTimeMillis:e.integer()}),Composite:e.record({_tag:e.constant("Composite"),left:t("FiberId"),right:t("FiberId")}),FiberId:e.oneof(t("None"),t("Runtime"),t("Composite"))})).FiberId.map(Dg),Dm=e=>{switch(e._tag){case"None":return"FiberId.none";case"Runtime":return`FiberId.runtime(${e.id}, ${e.startTimeMillis})`;case"Composite":return`FiberId.composite(${Dm(e.right)}, ${Dm(e.left)})`}},Dg=e=>{switch(e._tag){case"None":return rQ;case"Runtime":return rZ(e.id,e.startTimeMillis);case"Composite":return r0(Dg(e.left),Dg(e.right))}},Db=e=>PR({_tag:zV("Die"),defect:e}),Dx=PR({_tag:zV("Empty")}),Dy=e=>PR({_tag:zV("Fail"),error:e}),Dv=PR({_tag:zV("Interrupt"),fiberId:Dd}),Dw=e=>PR({_tag:zV("Parallel"),left:e,right:e}),DS=e=>PR({_tag:zV("Sequential"),left:e,right:e}),D_=(e,t)=>{let s=PL(()=>i),i=z7(Dx,Dy(e),Db(t),Dv,DS(s),Dw(s)).annotations({title:`CauseEncoded<${zL(e)}>`});return i},Dk=(e,t)=>s=>s.letrec(i=>({Empty:s.record({_tag:s.constant("Empty")}),Fail:s.record({_tag:s.constant("Fail"),error:e(s)}),Die:s.record({_tag:s.constant("Die"),defect:t(s)}),Interrupt:s.record({_tag:s.constant("Interrupt"),fiberId:Df(s)}),Sequential:s.record({_tag:s.constant("Sequential"),left:i("Cause"),right:i("Cause")}),Parallel:s.record({_tag:s.constant("Parallel"),left:i("Cause"),right:i("Cause")}),Cause:s.oneof(i("Empty"),i("Fail"),i("Die"),i("Interrupt"),i("Sequential"),i("Parallel"))})).Cause.map(DR),DO=e=>t=>{let s=t=>{switch(t._tag){case"Empty":return"Cause.empty";case"Fail":return`Cause.fail(${e(t.error)})`;case"Die":return`Cause.die(${cause_.pretty(t)})`;case"Interrupt":return`Cause.interrupt(${Dm(t.fiberId)})`;case"Sequential":return`Cause.sequential(${s(t.left)}, ${s(t.right)})`;case"Parallel":return`Cause.parallel(${s(t.left)}, ${s(t.right)})`}};return s(t)},DE=e=>(t,s,i)=>cause_.isCause(t)?P2(e(function e(t){switch(t._tag){case"Empty":return{_tag:"Empty"};case"Fail":return{_tag:"Fail",error:t.error};case"Die":return{_tag:"Die",defect:t.defect};case"Interrupt":return{_tag:"Interrupt",fiberId:t.fiberId};case"Sequential":return{_tag:"Sequential",left:e(t.left),right:e(t.right)};case"Parallel":return{_tag:"Parallel",left:e(t.left),right:e(t.right)}}}(t),s),DR,i,t):ParseResult.fail(new ParseResult.Type(i,t)),DC=({defect:e,error:t})=>zQ([t,e],{decode:(e,t)=>DE(ParseResult.decodeUnknown(D_(e,t))),encode:(e,t)=>DE(ParseResult.encodeUnknown(D_(e,t)))},{title:`Cause<${t.ast}>`,pretty:DO,arbitrary:Dk});function DR(e){switch(e._tag){case"Empty":return cause_.empty;case"Fail":return cause_.fail(e.error);case"Die":return cause_.die(e.defect);case"Interrupt":return cause_.interrupt(Dg(e.fiberId));case"Sequential":return cause_.sequential(DR(e.left),DR(e.right));case"Parallel":return cause_.parallel(DR(e.left),DR(e.right))}}let DI=(e,t)=>PR({_tag:zV("Failure"),cause:D_(e,t)}),DT=e=>PR({_tag:zV("Success"),value:e}),DF=e=>{switch(e._tag){case"Failure":return exit_.failCause(DR(e.cause));case"Success":return exit_.succeed(e.value)}},DA=(e,t,s)=>i=>i.oneof(i.record({_tag:i.constant("Failure"),cause:Dk(t,s)(i)}),i.record({_tag:i.constant("Success"),value:e(i)})).map(DF),DN=(e,t)=>s=>"Failure"===s._tag?`Exit.failCause(${DO(t)(s.cause)})`:`Exit.succeed(${e(s.value)})`,DM=(e,t)=>(s,i,n)=>exit_.isExit(s)?exit_.match(s,{onFailure:e=>P2(t(e,i),exit_.failCause,n,s),onSuccess:t=>P2(e(t,i),exit_.succeed,n,s)}):ParseResult.fail(new ParseResult.Type(n,s)),Dj=Symbol.for("@effect/platform/Headers"),Dz=Object.assign(Object.create(null),{[Dj]:Dj,[eJ](e){return DH(this,dw(e,DJ))}}),DP=e=>Object.assign(Object.create(Dz),e),DD=Object.create(Dz),DL=e=>{if(void 0===e)return DD;if(Symbol.iterator in e){let t=Object.create(Dz);for(let[s,i]of e)t[s.toLowerCase()]=i;return t}let t=Object.create(Dz);for(let[s,i]of Object.entries(e))Array.isArray(i)?t[s.toLowerCase()]=i.join(", "):void 0!==i&&(t[s.toLowerCase()]=i);return t},D$=e=>Object.setPrototypeOf(e,Dz),DU=M(3,(e,t,s)=>{let i=DP(e);return i[t.toLowerCase()]=s,i}),DB=M(2,(e,t)=>DP({...e,...DL(t)})),Dq=M(2,(e,t)=>{let s=DP(e);return delete s[t.toLowerCase()],s}),DH=M(2,(e,t)=>{let s={...e},i=t=>{if("string"==typeof t){let i=t.toLowerCase();i in e&&(s[i]=Av(e[i]))}else for(let i in e)t.test(i)&&(s[i]=Av(e[i]))};if(Array.isArray(t))for(let e=0;e<t.length;e++)i(t[e]);else i(t);return s}),DJ=H("@effect/platform/Headers/currentRedactedNames",()=>ua(["authorization","cookie","set-cookie","x-api-key"])),DW=e=>D$({b3:`${e.traceId}-${e.spanId}-${e.sampled?"1":"0"}${"Some"===e.parent._tag?`-${e.parent.value.spanId}`:""}`,traceparent:`00-${e.traceId}-${e.spanId}-${e.sampled?"01":"00"}`}),DK=e=>{let t=DQ(e);return"Some"===t._tag||"Some"===(t=DV(e))._tag?t:DG(e)},DV=e=>{if(!("b3"in e))return t4();let t=e.b3.split("-");return t.length<2?t4():tw(mz({traceId:t[0],spanId:t[1],sampled:!t[2]||"1"===t[2]}))},DG=e=>e["x-b3-traceid"]&&e["x-b3-spanid"]?tw(mz({traceId:e["x-b3-traceid"],spanId:e["x-b3-spanid"],sampled:!e["x-b3-sampled"]||"1"===e["x-b3-sampled"]})):t4(),DY=/^[0-9a-f]{32}$/gi,DX=/^[0-9a-f]{16}$/gi,DQ=e=>{if(!e.traceparent)return t4();let t=e.traceparent.split("-");if(4!==t.length)return t4();let[s,i,n,r]=t;return"00"===s?!1===DY.test(i)||!1===DX.test(n)?t4():tw(mz({traceId:i,spanId:n,sampled:(1&parseInt(r,16))==1})):t4()},DZ=e=>{let t=Symbol.iterator in e?sC(e):Object.entries(e),s=[];for(let[e,i]of t)if(Array.isArray(i))for(let t=0;t<i.length;t++)void 0!==i[t]&&s.push([e,String(i[t])]);else void 0!==i&&s.push([e,String(i)]);return s},D0=((e,t,s)=>sA(ir(e,([e])=>e!==t),[t,String(s)]),M(2,(e,t)=>{let s=DZ(t),i=s.map(([e])=>e);return sN(ir(e,([e])=>i.includes(e)),s)})),D1=M(3,(e,t,s)=>sA(e,[t,String(s)])),D2=((e,t)=>sN(e,DZ(t)),(e,t,s)=>{try{let i=new URL(e,D3());for(let e=0;e<t.length;e++){let[s,n]=t[e];void 0!==n&&i.searchParams.append(s,n)}return"Some"===s._tag&&(i.hash=s.value),tV(i)}catch(e){return tK(e)}}),D3=()=>{if("location"in globalThis&&void 0!==globalThis.location&&void 0!==globalThis.location.origin&&void 0!==globalThis.location.pathname)return location.origin+location.pathname},D5=(e,t,s)=>ON(Oj(f6(()=>lz)),i=>$(Oj(lM(lF(e,e=>f7(i,t=>s(e,t))))),ON(t),OI(e=>lr(f8(i),t=>t(e))))),D4=tz("@effect/platform/FileSystem"),D6=e=>"bigint"==typeof e?e:BigInt(e),D8=Symbol.for("@effect/platform/HttpBody"),D7=Symbol.for("@effect/platform/HttpBody/HttpBodyError"),D9=e=>{let t=void 0===e?Object.create(to):ag(e);return t._tag="HttpBodyError",t},Le=e=>D9({[D7]:D7,reason:e});class Lt{constructor(){this[D8]=D8}[eD](){return this.toJSON()}toString(){return e$(this)}}class Ls extends Lt{toJSON(){return{_id:"@effect/platform/HttpBody",_tag:"Empty"}}constructor(...e){super(...e),this._tag="Empty"}}let Li=new Ls;class Ln extends Lt{constructor(e,t){super(),this._tag="Uint8Array",this.body=e,this.contentType=t}get contentLength(){return this.body.length}toJSON(){return{_id:"@effect/platform/HttpBody",_tag:"Uint8Array",body:this.contentType.startsWith("text/")||this.contentType.endsWith("json")?new TextDecoder().decode(this.body):`Uint8Array(${this.body.length})`,contentType:this.contentType,contentLength:this.contentLength}}}let Lr=(e,t)=>new Ln(e,t??"application/octet-stream"),La=new TextEncoder,Lo=(e,t)=>Lr(La.encode(e),t??"text/plain"),Lc=e=>Lo(JSON.stringify(e),"application/json"),Ll=e=>mH({try:()=>Lc(e),catch:e=>Le({_tag:"JsonError",error:e})});class Lu extends Lt{constructor(e,t,s){super(),this._tag="Stream",this.stream=e,this.contentType=t,this.contentLength=s}toJSON(){return{_id:"@effect/platform/HttpBody",_tag:"Stream",contentType:this.contentType,contentLength:this.contentLength}}}let Lh=Symbol.for("@effect/platform/HttpClientRequest"),Lp={[Lh]:Lh,...eU,toJSON(){return{_id:"@effect/platform/HttpClientRequest",method:this.method,url:this.url,urlParams:this.urlParams,hash:this.hash,headers:eG(this.headers),body:this.body.toJSON()}},pipe(){return eY(this,arguments)}};function Ld(e,t,s,i,n,r){let a=Object.create(Lp);return a.method=e,a.url=t,a.urlParams=s,a.hash=i,a.headers=n,a.body=r,a}let Lf=Ld("GET","",[],t4(),DD,Li),Lm=e=>(t,s)=>L_(Lf,{method:e,url:t,...s??void 0}),Lg=Lm("GET"),Lb=Lm("POST"),Lx=Lm("PUT"),Ly=Lm("PATCH"),Lv=Lm("DELETE"),Lw=Lm("HEAD"),LS=Lm("OPTIONS"),L_=M(2,(e,t)=>{let s=e;return t.method&&(s=LR(s,t.method)),t.url&&(s=LI(s,t.url)),t.headers&&(s=LO(s,t.headers)),t.urlParams&&(s=LA(s,t.urlParams)),t.hash&&(s=LN(s,t.hash)),t.body&&(s=LM(s,t.body)),t.accept&&(s=LE(s,t.accept)),t.acceptJson&&(s=LC(s)),s}),Lk=M(3,(e,t,s)=>Ld(e.method,e.url,e.urlParams,e.hash,DU(e.headers,t,s),e.body)),LO=M(2,(e,t)=>Ld(e.method,e.url,e.urlParams,e.hash,DB(e.headers,t),e.body)),LE=M(2,(e,t)=>Lk(e,"Accept",t)),LC=LE("application/json"),LR=M(2,(e,t)=>Ld(t,e.url,e.urlParams,e.hash,e.headers,e.body)),LI=M(2,(e,t)=>{if("string"==typeof t)return Ld(e.method,t,e.urlParams,e.hash,e.headers,e.body);let s=new URL(t.toString()),i=DZ(s.searchParams),n=s.hash?tw(s.hash.slice(1)):t4();return s.search="",s.hash="",Ld(e.method,s.toString(),i,n,e.headers,e.body)}),LT=M(2,(e,t)=>Ld(e.method,t.endsWith("/")&&e.url.startsWith("/")?t+e.url.slice(1):t+e.url,e.urlParams,e.hash,e.headers,e.body)),LF=M(3,(e,t,s)=>Ld(e.method,e.url,D1(e.urlParams,t,s),e.hash,e.headers,e.body)),LA=M(2,(e,t)=>Ld(e.method,e.url,D0(e.urlParams,t),e.hash,e.headers,e.body)),LN=M(2,(e,t)=>Ld(e.method,e.url,e.urlParams,tw(t),e.headers,e.body)),LM=M(2,(e,t)=>{let s=e.headers;if("Empty"===t._tag)s=Dq(Dq(s,"Content-Type"),"Content-length");else{let e=t.contentType;e&&(s=DU(s,"content-type",e));let i=t.contentLength;i&&(s=DU(s,"content-length",i.toString()))}return Ld(e.method,e.url,e.urlParams,e.hash,s,t)}),Lj=M(2,(e,t)=>ly(Ll(t),t=>LM(e,t))),Lz=Symbol.for("@effect/platform/HttpIncomingMessage"),LP=(e,t)=>{let s=zB(e,t);return e=>lr(e.json,s)},LD=(e,t)=>{let s=zB(e,t);return e=>s(e.headers)},LL=H("@effect/platform/HttpIncomingMessage/maxBodySize",()=>ua(t4())),L$=(e,t)=>{let s;let i=e.headers["content-type"]??"";if(i.includes("application/json"))try{s=w8(e.json)}catch(e){}else if(i.includes("text/")||i.includes("urlencoded"))try{s=w8(e.text)}catch(e){}let n={...t,headers:eG(e.headers),remoteAddress:e.remoteAddress.toJSON()};return void 0!==s&&(n.body=s),n},LU=Symbol.for("@effect/platform/HttpClientResponse"),LB=(e,t)=>new Lq(e,t);class Lq extends eB{constructor(e,t){super(),this.request=e,this.source=t,this[Lz]=Lz,this[LU]=LU}toJSON(){return L$(this,{_id:"@effect/platform/HttpClientResponse",request:this.request.toJSON(),status:this.status})}get status(){return this.source.status}get headers(){return DL(this.source.headers)}get cookies(){return this.cachedCookies?this.cachedCookies:this.cachedCookies=An(this.source.headers.getSetCookie())}get remoteAddress(){return t4()}get stream(){return this.source.body?FY(()=>this.source.body,e=>new F4({request:this.request,response:this,reason:"Decode",cause:e})):TH(new F4({request:this.request,response:this,reason:"EmptyBody",description:"can not create stream from empty body"}))}get json(){return gp(this.text,{try:e=>""===e?null:JSON.parse(e),catch:e=>new F4({request:this.request,response:this,reason:"Decode",cause:e})})}get text(){return this.textBody??=gh({try:()=>this.source.text(),catch:e=>new F4({request:this.request,response:this,reason:"Decode",cause:e})}).pipe(_d,w8)}get urlParamsBody(){return lr(this.text,e=>mH({try:()=>DZ(new URLSearchParams(e)),catch:e=>new F4({request:this.request,response:this,reason:"Decode",cause:e})}))}get formData(){return this.formDataBody??=gh({try:()=>this.source.formData(),catch:e=>new F4({request:this.request,response:this,reason:"Decode",cause:e})}).pipe(_d,w8)}get arrayBuffer(){return this.arrayBufferBody??=gh({try:()=>this.source.arrayBuffer(),catch:e=>new F4({request:this.request,response:this,reason:"Decode",cause:e})}).pipe(_d,w8)}}let LH=e=>e.status>=200&&e.status<300?lR(e):c9(new F4({response:e,request:e.request,reason:"StatusCode",description:"non 2xx status code"})),LJ=Symbol.for("@effect/platform/HttpClient"),LW=tz("@effect/platform/HttpClient"),LK=H(Symbol.for("@effect/platform/HttpClient/tracerDisabledWhen"),()=>ua(D)),LV=H(Symbol.for("@effect/platform/HttpClient/currentTracerPropagation"),()=>ua(!0)),LG={[LJ]:LJ,pipe(){return eY(this,arguments)},...eU,toJSON:()=>({_id:"@effect/platform/HttpClient"}),get(e,t){return this.execute(Lg(e,t))},head(e,t){return this.execute(Lw(e,t))},post(e,t){return this.execute(Lb(e,t))},put(e,t){return this.execute(Lx(e,t))},patch(e,t){return this.execute(Ly(e,t))},del(e,t){return this.execute(Lv(e,t))},options(e,t){return this.execute(LS(e,t))}},LY=(e,t)=>{let s=Object.create(LG);return s.preprocess=t,s.postprocess=e,s.execute=function(s){return e(t(s))},s},{del:LX,execute:LQ,get:LZ,head:L0,options:L1,patch:L2,post:L3,put:L5}=new Proxy({},{get:(e,t,s)=>(...e)=>lr(LW,s=>s[t](...e))}),L4=M(2,(e,t)=>LY(s=>t(e.postprocess(s)),e.preprocess)),L6="@effect/platform/FetchHttpClient/Fetch",L8=(e=>LY(t=>lr(t,t=>cW(s=>{let i=tN(s.getFiberRef(uh),yQ),n=new AbortController,r=uT(i,lT(()=>n.abort())),a=D2(t.url,t.urlParams,t.hash);if("Left"===a._tag)return c9(new F5({request:t,reason:"InvalidUrl",cause:a.left}));let o=a.right;return!s.getFiberRef(uk)||s.getFiberRef(LK)(t)?yY(r,e(t,o,n.signal,s)):yY(r,_S(`http.client ${t.method}`,{kind:"client",captureStackTrace:!1},i=>{i.attribute("http.request.method",t.method),i.attribute("server.address",o.origin),""!==o.port&&i.attribute("server.port",+o.port),i.attribute("url.full",o.toString()),i.attribute("url.path",o.pathname),i.attribute("url.scheme",o.protocol.slice(0,-1));let r=o.search.slice(1);""!==r&&i.attribute("url.query",r);let a=s.getFiberRef(DJ),c=DH(t.headers,a);for(let e in c)i.attribute(`http.request.header.${e}`,String(c[e]));return lF(gx(e(t=s.getFiberRef(LV)?LO(t,DW(i)):t,o,n.signal,s),i),e=>{i.attribute("http.response.status_code",e.status);let t=DH(e.headers,a);for(let e in t)i.attribute(`http.response.header.${e}`,String(t[e]))})}))})),lR))((e,t,s,i)=>{let n=i.getFiberRef(uh),r=n.unsafeMap.get(L6)??globalThis.fetch,a=n.unsafeMap.get("@effect/platform/FetchHttpClient/FetchOptions")??{},o=new globalThis.Headers(e.headers),c=i=>ly(gh({try:()=>r(t,{...a,method:e.method,headers:o,body:i,duplex:"Stream"===e.body._tag?"half":void 0,signal:s}),catch:t=>new F5({request:e,reason:"Transport",cause:t})}),t=>LB(e,t));switch(e.body._tag){case"Raw":case"Uint8Array":return c(e.body.body);case"FormData":return c(e.body.formData);case"Stream":return lr(FN(e.body.stream),c)}return c(void 0)}),L7=(O=lR(L8),Sm(LW,lr(hv(),e=>ly(O,t=>L4(t,hk(t=>tj(e,t)))))));class L9 extends tL(L6)(){}function $e(e){if(Array.isArray(e))return e.map($e).join("");switch(typeof e){case"string":return e;case"number":case"bigint":return e.toString();case"boolean":return e?"true":"false";default:return""}}let $t=Symbol.for("@effect/platform/HttpServerResponse"),$s=Symbol.for("@effect/platform/HttpServerRespondable");class $i extends di{constructor(e,t,s,i,n){if(super(),this.status=e,this.statusText=t,this.cookies=i,this.body=n,this[$t]=$t,n.contentType||n.contentLength){let e={...s};n.contentType&&(e["content-type"]=n.contentType),n.contentLength&&(e["content-length"]=n.contentLength.toString()),this.headers=e}else this.headers=s}commit(){return lR(this)}[$s](){return lR(this)}[eD](){return this.toJSON()}toString(){return e$(this)}toJSON(){return{_id:"@effect/platform/HttpServerResponse",status:this.status,statusText:this.statusText,headers:eG(this.headers),cookies:this.cookies.toJSON(),body:this.body.toJSON()}}}let $n=e=>"object"==typeof e&&null!==e&&$t in e,$r=e=>new $i(e?.status??204,e?.statusText,e?.headers??DD,e?.cookies??Ar,Li),$a=M(3,(e,t,s)=>new $i(e.status,e.statusText,DU(e.headers,t,s),e.cookies,e.body)),$o=(e,t)=>ly(Ll(e),e=>new $i(t?.status??200,t?.statusText,t?.headers??DD,t?.cookies??Ar,e)),$c=(e,t)=>{let s=new globalThis.Headers(e.headers);if(!Aa(e.cookies))for(let t of Ad(e.cookies))s.append("set-cookie",t);if(t?.withoutBody)return new Response(void 0,{status:e.status,statusText:e.statusText,headers:s});let i=e.body;switch(i._tag){case"Empty":return new Response(void 0,{status:e.status,statusText:e.statusText,headers:s});case"Uint8Array":case"Raw":return new Response(i.body,{status:e.status,statusText:e.statusText,headers:s});case"FormData":return new Response(i.formData,{status:e.status,statusText:e.statusText,headers:s});case"Stream":return new Response(FM(i.stream,t?.runtime??w3),{status:e.status,statusText:e.statusText,headers:s})}},$l=Symbol.for("@effect/platform/HttpServerRespondable"),$u=e=>ei(e,$l),$h=$r({status:400}),$p=$r({status:404}),$d=e=>$n(e)?lR(e):lO(e[$l]()),$f=(e,t)=>$n(e)?lR(e):$u(e)?cZ(e[$l](),()=>lR(t)):j$(e)?lR($h):wN(e)?lR($p):lR(t),$m=Symbol.for("@effect/platform/HttpServerError"),$g=H("@effect/platform/HttpServerError/clientAbortFiberId",()=>rZ(-499,0)),$b=e=>{let t;let s=cr(e,e=>$n(e)?(t=e,tw(oG)):t4());return[t??$x,s]},$x=$r({status:500}),$y=$r({status:499}),$v=$r({status:503}),$w=$m;class $S extends F2($w,"RequestError"){[$l](){return $r({status:400})}get methodAndUrl(){return`${this.request.method} ${this.request.url}`}get message(){return this.description?`${this.reason}: ${this.description} (${this.methodAndUrl})`:`${this.reason} error (${this.methodAndUrl})`}}class $_ extends F2($w,"RouteNotFound"){constructor(e){super(e),this.stack=`${this.name}: ${this.message}`}[$l](){return $r({status:404})}get message(){return`${this.request.method} ${this.request.url} not found`}}let $k=e=>{let[t,s]=cb(e,[lR($x),oG],(e,t)=>{switch(t._tag){case"Empty":return tw(e);case"Fail":return tw([$f(t.error,$x),t]);case"Die":return tw([$f(t.defect,$x),t]);case"Interrupt":if("Empty"!==e[1]._tag)return t4();return tw([lR(t.fiberId===$g?$y:$v),t]);default:return t4()}});return ly(t,e=>wT(s)?[e,oX(e)]:[e,o0(s,oX(e))])},$O=e=>"Success"===e._tag?e.value:$b(e.cause)[0],$E=Symbol.for("effect/Mailbox"),$C=Symbol.for("effect/Mailbox/ReadonlyMailbox"),$R=iS(),$I=hs($R),$T=hs(!1),$F=hs(!0),$A=[$R,!0];class $N extends ds{constructor(e,t,s){super(),this[$E]=$E,this[$C]=$C,this.state={_tag:"Open",takers:new Set,offers:new Set,awaiters:new Set},this.messages=[],this.messagesChunk=iS(),this.shutdown=lT(()=>{if("Done"===this.state._tag)return!0;this.messages=[],this.messagesChunk=$R;let e=this.state.offers;if(this.finalize("Open"===this.state._tag?hi:this.state.exit),e.size>0){for(let t of e)"Single"===t._tag?t.resume($T):t.resume(hs(iT(t.remaining.slice(t.offset))));e.clear()}return!0}),this.end=this.done(hi),this.clear=lI(()=>{if("Done"===this.state._tag)return u0(this.state.exit,$R);let e=this.unsafeTakeAll();return this.releaseCapacity(),lR(e)}),this.takeAll=lI(()=>{if("Done"===this.state._tag)return u0(this.state.exit,$A);let e=this.unsafeTakeAll();return 0===e.length?lH(this.awaitTake,this.takeAll):lR([e,this.releaseCapacity()])}),this.take=lI(()=>this.unsafeTake()??lH(this.awaitTake,this.take)),this.await=cX(e=>"Done"===this.state._tag?e(this.state.exit):(this.state.awaiters.add(e),lT(()=>{"Done"!==this.state._tag&&this.state.awaiters.delete(e)}))),this.size=lT(()=>this.unsafeSize()),this.awaitTake=cX(e=>"Done"===this.state._tag?e(this.state.exit):(this.state.takers.add(e),lT(()=>{"Done"!==this.state._tag&&this.state.takers.delete(e)}))),this.scheduleRunning=!1,this.releaseTaker=()=>{if(this.scheduleRunning=!1,"Done"===this.state._tag||0===this.state.takers.size)return;let e=sp(this.state.takers);this.state.takers.delete(e),e(hi)},this.scheduler=e,this.capacity=t,this.strategy=s}offer(e){return lI(()=>{if("Open"!==this.state._tag)return $T;if(this.messages.length+this.messagesChunk.length>=this.capacity)switch(this.strategy){case"dropping":return $T;case"suspend":return this.offerRemainingSingle(e);case"sliding":return this.unsafeTake(),this.messages.push(e),$F}return this.messages.push(e),this.scheduleReleaseTaker(),$F})}unsafeOffer(e){return"Open"===this.state._tag&&(this.messages.length+this.messagesChunk.length>=this.capacity?"sliding"===this.strategy&&(this.unsafeTake(),this.messages.push(e),!0):(this.messages.push(e),this.scheduleReleaseTaker(),!0))}offerAll(e){return lI(()=>{if("Open"!==this.state._tag)return lR(iO(e));let t=this.unsafeOfferAllArray(e);return 0===t.length?$I:"dropping"===this.strategy?lR(iT(t)):this.offerRemainingArray(t)})}unsafeOfferAll(e){return iT(this.unsafeOfferAllArray(e))}unsafeOfferAllArray(e){if("Open"!==this.state._tag)return sC(e);if(this.capacity===Number.POSITIVE_INFINITY||"sliding"===this.strategy)return this.messages.length>0&&(this.messagesChunk=iD(this.messagesChunk,iT(this.messages))),"sliding"===this.strategy?this.messagesChunk=this.messagesChunk.pipe(iD(iO(e)),iZ(this.capacity)):iv(e)?this.messagesChunk=iD(this.messagesChunk,e):this.messages=sC(e),this.scheduleReleaseTaker(),[];let t=this.capacity-this.messages.length-this.messagesChunk.length;if(0===t)return sC(e);let s=[],i=0;for(let n of e)i<t?this.messages.push(n):s.push(n),i++;return this.scheduleReleaseTaker(),s}fail(e){return this.done(u5(e))}failCause(e){return this.done(u4(e))}unsafeDone(e){return"Open"===this.state._tag&&(0===this.state.offers.size&&0===this.messages.length&&0===this.messagesChunk.length?this.finalize(e):this.state={...this.state,_tag:"Closing",exit:e},!0)}done(e){return lT(()=>this.unsafeDone(e))}takeN(e){return lI(()=>{let t;if("Done"===this.state._tag)return u0(this.state.exit,$A);if(e<=0)return lR([$R,!1]);if((e=Math.min(e,this.capacity))<=this.messagesChunk.length)t=ij(this.messagesChunk,e),this.messagesChunk=iz(this.messagesChunk,e);else{if(!(e<=this.messages.length+this.messagesChunk.length))return lH(this.awaitTake,this.takeN(e));this.messagesChunk=iD(this.messagesChunk,iT(this.messages)),this.messages=[],t=ij(this.messagesChunk,e),this.messagesChunk=iz(this.messagesChunk,e)}return lR([t,this.releaseCapacity()])})}unsafeTake(){let e;if("Done"===this.state._tag)return hr(this.state.exit,u5(new uJ));if(this.messagesChunk.length>0)e=iK(this.messagesChunk),this.messagesChunk=iz(this.messagesChunk,1);else{if(!(this.messages.length>0))return;e=this.messages[0],this.messagesChunk=iz(iT(this.messages),1),this.messages=[]}return this.releaseCapacity(),hs(e)}unsafeSize(){let e=this.messages.length+this.messagesChunk.length;return"Done"===this.state._tag?t4():tw(e)}commit(){return this.takeAll}pipe(){return eY(this,arguments)}toJSON(){return{_id:"effect/Mailbox",state:this.state._tag,size:this.unsafeSize().toJSON()}}toString(){return e$(this)}[eD](){return e$(this)}offerRemainingSingle(e){return cX(t=>{if("Open"!==this.state._tag)return t($T);let s={_tag:"Single",message:e,resume:t};return this.state.offers.add(s),lT(()=>{"Open"===this.state._tag&&this.state.offers.delete(s)})})}offerRemainingArray(e){return cX(t=>{if("Open"!==this.state._tag)return t(hs(iT(e)));let s={_tag:"Array",remaining:e,offset:0,resume:t};return this.state.offers.add(s),lT(()=>{"Open"===this.state._tag&&this.state.offers.delete(s)})})}releaseCapacity(){if("Done"===this.state._tag)return"Success"===this.state.exit._tag;if(0===this.state.offers.size)return"Closing"===this.state._tag&&0===this.messages.length&&0===this.messagesChunk.length&&(this.finalize(this.state.exit),"Success"===this.state.exit._tag);let e=this.capacity-this.messages.length-this.messagesChunk.length;for(let t of this.state.offers){if(0===e)break;if("Single"===t._tag)this.messages.push(t.message),e--,t.resume($F),this.state.offers.delete(t);else{for(;t.offset<t.remaining.length;t.offset++){if(0===e)return!1;this.messages.push(t.remaining[t.offset]),e--}t.resume($I),this.state.offers.delete(t)}}return!1}scheduleReleaseTaker(){this.scheduleRunning||(this.scheduleRunning=!0,this.scheduler.scheduleTask(this.releaseTaker,0))}unsafeTakeAll(){if(this.messagesChunk.length>0){let e=this.messages.length>0?iD(this.messagesChunk,iT(this.messages)):this.messagesChunk;return this.messagesChunk=$R,this.messages=[],e}if(this.messages.length>0){let e=iT(this.messages);return this.messages=[],e}return $R}finalize(e){if("Done"===this.state._tag)return;let t=this.state;for(let s of(this.state={_tag:"Done",exit:e},t.takers))s(e);for(let s of(t.takers.clear(),t.awaiters))s(e);t.awaiters.clear()}}let $M=e=>cW(t=>lR(new $N(t.currentScheduler,"number"==typeof e?e:e?.capacity??Number.POSITIVE_INFINITY,"number"==typeof e?"suspend":e?.strategy??"suspend"))),$j=((e,t)=>lj(s=>lu(s(e),{onFailure:e=>t.failCause(e),onSuccess:e=>t.end})),/; *([!#$%&'*+.^\w`|~-]+)=("(?:[\v\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\v\u0020-\u00ff])*"|[!#$%&'*+.^\w`|~-]+) */gu),$z=/\\([\v\u0020-\u00ff])/gu,$P=/^[!#$%&'*+.^\w|~-]+\/[!#$%&'*+.^\w|~-]+$/u,$D=/^[!#$%&'*+.^\w|~-]+$/u,$L={value:"",parameters:Object.create(null)};function $$(e,t=!1){let s,i,n;if("string"!=typeof e)return $L;let r=e.indexOf(";"),a=-1!==r?e.slice(0,r).trim():e.trim();if(!1===(t?$D:$P).test(a))return $L;let o={value:a.toLowerCase(),parameters:Object.create(null)};if(-1===r)return o;for($j.lastIndex=r;i=$j.exec(e);){if(i.index!==r)return $L;r+=i[0].length,s=i[1].toLowerCase(),'"'===(n=i[2])[0]&&(n=n.slice(1,n.length-1),!t&&$z.test(n)&&(n=n.replace($z,"$1"))),o.parameters[s]=n}return r!==e.length?$L:o}!function(e){e[e.key=0]="key",e[e.whitespace=1]="whitespace",e[e.value=2]="value"}(C||(C={}));let $U={_tag:"Continue"},$B=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1],$q=[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];!function(e){e[e.headers=0]="headers",e[e.body=1]="body"}(R||(R={}));let $H={_tag:"InvalidDisposition"},$J={_tag:"EndNotReached"},$W={_tag:"ReachedLimit",limit:"MaxParts"},$K={_tag:"ReachedLimit",limit:"MaxTotalSize"},$V={_tag:"ReachedLimit",limit:"MaxPartSize"},$G={_tag:"ReachedLimit",limit:"MaxFieldSize"},$Y=new TextEncoder().encode("\r\n");function $X(e){return void 0!==e.filename||"application/octet-stream"===e.contentType}function $Q(e){}let $Z=new TextDecoder("utf-8"),$0=function({headers:e,onFile:t,onField:s,onError:i,onDone:n,isFile:r=$X,maxParts:a=1/0,maxTotalSize:o=1/0,maxPartSize:c=1/0,maxFieldSize:l=1048576}){let u=$$(e["content-type"]).parameters.boundary;if(void 0===u)return i({_tag:"InvalidBoundary"}),{write:$Q,end(){}};let h={state:R.headers,index:0,parts:0,onChunk:$Q,info:void 0,headerSkip:0,partSize:0,totalSize:0,isFile:!1,fieldChunks:[],fieldSize:0};function p(){h.state=R.body,h.isFile=!0,h.onChunk=$Q}let d=function(){let e=new TextDecoder,t={state:C.key,headers:Object.create(null),key:"",value:void 0,crlf:0,previousChunk:void 0,pairs:0,size:0};function s(e){return t.state=C.key,t.headers=Object.create(null),t.key="",t.value=void 0,t.crlf=0,t.previousChunk=void 0,t.pairs=0,t.size=0,e}function i(e,t){let s=new Uint8Array(e.length+t.length);return s.set(e),s.set(t,e.length),s}function n(e){return s({_tag:"Failure",reason:e,headers:t.headers})}return function(r,a){let o,c=0;if(void 0!==t.previousChunk){o=c=t.previousChunk.length;let e=new Uint8Array(r.length+c);e.set(t.previousChunk),e.set(r,c),t.previousChunk=void 0,r=e}let l=r.length;e:for(;a<l;){if(t.state===C.key){let s=a;for(;s<l;s++){if(t.size++>16384)return n("HeaderTooLarge");if(58===r[s]){if(t.key+=e.decode(r.subarray(a,s)).toLowerCase(),0===t.key.length)return n("InvalidHeaderName");32===r[s+1]&&32!==r[s+2]&&9!==r[s+2]?(a=s+2,t.state=C.value,t.size++):32!==r[s+1]&&9!==r[s+1]?(a=s+1,t.state=C.value):(a=s+1,t.state=C.whitespace);break}if(1!==$B[r[s]])return n("InvalidHeaderName")}if(s===l)return t.key+=e.decode(r.subarray(a,l)).toLowerCase(),$U}if(t.state===C.whitespace){for(;a<l;a++){if(t.size++>16384)return n("HeaderTooLarge");if(32!==r[a]&&9!==r[a]){t.state=C.value;break}}if(a===l)return $U}if(t.state===C.value){let u=a;for(void 0!==o&&(u=o,o=void 0);u<l;u++){if(t.size++>16384)return n("HeaderTooLarge");if(13===r[u]||t.crlf>0){let o=r[u];if(13===o&&0===t.crlf&&(t.crlf=1,u++,t.size++,o=r[u]),10===o&&1===t.crlf&&(t.crlf=2,u++,t.size++,o=r[u]),13===o&&2===t.crlf&&(t.crlf=3,u++,t.size++,o=r[u]),10===o&&3===t.crlf&&(t.crlf=4,u++,t.size++),t.crlf<4&&u>=l)return t.previousChunk=r.subarray(a),$U;if(t.crlf>=2){t.value=void 0===t.value?r.subarray(a,u-t.crlf):i(t.value,r.subarray(a,u-t.crlf));let o=e.decode(t.value);if(void 0===t.headers[t.key]?t.headers[t.key]=o:"string"==typeof t.headers[t.key]?t.headers[t.key]=[t.headers[t.key],o]:t.headers[t.key].push(o),a=u,t.size--,4!==t.crlf&&100===t.pairs)return n("TooManyHeaders");if(3===t.crlf)return n("InvalidHeaderValue");if(4===t.crlf)return s({_tag:"Headers",headers:t.headers,endPosition:a-c});t.pairs++,t.key="",t.value=void 0,t.crlf=0,t.state=C.key;continue e}}else if(1!==$q[r[u]])return n("InvalidHeaderValue")}if(u===l)return t.value=void 0===t.value?r.subarray(a,l):i(t.value,r.subarray(a,l)),$U}}return a>l&&(t.size+=l-a),$U}}(),f=function(e,t,s){let i=function(e){let t=new TextEncoder().encode(e),s=t.length,i={};for(let e=0;e<s;e++){let s=t[e];void 0===i[s]&&(i[s]=[]),i[s].push(e)}return{needle:t,needleLength:s,indexes:i,firstByte:t[0],previousChunk:void 0,previousChunkLength:0,matchIndex:0}}(e);void 0!==s&&(i.previousChunk=s,i.previousChunkLength=s.length);let n=function(){if("Buffer"in globalThis&&!("Bun"in globalThis||"Deno"in globalThis))return function(e,t,s){return Buffer.prototype.indexOf.call(e,t,s)};let e=new Uint8Array(256).fill(i.needle.length);for(let t=0,s=i.needle.length-1;t<s;++t)e[i.needle[t]]=s-t;return function(t,s,n){let r=t.length,a=n+i.needleLength-1;for(;a<r;){for(let e=i.needleLength-1,n=a;e>=0&&t[n]===s[e];e--,n--)if(0===e)return n;a+=e[t[a]]}return -1}}();return{write:function(e){let s=e.length;if(void 0!==i.previousChunk){let t=new Uint8Array(i.previousChunkLength+s);t.set(i.previousChunk),t.set(e,i.previousChunkLength),e=t,s=i.previousChunkLength+s,i.previousChunk=void 0}if(s<i.needleLength){i.previousChunk=e,i.previousChunkLength=s;return}let r=0;for(;r<s;){let a=n(e,i.needle,r);if(a>-1){a>r&&t(i.matchIndex,e.subarray(r,a)),i.matchIndex+=1,r=a+i.needleLength;continue}if(e[s-1]in i.indexes){let n=i.indexes[e[s-1]],a=-1;for(let t=0,r=n.length;t<r;t++){let r=n[t];e[s-1-r]===i.firstByte&&t>a&&(a=r)}-1===a?0===r?t(i.matchIndex,e):t(i.matchIndex,e.subarray(r)):(s-1-a>r&&t(i.matchIndex,e.subarray(r,s-1-a)),i.previousChunk=e.subarray(s-1-a),i.previousChunkLength=a+1)}else 0===r?t(i.matchIndex,e):t(i.matchIndex,e.subarray(r));break}},end:function(){void 0!==i.previousChunk&&i.previousChunk!==s&&t(i.matchIndex,i.previousChunk),i.previousChunk=s,i.previousChunkLength=s?.length??0,i.matchIndex=0}}}(`\r
--${u}`,function(e,o){if(0===e){p();return}if(e!==h.index){if(h.index>0){if(h.isFile)h.onChunk(null),h.partSize=0;else{if(1===h.fieldChunks.length)s(h.info,h.fieldChunks[0]);else{let e=new Uint8Array(h.fieldSize),t=0;for(let s=0;s<h.fieldChunks.length;s++){let i=h.fieldChunks[s];e.set(i,t),t+=i.length}s(h.info,e)}h.fieldSize=0,h.fieldChunks=[]}}if(h.state=R.headers,h.index=e,h.headerSkip=2,45===o[0]&&45===o[1])return n();h.parts++,h.parts>a&&i($W)}if((h.partSize+=o.length)>c&&i($V),h.state===R.headers){let e;let s=d(o,h.headerSkip);if(h.headerSkip=0,"Continue"===s._tag)return;if("Failure"===s._tag)return p(),i({_tag:"BadHeaders",error:s});let n=$$(s.headers["content-type"]),a=$$(s.headers["content-disposition"],!0);if("form-data"===a.value&&!("name"in a.parameters))return p(),i($H);if("filename*"in a.parameters){let t=a.parameters["filename*"].split("''");2===t.length&&(e=decodeURIComponent(t[1]))}if(h.info={name:a.parameters.name??"",filename:e??a.parameters.filename,contentType:""===n.value?void 0!==a.parameters.filename?"application/octet-stream":"text/plain":n.value,contentTypeParameters:n.parameters,contentDisposition:a.value,contentDispositionParameters:a.parameters,headers:s.headers},h.state=R.body,h.isFile=r(h.info),h.isFile&&(h.onChunk=t(h.info)),s.endPosition<o.length){if(h.isFile)h.onChunk(o.subarray(s.endPosition));else{let e=o.subarray(s.endPosition);(h.fieldSize+=e.length)>l&&i($G),h.fieldChunks.push(e)}}}else h.isFile?h.onChunk(o):((h.fieldSize+=o.length)>l&&i($G),h.fieldChunks.push(o))},$Y);return{write:e=>(h.totalSize+=e.length)>o?i($K):f.write(e),end(){f.end(),h.state===R.body&&i($J),h.state=R.headers,h.index=0,h.parts=0,h.onChunk=$Q,h.info=void 0,h.totalSize=0,h.partSize=0,h.fieldChunks=[],h.fieldSize=0}}},$1=Symbol.for("@effect/platform/Path"),$2=tz("@effect/platform/Path");function $3(e,t){let s,i="",n=0,r=-1,a=0;for(let o=0;o<=e.length;++o){if(o<e.length)s=e.charCodeAt(o);else if(47===s)break;else s=47;if(47===s){if(r===o-1||1===a);else if(r!==o-1&&2===a){if(i.length<2||2!==n||46!==i.charCodeAt(i.length-1)||46!==i.charCodeAt(i.length-2)){if(i.length>2){let e=i.lastIndexOf("/");if(e!==i.length-1){-1===e?(i="",n=0):n=(i=i.slice(0,e)).length-1-i.lastIndexOf("/"),r=o,a=0;continue}}else if(2===i.length||1===i.length){i="",n=0,r=o,a=0;continue}}t&&(i.length>0?i+="/..":i="..",n=2)}else i.length>0?i+="/"+e.slice(r+1,o):i=e.slice(r+1,o),n=o-r-1;r=o,a=0}else 46===s&&-1!==a?++a:a=-1}return i}let $5=function(){let e,t="",s=!1;for(let i=arguments.length-1;i>=-1&&!s;i--){let n;if(i>=0)n=arguments[i];else{let t=globalThis.process;void 0===e&&"process"in globalThis&&"object"==typeof t&&null!==t&&"function"==typeof t.cwd&&(e=t.cwd()),n=e}0!==n.length&&(t=n+"/"+t,s=47===n.charCodeAt(0))}return(t=$3(t,!s),s)?t.length>0?"/"+t:"/":t.length>0?t:"."},$4=/%/g,$6=/\\/g,$8=/\n/g,$7=/\r/g,$9=/\t/g,Ue=$2.of({[$1]:$1,resolve:$5,normalize(e){if(0===e.length)return".";let t=47===e.charCodeAt(0),s=47===e.charCodeAt(e.length-1);return(0!==(e=$3(e,!t)).length||t||(e="."),e.length>0&&s&&(e+="/"),t)?"/"+e:e},isAbsolute:e=>e.length>0&&47===e.charCodeAt(0),join(){let e;if(0==arguments.length)return".";for(let t=0;t<arguments.length;++t){let s=arguments[t];s.length>0&&(void 0===e?e=s:e+="/"+s)}return void 0===e?".":Ue.normalize(e)},relative(e,t){if(e===t||(e=Ue.resolve(e),t=Ue.resolve(t),e===t))return"";let s=1;for(;s<e.length&&47===e.charCodeAt(s);++s);let i=e.length,n=i-s,r=1;for(;r<t.length&&47===t.charCodeAt(r);++r);let a=t.length-r,o=n<a?n:a,c=-1,l=0;for(;l<=o;++l){if(l===o){if(a>o){if(47===t.charCodeAt(r+l))return t.slice(r+l+1);if(0===l)return t.slice(r+l)}else n>o&&(47===e.charCodeAt(s+l)?c=l:0===l&&(c=0));break}let i=e.charCodeAt(s+l);if(i!==t.charCodeAt(r+l))break;47===i&&(c=l)}let u="";for(l=s+c+1;l<=i;++l)(l===i||47===e.charCodeAt(l))&&(0===u.length?u+="..":u+="/..");return u.length>0?u+t.slice(r+c):(r+=c,47===t.charCodeAt(r)&&++r,t.slice(r))},dirname(e){if(0===e.length)return".";let t=e.charCodeAt(0),s=47===t,i=-1,n=!0;for(let s=e.length-1;s>=1;--s)if(47===(t=e.charCodeAt(s))){if(!n){i=s;break}}else n=!1;return -1===i?s?"/":".":s&&1===i?"//":e.slice(0,i)},basename(e,t){let s,i=0,n=-1,r=!0;if(void 0!==t&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";let a=t.length-1,o=-1;for(s=e.length-1;s>=0;--s){let c=e.charCodeAt(s);if(47===c){if(!r){i=s+1;break}}else -1===o&&(r=!1,o=s+1),a>=0&&(c===t.charCodeAt(a)?-1==--a&&(n=s):(a=-1,n=o))}return i===n?n=o:-1===n&&(n=e.length),e.slice(i,n)}for(s=e.length-1;s>=0;--s)if(47===e.charCodeAt(s)){if(!r){i=s+1;break}}else -1===n&&(r=!1,n=s+1);return -1===n?"":e.slice(i,n)},extname(e){let t=-1,s=0,i=-1,n=!0,r=0;for(let a=e.length-1;a>=0;--a){let o=e.charCodeAt(a);if(47===o){if(!n){s=a+1;break}continue}-1===i&&(n=!1,i=a+1),46===o?-1===t?t=a:1!==r&&(r=1):-1!==t&&(r=-1)}return -1===t||-1===i||0===r||1===r&&t===i-1&&t===s+1?"":e.slice(t,i)},format:function(e){if(null===e||"object"!=typeof e)throw TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,t){let s=t.dir||t.root,i=t.base||(t.name||"")+(t.ext||"");return s?s===t.root?s+i:s+"/"+i:i}(0,e)},parse(e){let t;let s={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return s;let i=e.charCodeAt(0),n=47===i;n?(s.root="/",t=1):t=0;let r=-1,a=0,o=-1,c=!0,l=e.length-1,u=0;for(;l>=t;--l){if(47===(i=e.charCodeAt(l))){if(!c){a=l+1;break}continue}-1===o&&(c=!1,o=l+1),46===i?-1===r?r=l:1!==u&&(u=1):-1!==r&&(u=-1)}return -1===r||-1===o||0===u||1===u&&r===o-1&&r===a+1?-1!==o&&(0===a&&n?s.base=s.name=e.slice(1,o):s.base=s.name=e.slice(a,o)):(0===a&&n?(s.name=e.slice(1,r),s.base=e.slice(1,o)):(s.name=e.slice(a,r),s.base=e.slice(a,o)),s.ext=e.slice(r,o)),a>0?s.dir=e.slice(0,a-1):n&&(s.dir="/"),s},sep:"/",fromFileUrl:function(e){if("file:"!==e.protocol)return c9(F1({module:"Path",method:"fromFileUrl",message:"URL must be of scheme file"}));if(""!==e.hostname)return c9(F1({module:"Path",method:"fromFileUrl",message:"Invalid file URL host"}));let t=e.pathname;for(let e=0;e<t.length;e++)if("%"===t[e]){let s=32|t.codePointAt(e+2);if("2"===t[e+1]&&102===s)return c9(F1({module:"Path",method:"fromFileUrl",message:"must not include encoded / characters"}))}return lR(decodeURIComponent(t))},toFileUrl:function(e){var t;let s=new URL("file://"),i=$5(e);return 47===e.charCodeAt(e.length-1)&&"/"!==i[i.length-1]&&(i+="/"),s.pathname=((t=i).includes("%")&&(t=t.replace($4,"%25")),t.includes("\\")&&(t=t.replace($6,"%5C")),t.includes("\n")&&(t=t.replace($8,"%0A")),t.includes("\r")&&(t=t.replace($7,"%0D")),t.includes("	")&&(t=t.replace($9,"%09")),t),lR(s)},toNamespacedPath:j}),Ut=Symbol.for("@effect/platform/Multipart"),Us=Symbol.for("@effect/platform/Multipart/MultipartError");class Ui extends F2(Us,"MultipartError"){get message(){return this.reason}}let Un=H("@effect/platform/Multipart/maxParts",()=>ua(t4())),Ur=H("@effect/platform/Multipart/maxFieldSize",()=>ua(D6(0xa00000))),Ua=H("@effect/platform/Multipart/maxFileSize",()=>ua(t4())),Uo=H("@effect/platform/Multipart/fieldMimeTypes",()=>ua(i_("application/json"))),Uc=e=>cW(t=>{let s=t.getFiberRef(Uo);return lR({headers:e,maxParts:st(t.getFiberRef(Un)),maxFieldSize:Number(t.getFiberRef(Ur)),maxPartSize:t.getFiberRef(Ua).pipe(sn(Number),st),maxTotalSize:t.getFiberRef(LL).pipe(sn(Number),st),isFile:0===s.length?void 0:e=>!i5(s,t=>e.contentType.includes(t))&&$X(e)})}),Ul=e=>"Success"===e._tag?OH:OF(e.cause);class Uu extends eB{constructor(){super(),this[Ut]=Ut}}class Uh extends Uu{constructor(e,t,s){super(),this._tag="Field",this.key=e,this.contentType=t,this.value=s}toJSON(){return{_id:"@effect/platform/Multipart/Part",_tag:"Field",key:this.key,contentType:this.contentType,value:this.value}}}class Up extends Uu{constructor(e,t){super(),this._tag="File",this.key=e.name,this.name=e.filename??e.name,this.contentType=e.contentType,this.content=T0(t)}toJSON(){return{_id:"@effect/platform/Multipart/Part",_tag:"File",key:this.key,name:this.name,contentType:this.contentType}}}let Ud=(e,t)=>lr(D4,s=>lw(Fx(t.content,s.sink(e)),e=>new Ui({reason:"InternalError",cause:e})));class Uf extends Uu{constructor(e,t,s,i){super(),this._tag="PersistedFile",this.key=e,this.name=t,this.contentType=s,this.path=i}toJSON(){return{_id:"@effect/platform/Multipart/Part",_tag:"PersistedFile",key:this.key,name:this.name,contentType:this.contentType,path:this.path}}}let Um=(e,t=16)=>D5(yA([Uc(e),$M(t)]),([e,t])=>{let s=[],i=t4(),n=$0({...e,onField(e,t){s.push(new Uh(e.name,e.contentType,(function(e){if("utf-8"===e||"utf8"===e||""===e)return $Z;try{return new TextDecoder(e)}catch(e){return $Z}})(e.contentTypeParameters.charset??"utf-8").decode(t)))},onFile(e){let t=[],i=!1,n=OB(()=>{if(0===t.length)return i?OH:Cv(r,n);let e=iT(t);return t=[],i?OJ(e):Cv(OJ(e),Cv(r,n))});return s.push(new Up(e,n)),function(e){null===e?i=!0:t.push(e)}},onError(e){i=tw(u5(function(e){if("ReachedLimit"===e._tag)switch(e.limit){case"MaxParts":return new Ui({reason:"TooManyParts",cause:e});case"MaxFieldSize":return new Ui({reason:"FieldTooLarge",cause:e});case"MaxPartSize":return new Ui({reason:"FileTooLarge",cause:e});case"MaxTotalSize":return new Ui({reason:"BodyTooLarge",cause:e})}return new Ui({reason:"Parse",cause:e})}(e)))},onDone(){i=tw(hi)}}),r=ON(t.takeAll,([e,t])=>Oq(()=>{iB(e,iB(n.write)),t&&n.end()})),a=ON(r,()=>{if(0===s.length)return"None"===i._tag?a:Ul(i.value);let e=iT(s);return s=[],Cv(OJ(e),"None"===i._tag?a:Ul(i.value))});return OR(a,{awaitRead:()=>lz,emit:e=>t.offer(e),error:e=>(i=tw(u4(e)),t.end),done:e=>t.end})},([,e])=>e.shutdown),Ug=(e,t=Ud)=>_f(function*(){let s=yield*D4,i=yield*$2,n=yield*s.makeTempDirectoryScoped();return yield*Fy(e,Object.create(null),(e,s)=>{if("Field"===s._tag)return e[s.key]=s.value,lR(e);let r=i.join(n,i.basename(s.name).slice(-128));return Array.isArray(e[s.key])||(e[s.key]=[]),e[s.key].push(new Uf(s.key,s.name,s.contentType,r)),cV(t(r,s),e)})}).pipe(mK({SystemError:e=>c9(new Ui({reason:"InternalError",cause:e})),BadArgument:e=>c9(new Ui({reason:"InternalError",cause:e}))})),Ub=Symbol.for("@effect/platform/HttpServerRequest"),Ux=tz("@effect/platform/HttpServerRequest"),Uy=tz("@effect/platform/HttpServerRequest/ParsedSearchParams"),Uv=e=>{if("/"===e[0])return e;let t=e.indexOf("/",e.indexOf("//")+2);return -1===t?"/":e.slice(t)};class Uw extends eB{constructor(e,t,s,i){super(),this.source=e,this.url=t,this.headersOverride=s,this.remoteAddressOverride=i,this[Ub]=Ub,this[Lz]=Lz}toJSON(){return L$(this,{_id:"@effect/platform/HttpServerRequest",method:this.method,url:this.originalUrl})}modify(e){return new Uw(this.source,e.url??this.url,e.headers??this.headersOverride,e.remoteAddress??this.remoteAddressOverride)}get method(){return this.source.method.toUpperCase()}get originalUrl(){return this.source.url}get remoteAddress(){return this.remoteAddressOverride?tw(this.remoteAddressOverride):t4()}get headers(){return this.headersOverride??=DL(this.source.headers),this.headersOverride}get cookies(){return this.cachedCookies?this.cachedCookies:this.cachedCookies=function(e){let t={},s=e.length,i=0,n=0;for(;n!==s;){-1===(n=e.indexOf(";",i))&&(n=s);let r=e.indexOf("=",i);if(-1===r)break;if(r>n){i=n+1;continue}let a=e.substring(i,r++).trim();if(void 0===t[a]){let s=34===e.charCodeAt(r)?e.substring(r+1,n-1).trim():e.substring(r,n).trim();t[a]=-1!==s.indexOf("%")?Af(s):s}i=n+1}return t}(this.headers.cookie??"")}get stream(){return this.source.body?FY(()=>this.source.body,e=>new $S({request:this,reason:"Decode",cause:e})):TH(new $S({request:this,reason:"Decode",description:"can not create stream from empty body"}))}get text(){return this.textEffect||(this.textEffect=w8(_d(gh({try:()=>this.source.text(),catch:e=>new $S({request:this,reason:"Decode",cause:e})})))),this.textEffect}get json(){return gp(this.text,{try:e=>JSON.parse(e),catch:e=>new $S({request:this,reason:"Decode",cause:e})})}get urlParamsBody(){return lr(this.text,e=>mH({try:()=>DZ(new URLSearchParams(e)),catch:e=>new $S({request:this,reason:"Decode",cause:e})}))}get multipart(){return this.multipartEffect||(this.multipartEffect=w8(_d(Ug(this.multipartStream)))),this.multipartEffect}get multipartStream(){return Fl(Fr(this.stream,e=>new Ui({reason:"InternalError",cause:e})),Um(this.headers))}get arrayBuffer(){return this.arrayBuffer?this.arrayBuffer:(this.arrayBufferEffect=w8(_d(gh({try:()=>this.source.arrayBuffer(),catch:e=>new $S({request:this,reason:"Decode",cause:e})}))),this.arrayBufferEffect)}get upgrade(){return c9(new $S({request:this,reason:"Decode",description:"Not an upgradeable ServerRequest"}))}}let US=(e,t)=>lr(Ux,LD(e,t)),U_=(e,t)=>lr(Ux,LP(e,t)),Uk=e=>new Uw(e,Uv(e.url)),UO=e=>{let t=e.headers.host??"localhost",s="https"===e.headers["x-forwarded-proto"]?"https":"http";try{return tw(new URL(e.url,`${s}://${t}`))}catch(e){return t4()}},UE=H(Symbol.for("@effect/platform/HttpApp/preResponseHandlers"),()=>ua(t4())),UC=H(Symbol.for("@effect/platform/HttpMiddleware/tracerDisabledWhen"),()=>ua(D)),UR=e=>cW(t=>{let s=tN(t.currentContext,Ux);if(t.getFiberRef(UC)(s))return e;let i=st(UO(s));void 0!==i&&(""!==i.username||""!==i.password)&&(i.username="REDACTED",i.password="REDACTED");let n=t.getFiberRef(DJ),r=DH(s.headers,n);return _S(`http.server ${s.method}`,{parent:st(DK(s.headers)),kind:"server",captureStackTrace:!1},t=>{for(let e in t.attribute("http.request.method",s.method),void 0!==i&&(t.attribute("url.full",i.toString()),t.attribute("url.path",i.pathname),""!==i.search.slice(1)&&t.attribute("url.query",i.search.slice(1)),t.attribute("url.scheme",i.protocol.slice(0,-1))),void 0!==s.headers["user-agent"]&&t.attribute("user_agent.original",s.headers["user-agent"]),r)t.attribute(`http.request.header.${e}`,String(r[e]));return"Some"===s.remoteAddress._tag&&t.attribute("client.address",s.remoteAddress.value),lr(c7(gx(e,t)),e=>{let s=$O(e);t.attribute("http.response.status_code",s.status);let i=DH(s.headers,n);for(let e in i)t.attribute(`http.response.header.${e}`,String(i[e]));return e})})}),UI=Symbol.for("@effect/platform/HttpApp/handled"),UT=(e,t,s)=>{let i=cZ(cW(s=>lr(e,e=>{let i=tN(s.currentContext,Ux),n=s.getFiberRef(UF);return"None"===n._tag?(i[UI]=!0,cV(t(i,e),e)):lF(n.value(i,e),e=>(i[UI]=!0,t(i,e)))})),e=>cW(s=>lr($k(e),([e,i])=>{let n=tN(s.currentContext,Ux),r=s.getFiberRef(UF);return"None"===r._tag?(n[UI]=!0,yY(t(n,e),lt(i))):yY(lF(r.value(n,e),e=>(n[UI]=!0,t(n,e))),lt(i))})));return lM(_x(j(void 0===s?UR(i):lu(s(UR(i)),{onFailure:e=>cW(s=>{let i=tN(s.currentContext,Ux);return UI in i?lz:lu($k(e),{onFailure:e=>t(i,$r({status:500})),onSuccess:([e])=>t(i,e)})}),onSuccess:e=>cW(s=>{let i=tN(s.currentContext,Ux);return UI in i?lz:t(i,e)})}))))},UF=UE,UA=e=>{let t=w$(e);return(s,i)=>{let n=Symbol.for("@effect/platform/HttpApp/resolve"),r=UT(s,(t,s)=>(t[n]($c(s,{withoutBody:"HEAD"===t.method,runtime:e})),lz),i);return e=>new Promise(s=>{let i=Uk(e);i[n]=s;let a=t(gi(r,Ux,i));e.signal?.addEventListener("abort",()=>{a.unsafeInterruptAsFork($g)},{once:!0})})}},UN=/\+/g,UM=function(){};UM.prototype=Object.create(null);let Uj=Array.from({length:256},(e,t)=>"%"+((t<16?"0":"")+t.toString(16)).toUpperCase()),Uz=new Int8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,1,1,1,0,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,0]),UP=/^https?:\/\/.*?\//,UD=/(\/:[^/()]*?)\?(\/?)/;class UL{constructor(e={}){this.options={ignoreTrailingSlash:!0,ignoreDuplicateSlashes:!0,caseSensitive:!1,maxParamLength:100,...e}}options;routes=[];trees={};on(e,t,s){let i=t.match(UD);if(i&&void 0!==i.index){UW(t.length===i.index+i[0].length,"Optional Parameter needs to be the last parameter of the path");let n=t.replace(UD,"$1$2"),r=t.replace(UD,"$2");this.on(e,n,s),this.on(e,r,s);return}for(let i of(this.options.ignoreDuplicateSlashes&&(t=UK(t)),this.options.ignoreTrailingSlash&&(t=UV(t)),"string"==typeof e?[e]:e))this._on(i,t,s)}all(e,t){this.on(UX,e,t)}_on(e,t,s){void 0===this.trees[e]&&(this.trees[e]=new Uq("/"));let i=t;if("*"===i&&0!==this.trees[e].prefix.length){let t=this.trees[e];this.trees[e]=new Uq(""),this.trees[e].staticChildren["/"]=t}let n=this.trees[e].prefix.length,r=this.trees[e],a=[];for(let e=0;e<=i.length;e++){if(58===i.charCodeAt(e)&&58===i.charCodeAt(e+1)){e++;continue}let t=58===i.charCodeAt(e)&&58!==i.charCodeAt(e+1),s=42===i.charCodeAt(e);if(t||s||e===i.length&&e!==n){let t=i.slice(n,e);this.options.caseSensitive||(t=t.toLowerCase()),t=(t=t.split("::").join(":")).split("%").join("%25"),r=r.createStaticChild(t)}if(t){let t=!1,s=[],c=e+1;for(let l=c;;l++){let u=i.charCodeAt(l),h=40===u,p=45===u||46===u,d=47===u||l===i.length;if(h||p||d){let u=i.slice(c,l);if(a.push(u),t=t||h||p,h){var o;let e=function(e,t){let s=1;for(;t<e.length;){if("\\"===e[++t]){t++;continue}if(")"===e[t]?s--:"("===e[t]&&s++,!s)return t}throw TypeError('Invalid regexp expression in "'+e+'"')}(i,l),t=i.slice(l,e+1);s.push((94===(o=t).charCodeAt(1)&&(o=o.slice(0,1)+o.slice(2)),36===o.charCodeAt(o.length-2)&&(o=o.slice(0,o.length-2)+o.slice(o.length-1)),o)),l=e+1}else s.push("(.*?)");let f=l;for(;l<i.length;l++){let e=i.charCodeAt(l);if(47===e)break;if(58===e){if(58===i.charCodeAt(l+1))l++;else break}}let m=i.slice(f,l);if(m&&(m=(m=m.split("::").join(":")).split("%").join("%25"),s.push(m.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"))),c=l+1,d||47===i.charCodeAt(l)||l===i.length){let a=t?"()"+m:m,o=i.slice(e,l);i=i.slice(0,e+1)+a+i.slice(l),e+=a.length;let c=t?RegExp("^"+s.join("")+"$"):void 0;r=r.createParametricChild(c,m,o),n=e+1;break}}}}else if(s&&(a.push("*"),r=r.createWildcardChild(),n=e+1,e!==i.length-1))throw Error("Wildcard must be the last character in the route")}for(let t of(this.options.caseSensitive||(i=i.toLowerCase()),"*"===i&&(i="/*"),this.routes))if(t.method===e&&t.pattern===i)throw Error(`Method '${e}' already declared for route '${i}'`);let c={method:e,path:t,pattern:i,params:a,handler:s};this.routes.push(c),r.addRoute(c)}has(e,t){let s=this.trees[e];if(void 0===s)return!1;let i=s.getStaticChild(t);return void 0!==i&&i.isLeafNode}find(e,t){let s,i,n,r=this.trees[e];if(void 0===r)return;47!==t.charCodeAt(0)&&(t=t.replace(UP,"/")),this.options.ignoreDuplicateSlashes&&(t=UK(t));try{t=(s=function(e){let t=!1,s=!1,i="";for(let n=1;n<e.length;n++){let r=e.charCodeAt(n);if(37===r){let i=e.charCodeAt(n+1),r=e.charCodeAt(n+2);void 0===UG(i,r)?t=!0:(s=!0,50===i&&53===r&&(t=!0,e=e.slice(0,n+1)+"25"+e.slice(n+1),n+=2),n+=2)}else if(63===r||59===r||35===r){i=e.slice(n+1),e=e.slice(0,n);break}}return{path:t?decodeURI(e):e,querystring:i,shouldDecodeParam:s}}(t)).path,i=s.querystring,n=s.shouldDecodeParam}catch(e){return}this.options.ignoreTrailingSlash&&(t=UV(t));let a=t;!1===this.options.caseSensitive&&(t=t.toLowerCase());let o=this.options.maxParamLength,c=r.prefix.length,l=[],u=t.length,h=[];for(;;){if(c===u&&r.isLeafNode){let e=r.handlerStorage?.find();if(void 0!==e)return{handler:e.handler,params:e.createParams(l),searchParams:function(e){let t=new UM;if("string"!=typeof e)return t;let s=e.length,i="",n="",r=-1,a=-1,o=!1,c=!1,l=!1,u=!1,h=!1,p=0;for(let d=0;d<s+1;d++)if(38===(p=d!==s?e.charCodeAt(d):38)){if((h=a>r)||(a=d),i=e.slice(r+1,a),h||i.length>0){l&&(i=i.replace(UN," ")),o&&(i=decodeURIComponent(i)||i),h&&(n=e.slice(a+1,d),u&&(n=n.replace(UN," ")),c&&(n=decodeURIComponent(n)||n));let s=t[i];void 0===s?t[i]=n:s.pop?s.push(n):t[i]=[s,n]}n="",r=d,a=d,o=!1,c=!1,l=!1,u=!1}else 61===p?a<=r?a=d:c=!0:43===p?a>r?u=!0:l=!0:37===p&&(a>r?c=!0:o=!0);return t}(i)}}let e=r.getNextNode(t,c,h,l.length);if(void 0===e){if(0===h.length)return;let t=h.pop();c=t.brotherPathIndex,l.splice(t.paramsCount),e=t.brotherNode}if("StaticNode"===(r=e)._tag){c+=r.prefix.length;continue}if("WildcardNode"===r._tag){let e=a.slice(c);n&&(e=UY(e)),l.push(e),c=u;continue}if("ParametricNode"===r._tag){let e=a.indexOf("/",c);-1===e&&(e=u);let t=a.slice(c,e);if(n&&(t=UY(t)),void 0!==r.regex){let e=r.regex.exec(t);if(null===e)continue;for(let t=1;t<e.length;t++){let s=e[t];if(s.length>o)return;l.push(s)}}else{if(t.length>o)return;l.push(t)}c=e}}}}class U${handlers=[];unconstrainedHandler;find(){return this.unconstrainedHandler}add(e){let t={params:e.params,handler:e.handler,createParams:function(e){let t=e.length;return function(s){let i={};for(let n=0;n<t;n++)i[e[n]]=s[n];return i}}(e.params)};this.handlers.push(t),this.unconstrainedHandler=this.handlers[0]}}class UU{isLeafNode=!1;routes;handlerStorage;addRoute(e){void 0===this.routes?this.routes=[e]:this.routes.push(e),void 0===this.handlerStorage&&(this.handlerStorage=new U$),this.isLeafNode=!0,this.handlerStorage.add(e)}}class UB extends UU{staticChildren={};findStaticMatchingChild(e,t){let s=this.staticChildren[e.charAt(t)];if(void 0!==s&&s.matchPrefix(e,t))return s}getStaticChild(e,t=0){if(e.length===t)return this;let s=this.findStaticMatchingChild(e,t);if(void 0!==s)return s.getStaticChild(e,t+s.prefix.length)}createStaticChild(e){if(0===e.length)return this;let t=this.staticChildren[e.charAt(0)];if(t){let s=1;for(;s<t.prefix.length;s++)if(e.charCodeAt(s)!==t.prefix.charCodeAt(s)){t=t.split(this,s);break}return t.createStaticChild(e.slice(s))}let s=e.charAt(0);return this.staticChildren[s]=new Uq(e),this.staticChildren[s]}}class Uq extends UB{_tag="StaticNode";constructor(e){super(),this.setPrefix(e)}prefix;matchPrefix;parametricChildren=[];wildcardChild;setPrefix(e){if(this.prefix=e,1===e.length)this.matchPrefix=(e,t)=>!0;else{let t=e.length;this.matchPrefix=function(e,s){for(let i=1;i<t;i++)if(e.charCodeAt(s+i)!==this.prefix.charCodeAt(i))return!1;return!0}}}getParametricChild(e){if(void 0===e)return this.parametricChildren.find(e=>!1===e.isRegex);let t=e.source;return this.parametricChildren.find(e=>void 0!==e.regex&&e.regex.source===t)}createParametricChild(e,t,s){let i=this.getParametricChild(e);return void 0!==i?i.nodePaths.add(s):(i=new UH(e,t,s),this.parametricChildren.push(i),this.parametricChildren.sort((e,t)=>e.isRegex?t.isRegex?void 0===e.staticSuffix?1:void 0===t.staticSuffix?-1:t.staticSuffix.endsWith(e.staticSuffix)?1:e.staticSuffix.endsWith(t.staticSuffix)?-1:0:-1:1)),i}createWildcardChild(){return void 0===this.wildcardChild&&(this.wildcardChild=new UJ),this.wildcardChild}split(e,t){let s=this.prefix.slice(0,t),i=this.prefix.slice(t);this.setPrefix(i);let n=new Uq(s);return n.staticChildren[i.charAt(0)]=this,e.staticChildren[s.charAt(0)]=n,n}getNextNode(e,t,s,i){let n=this.findStaticMatchingChild(e,t),r=0;if(void 0===n){if(0===this.parametricChildren.length)return this.wildcardChild;n=this.parametricChildren[0],r=1}void 0!==this.wildcardChild&&s.push({paramsCount:i,brotherPathIndex:t,brotherNode:this.wildcardChild});for(let e=this.parametricChildren.length-1;e>=r;e--)s.push({paramsCount:i,brotherPathIndex:t,brotherNode:this.parametricChildren[e]});return n}}class UH extends UB{regex;staticSuffix;_tag="ParametricNode";constructor(e,t,s){super(),this.regex=e,this.staticSuffix=t,this.isRegex=!!e,this.nodePaths=new Set([s])}isRegex;nodePaths;getNextNode(e,t){return this.findStaticMatchingChild(e,t)}}class UJ extends UU{_tag="WildcardNode";getNextNode(e,t,s,i){}}let UW=(e,t)=>{if(!e)throw Error(t)};function UK(e){return e.replace(/\/\/+/g,"/")}function UV(e){return e.length>1&&47===e.charCodeAt(e.length-1)?e.slice(0,-1):e}function UG(e,t){return 50===e?53===t?"%":51===t?"#":52===t?"$":54===t?"&":66===t||98===t?"+":67===t||99===t?",":70===t||102===t?"/":void 0:51===e?65===t||97===t?":":66===t||98===t?";":68===t||100===t?"=":70===t||102===t?"?":void 0:52===e&&48===t?"@":void 0}function UY(e){let t=e.indexOf("%");if(-1===t)return e;let s="",i=t;for(let n=t;n<e.length;n++)if(37===e.charCodeAt(n)){let t=UG(e.charCodeAt(n+1),e.charCodeAt(n+2));s+=e.slice(i,n)+t,i=n+3}return e.slice(0,t)+s+e.slice(i)}let UX=["ACL","BIND","CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LINK","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCALENDAR","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REBIND","REPORT","SEARCH","SOURCE","SUBSCRIBE","TRACE","UNBIND","UNLINK","UNLOCK","UNSUBSCRIBE"],UQ=(e={})=>new UL(e),UZ=Symbol.for("@effect/platform/HttpRouter"),U0=Symbol.for("@effect/platform/HttpRouter/Route"),U1=Symbol.for("@effect/platform/HttpRouter/RouteContext"),U2=tz("@effect/platform/HttpRouter/RouteContext"),U3=e=>ei(e,UZ),U5=H("@effect/platform/HttpRouter/currentRouterConfig",()=>ua({}));class U4 extends di{constructor(e,t){super(),this.routes=e,this.mounts=t,this[UZ]=UZ,this.httpApp=l4(U5).pipe(lr(e=>this.httpApp=U6(this,e)))}commit(){return this.httpApp}toJSON(){return{_id:"Router",routes:this.routes.toJSON(),mounts:this.mounts.toJSON()}}toString(){return e$(this)}[eD](){return this.toJSON()}}let U6=(e,t)=>{let s=UQ(t),i=iC(e.mounts).map(([e,t,s])=>[e,new U9(new U7("*",s?.includePrefix?`${e}/*`:"/*",t,s?.includePrefix?t4():tw(e),!1),{}),s]),n=i.length;return iB(e.routes,e=>{"*"===e.method?s.all(e.path,e):s.on(e.method,e.path,e)}),cW(e=>{let t=tC(new Map(e.getFiberRef(uh).unsafeMap)),r=tN(t,Ux);if(n>0)for(let e=0;e<n;e++){let[s,n,a]=i[e];if(r.url.startsWith(s))return t.unsafeMap.set(U2.key,n),a?.includePrefix!==!0&&t.unsafeMap.set(Ux.key,U8(r,s)),un(lr(n.route.handler,$d),uh,t)}let a=s.find(r.method,r.url);if(void 0===a&&"HEAD"===r.method&&(a=s.find("GET",r.url)),void 0===a)return c9(new $_({request:r}));let o=a.handler;"Some"===o.prefix._tag&&t.unsafeMap.set(Ux.key,U8(r,o.prefix.value)),t.unsafeMap.set(Uy.key,a.searchParams),t.unsafeMap.set(U2.key,new U9(o,a.params));let c=tM(t,pY);"Some"===c._tag&&"Span"===c.value._tag&&c.value.attribute("http.route",o.path);let l=lr(o.handler,$d);return un(o.uninterruptible?l:lb(l),uh,t)})};function U8(e,t){let s=t.length;return e.modify({url:e.url.length<=s?"/":e.url.slice(s)})}class U7 extends eB{constructor(e,t,s,i=t4(),n=!1){super(),this.method=e,this.path=t,this.handler=s,this.prefix=i,this.uninterruptible=n,this[U0]=U0}toJSON(){return{_id:"@effect/platform/HttpRouter/Route",method:this.method,path:this.path,prefix:this.prefix.toJSON()}}}class U9{constructor(e,t){this.route=e,this.params=t,this[U1]=U1}}let Be=new U4(iS(),iS()),Bt=e=>e.endsWith("/")?e.slice(0,-1):e,Bs=((e,t)=>(t=Bt(t),new U4(iG(e.routes,e=>new U7(e.method,"/"===e.path?t:t+e.path,e.handler,t7(sn(e.prefix,e=>t+e),()=>tw(t)),e.uninterruptible)),iG(e.mounts,([e,s])=>["/"===e?t:t+e,s]))),e=>M(e=>U3(e[0]),(t,s,i,n)=>new U4(iN(t.routes,new U7(e,s,i,t4(),n?.uninterruptible??!1)),t.mounts))),Bi=Bs("GET"),Bn=Bs("POST"),Br=M(2,(e,t)=>new U4(iG(e.routes,e=>new U7(e.method,e.path,t(lr(e.handler,$d)),e.prefix,e.uninterruptible)),iG(e.mounts,([e,s])=>[e,t(s)]))),Ba=((e,t)=>new U4(iG(e.routes,e=>new U7(e.method,e.path,t(e.handler),e.prefix,e.uninterruptible)),iG(e.mounts,([e,s])=>[e,lr(t(s),$d)])),(e,t)=>{let s=zB(e,t);return lr(hv(),e=>{let t=tN(e,Uy),i=tN(e,U2);return s({...t,...i.params})})}),Bo=e=>L4(e,lr(LH)),Bc=e=>FP(ly(e,e=>e.stream)),Bl={[Symbol.for("@effect/matcher/Matcher")]:{_input:j,_filters:j,_result:j,_return:j},_tag:"ValueMatcher",add(e){return"Right"===this.value._tag?this:"When"===e._tag&&!0===e.guard(this.provided)?Bu(this.provided,tV(e.evaluate(this.provided))):"Not"===e._tag&&!1===e.guard(this.provided)?Bu(this.provided,tV(e.evaluate(this.provided))):this},pipe(){return eY(this,arguments)}};function Bu(e,t){let s=Object.create(Bl);return s.provided=e,s.value=t,s}let Bh=(e,t)=>({_tag:"When",guard:e,evaluate:t}),Bp=e=>{if("function"==typeof e)return e;if(Array.isArray(e)){let t=e.map(Bp),s=t.length;return e=>{if(!Array.isArray(e))return!1;for(let i=0;i<s;i++)if(!1===t[i](e[i]))return!1;return!0}}if(null!==e&&"object"==typeof e){let t=Object.entries(e).map(([e,t])=>[e,Bp(t)]),s=t.length;return e=>{if("object"!=typeof e||null===e)return!1;for(let i=0;i<s;i++){let[s,n]=t[i];if(!(s in e)||!1===n(e[s]))return!1}return!0}}return t=>t===e},Bd=e=>{if("ValueMatcher"===e._tag)return e.value;let t=e.cases.length;if(1===t){let t=e.cases[0];return e=>"When"===t._tag&&!0===t.guard(e)?tV(t.evaluate(e)):"Not"===t._tag&&!1===t.guard(e)?tV(t.evaluate(e)):tK(e)}return s=>{for(let i=0;i<t;i++){let t=e.cases[i];if("When"===t._tag&&!0===t.guard(s)||"Not"===t._tag&&!1===t.guard(s))return tV(t.evaluate(s))}return tK(s)}},Bf=e=>Bu(e,tK(e)),Bm=(e,t)=>s=>s.add(Bh(Bp(e),t)),Bg=e=>t=>{let s=Bd(t);return tH(s)?"Right"===s._tag?s.right:e(s.left):t=>{let i=s(t);return"Right"===i._tag?i.right:e(i.left)}},Bb={"application/andrew-inset":{source:"iana",extensions:["ez"]},"application/applixware":{source:"apache",extensions:["aw"]},"application/atom+xml":{source:"iana",extensions:["atom"]},"application/atomcat+xml":{source:"iana",extensions:["atomcat"]},"application/atomdeleted+xml":{source:"iana",extensions:["atomdeleted"]},"application/atomsvc+xml":{source:"iana",extensions:["atomsvc"]},"application/atsc-dwd+xml":{source:"iana",extensions:["dwd"]},"application/atsc-held+xml":{source:"iana",extensions:["held"]},"application/atsc-rsat+xml":{source:"iana",extensions:["rsat"]},"application/calendar+xml":{source:"iana",extensions:["xcs"]},"application/ccxml+xml":{source:"iana",extensions:["ccxml"]},"application/cdfx+xml":{source:"iana",extensions:["cdfx"]},"application/cdmi-capability":{source:"iana",extensions:["cdmia"]},"application/cdmi-container":{source:"iana",extensions:["cdmic"]},"application/cdmi-domain":{source:"iana",extensions:["cdmid"]},"application/cdmi-object":{source:"iana",extensions:["cdmio"]},"application/cdmi-queue":{source:"iana",extensions:["cdmiq"]},"application/cpl+xml":{source:"iana",extensions:["cpl"]},"application/cu-seeme":{source:"apache",extensions:["cu"]},"application/dash+xml":{source:"iana",extensions:["mpd"]},"application/dash-patch+xml":{source:"iana",extensions:["mpp"]},"application/davmount+xml":{source:"iana",extensions:["davmount"]},"application/dicom":{source:"iana",extensions:["dcm"]},"application/docbook+xml":{source:"apache",extensions:["dbk"]},"application/dssc+der":{source:"iana",extensions:["dssc"]},"application/dssc+xml":{source:"iana",extensions:["xdssc"]},"application/ecmascript":{source:"iana",extensions:["es","ecma"]},"application/emma+xml":{source:"iana",extensions:["emma"]},"application/emotionml+xml":{source:"iana",extensions:["emotionml"]},"application/epub+zip":{source:"iana",extensions:["epub"]},"application/exi":{source:"iana",extensions:["exi"]},"application/express":{source:"iana",extensions:["exp"]},"application/fdt+xml":{source:"iana",extensions:["fdt"]},"application/font-tdpfr":{source:"iana",extensions:["pfr"]},"application/geo+json":{source:"iana",extensions:["geojson"]},"application/gml+xml":{source:"iana",extensions:["gml"]},"application/gpx+xml":{source:"apache",extensions:["gpx"]},"application/gxf":{source:"apache",extensions:["gxf"]},"application/gzip":{source:"iana",extensions:["gz"]},"application/hyperstudio":{source:"iana",extensions:["stk"]},"application/inkml+xml":{source:"iana",extensions:["ink","inkml"]},"application/ipfix":{source:"iana",extensions:["ipfix"]},"application/its+xml":{source:"iana",extensions:["its"]},"application/java-archive":{source:"apache",extensions:["jar","war","ear"]},"application/java-serialized-object":{source:"apache",extensions:["ser"]},"application/java-vm":{source:"apache",extensions:["class"]},"application/javascript":{source:"iana",charset:"UTF-8",extensions:["js","mjs"]},"application/json":{source:"iana",charset:"UTF-8",extensions:["json","map"]},"application/jsonml+json":{source:"apache",extensions:["jsonml"]},"application/ld+json":{source:"iana",extensions:["jsonld"]},"application/lgr+xml":{source:"iana",extensions:["lgr"]},"application/lost+xml":{source:"iana",extensions:["lostxml"]},"application/mac-binhex40":{source:"iana",extensions:["hqx"]},"application/mac-compactpro":{source:"apache",extensions:["cpt"]},"application/mads+xml":{source:"iana",extensions:["mads"]},"application/manifest+json":{source:"iana",charset:"UTF-8",extensions:["webmanifest"]},"application/marc":{source:"iana",extensions:["mrc"]},"application/marcxml+xml":{source:"iana",extensions:["mrcx"]},"application/mathematica":{source:"iana",extensions:["ma","nb","mb"]},"application/mathml+xml":{source:"iana",extensions:["mathml"]},"application/mbox":{source:"iana",extensions:["mbox"]},"application/media-policy-dataset+xml":{source:"iana",extensions:["mpf"]},"application/mediaservercontrol+xml":{source:"iana",extensions:["mscml"]},"application/metalink+xml":{source:"apache",extensions:["metalink"]},"application/metalink4+xml":{source:"iana",extensions:["meta4"]},"application/mets+xml":{source:"iana",extensions:["mets"]},"application/mmt-aei+xml":{source:"iana",extensions:["maei"]},"application/mmt-usd+xml":{source:"iana",extensions:["musd"]},"application/mods+xml":{source:"iana",extensions:["mods"]},"application/mp21":{source:"iana",extensions:["m21","mp21"]},"application/mp4":{source:"iana",extensions:["mp4s","m4p"]},"application/msword":{source:"iana",extensions:["doc","dot"]},"application/mxf":{source:"iana",extensions:["mxf"]},"application/n-quads":{source:"iana",extensions:["nq"]},"application/n-triples":{source:"iana",extensions:["nt"]},"application/node":{source:"iana",extensions:["cjs"]},"application/octet-stream":{source:"iana",extensions:["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"]},"application/oda":{source:"iana",extensions:["oda"]},"application/oebps-package+xml":{source:"iana",extensions:["opf"]},"application/ogg":{source:"iana",extensions:["ogx"]},"application/omdoc+xml":{source:"apache",extensions:["omdoc"]},"application/onenote":{source:"apache",extensions:["onetoc","onetoc2","onetmp","onepkg"]},"application/oxps":{source:"iana",extensions:["oxps"]},"application/p2p-overlay+xml":{source:"iana",extensions:["relo"]},"application/patch-ops-error+xml":{source:"iana",extensions:["xer"]},"application/pdf":{source:"iana",extensions:["pdf"]},"application/pgp-encrypted":{source:"iana",extensions:["pgp"]},"application/pgp-keys":{source:"iana",extensions:["asc"]},"application/pgp-signature":{source:"iana",extensions:["asc","sig"]},"application/pics-rules":{source:"apache",extensions:["prf"]},"application/pkcs10":{source:"iana",extensions:["p10"]},"application/pkcs7-mime":{source:"iana",extensions:["p7m","p7c"]},"application/pkcs7-signature":{source:"iana",extensions:["p7s"]},"application/pkcs8":{source:"iana",extensions:["p8"]},"application/pkix-attr-cert":{source:"iana",extensions:["ac"]},"application/pkix-cert":{source:"iana",extensions:["cer"]},"application/pkix-crl":{source:"iana",extensions:["crl"]},"application/pkix-pkipath":{source:"iana",extensions:["pkipath"]},"application/pkixcmp":{source:"iana",extensions:["pki"]},"application/pls+xml":{source:"iana",extensions:["pls"]},"application/postscript":{source:"iana",extensions:["ai","eps","ps"]},"application/provenance+xml":{source:"iana",extensions:["provx"]},"application/prs.cww":{source:"iana",extensions:["cww"]},"application/pskc+xml":{source:"iana",extensions:["pskcxml"]},"application/rdf+xml":{source:"iana",extensions:["rdf","owl"]},"application/reginfo+xml":{source:"iana",extensions:["rif"]},"application/relax-ng-compact-syntax":{source:"iana",extensions:["rnc"]},"application/resource-lists+xml":{source:"iana",extensions:["rl"]},"application/resource-lists-diff+xml":{source:"iana",extensions:["rld"]},"application/rls-services+xml":{source:"iana",extensions:["rs"]},"application/route-apd+xml":{source:"iana",extensions:["rapd"]},"application/route-s-tsid+xml":{source:"iana",extensions:["sls"]},"application/route-usd+xml":{source:"iana",extensions:["rusd"]},"application/rpki-ghostbusters":{source:"iana",extensions:["gbr"]},"application/rpki-manifest":{source:"iana",extensions:["mft"]},"application/rpki-roa":{source:"iana",extensions:["roa"]},"application/rsd+xml":{source:"apache",extensions:["rsd"]},"application/rss+xml":{source:"apache",extensions:["rss"]},"application/rtf":{source:"iana",extensions:["rtf"]},"application/sbml+xml":{source:"iana",extensions:["sbml"]},"application/scvp-cv-request":{source:"iana",extensions:["scq"]},"application/scvp-cv-response":{source:"iana",extensions:["scs"]},"application/scvp-vp-request":{source:"iana",extensions:["spq"]},"application/scvp-vp-response":{source:"iana",extensions:["spp"]},"application/sdp":{source:"iana",extensions:["sdp"]},"application/senml+xml":{source:"iana",extensions:["senmlx"]},"application/sensml+xml":{source:"iana",extensions:["sensmlx"]},"application/set-payment-initiation":{source:"iana",extensions:["setpay"]},"application/set-registration-initiation":{source:"iana",extensions:["setreg"]},"application/shf+xml":{source:"iana",extensions:["shf"]},"application/sieve":{source:"iana",extensions:["siv","sieve"]},"application/smil+xml":{source:"iana",extensions:["smi","smil"]},"application/sparql-query":{source:"iana",extensions:["rq"]},"application/sparql-results+xml":{source:"iana",extensions:["srx"]},"application/srgs":{source:"iana",extensions:["gram"]},"application/srgs+xml":{source:"iana",extensions:["grxml"]},"application/sru+xml":{source:"iana",extensions:["sru"]},"application/ssdl+xml":{source:"apache",extensions:["ssdl"]},"application/ssml+xml":{source:"iana",extensions:["ssml"]},"application/swid+xml":{source:"iana",extensions:["swidtag"]},"application/tei+xml":{source:"iana",extensions:["tei","teicorpus"]},"application/thraud+xml":{source:"iana",extensions:["tfi"]},"application/timestamped-data":{source:"iana",extensions:["tsd"]},"application/trig":{source:"iana",extensions:["trig"]},"application/ttml+xml":{source:"iana",extensions:["ttml"]},"application/urc-ressheet+xml":{source:"iana",extensions:["rsheet"]},"application/urc-targetdesc+xml":{source:"iana",extensions:["td"]},"application/vnd.1000minds.decision-model+xml":{source:"iana",extensions:["1km"]},"application/vnd.3gpp.pic-bw-large":{source:"iana",extensions:["plb"]},"application/vnd.3gpp.pic-bw-small":{source:"iana",extensions:["psb"]},"application/vnd.3gpp.pic-bw-var":{source:"iana",extensions:["pvb"]},"application/vnd.3gpp2.tcap":{source:"iana",extensions:["tcap"]},"application/vnd.3m.post-it-notes":{source:"iana",extensions:["pwn"]},"application/vnd.accpac.simply.aso":{source:"iana",extensions:["aso"]},"application/vnd.accpac.simply.imp":{source:"iana",extensions:["imp"]},"application/vnd.acucobol":{source:"iana",extensions:["acu"]},"application/vnd.acucorp":{source:"iana",extensions:["atc","acutc"]},"application/vnd.adobe.air-application-installer-package+zip":{source:"apache",extensions:["air"]},"application/vnd.adobe.formscentral.fcdt":{source:"iana",extensions:["fcdt"]},"application/vnd.adobe.fxp":{source:"iana",extensions:["fxp","fxpl"]},"application/vnd.adobe.xdp+xml":{source:"iana",extensions:["xdp"]},"application/vnd.adobe.xfdf":{source:"iana",extensions:["xfdf"]},"application/vnd.age":{source:"iana",extensions:["age"]},"application/vnd.ahead.space":{source:"iana",extensions:["ahead"]},"application/vnd.airzip.filesecure.azf":{source:"iana",extensions:["azf"]},"application/vnd.airzip.filesecure.azs":{source:"iana",extensions:["azs"]},"application/vnd.amazon.ebook":{source:"apache",extensions:["azw"]},"application/vnd.americandynamics.acc":{source:"iana",extensions:["acc"]},"application/vnd.amiga.ami":{source:"iana",extensions:["ami"]},"application/vnd.android.package-archive":{source:"apache",extensions:["apk"]},"application/vnd.anser-web-certificate-issue-initiation":{source:"iana",extensions:["cii"]},"application/vnd.anser-web-funds-transfer-initiation":{source:"apache",extensions:["fti"]},"application/vnd.antix.game-component":{source:"iana",extensions:["atx"]},"application/vnd.apple.installer+xml":{source:"iana",extensions:["mpkg"]},"application/vnd.apple.keynote":{source:"iana",extensions:["key"]},"application/vnd.apple.mpegurl":{source:"iana",extensions:["m3u8"]},"application/vnd.apple.numbers":{source:"iana",extensions:["numbers"]},"application/vnd.apple.pages":{source:"iana",extensions:["pages"]},"application/vnd.aristanetworks.swi":{source:"iana",extensions:["swi"]},"application/vnd.astraea-software.iota":{source:"iana",extensions:["iota"]},"application/vnd.audiograph":{source:"iana",extensions:["aep"]},"application/vnd.balsamiq.bmml+xml":{source:"iana",extensions:["bmml"]},"application/vnd.blueice.multipass":{source:"iana",extensions:["mpm"]},"application/vnd.bmi":{source:"iana",extensions:["bmi"]},"application/vnd.businessobjects":{source:"iana",extensions:["rep"]},"application/vnd.chemdraw+xml":{source:"iana",extensions:["cdxml"]},"application/vnd.chipnuts.karaoke-mmd":{source:"iana",extensions:["mmd"]},"application/vnd.cinderella":{source:"iana",extensions:["cdy"]},"application/vnd.citationstyles.style+xml":{source:"iana",extensions:["csl"]},"application/vnd.claymore":{source:"iana",extensions:["cla"]},"application/vnd.cloanto.rp9":{source:"iana",extensions:["rp9"]},"application/vnd.clonk.c4group":{source:"iana",extensions:["c4g","c4d","c4f","c4p","c4u"]},"application/vnd.cluetrust.cartomobile-config":{source:"iana",extensions:["c11amc"]},"application/vnd.cluetrust.cartomobile-config-pkg":{source:"iana",extensions:["c11amz"]},"application/vnd.commonspace":{source:"iana",extensions:["csp"]},"application/vnd.contact.cmsg":{source:"iana",extensions:["cdbcmsg"]},"application/vnd.cosmocaller":{source:"iana",extensions:["cmc"]},"application/vnd.crick.clicker":{source:"iana",extensions:["clkx"]},"application/vnd.crick.clicker.keyboard":{source:"iana",extensions:["clkk"]},"application/vnd.crick.clicker.palette":{source:"iana",extensions:["clkp"]},"application/vnd.crick.clicker.template":{source:"iana",extensions:["clkt"]},"application/vnd.crick.clicker.wordbank":{source:"iana",extensions:["clkw"]},"application/vnd.criticaltools.wbs+xml":{source:"iana",extensions:["wbs"]},"application/vnd.ctc-posml":{source:"iana",extensions:["pml"]},"application/vnd.cups-ppd":{source:"iana",extensions:["ppd"]},"application/vnd.curl.car":{source:"apache",extensions:["car"]},"application/vnd.curl.pcurl":{source:"apache",extensions:["pcurl"]},"application/vnd.dart":{source:"iana",extensions:["dart"]},"application/vnd.data-vision.rdz":{source:"iana",extensions:["rdz"]},"application/vnd.dbf":{source:"iana",extensions:["dbf"]},"application/vnd.dece.data":{source:"iana",extensions:["uvf","uvvf","uvd","uvvd"]},"application/vnd.dece.ttml+xml":{source:"iana",extensions:["uvt","uvvt"]},"application/vnd.dece.unspecified":{source:"iana",extensions:["uvx","uvvx"]},"application/vnd.dece.zip":{source:"iana",extensions:["uvz","uvvz"]},"application/vnd.denovo.fcselayout-link":{source:"iana",extensions:["fe_launch"]},"application/vnd.dna":{source:"iana",extensions:["dna"]},"application/vnd.dolby.mlp":{source:"apache",extensions:["mlp"]},"application/vnd.dpgraph":{source:"iana",extensions:["dpg"]},"application/vnd.dreamfactory":{source:"iana",extensions:["dfac"]},"application/vnd.ds-keypoint":{source:"apache",extensions:["kpxx"]},"application/vnd.dvb.ait":{source:"iana",extensions:["ait"]},"application/vnd.dvb.service":{source:"iana",extensions:["svc"]},"application/vnd.dynageo":{source:"iana",extensions:["geo"]},"application/vnd.ecowin.chart":{source:"iana",extensions:["mag"]},"application/vnd.enliven":{source:"iana",extensions:["nml"]},"application/vnd.epson.esf":{source:"iana",extensions:["esf"]},"application/vnd.epson.msf":{source:"iana",extensions:["msf"]},"application/vnd.epson.quickanime":{source:"iana",extensions:["qam"]},"application/vnd.epson.salt":{source:"iana",extensions:["slt"]},"application/vnd.epson.ssf":{source:"iana",extensions:["ssf"]},"application/vnd.eszigno3+xml":{source:"iana",extensions:["es3","et3"]},"application/vnd.ezpix-album":{source:"iana",extensions:["ez2"]},"application/vnd.ezpix-package":{source:"iana",extensions:["ez3"]},"application/vnd.fdf":{source:"iana",extensions:["fdf"]},"application/vnd.fdsn.mseed":{source:"iana",extensions:["mseed"]},"application/vnd.fdsn.seed":{source:"iana",extensions:["seed","dataless"]},"application/vnd.flographit":{source:"iana",extensions:["gph"]},"application/vnd.fluxtime.clip":{source:"iana",extensions:["ftc"]},"application/vnd.framemaker":{source:"iana",extensions:["fm","frame","maker","book"]},"application/vnd.frogans.fnc":{source:"iana",extensions:["fnc"]},"application/vnd.frogans.ltf":{source:"iana",extensions:["ltf"]},"application/vnd.fsc.weblaunch":{source:"iana",extensions:["fsc"]},"application/vnd.fujitsu.oasys":{source:"iana",extensions:["oas"]},"application/vnd.fujitsu.oasys2":{source:"iana",extensions:["oa2"]},"application/vnd.fujitsu.oasys3":{source:"iana",extensions:["oa3"]},"application/vnd.fujitsu.oasysgp":{source:"iana",extensions:["fg5"]},"application/vnd.fujitsu.oasysprs":{source:"iana",extensions:["bh2"]},"application/vnd.fujixerox.ddd":{source:"iana",extensions:["ddd"]},"application/vnd.fujixerox.docuworks":{source:"iana",extensions:["xdw"]},"application/vnd.fujixerox.docuworks.binder":{source:"iana",extensions:["xbd"]},"application/vnd.fuzzysheet":{source:"iana",extensions:["fzs"]},"application/vnd.genomatix.tuxedo":{source:"iana",extensions:["txd"]},"application/vnd.geogebra.file":{source:"iana",extensions:["ggb"]},"application/vnd.geogebra.tool":{source:"iana",extensions:["ggt"]},"application/vnd.geometry-explorer":{source:"iana",extensions:["gex","gre"]},"application/vnd.geonext":{source:"iana",extensions:["gxt"]},"application/vnd.geoplan":{source:"iana",extensions:["g2w"]},"application/vnd.geospace":{source:"iana",extensions:["g3w"]},"application/vnd.gmx":{source:"iana",extensions:["gmx"]},"application/vnd.google-earth.kml+xml":{source:"iana",extensions:["kml"]},"application/vnd.google-earth.kmz":{source:"iana",extensions:["kmz"]},"application/vnd.grafeq":{source:"iana",extensions:["gqf","gqs"]},"application/vnd.groove-account":{source:"iana",extensions:["gac"]},"application/vnd.groove-help":{source:"iana",extensions:["ghf"]},"application/vnd.groove-identity-message":{source:"iana",extensions:["gim"]},"application/vnd.groove-injector":{source:"iana",extensions:["grv"]},"application/vnd.groove-tool-message":{source:"iana",extensions:["gtm"]},"application/vnd.groove-tool-template":{source:"iana",extensions:["tpl"]},"application/vnd.groove-vcard":{source:"iana",extensions:["vcg"]},"application/vnd.hal+xml":{source:"iana",extensions:["hal"]},"application/vnd.handheld-entertainment+xml":{source:"iana",extensions:["zmm"]},"application/vnd.hbci":{source:"iana",extensions:["hbci"]},"application/vnd.hhe.lesson-player":{source:"iana",extensions:["les"]},"application/vnd.hp-hpgl":{source:"iana",extensions:["hpgl"]},"application/vnd.hp-hpid":{source:"iana",extensions:["hpid"]},"application/vnd.hp-hps":{source:"iana",extensions:["hps"]},"application/vnd.hp-jlyt":{source:"iana",extensions:["jlt"]},"application/vnd.hp-pcl":{source:"iana",extensions:["pcl"]},"application/vnd.hp-pclxl":{source:"iana",extensions:["pclxl"]},"application/vnd.hydrostatix.sof-data":{source:"iana",extensions:["sfd-hdstx"]},"application/vnd.ibm.minipay":{source:"iana",extensions:["mpy"]},"application/vnd.ibm.modcap":{source:"iana",extensions:["afp","listafp","list3820"]},"application/vnd.ibm.rights-management":{source:"iana",extensions:["irm"]},"application/vnd.ibm.secure-container":{source:"iana",extensions:["sc"]},"application/vnd.iccprofile":{source:"iana",extensions:["icc","icm"]},"application/vnd.igloader":{source:"iana",extensions:["igl"]},"application/vnd.immervision-ivp":{source:"iana",extensions:["ivp"]},"application/vnd.immervision-ivu":{source:"iana",extensions:["ivu"]},"application/vnd.insors.igm":{source:"iana",extensions:["igm"]},"application/vnd.intercon.formnet":{source:"iana",extensions:["xpw","xpx"]},"application/vnd.intergeo":{source:"iana",extensions:["i2g"]},"application/vnd.intu.qbo":{source:"iana",extensions:["qbo"]},"application/vnd.intu.qfx":{source:"iana",extensions:["qfx"]},"application/vnd.ipunplugged.rcprofile":{source:"iana",extensions:["rcprofile"]},"application/vnd.irepository.package+xml":{source:"iana",extensions:["irp"]},"application/vnd.is-xpr":{source:"iana",extensions:["xpr"]},"application/vnd.isac.fcs":{source:"iana",extensions:["fcs"]},"application/vnd.jam":{source:"iana",extensions:["jam"]},"application/vnd.jcp.javame.midlet-rms":{source:"iana",extensions:["rms"]},"application/vnd.jisp":{source:"iana",extensions:["jisp"]},"application/vnd.joost.joda-archive":{source:"iana",extensions:["joda"]},"application/vnd.kahootz":{source:"iana",extensions:["ktz","ktr"]},"application/vnd.kde.karbon":{source:"iana",extensions:["karbon"]},"application/vnd.kde.kchart":{source:"iana",extensions:["chrt"]},"application/vnd.kde.kformula":{source:"iana",extensions:["kfo"]},"application/vnd.kde.kivio":{source:"iana",extensions:["flw"]},"application/vnd.kde.kontour":{source:"iana",extensions:["kon"]},"application/vnd.kde.kpresenter":{source:"iana",extensions:["kpr","kpt"]},"application/vnd.kde.kspread":{source:"iana",extensions:["ksp"]},"application/vnd.kde.kword":{source:"iana",extensions:["kwd","kwt"]},"application/vnd.kenameaapp":{source:"iana",extensions:["htke"]},"application/vnd.kidspiration":{source:"iana",extensions:["kia"]},"application/vnd.kinar":{source:"iana",extensions:["kne","knp"]},"application/vnd.koan":{source:"iana",extensions:["skp","skd","skt","skm"]},"application/vnd.kodak-descriptor":{source:"iana",extensions:["sse"]},"application/vnd.las.las+xml":{source:"iana",extensions:["lasxml"]},"application/vnd.llamagraphics.life-balance.desktop":{source:"iana",extensions:["lbd"]},"application/vnd.llamagraphics.life-balance.exchange+xml":{source:"iana",extensions:["lbe"]},"application/vnd.lotus-1-2-3":{source:"iana",extensions:["123"]},"application/vnd.lotus-approach":{source:"iana",extensions:["apr"]},"application/vnd.lotus-freelance":{source:"iana",extensions:["pre"]},"application/vnd.lotus-notes":{source:"iana",extensions:["nsf"]},"application/vnd.lotus-organizer":{source:"iana",extensions:["org"]},"application/vnd.lotus-screencam":{source:"iana",extensions:["scm"]},"application/vnd.lotus-wordpro":{source:"iana",extensions:["lwp"]},"application/vnd.macports.portpkg":{source:"iana",extensions:["portpkg"]},"application/vnd.mapbox-vector-tile":{source:"iana",extensions:["mvt"]},"application/vnd.mcd":{source:"iana",extensions:["mcd"]},"application/vnd.medcalcdata":{source:"iana",extensions:["mc1"]},"application/vnd.mediastation.cdkey":{source:"iana",extensions:["cdkey"]},"application/vnd.mfer":{source:"iana",extensions:["mwf"]},"application/vnd.mfmp":{source:"iana",extensions:["mfm"]},"application/vnd.micrografx.flo":{source:"iana",extensions:["flo"]},"application/vnd.micrografx.igx":{source:"iana",extensions:["igx"]},"application/vnd.mif":{source:"iana",extensions:["mif"]},"application/vnd.mobius.daf":{source:"iana",extensions:["daf"]},"application/vnd.mobius.dis":{source:"iana",extensions:["dis"]},"application/vnd.mobius.mbk":{source:"iana",extensions:["mbk"]},"application/vnd.mobius.mqy":{source:"iana",extensions:["mqy"]},"application/vnd.mobius.msl":{source:"iana",extensions:["msl"]},"application/vnd.mobius.plc":{source:"iana",extensions:["plc"]},"application/vnd.mobius.txf":{source:"iana",extensions:["txf"]},"application/vnd.mophun.application":{source:"iana",extensions:["mpn"]},"application/vnd.mophun.certificate":{source:"iana",extensions:["mpc"]},"application/vnd.mozilla.xul+xml":{source:"iana",extensions:["xul"]},"application/vnd.ms-artgalry":{source:"iana",extensions:["cil"]},"application/vnd.ms-cab-compressed":{source:"iana",extensions:["cab"]},"application/vnd.ms-excel":{source:"iana",extensions:["xls","xlm","xla","xlc","xlt","xlw"]},"application/vnd.ms-excel.addin.macroenabled.12":{source:"iana",extensions:["xlam"]},"application/vnd.ms-excel.sheet.binary.macroenabled.12":{source:"iana",extensions:["xlsb"]},"application/vnd.ms-excel.sheet.macroenabled.12":{source:"iana",extensions:["xlsm"]},"application/vnd.ms-excel.template.macroenabled.12":{source:"iana",extensions:["xltm"]},"application/vnd.ms-fontobject":{source:"iana",extensions:["eot"]},"application/vnd.ms-htmlhelp":{source:"iana",extensions:["chm"]},"application/vnd.ms-ims":{source:"iana",extensions:["ims"]},"application/vnd.ms-lrm":{source:"iana",extensions:["lrm"]},"application/vnd.ms-officetheme":{source:"iana",extensions:["thmx"]},"application/vnd.ms-pki.seccat":{source:"apache",extensions:["cat"]},"application/vnd.ms-pki.stl":{source:"apache",extensions:["stl"]},"application/vnd.ms-powerpoint":{source:"iana",extensions:["ppt","pps","pot"]},"application/vnd.ms-powerpoint.addin.macroenabled.12":{source:"iana",extensions:["ppam"]},"application/vnd.ms-powerpoint.presentation.macroenabled.12":{source:"iana",extensions:["pptm"]},"application/vnd.ms-powerpoint.slide.macroenabled.12":{source:"iana",extensions:["sldm"]},"application/vnd.ms-powerpoint.slideshow.macroenabled.12":{source:"iana",extensions:["ppsm"]},"application/vnd.ms-powerpoint.template.macroenabled.12":{source:"iana",extensions:["potm"]},"application/vnd.ms-project":{source:"iana",extensions:["mpp","mpt"]},"application/vnd.ms-word.document.macroenabled.12":{source:"iana",extensions:["docm"]},"application/vnd.ms-word.template.macroenabled.12":{source:"iana",extensions:["dotm"]},"application/vnd.ms-works":{source:"iana",extensions:["wps","wks","wcm","wdb"]},"application/vnd.ms-wpl":{source:"iana",extensions:["wpl"]},"application/vnd.ms-xpsdocument":{source:"iana",extensions:["xps"]},"application/vnd.mseq":{source:"iana",extensions:["mseq"]},"application/vnd.musician":{source:"iana",extensions:["mus"]},"application/vnd.muvee.style":{source:"iana",extensions:["msty"]},"application/vnd.mynfc":{source:"iana",extensions:["taglet"]},"application/vnd.neurolanguage.nlu":{source:"iana",extensions:["nlu"]},"application/vnd.nitf":{source:"iana",extensions:["ntf","nitf"]},"application/vnd.noblenet-directory":{source:"iana",extensions:["nnd"]},"application/vnd.noblenet-sealer":{source:"iana",extensions:["nns"]},"application/vnd.noblenet-web":{source:"iana",extensions:["nnw"]},"application/vnd.nokia.n-gage.ac+xml":{source:"iana",extensions:["ac"]},"application/vnd.nokia.n-gage.data":{source:"iana",extensions:["ngdat"]},"application/vnd.nokia.n-gage.symbian.install":{source:"iana",extensions:["n-gage"]},"application/vnd.nokia.radio-preset":{source:"iana",extensions:["rpst"]},"application/vnd.nokia.radio-presets":{source:"iana",extensions:["rpss"]},"application/vnd.novadigm.edm":{source:"iana",extensions:["edm"]},"application/vnd.novadigm.edx":{source:"iana",extensions:["edx"]},"application/vnd.novadigm.ext":{source:"iana",extensions:["ext"]},"application/vnd.oasis.opendocument.chart":{source:"iana",extensions:["odc"]},"application/vnd.oasis.opendocument.chart-template":{source:"iana",extensions:["otc"]},"application/vnd.oasis.opendocument.database":{source:"iana",extensions:["odb"]},"application/vnd.oasis.opendocument.formula":{source:"iana",extensions:["odf"]},"application/vnd.oasis.opendocument.formula-template":{source:"iana",extensions:["odft"]},"application/vnd.oasis.opendocument.graphics":{source:"iana",extensions:["odg"]},"application/vnd.oasis.opendocument.graphics-template":{source:"iana",extensions:["otg"]},"application/vnd.oasis.opendocument.image":{source:"iana",extensions:["odi"]},"application/vnd.oasis.opendocument.image-template":{source:"iana",extensions:["oti"]},"application/vnd.oasis.opendocument.presentation":{source:"iana",extensions:["odp"]},"application/vnd.oasis.opendocument.presentation-template":{source:"iana",extensions:["otp"]},"application/vnd.oasis.opendocument.spreadsheet":{source:"iana",extensions:["ods"]},"application/vnd.oasis.opendocument.spreadsheet-template":{source:"iana",extensions:["ots"]},"application/vnd.oasis.opendocument.text":{source:"iana",extensions:["odt"]},"application/vnd.oasis.opendocument.text-master":{source:"iana",extensions:["odm"]},"application/vnd.oasis.opendocument.text-template":{source:"iana",extensions:["ott"]},"application/vnd.oasis.opendocument.text-web":{source:"iana",extensions:["oth"]},"application/vnd.olpc-sugar":{source:"iana",extensions:["xo"]},"application/vnd.oma.dd2+xml":{source:"iana",extensions:["dd2"]},"application/vnd.openblox.game+xml":{source:"iana",extensions:["obgx"]},"application/vnd.openofficeorg.extension":{source:"apache",extensions:["oxt"]},"application/vnd.openstreetmap.data+xml":{source:"iana",extensions:["osm"]},"application/vnd.openxmlformats-officedocument.presentationml.presentation":{source:"iana",extensions:["pptx"]},"application/vnd.openxmlformats-officedocument.presentationml.slide":{source:"iana",extensions:["sldx"]},"application/vnd.openxmlformats-officedocument.presentationml.slideshow":{source:"iana",extensions:["ppsx"]},"application/vnd.openxmlformats-officedocument.presentationml.template":{source:"iana",extensions:["potx"]},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":{source:"iana",extensions:["xlsx"]},"application/vnd.openxmlformats-officedocument.spreadsheetml.template":{source:"iana",extensions:["xltx"]},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{source:"iana",extensions:["docx"]},"application/vnd.openxmlformats-officedocument.wordprocessingml.template":{source:"iana",extensions:["dotx"]},"application/vnd.osgeo.mapguide.package":{source:"iana",extensions:["mgp"]},"application/vnd.osgi.dp":{source:"iana",extensions:["dp"]},"application/vnd.osgi.subsystem":{source:"iana",extensions:["esa"]},"application/vnd.palm":{source:"iana",extensions:["pdb","pqa","oprc"]},"application/vnd.pawaafile":{source:"iana",extensions:["paw"]},"application/vnd.pg.format":{source:"iana",extensions:["str"]},"application/vnd.pg.osasli":{source:"iana",extensions:["ei6"]},"application/vnd.picsel":{source:"iana",extensions:["efif"]},"application/vnd.pmi.widget":{source:"iana",extensions:["wg"]},"application/vnd.pocketlearn":{source:"iana",extensions:["plf"]},"application/vnd.powerbuilder6":{source:"iana",extensions:["pbd"]},"application/vnd.previewsystems.box":{source:"iana",extensions:["box"]},"application/vnd.proteus.magazine":{source:"iana",extensions:["mgz"]},"application/vnd.publishare-delta-tree":{source:"iana",extensions:["qps"]},"application/vnd.pvi.ptid1":{source:"iana",extensions:["ptid"]},"application/vnd.quark.quarkxpress":{source:"iana",extensions:["qxd","qxt","qwd","qwt","qxl","qxb"]},"application/vnd.rar":{source:"iana",extensions:["rar"]},"application/vnd.realvnc.bed":{source:"iana",extensions:["bed"]},"application/vnd.recordare.musicxml":{source:"iana",extensions:["mxl"]},"application/vnd.recordare.musicxml+xml":{source:"iana",extensions:["musicxml"]},"application/vnd.rig.cryptonote":{source:"iana",extensions:["cryptonote"]},"application/vnd.rim.cod":{source:"apache",extensions:["cod"]},"application/vnd.rn-realmedia":{source:"apache",extensions:["rm"]},"application/vnd.rn-realmedia-vbr":{source:"apache",extensions:["rmvb"]},"application/vnd.route66.link66+xml":{source:"iana",extensions:["link66"]},"application/vnd.sailingtracker.track":{source:"iana",extensions:["st"]},"application/vnd.seemail":{source:"iana",extensions:["see"]},"application/vnd.sema":{source:"iana",extensions:["sema"]},"application/vnd.semd":{source:"iana",extensions:["semd"]},"application/vnd.semf":{source:"iana",extensions:["semf"]},"application/vnd.shana.informed.formdata":{source:"iana",extensions:["ifm"]},"application/vnd.shana.informed.formtemplate":{source:"iana",extensions:["itp"]},"application/vnd.shana.informed.interchange":{source:"iana",extensions:["iif"]},"application/vnd.shana.informed.package":{source:"iana",extensions:["ipk"]},"application/vnd.simtech-mindmapper":{source:"iana",extensions:["twd","twds"]},"application/vnd.smaf":{source:"iana",extensions:["mmf"]},"application/vnd.smart.teacher":{source:"iana",extensions:["teacher"]},"application/vnd.software602.filler.form+xml":{source:"iana",extensions:["fo"]},"application/vnd.solent.sdkm+xml":{source:"iana",extensions:["sdkm","sdkd"]},"application/vnd.spotfire.dxp":{source:"iana",extensions:["dxp"]},"application/vnd.spotfire.sfs":{source:"iana",extensions:["sfs"]},"application/vnd.stardivision.calc":{source:"apache",extensions:["sdc"]},"application/vnd.stardivision.draw":{source:"apache",extensions:["sda"]},"application/vnd.stardivision.impress":{source:"apache",extensions:["sdd"]},"application/vnd.stardivision.math":{source:"apache",extensions:["smf"]},"application/vnd.stardivision.writer":{source:"apache",extensions:["sdw","vor"]},"application/vnd.stardivision.writer-global":{source:"apache",extensions:["sgl"]},"application/vnd.stepmania.package":{source:"iana",extensions:["smzip"]},"application/vnd.stepmania.stepchart":{source:"iana",extensions:["sm"]},"application/vnd.sun.wadl+xml":{source:"iana",extensions:["wadl"]},"application/vnd.sun.xml.calc":{source:"apache",extensions:["sxc"]},"application/vnd.sun.xml.calc.template":{source:"apache",extensions:["stc"]},"application/vnd.sun.xml.draw":{source:"apache",extensions:["sxd"]},"application/vnd.sun.xml.draw.template":{source:"apache",extensions:["std"]},"application/vnd.sun.xml.impress":{source:"apache",extensions:["sxi"]},"application/vnd.sun.xml.impress.template":{source:"apache",extensions:["sti"]},"application/vnd.sun.xml.math":{source:"apache",extensions:["sxm"]},"application/vnd.sun.xml.writer":{source:"apache",extensions:["sxw"]},"application/vnd.sun.xml.writer.global":{source:"apache",extensions:["sxg"]},"application/vnd.sun.xml.writer.template":{source:"apache",extensions:["stw"]},"application/vnd.sus-calendar":{source:"iana",extensions:["sus","susp"]},"application/vnd.svd":{source:"iana",extensions:["svd"]},"application/vnd.symbian.install":{source:"apache",extensions:["sis","sisx"]},"application/vnd.syncml+xml":{source:"iana",charset:"UTF-8",extensions:["xsm"]},"application/vnd.syncml.dm+wbxml":{source:"iana",charset:"UTF-8",extensions:["bdm"]},"application/vnd.syncml.dm+xml":{source:"iana",charset:"UTF-8",extensions:["xdm"]},"application/vnd.syncml.dmddf+xml":{source:"iana",charset:"UTF-8",extensions:["ddf"]},"application/vnd.tao.intent-module-archive":{source:"iana",extensions:["tao"]},"application/vnd.tcpdump.pcap":{source:"iana",extensions:["pcap","cap","dmp"]},"application/vnd.tmobile-livetv":{source:"iana",extensions:["tmo"]},"application/vnd.trid.tpt":{source:"iana",extensions:["tpt"]},"application/vnd.triscape.mxs":{source:"iana",extensions:["mxs"]},"application/vnd.trueapp":{source:"iana",extensions:["tra"]},"application/vnd.ufdl":{source:"iana",extensions:["ufd","ufdl"]},"application/vnd.uiq.theme":{source:"iana",extensions:["utz"]},"application/vnd.umajin":{source:"iana",extensions:["umj"]},"application/vnd.unity":{source:"iana",extensions:["unityweb"]},"application/vnd.uoml+xml":{source:"iana",extensions:["uoml"]},"application/vnd.vcx":{source:"iana",extensions:["vcx"]},"application/vnd.visio":{source:"iana",extensions:["vsd","vst","vss","vsw"]},"application/vnd.visionary":{source:"iana",extensions:["vis"]},"application/vnd.vsf":{source:"iana",extensions:["vsf"]},"application/vnd.wap.wbxml":{source:"iana",charset:"UTF-8",extensions:["wbxml"]},"application/vnd.wap.wmlc":{source:"iana",extensions:["wmlc"]},"application/vnd.wap.wmlscriptc":{source:"iana",extensions:["wmlsc"]},"application/vnd.webturbo":{source:"iana",extensions:["wtb"]},"application/vnd.wolfram.player":{source:"iana",extensions:["nbp"]},"application/vnd.wordperfect":{source:"iana",extensions:["wpd"]},"application/vnd.wqd":{source:"iana",extensions:["wqd"]},"application/vnd.wt.stf":{source:"iana",extensions:["stf"]},"application/vnd.xara":{source:"iana",extensions:["xar"]},"application/vnd.xfdl":{source:"iana",extensions:["xfdl"]},"application/vnd.yamaha.hv-dic":{source:"iana",extensions:["hvd"]},"application/vnd.yamaha.hv-script":{source:"iana",extensions:["hvs"]},"application/vnd.yamaha.hv-voice":{source:"iana",extensions:["hvp"]},"application/vnd.yamaha.openscoreformat":{source:"iana",extensions:["osf"]},"application/vnd.yamaha.openscoreformat.osfpvg+xml":{source:"iana",extensions:["osfpvg"]},"application/vnd.yamaha.smaf-audio":{source:"iana",extensions:["saf"]},"application/vnd.yamaha.smaf-phrase":{source:"iana",extensions:["spf"]},"application/vnd.yellowriver-custom-menu":{source:"iana",extensions:["cmp"]},"application/vnd.zul":{source:"iana",extensions:["zir","zirz"]},"application/vnd.zzazz.deck+xml":{source:"iana",extensions:["zaz"]},"application/voicexml+xml":{source:"iana",extensions:["vxml"]},"application/wasm":{source:"iana",extensions:["wasm"]},"application/watcherinfo+xml":{source:"iana",extensions:["wif"]},"application/widget":{source:"iana",extensions:["wgt"]},"application/winhlp":{source:"apache",extensions:["hlp"]},"application/wsdl+xml":{source:"iana",extensions:["wsdl"]},"application/wspolicy+xml":{source:"iana",extensions:["wspolicy"]},"application/x-7z-compressed":{source:"apache",extensions:["7z"]},"application/x-abiword":{source:"apache",extensions:["abw"]},"application/x-ace-compressed":{source:"apache",extensions:["ace"]},"application/x-apple-diskimage":{source:"apache",extensions:["dmg"]},"application/x-authorware-bin":{source:"apache",extensions:["aab","x32","u32","vox"]},"application/x-authorware-map":{source:"apache",extensions:["aam"]},"application/x-authorware-seg":{source:"apache",extensions:["aas"]},"application/x-bcpio":{source:"apache",extensions:["bcpio"]},"application/x-bittorrent":{source:"apache",extensions:["torrent"]},"application/x-blorb":{source:"apache",extensions:["blb","blorb"]},"application/x-bzip":{source:"apache",extensions:["bz"]},"application/x-bzip2":{source:"apache",extensions:["bz2","boz"]},"application/x-cbr":{source:"apache",extensions:["cbr","cba","cbt","cbz","cb7"]},"application/x-cdlink":{source:"apache",extensions:["vcd"]},"application/x-cfs-compressed":{source:"apache",extensions:["cfs"]},"application/x-chat":{source:"apache",extensions:["chat"]},"application/x-chess-pgn":{source:"apache",extensions:["pgn"]},"application/x-cocoa":{source:"nginx",extensions:["cco"]},"application/x-conference":{source:"apache",extensions:["nsc"]},"application/x-cpio":{source:"apache",extensions:["cpio"]},"application/x-csh":{source:"apache",extensions:["csh"]},"application/x-debian-package":{source:"apache",extensions:["deb","udeb"]},"application/x-dgc-compressed":{source:"apache",extensions:["dgc"]},"application/x-director":{source:"apache",extensions:["dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"]},"application/x-doom":{source:"apache",extensions:["wad"]},"application/x-dtbncx+xml":{source:"apache",extensions:["ncx"]},"application/x-dtbook+xml":{source:"apache",extensions:["dtb"]},"application/x-dtbresource+xml":{source:"apache",extensions:["res"]},"application/x-dvi":{source:"apache",extensions:["dvi"]},"application/x-envoy":{source:"apache",extensions:["evy"]},"application/x-eva":{source:"apache",extensions:["eva"]},"application/x-font-bdf":{source:"apache",extensions:["bdf"]},"application/x-font-ghostscript":{source:"apache",extensions:["gsf"]},"application/x-font-linux-psf":{source:"apache",extensions:["psf"]},"application/x-font-pcf":{source:"apache",extensions:["pcf"]},"application/x-font-snf":{source:"apache",extensions:["snf"]},"application/x-font-type1":{source:"apache",extensions:["pfa","pfb","pfm","afm"]},"application/x-freearc":{source:"apache",extensions:["arc"]},"application/x-futuresplash":{source:"apache",extensions:["spl"]},"application/x-gca-compressed":{source:"apache",extensions:["gca"]},"application/x-glulx":{source:"apache",extensions:["ulx"]},"application/x-gnumeric":{source:"apache",extensions:["gnumeric"]},"application/x-gramps-xml":{source:"apache",extensions:["gramps"]},"application/x-gtar":{source:"apache",extensions:["gtar"]},"application/x-hdf":{source:"apache",extensions:["hdf"]},"application/x-install-instructions":{source:"apache",extensions:["install"]},"application/x-iso9660-image":{source:"apache",extensions:["iso"]},"application/x-java-archive-diff":{source:"nginx",extensions:["jardiff"]},"application/x-java-jnlp-file":{source:"apache",extensions:["jnlp"]},"application/x-latex":{source:"apache",extensions:["latex"]},"application/x-lzh-compressed":{source:"apache",extensions:["lzh","lha"]},"application/x-makeself":{source:"nginx",extensions:["run"]},"application/x-mie":{source:"apache",extensions:["mie"]},"application/x-mobipocket-ebook":{source:"apache",extensions:["prc","mobi"]},"application/x-ms-application":{source:"apache",extensions:["application"]},"application/x-ms-shortcut":{source:"apache",extensions:["lnk"]},"application/x-ms-wmd":{source:"apache",extensions:["wmd"]},"application/x-ms-wmz":{source:"apache",extensions:["wmz"]},"application/x-ms-xbap":{source:"apache",extensions:["xbap"]},"application/x-msaccess":{source:"apache",extensions:["mdb"]},"application/x-msbinder":{source:"apache",extensions:["obd"]},"application/x-mscardfile":{source:"apache",extensions:["crd"]},"application/x-msclip":{source:"apache",extensions:["clp"]},"application/x-msdownload":{source:"apache",extensions:["exe","dll","com","bat","msi"]},"application/x-msmediaview":{source:"apache",extensions:["mvb","m13","m14"]},"application/x-msmetafile":{source:"apache",extensions:["wmf","wmz","emf","emz"]},"application/x-msmoney":{source:"apache",extensions:["mny"]},"application/x-mspublisher":{source:"apache",extensions:["pub"]},"application/x-msschedule":{source:"apache",extensions:["scd"]},"application/x-msterminal":{source:"apache",extensions:["trm"]},"application/x-mswrite":{source:"apache",extensions:["wri"]},"application/x-netcdf":{source:"apache",extensions:["nc","cdf"]},"application/x-nzb":{source:"apache",extensions:["nzb"]},"application/x-perl":{source:"nginx",extensions:["pl","pm"]},"application/x-pilot":{source:"nginx",extensions:["prc","pdb"]},"application/x-pkcs12":{source:"apache",extensions:["p12","pfx"]},"application/x-pkcs7-certificates":{source:"apache",extensions:["p7b","spc"]},"application/x-pkcs7-certreqresp":{source:"apache",extensions:["p7r"]},"application/x-rar-compressed":{source:"apache",extensions:["rar"]},"application/x-redhat-package-manager":{source:"nginx",extensions:["rpm"]},"application/x-research-info-systems":{source:"apache",extensions:["ris"]},"application/x-sea":{source:"nginx",extensions:["sea"]},"application/x-sh":{source:"apache",extensions:["sh"]},"application/x-shar":{source:"apache",extensions:["shar"]},"application/x-shockwave-flash":{source:"apache",extensions:["swf"]},"application/x-silverlight-app":{source:"apache",extensions:["xap"]},"application/x-sql":{source:"apache",extensions:["sql"]},"application/x-stuffit":{source:"apache",extensions:["sit"]},"application/x-stuffitx":{source:"apache",extensions:["sitx"]},"application/x-subrip":{source:"apache",extensions:["srt"]},"application/x-sv4cpio":{source:"apache",extensions:["sv4cpio"]},"application/x-sv4crc":{source:"apache",extensions:["sv4crc"]},"application/x-t3vm-image":{source:"apache",extensions:["t3"]},"application/x-tads":{source:"apache",extensions:["gam"]},"application/x-tar":{source:"apache",extensions:["tar"]},"application/x-tcl":{source:"apache",extensions:["tcl","tk"]},"application/x-tex":{source:"apache",extensions:["tex"]},"application/x-tex-tfm":{source:"apache",extensions:["tfm"]},"application/x-texinfo":{source:"apache",extensions:["texinfo","texi"]},"application/x-tgif":{source:"apache",extensions:["obj"]},"application/x-ustar":{source:"apache",extensions:["ustar"]},"application/x-wais-source":{source:"apache",extensions:["src"]},"application/x-x509-ca-cert":{source:"iana",extensions:["der","crt","pem"]},"application/x-xfig":{source:"apache",extensions:["fig"]},"application/x-xliff+xml":{source:"apache",extensions:["xlf"]},"application/x-xpinstall":{source:"apache",extensions:["xpi"]},"application/x-xz":{source:"apache",extensions:["xz"]},"application/x-zmachine":{source:"apache",extensions:["z1","z2","z3","z4","z5","z6","z7","z8"]},"application/xaml+xml":{source:"apache",extensions:["xaml"]},"application/xcap-att+xml":{source:"iana",extensions:["xav"]},"application/xcap-caps+xml":{source:"iana",extensions:["xca"]},"application/xcap-diff+xml":{source:"iana",extensions:["xdf"]},"application/xcap-el+xml":{source:"iana",extensions:["xel"]},"application/xcap-ns+xml":{source:"iana",extensions:["xns"]},"application/xenc+xml":{source:"iana",extensions:["xenc"]},"application/xhtml+xml":{source:"iana",extensions:["xhtml","xht"]},"application/xliff+xml":{source:"iana",extensions:["xlf"]},"application/xml":{source:"iana",extensions:["xml","xsl","xsd","rng"]},"application/xml-dtd":{source:"iana",extensions:["dtd"]},"application/xop+xml":{source:"iana",extensions:["xop"]},"application/xproc+xml":{source:"apache",extensions:["xpl"]},"application/xslt+xml":{source:"iana",extensions:["xsl","xslt"]},"application/xspf+xml":{source:"apache",extensions:["xspf"]},"application/xv+xml":{source:"iana",extensions:["mxml","xhvml","xvml","xvm"]},"application/yaml":{source:"iana",extensions:["yaml","yml"]},"application/yang":{source:"iana",extensions:["yang"]},"application/yin+xml":{source:"iana",extensions:["yin"]},"application/zip":{source:"iana",extensions:["zip"]},"audio/3gpp":{source:"iana",extensions:["3gpp"]},"audio/adpcm":{source:"apache",extensions:["adp"]},"audio/amr":{source:"iana",extensions:["amr"]},"audio/basic":{source:"iana",extensions:["au","snd"]},"audio/midi":{source:"apache",extensions:["mid","midi","kar","rmi"]},"audio/mobile-xmf":{source:"iana",extensions:["mxmf"]},"audio/mp4":{source:"iana",extensions:["m4a","mp4a"]},"audio/mpeg":{source:"iana",extensions:["mpga","mp2","mp2a","mp3","m2a","m3a"]},"audio/ogg":{source:"iana",extensions:["oga","ogg","spx","opus"]},"audio/s3m":{source:"apache",extensions:["s3m"]},"audio/silk":{source:"apache",extensions:["sil"]},"audio/vnd.dece.audio":{source:"iana",extensions:["uva","uvva"]},"audio/vnd.digital-winds":{source:"iana",extensions:["eol"]},"audio/vnd.dra":{source:"iana",extensions:["dra"]},"audio/vnd.dts":{source:"iana",extensions:["dts"]},"audio/vnd.dts.hd":{source:"iana",extensions:["dtshd"]},"audio/vnd.lucent.voice":{source:"iana",extensions:["lvp"]},"audio/vnd.ms-playready.media.pya":{source:"iana",extensions:["pya"]},"audio/vnd.nuera.ecelp4800":{source:"iana",extensions:["ecelp4800"]},"audio/vnd.nuera.ecelp7470":{source:"iana",extensions:["ecelp7470"]},"audio/vnd.nuera.ecelp9600":{source:"iana",extensions:["ecelp9600"]},"audio/vnd.rip":{source:"iana",extensions:["rip"]},"audio/webm":{source:"apache",extensions:["weba"]},"audio/x-aac":{source:"apache",extensions:["aac"]},"audio/x-aiff":{source:"apache",extensions:["aif","aiff","aifc"]},"audio/x-caf":{source:"apache",extensions:["caf"]},"audio/x-flac":{source:"apache",extensions:["flac"]},"audio/x-m4a":{source:"nginx",extensions:["m4a"]},"audio/x-matroska":{source:"apache",extensions:["mka"]},"audio/x-mpegurl":{source:"apache",extensions:["m3u"]},"audio/x-ms-wax":{source:"apache",extensions:["wax"]},"audio/x-ms-wma":{source:"apache",extensions:["wma"]},"audio/x-pn-realaudio":{source:"apache",extensions:["ram","ra"]},"audio/x-pn-realaudio-plugin":{source:"apache",extensions:["rmp"]},"audio/x-realaudio":{source:"nginx",extensions:["ra"]},"audio/x-wav":{source:"apache",extensions:["wav"]},"audio/x-gsm":{source:"apache",extensions:["gsm"]},"audio/xm":{source:"apache",extensions:["xm"]},"image/aces":{source:"iana",extensions:["exr"]},"image/avci":{source:"iana",extensions:["avci"]},"image/avcs":{source:"iana",extensions:["avcs"]},"image/avif":{source:"iana",extensions:["avif"]},"image/bmp":{source:"iana",extensions:["bmp"]},"image/cgm":{source:"iana",extensions:["cgm"]},"image/dicom-rle":{source:"iana",extensions:["drle"]},"image/emf":{source:"iana",extensions:["emf"]},"image/fits":{source:"iana",extensions:["fits"]},"image/g3fax":{source:"iana",extensions:["g3"]},"image/gif":{source:"iana",extensions:["gif"]},"image/heic":{source:"iana",extensions:["heic"]},"image/heic-sequence":{source:"iana",extensions:["heics"]},"image/heif":{source:"iana",extensions:["heif"]},"image/heif-sequence":{source:"iana",extensions:["heifs"]},"image/hej2k":{source:"iana",extensions:["hej2"]},"image/hsj2":{source:"iana",extensions:["hsj2"]},"image/ief":{source:"iana",extensions:["ief"]},"image/jls":{source:"iana",extensions:["jls"]},"image/jp2":{source:"iana",extensions:["jp2","jpg2"]},"image/jpeg":{source:"iana",extensions:["jpeg","jpg","jpe","jfif","pjpeg","pjp"]},"image/jph":{source:"iana",extensions:["jph"]},"image/jphc":{source:"iana",extensions:["jhc"]},"image/jpm":{source:"iana",extensions:["jpm"]},"image/jpx":{source:"iana",extensions:["jpx","jpf"]},"image/jxr":{source:"iana",extensions:["jxr"]},"image/jxra":{source:"iana",extensions:["jxra"]},"image/jxrs":{source:"iana",extensions:["jxrs"]},"image/jxs":{source:"iana",extensions:["jxs"]},"image/jxsc":{source:"iana",extensions:["jxsc"]},"image/jxsi":{source:"iana",extensions:["jxsi"]},"image/jxss":{source:"iana",extensions:["jxss"]},"image/ktx":{source:"iana",extensions:["ktx"]},"image/ktx2":{source:"iana",extensions:["ktx2"]},"image/png":{source:"iana",extensions:["png"]},"image/prs.btif":{source:"iana",extensions:["btif"]},"image/prs.pti":{source:"iana",extensions:["pti"]},"image/sgi":{source:"apache",extensions:["sgi"]},"image/svg+xml":{source:"iana",extensions:["svg","svgz"]},"image/t38":{source:"iana",extensions:["t38"]},"image/tiff":{source:"iana",extensions:["tif","tiff"]},"image/tiff-fx":{source:"iana",extensions:["tfx"]},"image/vnd.adobe.photoshop":{source:"iana",extensions:["psd"]},"image/vnd.airzip.accelerator.azv":{source:"iana",extensions:["azv"]},"image/vnd.dece.graphic":{source:"iana",extensions:["uvi","uvvi","uvg","uvvg"]},"image/vnd.djvu":{source:"iana",extensions:["djvu","djv"]},"image/vnd.dvb.subtitle":{source:"iana",extensions:["sub"]},"image/vnd.dwg":{source:"iana",extensions:["dwg"]},"image/vnd.dxf":{source:"iana",extensions:["dxf"]},"image/vnd.fastbidsheet":{source:"iana",extensions:["fbs"]},"image/vnd.fpx":{source:"iana",extensions:["fpx"]},"image/vnd.fst":{source:"iana",extensions:["fst"]},"image/vnd.fujixerox.edmics-mmr":{source:"iana",extensions:["mmr"]},"image/vnd.fujixerox.edmics-rlc":{source:"iana",extensions:["rlc"]},"image/vnd.microsoft.icon":{source:"iana",extensions:["ico"]},"image/vnd.ms-modi":{source:"iana",extensions:["mdi"]},"image/vnd.ms-photo":{source:"apache",extensions:["wdp"]},"image/vnd.net-fpx":{source:"iana",extensions:["npx"]},"image/vnd.pco.b16":{source:"iana",extensions:["b16"]},"image/vnd.tencent.tap":{source:"iana",extensions:["tap"]},"image/vnd.valve.source.texture":{source:"iana",extensions:["vtf"]},"image/vnd.wap.wbmp":{source:"iana",extensions:["wbmp"]},"image/vnd.xiff":{source:"iana",extensions:["xif"]},"image/vnd.zbrush.pcx":{source:"iana",extensions:["pcx"]},"image/webp":{source:"apache",extensions:["webp"]},"image/wmf":{source:"iana",extensions:["wmf"]},"image/x-3ds":{source:"apache",extensions:["3ds"]},"image/x-cmu-raster":{source:"apache",extensions:["ras"]},"image/x-cmx":{source:"apache",extensions:["cmx"]},"image/x-freehand":{source:"apache",extensions:["fh","fhc","fh4","fh5","fh7"]},"image/x-icon":{source:"apache",extensions:["ico"]},"image/x-jng":{source:"nginx",extensions:["jng"]},"image/x-mrsid-image":{source:"apache",extensions:["sid"]},"image/x-ms-bmp":{source:"nginx",extensions:["bmp"]},"image/x-pcx":{source:"apache",extensions:["pcx"]},"image/x-pict":{source:"apache",extensions:["pic","pct"]},"image/x-portable-anymap":{source:"apache",extensions:["pnm"]},"image/x-portable-bitmap":{source:"apache",extensions:["pbm"]},"image/x-portable-graymap":{source:"apache",extensions:["pgm"]},"image/x-portable-pixmap":{source:"apache",extensions:["ppm"]},"image/x-rgb":{source:"apache",extensions:["rgb"]},"image/x-tga":{source:"apache",extensions:["tga"]},"image/x-xbitmap":{source:"apache",extensions:["xbm"]},"image/x-xpixmap":{source:"apache",extensions:["xpm"]},"image/x-xwindowdump":{source:"apache",extensions:["xwd"]},"text/cache-manifest":{source:"iana",extensions:["appcache","manifest"]},"text/calendar":{source:"iana",extensions:["ics","ifb"]},"text/css":{source:"iana",charset:"UTF-8",extensions:["css"]},"text/csv":{source:"iana",extensions:["csv"]},"text/html":{source:"iana",extensions:["html","htm","shtml"]},"text/markdown":{source:"iana",extensions:["markdown","md"]},"text/mathml":{source:"nginx",extensions:["mml"]},"text/n3":{source:"iana",charset:"UTF-8",extensions:["n3"]},"text/plain":{source:"iana",extensions:["txt","text","conf","def","list","log","in","ini"]},"text/prs.lines.tag":{source:"iana",extensions:["dsc"]},"text/richtext":{source:"iana",extensions:["rtx"]},"text/rtf":{source:"iana",extensions:["rtf"]},"text/sgml":{source:"iana",extensions:["sgml","sgm"]},"text/shex":{source:"iana",extensions:["shex"]},"text/spdx":{source:"iana",extensions:["spdx"]},"text/tab-separated-values":{source:"iana",extensions:["tsv"]},"text/troff":{source:"iana",extensions:["t","tr","roff","man","me","ms"]},"text/turtle":{source:"iana",charset:"UTF-8",extensions:["ttl"]},"text/uri-list":{source:"iana",extensions:["uri","uris","urls"]},"text/vcard":{source:"iana",extensions:["vcard"]},"text/vnd.curl":{source:"iana",extensions:["curl"]},"text/vnd.curl.dcurl":{source:"apache",extensions:["dcurl"]},"text/vnd.curl.mcurl":{source:"apache",extensions:["mcurl"]},"text/vnd.curl.scurl":{source:"apache",extensions:["scurl"]},"text/vnd.dvb.subtitle":{source:"iana",extensions:["sub"]},"text/vnd.familysearch.gedcom":{source:"iana",extensions:["ged"]},"text/vnd.fly":{source:"iana",extensions:["fly"]},"text/vnd.fmi.flexstor":{source:"iana",extensions:["flx"]},"text/vnd.graphviz":{source:"iana",extensions:["gv"]},"text/vnd.in3d.3dml":{source:"iana",extensions:["3dml"]},"text/vnd.in3d.spot":{source:"iana",extensions:["spot"]},"text/vnd.sun.j2me.app-descriptor":{source:"iana",charset:"UTF-8",extensions:["jad"]},"text/vnd.wap.wml":{source:"iana",extensions:["wml"]},"text/vnd.wap.wmlscript":{source:"iana",extensions:["wmls"]},"text/vtt":{source:"iana",charset:"UTF-8",extensions:["vtt"]},"text/x-asm":{source:"apache",extensions:["s","asm"]},"text/x-c":{source:"apache",extensions:["c","cc","cxx","cpp","h","hh","dic"]},"text/x-component":{source:"nginx",extensions:["htc"]},"text/x-fortran":{source:"apache",extensions:["f","for","f77","f90"]},"text/x-java-source":{source:"apache",extensions:["java"]},"text/x-nfo":{source:"apache",extensions:["nfo"]},"text/x-opml":{source:"apache",extensions:["opml"]},"text/x-pascal":{source:"apache",extensions:["p","pas"]},"text/x-setext":{source:"apache",extensions:["etx"]},"text/x-sfv":{source:"apache",extensions:["sfv"]},"text/x-uuencode":{source:"apache",extensions:["uu"]},"text/x-vcalendar":{source:"apache",extensions:["vcs"]},"text/x-vcard":{source:"apache",extensions:["vcf"]},"text/xml":{source:"iana",extensions:["xml"]},"video/3gpp":{source:"iana",extensions:["3gp","3gpp"]},"video/3gpp2":{source:"iana",extensions:["3g2"]},"video/h261":{source:"iana",extensions:["h261"]},"video/h263":{source:"iana",extensions:["h263"]},"video/h264":{source:"iana",extensions:["h264"]},"video/iso.segment":{source:"iana",extensions:["m4s"]},"video/jpeg":{source:"iana",extensions:["jpgv"]},"video/jpm":{source:"apache",extensions:["jpm","jpgm"]},"video/mj2":{source:"iana",extensions:["mj2","mjp2"]},"video/mp2t":{source:"iana",extensions:["ts"]},"video/mp4":{source:"iana",extensions:["mp4","mp4v","mpg4"]},"video/mpeg":{source:"iana",extensions:["mpeg","mpg","mpe","m1v","m2v"]},"video/ogg":{source:"iana",extensions:["ogv"]},"video/quicktime":{source:"iana",extensions:["qt","mov"]},"video/vnd.dece.hd":{source:"iana",extensions:["uvh","uvvh"]},"video/vnd.dece.mobile":{source:"iana",extensions:["uvm","uvvm"]},"video/vnd.dece.pd":{source:"iana",extensions:["uvp","uvvp"]},"video/vnd.dece.sd":{source:"iana",extensions:["uvs","uvvs"]},"video/vnd.dece.video":{source:"iana",extensions:["uvv","uvvv"]},"video/vnd.dvb.file":{source:"iana",extensions:["dvb"]},"video/vnd.fvt":{source:"iana",extensions:["fvt"]},"video/vnd.mpegurl":{source:"iana",extensions:["mxu","m4u"]},"video/vnd.ms-playready.media.pyv":{source:"iana",extensions:["pyv"]},"video/vnd.uvvu.mp4":{source:"iana",extensions:["uvu","uvvu"]},"video/vnd.vivo":{source:"iana",extensions:["viv"]},"video/webm":{source:"apache",extensions:["webm"]},"video/x-f4v":{source:"apache",extensions:["f4v"]},"video/x-fli":{source:"apache",extensions:["fli"]},"video/x-flv":{source:"apache",extensions:["flv"]},"video/x-m4v":{source:"apache",extensions:["m4v"]},"video/x-matroska":{source:"apache",extensions:["mkv","mk3d","mks"]},"video/x-mng":{source:"apache",extensions:["mng"]},"video/x-ms-asf":{source:"apache",extensions:["asf","asx"]},"video/x-ms-vob":{source:"apache",extensions:["vob"]},"video/x-ms-wm":{source:"apache",extensions:["wm"]},"video/x-ms-wmv":{source:"apache",extensions:["wmv"]},"video/x-ms-wmx":{source:"apache",extensions:["wmx"]},"video/x-ms-wvx":{source:"apache",extensions:["wvx"]},"video/x-msvideo":{source:"apache",extensions:["avi"]},"video/x-sgi-movie":{source:"apache",extensions:["movie"]},"video/x-smv":{source:"apache",extensions:["smv"]},"chemical/x-cdx":{source:"apache",extensions:["cdx"]},"chemical/x-cif":{source:"apache",extensions:["cif"]},"chemical/x-cmdf":{source:"apache",extensions:["cmdf"]},"chemical/x-cml":{source:"apache",extensions:["cml"]},"chemical/x-csml":{source:"apache",extensions:["csml"]},"chemical/x-xyz":{source:"apache",extensions:["xyz"]},"font/collection":{source:"iana",extensions:["ttc"]},"font/otf":{source:"iana",extensions:["otf"]},"font/ttf":{source:"iana",extensions:["ttf"]},"font/woff":{source:"iana",extensions:["woff"]},"font/woff2":{source:"iana",extensions:["woff2"]},"message/disposition-notification":{source:"iana",extensions:["disposition-notification"]},"message/global":{source:"iana",extensions:["u8msg"]},"message/global-delivery-status":{source:"iana",extensions:["u8dsn"]},"message/global-disposition-notification":{source:"iana",extensions:["u8mdn"]},"message/global-headers":{source:"iana",extensions:["u8hdr"]},"message/rfc822":{source:"iana",extensions:["eml","mime"]},"message/vnd.wfa.wsc":{source:"iana",extensions:["wsc"]},"model/3mf":{source:"iana",extensions:["3mf"]},"model/gltf+json":{source:"iana",extensions:["gltf"]},"model/gltf-binary":{source:"iana",extensions:["glb"]},"model/iges":{source:"iana",extensions:["igs","iges"]},"model/mesh":{source:"iana",extensions:["msh","mesh","silo"]},"model/mtl":{source:"iana",extensions:["mtl"]},"model/obj":{source:"iana",extensions:["obj"]},"model/step":{source:"iana",extensions:[".p21",".stp",".step",".stpnc",".210"]},"model/step+xml":{source:"iana",extensions:["stpx"]},"model/step+zip":{source:"iana",extensions:["stpz"]},"model/step-xml+zip":{source:"iana",extensions:["stpxz"]},"model/stl":{source:"iana",extensions:["stl"]},"model/vnd.collada+xml":{source:"iana",extensions:["dae"]},"model/vnd.dwf":{source:"iana",extensions:["dwf"]},"model/vnd.gdl":{source:"iana",extensions:["gdl"]},"model/vnd.gtw":{source:"iana",extensions:["gtw"]},"model/vnd.mts":{source:"iana",extensions:["mts"]},"model/vnd.opengex":{source:"iana",extensions:["ogex"]},"model/vnd.parasolid.transmit.binary":{source:"iana",extensions:["x_b"]},"model/vnd.parasolid.transmit.text":{source:"iana",extensions:["x_t"]},"model/vnd.sap.vds":{source:"iana",extensions:["vds"]},"model/vnd.usdz+zip":{source:"iana",extensions:["usdz"]},"model/vnd.valve.source.compiled-map":{source:"iana",extensions:["bsp"]},"model/vnd.vtu":{source:"iana",extensions:["vtu"]},"model/vrml":{source:"iana",extensions:["wrl","vrml"]},"model/x3d+binary":{source:"apache",extensions:["x3db","x3dbz"]},"model/x3d+fastinfoset":{source:"iana",extensions:["x3db"]},"model/x3d+vrml":{source:"apache",extensions:["x3dv","x3dvz"]},"model/x3d+xml":{source:"iana",extensions:["x3d","x3dz"]},"model/x3d-vrml":{source:"iana",extensions:["x3dv"]},"x-conference/x-cooltalk":{source:"apache",extensions:["ice"]}},Bx={},By={},Bv=!1,Bw={alphabet:"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",minLength:0,blocklist:new Set(["0rgasm","1d10t","1d1ot","1di0t","1diot","1eccacu10","1eccacu1o","1eccacul0","1eccaculo","1mbec11e","1mbec1le","1mbeci1e","1mbecile","a11upat0","a11upato","a1lupat0","a1lupato","aand","ah01e","ah0le","aho1e","ahole","al1upat0","al1upato","allupat0","allupato","ana1","ana1e","anal","anale","anus","arrapat0","arrapato","arsch","arse","ass","b00b","b00be","b01ata","b0ceta","b0iata","b0ob","b0obe","b0sta","b1tch","b1te","b1tte","ba1atkar","balatkar","bastard0","bastardo","batt0na","battona","bitch","bite","bitte","bo0b","bo0be","bo1ata","boceta","boiata","boob","boobe","bosta","bran1age","bran1er","bran1ette","bran1eur","bran1euse","branlage","branler","branlette","branleur","branleuse","c0ck","c0g110ne","c0g11one","c0g1i0ne","c0g1ione","c0gl10ne","c0gl1one","c0gli0ne","c0glione","c0na","c0nnard","c0nnasse","c0nne","c0u111es","c0u11les","c0u1l1es","c0u1lles","c0ui11es","c0ui1les","c0uil1es","c0uilles","c11t","c11t0","c11to","c1it","c1it0","c1ito","cabr0n","cabra0","cabrao","cabron","caca","cacca","cacete","cagante","cagar","cagare","cagna","cara1h0","cara1ho","caracu10","caracu1o","caracul0","caraculo","caralh0","caralho","cazz0","cazz1mma","cazzata","cazzimma","cazzo","ch00t1a","ch00t1ya","ch00tia","ch00tiya","ch0d","ch0ot1a","ch0ot1ya","ch0otia","ch0otiya","ch1asse","ch1avata","ch1er","ch1ng0","ch1ngadaz0s","ch1ngadazos","ch1ngader1ta","ch1ngaderita","ch1ngar","ch1ngo","ch1ngues","ch1nk","chatte","chiasse","chiavata","chier","ching0","chingadaz0s","chingadazos","chingader1ta","chingaderita","chingar","chingo","chingues","chink","cho0t1a","cho0t1ya","cho0tia","cho0tiya","chod","choot1a","choot1ya","chootia","chootiya","cl1t","cl1t0","cl1to","clit","clit0","clito","cock","cog110ne","cog11one","cog1i0ne","cog1ione","cogl10ne","cogl1one","cogli0ne","coglione","cona","connard","connasse","conne","cou111es","cou11les","cou1l1es","cou1lles","coui11es","coui1les","couil1es","couilles","cracker","crap","cu10","cu1att0ne","cu1attone","cu1er0","cu1ero","cu1o","cul0","culatt0ne","culattone","culer0","culero","culo","cum","cunt","d11d0","d11do","d1ck","d1ld0","d1ldo","damn","de1ch","deich","depp","di1d0","di1do","dick","dild0","dildo","dyke","encu1e","encule","enema","enf01re","enf0ire","enfo1re","enfoire","estup1d0","estup1do","estupid0","estupido","etr0n","etron","f0da","f0der","f0ttere","f0tters1","f0ttersi","f0tze","f0utre","f1ca","f1cker","f1ga","fag","fica","ficker","figa","foda","foder","fottere","fotters1","fottersi","fotze","foutre","fr0c10","fr0c1o","fr0ci0","fr0cio","fr0sc10","fr0sc1o","fr0sci0","fr0scio","froc10","froc1o","froci0","frocio","frosc10","frosc1o","frosci0","froscio","fuck","g00","g0o","g0u1ne","g0uine","gandu","go0","goo","gou1ne","gouine","gr0gnasse","grognasse","haram1","harami","haramzade","hund1n","hundin","id10t","id1ot","idi0t","idiot","imbec11e","imbec1le","imbeci1e","imbecile","j1zz","jerk","jizz","k1ke","kam1ne","kamine","kike","leccacu10","leccacu1o","leccacul0","leccaculo","m1erda","m1gn0tta","m1gnotta","m1nch1a","m1nchia","m1st","mam0n","mamahuev0","mamahuevo","mamon","masturbat10n","masturbat1on","masturbate","masturbati0n","masturbation","merd0s0","merd0so","merda","merde","merdos0","merdoso","mierda","mign0tta","mignotta","minch1a","minchia","mist","musch1","muschi","n1gger","neger","negr0","negre","negro","nerch1a","nerchia","nigger","orgasm","p00p","p011a","p01la","p0l1a","p0lla","p0mp1n0","p0mp1no","p0mpin0","p0mpino","p0op","p0rca","p0rn","p0rra","p0uff1asse","p0uffiasse","p1p1","p1pi","p1r1a","p1rla","p1sc10","p1sc1o","p1sci0","p1scio","p1sser","pa11e","pa1le","pal1e","palle","pane1e1r0","pane1e1ro","pane1eir0","pane1eiro","panele1r0","panele1ro","paneleir0","paneleiro","patakha","pec0r1na","pec0rina","pecor1na","pecorina","pen1s","pendej0","pendejo","penis","pip1","pipi","pir1a","pirla","pisc10","pisc1o","pisci0","piscio","pisser","po0p","po11a","po1la","pol1a","polla","pomp1n0","pomp1no","pompin0","pompino","poop","porca","porn","porra","pouff1asse","pouffiasse","pr1ck","prick","pussy","put1za","puta","puta1n","putain","pute","putiza","puttana","queca","r0mp1ba11e","r0mp1ba1le","r0mp1bal1e","r0mp1balle","r0mpiba11e","r0mpiba1le","r0mpibal1e","r0mpiballe","rand1","randi","rape","recch10ne","recch1one","recchi0ne","recchione","retard","romp1ba11e","romp1ba1le","romp1bal1e","romp1balle","rompiba11e","rompiba1le","rompibal1e","rompiballe","ruff1an0","ruff1ano","ruffian0","ruffiano","s1ut","sa10pe","sa1aud","sa1ope","sacanagem","sal0pe","salaud","salope","saugnapf","sb0rr0ne","sb0rra","sb0rrone","sbattere","sbatters1","sbattersi","sborr0ne","sborra","sborrone","sc0pare","sc0pata","sch1ampe","sche1se","sche1sse","scheise","scheisse","schlampe","schwachs1nn1g","schwachs1nnig","schwachsinn1g","schwachsinnig","schwanz","scopare","scopata","sexy","sh1t","shit","slut","sp0mp1nare","sp0mpinare","spomp1nare","spompinare","str0nz0","str0nza","str0nzo","stronz0","stronza","stronzo","stup1d","stupid","succh1am1","succh1ami","succhiam1","succhiami","sucker","t0pa","tapette","test1c1e","test1cle","testic1e","testicle","tette","topa","tr01a","tr0ia","tr0mbare","tr1ng1er","tr1ngler","tring1er","tringler","tro1a","troia","trombare","turd","twat","vaffancu10","vaffancu1o","vaffancul0","vaffanculo","vag1na","vagina","verdammt","verga","w1chsen","wank","wichsen","x0ch0ta","x0chota","xana","xoch0ta","xochota","z0cc01a","z0cc0la","z0cco1a","z0ccola","z1z1","z1zi","ziz1","zizi","zocc01a","zocc0la","zocco1a","zoccola"])};class BS{constructor(e){var t,s,i;let n=null!==(t=null==e?void 0:e.alphabet)&&void 0!==t?t:Bw.alphabet,r=null!==(s=null==e?void 0:e.minLength)&&void 0!==s?s:Bw.minLength,a=null!==(i=null==e?void 0:e.blocklist)&&void 0!==i?i:Bw.blocklist;if(new Blob([n]).size!==n.length)throw Error("Alphabet cannot contain multibyte characters");if(n.length<3)throw Error("Alphabet length must be at least 3");if(new Set(n).size!==n.length)throw Error("Alphabet must contain unique characters");if("number"!=typeof r||r<0||r>255)throw Error("Minimum length has to be between 0 and 255");let o=new Set,c=n.toLowerCase().split("");for(let e of a)if(e.length>=3){let t=e.toLowerCase(),s=t.split("");s.filter(e=>c.includes(e)).length===s.length&&o.add(t)}this.alphabet=this.shuffle(n),this.minLength=r,this.blocklist=o}encode(e){if(0===e.length)return"";if(e.filter(e=>e>=0&&e<=this.maxValue()).length!==e.length)throw Error(`Encoding supports numbers between 0 and ${this.maxValue()}`);return this.encodeNumbers(e)}decode(e){let t=[];if(""===e)return t;let s=this.alphabet.split("");for(let i of e.split(""))if(!s.includes(i))return t;let i=e.charAt(0),n=this.alphabet.indexOf(i),r=this.alphabet.slice(n)+this.alphabet.slice(0,n);r=r.split("").reverse().join("");let a=e.slice(1);for(;a.length>0;){let e=r.slice(0,1),s=a.split(e);if(s.length>0){if(""===s[0])return t;t.push(this.toNumber(s[0],r.slice(1))),s.length>1&&(r=this.shuffle(r))}a=s.slice(1).join(e)}return t}encodeNumbers(e,t=0){if(t>this.alphabet.length)throw Error("Reached max attempts to re-generate the ID");let s=e.reduce((e,t,s)=>this.alphabet[t%this.alphabet.length].codePointAt(0)+s+e,e.length)%this.alphabet.length;s=(s+t)%this.alphabet.length;let i=this.alphabet.slice(s)+this.alphabet.slice(0,s),n=i.charAt(0);i=i.split("").reverse().join("");let r=[n];for(let t=0;t!==e.length;t++){let s=e[t];r.push(this.toId(s,i.slice(1))),t<e.length-1&&(r.push(i.slice(0,1)),i=this.shuffle(i))}let a=r.join("");if(this.minLength>a.length)for(a+=i.slice(0,1);this.minLength-a.length>0;)i=this.shuffle(i),a+=i.slice(0,Math.min(this.minLength-a.length,i.length));return this.isBlockedId(a)&&(a=this.encodeNumbers(e,t+1)),a}shuffle(e){let t=e.split("");for(let e=0,s=t.length-1;s>0;e++,s--){let i=(e*s+t[e].codePointAt(0)+t[s].codePointAt(0))%t.length;[t[e],t[i]]=[t[i],t[e]]}return t.join("")}toId(e,t){let s=[],i=t.split(""),n=e;do s.unshift(i[n%i.length]),n=Math.floor(n/i.length);while(n>0);return s.join("")}toNumber(e,t){let s=t.split("");return e.split("").reduce((e,t)=>e*s.length+s.indexOf(t),0)}isBlockedId(e){let t=e.toLowerCase();for(let e of this.blocklist)if(e.length<=t.length){if(t.length<=3||e.length<=3){if(t===e)return!0}else if(/\d/.test(e)){if(t.startsWith(e)||t.endsWith(e))return!0}else if(t.includes(e))return!0}return!1}maxValue(){return Number.MAX_SAFE_INTEGER}}class B_ extends f0("InvalidRouteConfig"){constructor(e,t){super({reason:t?`Expected route config to have a ${t} for key ${e} but none was found.`:`Encountered an invalid route config during backfilling. ${e} was not found.`})}}class Bk extends f0("UnknownFileType"){constructor(e){super({reason:`Could not determine type for ${e}`})}}class BO extends f0("InvalidFileType"){constructor(e,t){super({reason:`File type ${e} not allowed for ${t}`})}}class BE extends f0("InvalidFileSize"){constructor(e){super({reason:`Invalid file size: ${e}`})}}function BC(e){return{maxFileSize:"image"===e?"4MB":"video"===e?"16MB":"audio"===e||"blob"===e?"8MB":"pdf"===e?"4MB":"text"===e?"64KB":"4MB",maxFileCount:1,minFileCount:1,contentDisposition:"inline"}}let BR=e=>{if(Array.isArray(e))return fC(e.reduce((e,t)=>(e[t]=BC(t),e),{}));let t={};for(let s of BN(e)){let i=e[s];if(!i)return fR(new B_(s));t[s]={...BC(s),...i}}return fC(JSON.parse(JSON.stringify(t,BM)))},BI=(e,t)=>{let s=e.type||function(e){if(!e||"string"!=typeof e)return!1;let t=(function(e){let t=e.lastIndexOf(".");return t<0?"":e.substring(t)})("x."+e).toLowerCase().substring(1);return!!t&&((function(e,t){if(Bv)return;Bv=!0;let s=["nginx","apache",void 0,"iana"];Object.keys(Bb).forEach(i=>{let n=Bb[i],r=n.extensions;if(r?.length)for(let a of(e[i]=r,r)){if(t[a]){let e=s.indexOf(Bb[t[a]].source),i=s.indexOf(n.source);if("application/octet-stream"!==t[a]&&(e>i||e===i&&t[a].startsWith("application/")))continue}t[a]=i}})}(Bx,By),By)[t]||!1)}(e.name);if(!s)return t.includes("blob")?fC("blob"):fR(new Bk(e.name));if(t.some(e=>e.includes("/"))&&t.includes(s))return fC(s);let i="application/pdf"===s.toLowerCase()?"pdf":s.split("/")[0];return t.includes(i)?fC(i):t.includes("blob")?fC("blob"):fR(new BO(i,e.name))},BT=["B","KB","MB","GB"],BF=e=>{let t=RegExp(`^(\\d+)(\\.\\d+)?\\s*(${BT.join("|")})$`,"i"),s=e.match(t);if(!s)return fR(new BE(e));let i=parseFloat(s[1]),n=s[3].toUpperCase();return fC(Math.floor(i*Math.pow(1024,BT.indexOf(n))))},BA=e=>{if(0===e||-1===e)return"0B";let t=Math.floor(Math.log(e)/Math.log(1e3));return`${(e/Math.pow(1e3,t)).toFixed(2)}${BT[t]}`};function BN(e){return Object.keys(e)}let BM=(e,t)=>"number"!=typeof t||Number.isSafeInteger(t)||t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER?t:t===1/0?Number.MAX_SAFE_INTEGER:t===-1/0?Number.MIN_SAFE_INTEGER:Number.isNaN(t)?0:void 0,Bj={BAD_REQUEST:400,NOT_FOUND:404,FORBIDDEN:403,INTERNAL_SERVER_ERROR:500,INTERNAL_CLIENT_ERROR:500,TOO_LARGE:413,TOO_SMALL:400,TOO_MANY_FILES:400,KEY_TOO_LONG:400,URL_GENERATION_FAILED:500,UPLOAD_FAILED:500,MISSING_ENV:500,INVALID_SERVER_CONFIG:500,FILE_LIMIT_EXCEEDED:500};class Bz extends fZ{constructor(e){let t="string"==typeof e?{code:"INTERNAL_SERVER_ERROR",message:e}:e;super({message:t.message??function(e,t){return"string"==typeof e?e:e instanceof Error||e&&"object"==typeof e&&"message"in e&&"string"==typeof e.message?e.message:t??"An unknown error occurred"}(t.cause,t.code)}),this._tag="UploadThingError",this.name="UploadThingError",this.code=t.code,this.data=t.data,t.cause instanceof Error?this.cause=t.cause:el(t.cause)&&W(t.cause.status)&&J(t.cause.statusText)?this.cause=Error(`Response ${t.cause.status} ${t.cause.statusText}`):J(t.cause)?this.cause=Error(t.cause):this.cause=t.cause}static toObject(e){return{code:e.code,message:e.message,data:e.data}}static serialize(e){return JSON.stringify(Bz.toObject(e))}}let BP="hmac-sha256=",BD={name:"HMAC",hash:"SHA-256"},BL=new TextEncoder,B$=(e,t)=>fD(function*(){let s=yield*fP({try:()=>crypto.subtle.importKey("raw",BL.encode(Aw(t)),BD,!1,["sign"]),catch:e=>new Bz({code:"BAD_REQUEST",message:"Invalid signing secret",cause:e})}),i=yield*fL(fP({try:()=>crypto.subtle.sign(BD,s,BL.encode(e)),catch:e=>new Bz({code:"BAD_REQUEST",cause:e})}),e=>Nk(new Uint8Array(e)));return`${BP}${i}`}).pipe(fV("signPayload")),BU=(e,t,s)=>fD(function*(){let i=t?.slice(BP.length);if(!i)return!1;let n=BL.encode(Aw(s)),r=yield*fz(()=>crypto.subtle.importKey("raw",n,BD,!1,["verify"])),a=yield*fA(NO(i)),o=BL.encode(e);return yield*fz(()=>crypto.subtle.verify(BD,r,a,o))}).pipe(fV("verifySignature"),fK(()=>!1)),BB=(e,t,s)=>fF(()=>{let i=JSON.stringify(s?.(e)??[e.name,e.size,e.type,e.lastModified,Date.now()]),n=function(e,t){let s,i;let n=e.split(""),r=eR(t);for(let e=0;e<n.length;e++)i=(r%(e+1)+e)%n.length,s=n[e],n[e]=n[i],n[i]=s;return n.join("")}(Bw.alphabet,t),r=new BS({alphabet:n,minLength:36}).encode([Math.abs(eR(i))]);return new BS({alphabet:n,minLength:12}).encode([Math.abs(eR(t))])+r}).pipe(fV("generateKey")),Bq=(e,t,s)=>fD(function*(){let i=new URL(e),n=s.ttlInSeconds?function(e){if("number"==typeof e)return e;let t=e.split(/(\d+)/).filter(Boolean);return Number(t[0])*({s:1,m:60,h:3600,d:86400})[(t[1]??"s").trim().slice(0,1)]}(s.ttlInSeconds):3600,r=Date.now()+1e3*n;i.searchParams.append("expires",r.toString()),s.data&&Object.entries(s.data).forEach(([e,t])=>{if(null==t)return;let s=encodeURIComponent(t);i.searchParams.append(e,s)});let a=yield*B$(i.toString(),t);return i.searchParams.append("signature",a),i.href}).pipe(fV("generateSignedURL")),BH=e=>pg(new Map(s8(pL(e),([e,t])=>[pD(e).join("\uFEFF"),t])),{pathDelim:"\uFEFF",seqDelim:"\uFEFF"}),BJ=M(2,(e,t)=>e.log({fiberId:rq,logLevel:lQ,message:t,cause:oG,context:dp(),spans:ar(),annotations:nZ(),date:new Date})),BW=gU,BK=gq,BV=kr,BG=ka,BY=ko,BX=gH,BQ=gJ,BZ=gW,B0=gK,B1=yE,B2=yx,B3=e=>gq(t=>{let s=tN(dw(t.context,p1),pU).unsafe;switch(t.logLevel._tag){case"Debug":return s.debug(e.log(t));case"Info":return s.info(e.log(t));case"Trace":return s.trace(e.log(t));case"Warning":return s.warn(e.log(t));case"Error":case"Fatal":return s.error(e.log(t));default:return s.log(e.log(t))}}),B5=e=>gq(t=>{tN(dw(t.context,p1),pU).unsafe.error(e.log(t))}),B4={[gU]:gB,log:L,pipe(){return eY(this,arguments)}},B6=kc,B8=kl,B7=ku,B9=kh,qe=gV,qt=e=>gV(()=>e),qs=e=>gV(e),qi=BJ,qn=kn,qr=e=>gJ(e,e=>{let t=sr(dv(e.context,uh),tM(pY));return"None"===t._tag?e:{...e,annotations:$(e.annotations,n5("effect.traceId",t.value.traceId),n5("effect.spanId",t.value.spanId),"Span"===t.value._tag?n5("effect.spanName",t.value.name):j)}}),qa=gG,qo=gY,qc=gX,ql=yy,qu=g4,qh=g2,qp=gQ,qd=bl,qf=bp,qm=g3,qg=yk,qb=B8(yy,yv),qx=B8(yy,yw),qy=B8(yy,yS),qv=B8(yy,y_),qw=e=>SS(y6(yb,e)),qS=e=>"object"==typeof e&&null!=e&&gU in e;function q_(e,t){return lr(e.runtimeEffect,e=>cW(s=>(s.setFiberRefs(e.fiberRefs),s.currentRuntimeFlags=e.runtimeFlags,hS(t,e.context))))}let qk={...tc,[wj]:wj,pipe(){return eY(this,arguments)},commit(){return this.runtimeEffect}},qO=(e,t)=>{let s;t=t??So();let i=w8(y3()),n=cW(n=>(s||(s=w5(lF(y5(SC(e,t),i),e=>{r.cachedRuntime=e}),{scope:i,scheduler:n.currentScheduler})),lc(s.await))),r=Object.assign(Object.create(qk),{memoMap:t,scope:i,runtimeEffect:n,cachedRuntime:void 0,runtime:()=>void 0===r.cachedRuntime?w4(r.runtimeEffect):Promise.resolve(r.cachedRuntime),dispose:()=>w4(r.disposeEffect),disposeEffect:lI(()=>(r.runtimeEffect=c4("ManagedRuntime disposed"),r.cachedRuntime=void 0,uA(r.scope,hi))),runFork:(e,t)=>void 0===r.cachedRuntime?w5(q_(r,e),t):w$(r.cachedRuntime)(e,t),runSyncExit:e=>void 0===r.cachedRuntime?w7(q_(r,e)):wY(r.cachedRuntime)(e),runSync:e=>void 0===r.cachedRuntime?w8(q_(r,e)):wB(r.cachedRuntime)(e),runPromiseExit:(e,t)=>void 0===r.cachedRuntime?w6(q_(r,e),t):wQ(r.cachedRuntime)(e,t),runCallback:(e,t)=>void 0===r.cachedRuntime?wU(w3)(q_(r,e),t):wU(r.cachedRuntime)(e,t),runPromise:(e,t)=>void 0===r.cachedRuntime?w4(q_(r,e),t):wX(r.cachedRuntime)(e,t)});return r},qE=Symbol("uploadthing-custom-id-symbol");var qC="7.4.0";zV("inline","attachment"),zV("public-read","private");let qR=zV("upload"),qI=zV("callback","error"),qT=PK(P4,z3,{decode:e=>new TextDecoder().decode(e),encode:e=>new TextEncoder().encode(e)}),qF=PR({apiKey:(e=>PK(e,P5(zU(e)),{strict:!0,decode:e=>Av(e),encode:e=>Aw(e)}))(z3.pipe(((e,t)=>s=>s.pipe(PH(t=>t.startsWith(e),{schemaId:PG,[PG]:{startsWith:e},description:`a string starting with ${JSON.stringify(e)}`,jsonSchema:{pattern:`^${e}`},...t})))("sk_"))),appId:z3,regions:Pa(z3),ingestHost:z3.pipe(Pk({default:()=>"ingest.uploadthing.com"}))}),qA=P6.pipe(PD(qT),PD(PQ(qF)));class qN extends Do("FileUploadData")({name:z3,size:z5,type:z3,lastModified:z5.pipe(P_)}){}class qM extends qN.extend("FileUploadDataWithCustomId")({customId:z9(z3)}){}class qj extends qM.extend("UploadedFileData")({key:z3,url:z3,appUrl:z3,fileHash:z3}){}class qz extends Do("MetadataFetchStreamPart")({payload:z3,signature:z3,hook:qI}){}class qP extends Do("MetadataFetchResponse")({ok:z4}){}class qD extends Do("CallbackResultResponse")({ok:z4}){}class qL extends Do("UploadActionPayload")({files:Pr(qN),input:z2}){}let q$=pm().pipe(pk(()=>pg(new Map(Object.entries(Object.fromEntries(Object.entries({}).filter(e=>null!=e[1])))),{pathDelim:"_"})),p_("uploadthing"),e=>pw(e,po)),qU=e=>BH(e??{}).pipe(pk(()=>q$)),qB=(e=>{let t=AJ("a boolean property",e=>{switch(e){case"true":case"yes":case"on":case"1":return tV(!0);case"false":case"no":case"off":case"0":return tV(!1);default:return tK(hJ([],`Expected a boolean value but received ${e}`))}});return void 0===e?t:AB(t,e)})("isDev").pipe(Aq(()=>AK("undefined"!=typeof process?"production":void 0).pipe(AL(e=>"development"===e))),AG(!1)),qq=((e,t)=>{let s=zH(t);return AW(e).pipe(AU(e=>s(e).pipe(tG(e=>hJ([],zu.formatErrorSync(e))))))})("token",qA).pipe(mK({ConfigError:e=>new Bz({code:"InvalidData"===e._op?"INVALID_SERVER_CONFIG":"MISSING_ENV",message:"InvalidData"===e._op?"Invalid token. A token is a base64 encoded JSON object matching { apiKey: string, appId: string, regions: string[] }.":"Missing token. Please set the `UPLOADTHING_TOKEN` environment variable or provide a token manually through config.",cause:e})}));AW("apiUrl").pipe(AG("https://api.uploadthing.com"),A$(e=>new URL(e)),AL(e=>e.href.replace(/\/$/,"")));let qH=_f(function*(){let{regions:e,ingestHost:t}=yield*qq,s=e[0];return yield*AW("ingestUrl").pipe(AG(`https://${s}.${t}`),A$(e=>new URL(e)),AL(e=>e.href.replace(/\/$/,"")))});function qJ(e){return{message:e.message}}function qW(e,t){return(t[Object.keys(t)[0]]?.errorFormatter??qJ)(e)}let qK=(e,t)=>s=>{let i="";return s.pipe(F$(),FW(e=>_f(function*(){let t=(i+=e).split("\n"),s=[];for(let e of t)try{s.push(JSON.parse(e)),i=i.slice(e.length+1)}catch{}return yield*m5("Received chunks").pipe(mB("chunk",e),mB("parsedChunks",s),mB("buf",i)),s})),FW(zB(Pr(e))),FW(yN(e=>t(e))),FX,m7("handleJsonLineStream"))},qV=(e=>{let t=AU(AW(),e=>{let t=e.toUpperCase(),s=l2.find(e=>e.label===t);return void 0===s?tK(hJ([],`Expected a log level but received ${e}`)):tV(s)});return void 0===e?t:AB(t,e)})("logLevel").pipe(AG(lQ),la(e=>qw(e)),gl(e=>m8("Invalid log level").pipe(mB("error",e))),mW("ConfigError",e=>new Bz({code:"INVALID_SERVER_CONFIG",message:"Invalid server configuration",cause:e})),SF),qG=((...e)=>t=>{let s=e.map(String).join(", "),i=AJ(`one of (${s})`,t=>{let i=e.find(e=>String(e)===t);return void 0===i?tK(hJ([],`Expected one of (${s}) but received ${t}`)):tV(i)});return void 0===t?i:AB(i,t)})("json","logFmt","structured","pretty")("logFormat"),qY=_f(function*(){let e=yield*qB;return I[yield*qG.pipe(AG(e?"pretty":"json"))]}).pipe(mW("ConfigError",e=>new Bz({code:"INVALID_SERVER_CONFIG",message:"Invalid server configuration",cause:e})),SF),qX=(e,t)=>{let s=t?.mixin??"json",i=dV(t?.level??"Debug");return t=>lr("None"!==s?t[s]:lz,()=>_y(i,`${e} (${t.status})`).pipe(mB("response",t)))},qQ=e=>t=>"ResponseError"===t._tag?qX(e,{level:"Error"})(t.response):m8(e).pipe(mB("error",t));class qZ extends FZ("ParserError"){constructor(...e){super(...e),this.message="Input validation failed. The original error with it's validation issues is in the error cause."}}class q0 extends FQ{constructor(e,t,s){super({reason:`You uploaded a ${e} file that was ${BA(s)}, but the limit for that type is ${t}`}),this._tag="FileSizeMismatch",this.name="FileSizeMismatchError"}}class q1 extends FQ{constructor(e,t,s,i){super({reason:`You uploaded ${i} file(s) of type '${e}', but the ${t} for that type is ${s}`}),this._tag="FileCountMismatch",this.name="FileCountMismatchError"}}let q2=(e,t)=>_f(function*(){let s={};for(let i of e){let e=yield*BI(i,BN(t));s[e]=(s[e]??0)+1;let n=t[e]?.maxFileSize;if(!n)return yield*new B_(e,"maxFileSize");let r=yield*BF(n);if(i.size>r)return yield*new q0(e,n,i.size)}for(let e in s){let i=t[e];if(!i)return yield*new B_(e);let n=s[e],r=i.minFileCount,a=i.maxFileCount;if(r>a)return yield*new Bz({code:"BAD_REQUEST",message:"Invalid config during file count - minFileCount > maxFileCount",cause:`minFileCount must be less than maxFileCount for key ${e}. got: ${r} > ${a}`});if(n<r)return yield*new q1(e,"minimum",r,n);if(n>a)return yield*new q1(e,"maximum",a,n)}return null}),q3=e=>yN(BN(e),t=>ly(BR(e[t].routerConfig),e=>({slug:t,config:e}))),q5=(e,t)=>qO(SR(Sv(qY,qV,SI(L7,Sk(L9,e)),kd(l9(DJ,e=>e.concat(["x-uploadthing-api-key"])))),kf(qU(t))));class q4 extends tL("uploadthing/AdapterArguments")(){}let q6=(e,t,s,i)=>{let n=q5(s.config?.fetch,s.config),r=_m(()=>n.runtime().then(UA)),a=(...t)=>ly(_m(()=>n.runPromise(q8(s,i))),gn(q4,e(...t)));return async(...e)=>await r.pipe(_w(a(...e)),_w(t(...e)),m7("requestHandler"),n.runPromise)},q8=(e,t)=>_f(function*(){let s=yield*qB,i=yield*q3(e.router),n=e.config?.handleDaemonPromise?e.config.handleDaemonPromise:s?"void":"await";if(s&&"await"===n)return yield*new Bz({code:"INVALID_SERVER_CONFIG",message:'handleDaemonPromise: "await" is forbidden in development.'});let r=_f(function*(){return yield*$o(i)}),a=_f(function*(){let{"uploadthing-hook":s,"x-uploadthing-package":i,"x-uploadthing-version":r}=yield*US(PR({"uploadthing-hook":qI.pipe(P_),"x-uploadthing-package":z3.pipe(Pk({default:()=>"unknown"})),"x-uploadthing-version":z3.pipe(Pk({default:()=>qC}))}));r!==qC&&(yield*m6("Client version mismatch. Things may not work as expected, please sync your versions to ensure compatibility.").pipe(mB({clientVersion:r,serverVersion:qC})));let{slug:a,actionType:o}=yield*Ba(PR({actionType:qR.pipe(P_),slug:z3})),c=e.router[a];if(!c){let e=`No file route found for slug ${a}`;return yield*m8(e),yield*new Bz({code:"NOT_FOUND",message:e})}let{body:l,fiber:u}=yield*Bf({actionType:o,uploadthingHook:s}).pipe(Bm({actionType:"upload",uploadthingHook:void 0},()=>Ht({uploadable:c,fePackage:i,beAdapter:t,slug:a})),Bm({actionType:void 0,uploadthingHook:"callback"},()=>q9({uploadable:c,fePackage:i,beAdapter:t})),Bm({actionType:void 0,uploadthingHook:"error"},()=>q7({uploadable:c})),Bg(()=>lR({body:null,fiber:null})));return u&&(yield*m5("Running fiber as daemon").pipe(mB("handleDaemon",n)),"void"===n||("await"===n?yield*u.await:"function"==typeof n&&n(w4(u.await)))),yield*m5("Sending response").pipe(mB("body",l)),yield*$o(l)}).pipe(mK({ParseError:t=>$o(qW(new Bz({code:"BAD_REQUEST",message:"Invalid input",cause:t.message}),e.router),{status:400}),UploadThingError:t=>$o(qW(t,e.router),{status:Bj[t.code]??500})})),o=ly($a("x-uploadthing-version",qC));return Be.pipe(Bi("*",r),Bn("*",a),Br(o))}).pipe(m7("createRequestHandler")),q7=e=>_f(function*(){let{uploadable:t}=e,s=yield*Ux,{apiKey:i}=yield*qq,n=yield*BU((yield*s.text),s.headers["x-uploadthing-signature"],i);if(yield*m5(`Signature verified: ${n}`),!n)return yield*m8("Invalid signature"),yield*new Bz({code:"BAD_REQUEST",message:"Invalid signature"});let r=yield*U_(PR({fileKey:z3,error:z3}));yield*m5("Handling error callback request with input:").pipe(mB("json",r));let a=yield*q4;return{body:null,fiber:yield*gh({try:async()=>t.onUploadError({...a,error:new Bz({code:"UPLOAD_FAILED",message:`Upload failed for ${r.fileKey}: ${r.error}`}),fileKey:r.fileKey}),catch:e=>new Bz({code:"INTERNAL_SERVER_ERROR",message:"Failed to run onUploadError",cause:e})}).pipe(gl(e=>m8("Failed to run onUploadError. You probably shouldn't be throwing errors here.").pipe(mB("error",e)))).pipe(_b,yP)}}).pipe(m7("handleErrorRequest")),q9=e=>_f(function*(){let{uploadable:t,fePackage:s,beAdapter:i}=e,n=yield*Ux,{apiKey:r}=yield*qq,a=yield*BU((yield*n.text),n.headers["x-uploadthing-signature"],r);if(yield*m5(`Signature verified: ${a}`),!a)return yield*m8("Invalid signature"),yield*new Bz({code:"BAD_REQUEST",message:"Invalid signature"});let o=yield*U_(PR({status:z3,file:qj,metadata:PT({key:z3,value:z2})}));return yield*m5("Handling callback request with input:").pipe(mB("json",o)),{body:null,fiber:yield*_f(function*(){let e=yield*q4,n=yield*gh({try:async()=>t.onUploadComplete({...e,file:o.file,metadata:o.metadata}),catch:e=>new Bz({code:"INTERNAL_SERVER_ERROR",message:"Failed to run onUploadComplete. You probably shouldn't be throwing errors here.",cause:e})}),a={fileKey:o.file.key,callbackData:n??null};yield*m5("'onUploadComplete' callback finished. Sending response to UploadThing:").pipe(mB("callbackData",a));let c=yield*qH,l=(yield*LW).pipe(Bo);yield*Lb("/callback-result").pipe(LT(c),LO({"x-uploadthing-api-key":Aw(r),"x-uploadthing-version":qC,"x-uploadthing-be-adapter":i,"x-uploadthing-fe-package":s}),Lj(a),lr(l.execute),gl(qQ("Failed to register callback result")),lr(LP(qD)),lF(m3("Sent callback result to UploadThing")),_x)}).pipe(_b,yP)}}).pipe(m7("handleCallbackRequest")),He=e=>_f(function*(){let{json:{files:t,input:s},uploadable:i}=e;yield*m5("Running middleware");let n=yield*q4,r=yield*gh({try:async()=>i.middleware({...n,input:s,files:t}),catch:e=>e instanceof Bz?e:new Bz({code:"INTERNAL_SERVER_ERROR",message:"Failed to run middleware",cause:e})});if(r[qE]&&r[qE].length!==t.length){let e=`Expected files override to have the same length as original files, got ${r[qE].length} but expected ${t.length}`;return yield*m8(e),yield*new Bz({code:"BAD_REQUEST",message:"Files override must have the same length as files",cause:e})}let a=yield*yN(t,(e,t)=>_f(function*(){let s=r[qE]?.[t];return s&&s.size!==e.size&&(yield*m6("File size mismatch. Reverting to original size")),{name:s?.name??e.name,size:e.size,type:e.type,customId:s?.customId,lastModified:s?.lastModified??Date.now()}}));return{metadata:r,filesWithCustomIds:a}}).pipe(m7("runRouteMiddleware")),Ht=e=>_f(function*(){let t=(yield*LW).pipe(Bo),{uploadable:s,fePackage:i,beAdapter:n,slug:r}=e,a=yield*U_(qL);yield*m5("Handling upload request").pipe(mB("json",a)),yield*m5("Parsing user input");let o=yield*gh({try:()=>(function(e){if("~standard"in e)return async t=>{let s=await e["~standard"].validate(t);if(s.issues)throw new qZ({cause:s.issues});return s.value};if("parseAsync"in e&&"function"==typeof e.parseAsync)return e.parseAsync;if(zJ(e))return t=>zq(e)(t).catch(e=>{throw new qZ({cause:wA(e[wW])})});throw Error("Invalid parser")})(s.inputParser)(a.input),catch:e=>new Bz({code:"BAD_REQUEST",message:"Invalid input",cause:e})});yield*m5("Input parsed successfully").pipe(mB("input",o));let{metadata:c,filesWithCustomIds:l}=yield*He({json:{input:o,files:a.files},uploadable:s});yield*m5("Parsing route config").pipe(mB("routerConfig",s.routerConfig));let u=yield*BR(s.routerConfig).pipe(mW("InvalidRouteConfig",e=>new Bz({code:"BAD_REQUEST",message:"Invalid route config",cause:e})));yield*m5("Route config parsed successfully").pipe(mB("routeConfig",u)),yield*m5("Validating files meet the config requirements").pipe(mB("files",a.files)),yield*q2(a.files,u).pipe(lw(e=>new Bz({code:"BAD_REQUEST",message:`Invalid config: ${e._tag}`,cause:"reason"in e?e.reason:e.message}))),yield*m5("Files validated.");let h=yield*yN(l,e=>ly(BI(e,BN(u)),t=>({name:e.name,size:e.size,type:e.type||t,lastModified:e.lastModified,customId:e.customId,contentDisposition:u[t]?.contentDisposition??"inline",acl:u[t]?.acl}))).pipe(mK({InvalidFileType:e=>c4(e),UnknownFileType:e=>c4(e)})),p=s.routeOptions,{apiKey:d,appId:f}=yield*qq,m=yield*qH,g=yield*qB;yield*m5("Generating presigned URLs").pipe(mB("fileUploadRequests",h),mB("ingestUrl",m));let b=yield*yN(h,e=>_f(function*(){let t=yield*BB(e,f,p.getFileHashParts);return{url:yield*Bq(`${m}/${t}`,d,{ttlInSeconds:p.presignedURLTTL,data:{"x-ut-identifier":f,"x-ut-file-name":e.name,"x-ut-file-size":e.size,"x-ut-file-type":e.type,"x-ut-slug":r,"x-ut-custom-id":e.customId,"x-ut-content-disposition":e.contentDisposition,"x-ut-acl":e.acl}}),key:t}}),{concurrency:"unbounded"}),x=yield*Ux,y=yield*UO(x),v=yield*AW("callbackUrl").pipe(AG(y.origin+y.pathname),ly(e=>Lb(e).pipe(LF("slug",r)))),w=Lb("/route-metadata").pipe(LT(m),LO({"x-uploadthing-api-key":Aw(d),"x-uploadthing-version":qC,"x-uploadthing-be-adapter":n,"x-uploadthing-fe-package":i}),Lj({fileKeys:b.map(({key:e})=>e),metadata:c,isDev:g,callbackUrl:v.url,callbackSlug:r,awaitServerData:p.awaitServerData??!0}),lr(t.execute)),S=yield*lf(g,{onTrue:()=>w.pipe(gc({onSuccess:qX("Registered metadata",{mixin:"None"}),onFailure:qQ("Failed to register metadata")}),Bc,qK(qz,e=>v.pipe(LO({"uploadthing-hook":e.hook,"x-uploadthing-signature":e.signature}),LM(Lo(e.payload,"application/json")),t.execute,gc({onSuccess:qX("Successfully forwarded callback request from dev stream"),onFailure:qQ("Failed to forward callback request from dev stream")}),mB(e),cG,_b,_x))),onFalse:()=>w.pipe(gc({onSuccess:qX("Registered metadata"),onFailure:qQ("Failed to register metadata")}),lr(LP(qP)),_x)}).pipe(yP),_=b.map((e,t)=>({url:e.url,key:e.key,name:h[t].name,customId:h[t].customId??null}));return yield*m4("Sending presigned URLs to client").pipe(mB("presignedUrls",_)),{body:_,fiber:S}}).pipe(m7("handleUploadAction"));var Hs=s(3900),Hi=s(401),Hn=s(6392),Hr=Object.defineProperty;((e,t)=>{for(var s in t)Hr(e,s,{get:t[s],enumerable:!0})})({},{UpstashError:()=>Ha,UrlError:()=>Ho});var Ha=class extends Error{constructor(e){super(e),this.name="UpstashError"}},Ho=class extends Error{constructor(e){super(`Upstash Redis client was passed an invalid URL. You should pass a URL starting with https. Received: "${e}". `),this.name="UrlError"}},Hc=class{baseUrl;headers;options;readYourWrites;upstashSyncToken="";hasCredentials;retry;constructor(e){if(this.options={backend:e.options?.backend,agent:e.agent,responseEncoding:e.responseEncoding??"base64",cache:e.cache,signal:e.signal,keepAlive:e.keepAlive??!0},this.upstashSyncToken="",this.readYourWrites=e.readYourWrites??!0,this.baseUrl=(e.baseUrl||"").replace(/\/$/,""),this.baseUrl&&!/^https?:\/\/[^\s#$./?].\S*$/.test(this.baseUrl))throw new Ho(this.baseUrl);this.headers={"Content-Type":"application/json",...e.headers},this.hasCredentials=!!(this.baseUrl&&this.headers.authorization.split(" ")[1]),"base64"===this.options.responseEncoding&&(this.headers["Upstash-Encoding"]="base64"),this.retry="boolean"!=typeof e.retry||e.retry?{attempts:e.retry?.retries??5,backoff:e.retry?.backoff??(e=>50*Math.exp(e))}:{attempts:1,backoff:()=>0}}mergeTelemetry(e){this.headers=Hh(this.headers,"Upstash-Telemetry-Runtime",e.runtime),this.headers=Hh(this.headers,"Upstash-Telemetry-Platform",e.platform),this.headers=Hh(this.headers,"Upstash-Telemetry-Sdk",e.sdk)}async request(e){let t={cache:this.options.cache,method:"POST",headers:this.headers,body:JSON.stringify(e.body),keepalive:this.options.keepAlive,agent:this.options.agent,signal:this.options.signal,backend:this.options.backend};if(this.hasCredentials||console.warn("[Upstash Redis] Redis client was initialized without url or token. Failed to execute command."),this.readYourWrites){let e=this.upstashSyncToken;this.headers["upstash-sync-token"]=e}let s=null,i=null;for(let n=0;n<=this.retry.attempts;n++)try{s=await fetch([this.baseUrl,...e.path??[]].join("/"),t);break}catch(e){if(this.options.signal?.aborted){s=new Response(new Blob([JSON.stringify({result:this.options.signal.reason??"Aborted"})]),{status:200,statusText:this.options.signal.reason??"Aborted"});break}i=e,await new Promise(e=>setTimeout(e,this.retry.backoff(n)))}if(!s)throw i??Error("Exhausted all retries");let n=await s.json();if(!s.ok)throw new Ha(`${n.error}, command was: ${JSON.stringify(e.body)}`);if(this.readYourWrites||this.readYourWrites){let e=s.headers;this.upstashSyncToken=e.get("upstash-sync-token")??""}return"base64"===this.options.responseEncoding?Array.isArray(n)?n.map(({result:e,error:t})=>({result:Hu(e),error:t})):{result:Hu(n.result),error:n.error}:n}};function Hl(e){let t="";try{let s=atob(e),i=s.length,n=new Uint8Array(i);for(let e=0;e<i;e++)n[e]=s.charCodeAt(e);t=new TextDecoder().decode(n)}catch{t=e}return t}function Hu(e){let t;switch(typeof e){case"undefined":return e;case"number":t=e;break;case"object":t=Array.isArray(e)?e.map(e=>"string"==typeof e?Hl(e):Array.isArray(e)?e.map(e=>Hu(e)):e):null;break;case"string":t="OK"===e?"OK":Hl(e)}return t}function Hh(e,t,s){return s&&(e[t]=e[t]?[e[t],s].join(","):s),e}function Hp(e){try{return function e(t){let s=Array.isArray(t)?t.map(t=>{try{return e(t)}catch{return t}}):JSON.parse(t);return"number"==typeof s&&s.toString()!==t?t:s}(e)}catch{return e}}function Hd(e){return[e[0],...Hp(e.slice(1))]}var Hf=e=>{switch(typeof e){case"string":case"number":case"boolean":return e;default:return JSON.stringify(e)}},Hm=class{command;serialize;deserialize;constructor(e,t){if(this.serialize=Hf,this.deserialize=t?.automaticDeserialization===void 0||t.automaticDeserialization?t?.deserialize??Hp:e=>e,this.command=e.map(e=>this.serialize(e)),t?.latencyLogging){let e=this.exec.bind(this);this.exec=async t=>{let s=performance.now(),i=await e(t),n=(performance.now()-s).toFixed(2);return console.log(`Latency for \x1b[38;2;19;185;39m${this.command[0].toString().toUpperCase()}\x1b[0m: \x1b[38;2;0;255;255m${n} ms\x1b[0m`),i}}}async exec(e){let{result:t,error:s}=await e.request({body:this.command,upstashSyncToken:e.upstashSyncToken});if(s)throw new Ha(s);if(void 0===t)throw TypeError("Request did not return a result");return this.deserialize(t)}},Hg=class extends Hm{constructor(e,t){let s=["hrandfield",e[0]];"number"==typeof e[1]&&s.push(e[1]),e[2]&&s.push("WITHVALUES"),super(s,{deserialize:e[2]?e=>(function(e){if(0===e.length)return null;let t={};for(;e.length>=2;){let s=e.shift(),i=e.shift();try{t[s]=JSON.parse(i)}catch{t[s]=i}}return t})(e):t?.deserialize,...t})}},Hb=class extends Hm{constructor(e,t){super(["append",...e],t)}},Hx=class extends Hm{constructor([e,t,s],i){let n=["bitcount",e];"number"==typeof t&&n.push(t),"number"==typeof s&&n.push(s),super(n,i)}},Hy=class{constructor(e,t,s,i=e=>e.exec(this.client)){this.client=t,this.opts=s,this.execOperation=i,this.command=["bitfield",...e]}command;chain(...e){return this.command.push(...e),this}get(...e){return this.chain("get",...e)}set(...e){return this.chain("set",...e)}incrby(...e){return this.chain("incrby",...e)}overflow(e){return this.chain("overflow",e)}exec(){let e=new Hm(this.command,this.opts);return this.execOperation(e)}},Hv=class extends Hm{constructor(e,t){super(["bitop",...e],t)}},Hw=class extends Hm{constructor(e,t){super(["bitpos",...e],t)}},HS=class extends Hm{constructor([e,t,s],i){super(["COPY",e,t,...s?.replace?["REPLACE"]:[]],{...i,deserialize:e=>e>0?"COPIED":"NOT_COPIED"})}},H_=class extends Hm{constructor(e){super(["dbsize"],e)}},Hk=class extends Hm{constructor(e,t){super(["decr",...e],t)}},HO=class extends Hm{constructor(e,t){super(["decrby",...e],t)}},HE=class extends Hm{constructor(e,t){super(["del",...e],t)}},HC=class extends Hm{constructor(e,t){super(["echo",...e],t)}},HR=class extends Hm{constructor([e,t,s],i){super(["eval",e,t.length,...t,...s??[]],i)}},HI=class extends Hm{constructor([e,t,s],i){super(["evalsha",e,t.length,...t,...s??[]],i)}},HT=class extends Hm{constructor(e,t){super(["exists",...e],t)}},HF=class extends Hm{constructor(e,t){super(["expire",...e.filter(Boolean)],t)}},HA=class extends Hm{constructor(e,t){super(["expireat",...e],t)}},HN=class extends Hm{constructor(e,t){let s=["flushall"];e&&e.length>0&&e[0].async&&s.push("async"),super(s,t)}},HM=class extends Hm{constructor([e],t){let s=["flushdb"];e?.async&&s.push("async"),super(s,t)}},Hj=class extends Hm{constructor([e,t,...s],i){let n=["geoadd",e];"nx"in t&&t.nx?n.push("nx"):"xx"in t&&t.xx&&n.push("xx"),"ch"in t&&t.ch&&n.push("ch"),"latitude"in t&&t.latitude&&n.push(t.longitude,t.latitude,t.member),n.push(...s.flatMap(({latitude:e,longitude:t,member:s})=>[t,e,s])),super(n,i)}},Hz=class extends Hm{constructor([e,t,s,i="M"],n){super(["GEODIST",e,t,s,i],n)}},HP=class extends Hm{constructor(e,t){let[s]=e;super(["GEOHASH",s,...Array.isArray(e[1])?e[1]:e.slice(1)],t)}},HD=class extends Hm{constructor(e,t){let[s]=e;super(["GEOPOS",s,...Array.isArray(e[1])?e[1]:e.slice(1)],{deserialize:e=>(function(e){let t=[];for(let s of e)s?.[0]&&s?.[1]&&t.push({lng:Number.parseFloat(s[0]),lat:Number.parseFloat(s[1])});return t})(e),...t})}},HL=class extends Hm{constructor([e,t,s,i,n],r){let a=["GEOSEARCH",e];("FROMMEMBER"===t.type||"frommember"===t.type)&&a.push(t.type,t.member),("FROMLONLAT"===t.type||"fromlonlat"===t.type)&&a.push(t.type,t.coordinate.lon,t.coordinate.lat),("BYRADIUS"===s.type||"byradius"===s.type)&&a.push(s.type,s.radius,s.radiusType),("BYBOX"===s.type||"bybox"===s.type)&&a.push(s.type,s.rect.width,s.rect.height,s.rectType),a.push(i),n?.count&&a.push("COUNT",n.count.limit,...n.count.any?["ANY"]:[]),super([...a,...n?.withCoord?["WITHCOORD"]:[],...n?.withDist?["WITHDIST"]:[],...n?.withHash?["WITHHASH"]:[]],{deserialize:e=>n?.withCoord||n?.withDist||n?.withHash?e.map(e=>{let t=1,s={};try{s.member=JSON.parse(e[0])}catch{s.member=e[0]}return n.withDist&&(s.dist=Number.parseFloat(e[t++])),n.withHash&&(s.hash=e[t++].toString()),n.withCoord&&(s.coord={long:Number.parseFloat(e[t][0]),lat:Number.parseFloat(e[t][1])}),s}):e.map(e=>{try{return{member:JSON.parse(e)}}catch{return{member:e}}}),...r})}},H$=class extends Hm{constructor([e,t,s,i,n,r],a){let o=["GEOSEARCHSTORE",e,t];("FROMMEMBER"===s.type||"frommember"===s.type)&&o.push(s.type,s.member),("FROMLONLAT"===s.type||"fromlonlat"===s.type)&&o.push(s.type,s.coordinate.lon,s.coordinate.lat),("BYRADIUS"===i.type||"byradius"===i.type)&&o.push(i.type,i.radius,i.radiusType),("BYBOX"===i.type||"bybox"===i.type)&&o.push(i.type,i.rect.width,i.rect.height,i.rectType),o.push(n),r?.count&&o.push("COUNT",r.count.limit,...r.count.any?["ANY"]:[]),super([...o,...r?.storeDist?["STOREDIST"]:[]],a)}},HU=class extends Hm{constructor(e,t){super(["get",...e],t)}},HB=class extends Hm{constructor(e,t){super(["getbit",...e],t)}},Hq=class extends Hm{constructor(e,t){super(["getdel",...e],t)}},HH=class extends Hm{constructor(e,t){super(["getrange",...e],t)}},HJ=class extends Hm{constructor(e,t){super(["getset",...e],t)}},HW=class extends Hm{constructor(e,t){super(["hdel",...e],t)}},HK=class extends Hm{constructor(e,t){super(["hexists",...e],t)}},HV=class extends Hm{constructor(e,t){super(["hget",...e],t)}},HG=class extends Hm{constructor(e,t){super(["hgetall",...e],{deserialize:e=>(function(e){if(0===e.length)return null;let t={};for(;e.length>=2;){let s=e.shift(),i=e.shift();try{let e=!Number.isNaN(Number(i))&&!Number.isSafeInteger(Number(i));t[s]=e?i:JSON.parse(i)}catch{t[s]=i}}return t})(e),...t})}},HY=class extends Hm{constructor(e,t){super(["hincrby",...e],t)}},HX=class extends Hm{constructor(e,t){super(["hincrbyfloat",...e],t)}},HQ=class extends Hm{constructor([e],t){super(["hkeys",e],t)}},HZ=class extends Hm{constructor(e,t){super(["hlen",...e],t)}},H0=class extends Hm{constructor([e,...t],s){super(["hmget",e,...t],{deserialize:e=>(function(e,t){if(t.every(e=>null===e))return null;let s={};for(let[i,n]of e.entries())try{s[n]=JSON.parse(t[i])}catch{s[n]=t[i]}return s})(t,e),...s})}},H1=class extends Hm{constructor([e,t],s){super(["hmset",e,...Object.entries(t).flatMap(([e,t])=>[e,t])],s)}},H2=class extends Hm{constructor([e,t,s],i){let n=["hscan",e,t];s?.match&&n.push("match",s.match),"number"==typeof s?.count&&n.push("count",s.count),super(n,{deserialize:Hd,...i})}},H3=class extends Hm{constructor([e,t],s){super(["hset",e,...Object.entries(t).flatMap(([e,t])=>[e,t])],s)}},H5=class extends Hm{constructor(e,t){super(["hsetnx",...e],t)}},H4=class extends Hm{constructor(e,t){super(["hstrlen",...e],t)}},H6=class extends Hm{constructor(e,t){super(["hvals",...e],t)}},H8=class extends Hm{constructor(e,t){super(["incr",...e],t)}},H7=class extends Hm{constructor(e,t){super(["incrby",...e],t)}},H9=class extends Hm{constructor(e,t){super(["incrbyfloat",...e],t)}},Je=class extends Hm{constructor(e,t){super(["JSON.ARRAPPEND",...e],t)}},Jt=class extends Hm{constructor(e,t){super(["JSON.ARRINDEX",...e],t)}},Js=class extends Hm{constructor(e,t){super(["JSON.ARRINSERT",...e],t)}},Ji=class extends Hm{constructor(e,t){super(["JSON.ARRLEN",e[0],e[1]??"$"],t)}},Jn=class extends Hm{constructor(e,t){super(["JSON.ARRPOP",...e],t)}},Jr=class extends Hm{constructor(e,t){super(["JSON.ARRTRIM",e[0],e[1]??"$",e[2]??0,e[3]??0],t)}},Ja=class extends Hm{constructor(e,t){super(["JSON.CLEAR",...e],t)}},Jo=class extends Hm{constructor(e,t){super(["JSON.DEL",...e],t)}},Jc=class extends Hm{constructor(e,t){super(["JSON.FORGET",...e],t)}},Jl=class extends Hm{constructor(e,t){let s=["JSON.GET"];"string"==typeof e[1]?s.push(...e):(s.push(e[0]),e[1]&&(e[1].indent&&s.push("INDENT",e[1].indent),e[1].newline&&s.push("NEWLINE",e[1].newline),e[1].space&&s.push("SPACE",e[1].space)),s.push(...e.slice(2))),super(s,t)}},Ju=class extends Hm{constructor(e,t){super(["JSON.MGET",...e[0],e[1]],t)}},Jh=class extends Hm{constructor(e,t){let s=["JSON.MSET"];for(let t of e)s.push(t.key,t.path,t.value);super(s,t)}},Jp=class extends Hm{constructor(e,t){super(["JSON.NUMINCRBY",...e],t)}},Jd=class extends Hm{constructor(e,t){super(["JSON.NUMMULTBY",...e],t)}},Jf=class extends Hm{constructor(e,t){super(["JSON.OBJKEYS",...e],t)}},Jm=class extends Hm{constructor(e,t){super(["JSON.OBJLEN",...e],t)}},Jg=class extends Hm{constructor(e,t){super(["JSON.RESP",...e],t)}},Jb=class extends Hm{constructor(e,t){let s=["JSON.SET",e[0],e[1],e[2]];e[3]&&(e[3].nx?s.push("NX"):e[3].xx&&s.push("XX")),super(s,t)}},Jx=class extends Hm{constructor(e,t){super(["JSON.STRAPPEND",...e],t)}},Jy=class extends Hm{constructor(e,t){super(["JSON.STRLEN",...e],t)}},Jv=class extends Hm{constructor(e,t){super(["JSON.TOGGLE",...e],t)}},Jw=class extends Hm{constructor(e,t){super(["JSON.TYPE",...e],t)}},JS=class extends Hm{constructor(e,t){super(["keys",...e],t)}},J_=class extends Hm{constructor(e,t){super(["lindex",...e],t)}},Jk=class extends Hm{constructor(e,t){super(["linsert",...e],t)}},JO=class extends Hm{constructor(e,t){super(["llen",...e],t)}},JE=class extends Hm{constructor(e,t){super(["lmove",...e],t)}},JC=class extends Hm{constructor(e,t){let[s,i,n,r]=e;super(["LMPOP",s,...i,n,...r?["COUNT",r]:[]],t)}},JR=class extends Hm{constructor(e,t){super(["lpop",...e],t)}},JI=class extends Hm{constructor(e,t){let s=["lpos",e[0],e[1]];"number"==typeof e[2]?.rank&&s.push("rank",e[2].rank),"number"==typeof e[2]?.count&&s.push("count",e[2].count),"number"==typeof e[2]?.maxLen&&s.push("maxLen",e[2].maxLen),super(s,t)}},JT=class extends Hm{constructor(e,t){super(["lpush",...e],t)}},JF=class extends Hm{constructor(e,t){super(["lpushx",...e],t)}},JA=class extends Hm{constructor(e,t){super(["lrange",...e],t)}},JN=class extends Hm{constructor(e,t){super(["lrem",...e],t)}},JM=class extends Hm{constructor(e,t){super(["lset",...e],t)}},Jj=class extends Hm{constructor(e,t){super(["ltrim",...e],t)}},Jz=class extends Hm{constructor(e,t){super(["mget",...Array.isArray(e[0])?e[0]:e],t)}},JP=class extends Hm{constructor([e],t){super(["mset",...Object.entries(e).flatMap(([e,t])=>[e,t])],t)}},JD=class extends Hm{constructor([e],t){super(["msetnx",...Object.entries(e).flat()],t)}},JL=class extends Hm{constructor(e,t){super(["persist",...e],t)}},J$=class extends Hm{constructor(e,t){super(["pexpire",...e],t)}},JU=class extends Hm{constructor(e,t){super(["pexpireat",...e],t)}},JB=class extends Hm{constructor(e,t){super(["pfadd",...e],t)}},Jq=class extends Hm{constructor(e,t){super(["pfcount",...e],t)}},JH=class extends Hm{constructor(e,t){super(["pfmerge",...e],t)}},JJ=class extends Hm{constructor(e,t){let s=["ping"];e?.[0]!==void 0&&s.push(e[0]),super(s,t)}},JW=class extends Hm{constructor(e,t){super(["psetex",...e],t)}},JK=class extends Hm{constructor(e,t){super(["pttl",...e],t)}},JV=class extends Hm{constructor(e,t){super(["publish",...e],t)}},JG=class extends Hm{constructor(e){super(["randomkey"],e)}},JY=class extends Hm{constructor(e,t){super(["rename",...e],t)}},JX=class extends Hm{constructor(e,t){super(["renamenx",...e],t)}},JQ=class extends Hm{constructor(e,t){super(["rpop",...e],t)}},JZ=class extends Hm{constructor(e,t){super(["rpush",...e],t)}},J0=class extends Hm{constructor(e,t){super(["rpushx",...e],t)}},J1=class extends Hm{constructor(e,t){super(["sadd",...e],t)}},J2=class extends Hm{constructor([e,t],s){let i=["scan",e];t?.match&&i.push("match",t.match),"number"==typeof t?.count&&i.push("count",t.count),t?.type&&t.type.length>0&&i.push("type",t.type),super(i,{deserialize:Hd,...s})}},J3=class extends Hm{constructor(e,t){super(["scard",...e],t)}},J5=class extends Hm{constructor(e,t){super(["script","exists",...e],{deserialize:e=>e,...t})}},J4=class extends Hm{constructor([e],t){let s=["script","flush"];e?.sync?s.push("sync"):e?.async&&s.push("async"),super(s,t)}},J6=class extends Hm{constructor(e,t){super(["script","load",...e],t)}},J8=class extends Hm{constructor(e,t){super(["sdiff",...e],t)}},J7=class extends Hm{constructor(e,t){super(["sdiffstore",...e],t)}},J9=class extends Hm{constructor([e,t,s],i){let n=["set",e,t];s&&("nx"in s&&s.nx?n.push("nx"):"xx"in s&&s.xx&&n.push("xx"),"get"in s&&s.get&&n.push("get"),"ex"in s&&"number"==typeof s.ex?n.push("ex",s.ex):"px"in s&&"number"==typeof s.px?n.push("px",s.px):"exat"in s&&"number"==typeof s.exat?n.push("exat",s.exat):"pxat"in s&&"number"==typeof s.pxat?n.push("pxat",s.pxat):"keepTtl"in s&&s.keepTtl&&n.push("keepTtl")),super(n,i)}},We=class extends Hm{constructor(e,t){super(["setbit",...e],t)}},Wt=class extends Hm{constructor(e,t){super(["setex",...e],t)}},Ws=class extends Hm{constructor(e,t){super(["setnx",...e],t)}},Wi=class extends Hm{constructor(e,t){super(["setrange",...e],t)}},Wn=class extends Hm{constructor(e,t){super(["sinter",...e],t)}},Wr=class extends Hm{constructor(e,t){super(["sinterstore",...e],t)}},Wa=class extends Hm{constructor(e,t){super(["sismember",...e],t)}},Wo=class extends Hm{constructor(e,t){super(["smembers",...e],t)}},Wc=class extends Hm{constructor(e,t){super(["smismember",e[0],...e[1]],t)}},Wl=class extends Hm{constructor(e,t){super(["smove",...e],t)}},Wu=class extends Hm{constructor([e,t],s){let i=["spop",e];"number"==typeof t&&i.push(t),super(i,s)}},Wh=class extends Hm{constructor([e,t],s){let i=["srandmember",e];"number"==typeof t&&i.push(t),super(i,s)}},Wp=class extends Hm{constructor(e,t){super(["srem",...e],t)}},Wd=class extends Hm{constructor([e,t,s],i){let n=["sscan",e,t];s?.match&&n.push("match",s.match),"number"==typeof s?.count&&n.push("count",s.count),super(n,{deserialize:Hd,...i})}},Wf=class extends Hm{constructor(e,t){super(["strlen",...e],t)}},Wm=class extends Hm{constructor(e,t){super(["sunion",...e],t)}},Wg=class extends Hm{constructor(e,t){super(["sunionstore",...e],t)}},Wb=class extends Hm{constructor(e){super(["time"],e)}},Wx=class extends Hm{constructor(e,t){super(["touch",...e],t)}},Wy=class extends Hm{constructor(e,t){super(["ttl",...e],t)}},Wv=class extends Hm{constructor(e,t){super(["type",...e],t)}},Ww=class extends Hm{constructor(e,t){super(["unlink",...e],t)}},WS=class extends Hm{constructor([e,t,s],i){super(["XACK",e,t,...Array.isArray(s)?[...s]:[s]],i)}},W_=class extends Hm{constructor([e,t,s,i],n){let r=["XADD",e];for(let[e,n]of(i&&(i.nomkStream&&r.push("NOMKSTREAM"),i.trim&&(r.push(i.trim.type,i.trim.comparison,i.trim.threshold),void 0!==i.trim.limit&&r.push("LIMIT",i.trim.limit))),r.push(t),Object.entries(s)))r.push(e,n);super(r,n)}},Wk=class extends Hm{constructor([e,t,s,i,n,r],a){let o=[];r?.count&&o.push("COUNT",r.count),r?.justId&&o.push("JUSTID"),super(["XAUTOCLAIM",e,t,s,i,n,...o],a)}},WO=class extends Hm{constructor([e,t,s,i,n,r],a){let o=Array.isArray(n)?[...n]:[n],c=[];r?.idleMS&&c.push("IDLE",r.idleMS),r?.idleMS&&c.push("TIME",r.timeMS),r?.retryCount&&c.push("RETRYCOUNT",r.retryCount),r?.force&&c.push("FORCE"),r?.justId&&c.push("JUSTID"),r?.lastId&&c.push("LASTID",r.lastId),super(["XCLAIM",e,t,s,i,...o,...c],a)}},WE=class extends Hm{constructor([e,t],s){super(["XDEL",e,...Array.isArray(t)?[...t]:[t]],s)}},WC=class extends Hm{constructor([e,t],s){let i=["XGROUP"];switch(t.type){case"CREATE":i.push("CREATE",e,t.group,t.id),t.options&&(t.options.MKSTREAM&&i.push("MKSTREAM"),void 0!==t.options.ENTRIESREAD&&i.push("ENTRIESREAD",t.options.ENTRIESREAD.toString()));break;case"CREATECONSUMER":i.push("CREATECONSUMER",e,t.group,t.consumer);break;case"DELCONSUMER":i.push("DELCONSUMER",e,t.group,t.consumer);break;case"DESTROY":i.push("DESTROY",e,t.group);break;case"SETID":i.push("SETID",e,t.group,t.id),t.options?.ENTRIESREAD!==void 0&&i.push("ENTRIESREAD",t.options.ENTRIESREAD.toString());break;default:throw Error("Invalid XGROUP")}super(i,s)}},WR=class extends Hm{constructor([e,t],s){let i=[];"CONSUMERS"===t.type?i.push("CONSUMERS",e,t.group):i.push("GROUPS",e),super(["XINFO",...i],s)}},WI=class extends Hm{constructor(e,t){super(["XLEN",...e],t)}},WT=class extends Hm{constructor([e,t,s,i,n,r],a){super(["XPENDING",e,t,...r?.idleTime?["IDLE",r.idleTime]:[],s,i,n,...r?.consumer===void 0?[]:Array.isArray(r.consumer)?[...r.consumer]:[r.consumer]],a)}},WF=class extends Hm{constructor([e,t,s,i],n){let r=["XRANGE",e,t,s];"number"==typeof i&&r.push("COUNT",i),super(r,{deserialize:e=>(function(e){let t={};for(let s of e)for(;s.length>=2;){let e=s.shift(),i=s.shift();for((e in t)||(t[e]={});i.length>=2;){let s=i.shift(),n=i.shift();try{t[e][s]=JSON.parse(n)}catch{t[e][s]=n}}}return t})(e),...n})}},WA=class extends Hm{constructor([e,t,s],i){if(Array.isArray(e)&&Array.isArray(t)&&e.length!==t.length)throw Error("ERR Unbalanced XREAD list of streams: for each stream key an ID or '$' must be specified");let n=[];"number"==typeof s?.count&&n.push("COUNT",s.count),"number"==typeof s?.blockMS&&n.push("BLOCK",s.blockMS),n.push("STREAMS",...Array.isArray(e)?[...e]:[e],...Array.isArray(t)?[...t]:[t]),super(["XREAD",...n],i)}},WN=class extends Hm{constructor([e,t,s,i,n],r){if(Array.isArray(s)&&Array.isArray(i)&&s.length!==i.length)throw Error("ERR Unbalanced XREADGROUP list of streams: for each stream key an ID or '$' must be specified");let a=[];"number"==typeof n?.count&&a.push("COUNT",n.count),"number"==typeof n?.blockMS&&a.push("BLOCK",n.blockMS),"boolean"==typeof n?.NOACK&&n.NOACK&&a.push("NOACK"),a.push("STREAMS",...Array.isArray(s)?[...s]:[s],...Array.isArray(i)?[...i]:[i]),super(["XREADGROUP","GROUP",e,t,...a],r)}},WM=class extends Hm{constructor([e,t,s,i],n){let r=["XREVRANGE",e,t,s];"number"==typeof i&&r.push("COUNT",i),super(r,{deserialize:e=>(function(e){let t={};for(let s of e)for(;s.length>=2;){let e=s.shift(),i=s.shift();for((e in t)||(t[e]={});i.length>=2;){let s=i.shift(),n=i.shift();try{t[e][s]=JSON.parse(n)}catch{t[e][s]=n}}}return t})(e),...n})}},Wj=class extends Hm{constructor([e,t],s){let{limit:i,strategy:n,threshold:r,exactness:a="~"}=t;super(["XTRIM",e,n,a,r,...i?["LIMIT",i]:[]],s)}},Wz=class extends Hm{constructor([e,t,...s],i){let n=["zadd",e];"nx"in t&&t.nx?n.push("nx"):"xx"in t&&t.xx&&n.push("xx"),"ch"in t&&t.ch&&n.push("ch"),"incr"in t&&t.incr&&n.push("incr"),"lt"in t&&t.lt?n.push("lt"):"gt"in t&&t.gt&&n.push("gt"),"score"in t&&"member"in t&&n.push(t.score,t.member),n.push(...s.flatMap(({score:e,member:t})=>[e,t])),super(n,i)}},WP=class extends Hm{constructor(e,t){super(["zcard",...e],t)}},WD=class extends Hm{constructor(e,t){super(["zcount",...e],t)}},WL=class extends Hm{constructor(e,t){super(["zincrby",...e],t)}},W$=class extends Hm{constructor([e,t,s,i],n){let r=["zinterstore",e,t];Array.isArray(s)?r.push(...s):r.push(s),i&&("weights"in i&&i.weights?r.push("weights",...i.weights):"weight"in i&&"number"==typeof i.weight&&r.push("weights",i.weight),"aggregate"in i&&r.push("aggregate",i.aggregate)),super(r,n)}},WU=class extends Hm{constructor(e,t){super(["zlexcount",...e],t)}},WB=class extends Hm{constructor([e,t],s){let i=["zpopmax",e];"number"==typeof t&&i.push(t),super(i,s)}},Wq=class extends Hm{constructor([e,t],s){let i=["zpopmin",e];"number"==typeof t&&i.push(t),super(i,s)}},WH=class extends Hm{constructor([e,t,s,i],n){let r=["zrange",e,t,s];i?.byScore&&r.push("byscore"),i?.byLex&&r.push("bylex"),i?.rev&&r.push("rev"),i?.count!==void 0&&void 0!==i.offset&&r.push("limit",i.offset,i.count),i?.withScores&&r.push("withscores"),super(r,n)}},WJ=class extends Hm{constructor(e,t){super(["zrank",...e],t)}},WW=class extends Hm{constructor(e,t){super(["zrem",...e],t)}},WK=class extends Hm{constructor(e,t){super(["zremrangebylex",...e],t)}},WV=class extends Hm{constructor(e,t){super(["zremrangebyrank",...e],t)}},WG=class extends Hm{constructor(e,t){super(["zremrangebyscore",...e],t)}},WY=class extends Hm{constructor(e,t){super(["zrevrank",...e],t)}},WX=class extends Hm{constructor([e,t,s],i){let n=["zscan",e,t];s?.match&&n.push("match",s.match),"number"==typeof s?.count&&n.push("count",s.count),super(n,{deserialize:Hd,...i})}},WQ=class extends Hm{constructor(e,t){super(["zscore",...e],t)}},WZ=class extends Hm{constructor([e,t,s],i){let n=["zunion",e];Array.isArray(t)?n.push(...t):n.push(t),s&&("weights"in s&&s.weights?n.push("weights",...s.weights):"weight"in s&&"number"==typeof s.weight&&n.push("weights",s.weight),"aggregate"in s&&n.push("aggregate",s.aggregate),s.withScores&&n.push("withscores")),super(n,i)}},W0=class extends Hm{constructor([e,t,s,i],n){let r=["zunionstore",e,t];Array.isArray(s)?r.push(...s):r.push(s),i&&("weights"in i&&i.weights?r.push("weights",...i.weights):"weight"in i&&"number"==typeof i.weight&&r.push("weights",i.weight),"aggregate"in i&&r.push("aggregate",i.aggregate)),super(r,n)}},W1=class extends Hm{constructor(e,t){super(["zdiffstore",...e],t)}},W2=class extends Hm{constructor(e,t){let[s,i]=e;super(["zmscore",s,...i],t)}},W3=class{client;commands;commandOptions;multiExec;constructor(e){if(this.client=e.client,this.commands=[],this.commandOptions=e.commandOptions,this.multiExec=e.multiExec??!1,this.commandOptions?.latencyLogging){let e=this.exec.bind(this);this.exec=async t=>{let s=performance.now(),i=await (t?e(t):e()),n=(performance.now()-s).toFixed(2);return console.log(`Latency for \x1b[38;2;19;185;39m${this.multiExec?["MULTI-EXEC"]:["PIPELINE"].toString().toUpperCase()}\x1b[0m: \x1b[38;2;0;255;255m${n} ms\x1b[0m`),i}}}exec=async e=>{if(0===this.commands.length)throw Error("Pipeline is empty");let t=this.multiExec?["multi-exec"]:["pipeline"],s=await this.client.request({path:t,body:Object.values(this.commands).map(e=>e.command)});return e?.keepErrors?s.map(({error:e,result:t},s)=>({error:e,result:this.commands[s].deserialize(t)})):s.map(({error:e,result:t},s)=>{if(e)throw new Ha(`Command ${s+1} [ ${this.commands[s].command[0]} ] failed: ${e}`);return this.commands[s].deserialize(t)})};length(){return this.commands.length}chain(e){return this.commands.push(e),this}append=(...e)=>this.chain(new Hb(e,this.commandOptions));bitcount=(...e)=>this.chain(new Hx(e,this.commandOptions));bitfield=(...e)=>new Hy(e,this.client,this.commandOptions,this.chain.bind(this));bitop=(e,t,s,...i)=>this.chain(new Hv([e,t,s,...i],this.commandOptions));bitpos=(...e)=>this.chain(new Hw(e,this.commandOptions));copy=(...e)=>this.chain(new HS(e,this.commandOptions));zdiffstore=(...e)=>this.chain(new W1(e,this.commandOptions));dbsize=()=>this.chain(new H_(this.commandOptions));decr=(...e)=>this.chain(new Hk(e,this.commandOptions));decrby=(...e)=>this.chain(new HO(e,this.commandOptions));del=(...e)=>this.chain(new HE(e,this.commandOptions));echo=(...e)=>this.chain(new HC(e,this.commandOptions));eval=(...e)=>this.chain(new HR(e,this.commandOptions));evalsha=(...e)=>this.chain(new HI(e,this.commandOptions));exists=(...e)=>this.chain(new HT(e,this.commandOptions));expire=(...e)=>this.chain(new HF(e,this.commandOptions));expireat=(...e)=>this.chain(new HA(e,this.commandOptions));flushall=e=>this.chain(new HN(e,this.commandOptions));flushdb=(...e)=>this.chain(new HM(e,this.commandOptions));geoadd=(...e)=>this.chain(new Hj(e,this.commandOptions));geodist=(...e)=>this.chain(new Hz(e,this.commandOptions));geopos=(...e)=>this.chain(new HD(e,this.commandOptions));geohash=(...e)=>this.chain(new HP(e,this.commandOptions));geosearch=(...e)=>this.chain(new HL(e,this.commandOptions));geosearchstore=(...e)=>this.chain(new H$(e,this.commandOptions));get=(...e)=>this.chain(new HU(e,this.commandOptions));getbit=(...e)=>this.chain(new HB(e,this.commandOptions));getdel=(...e)=>this.chain(new Hq(e,this.commandOptions));getrange=(...e)=>this.chain(new HH(e,this.commandOptions));getset=(e,t)=>this.chain(new HJ([e,t],this.commandOptions));hdel=(...e)=>this.chain(new HW(e,this.commandOptions));hexists=(...e)=>this.chain(new HK(e,this.commandOptions));hget=(...e)=>this.chain(new HV(e,this.commandOptions));hgetall=(...e)=>this.chain(new HG(e,this.commandOptions));hincrby=(...e)=>this.chain(new HY(e,this.commandOptions));hincrbyfloat=(...e)=>this.chain(new HX(e,this.commandOptions));hkeys=(...e)=>this.chain(new HQ(e,this.commandOptions));hlen=(...e)=>this.chain(new HZ(e,this.commandOptions));hmget=(...e)=>this.chain(new H0(e,this.commandOptions));hmset=(e,t)=>this.chain(new H1([e,t],this.commandOptions));hrandfield=(e,t,s)=>this.chain(new Hg([e,t,s],this.commandOptions));hscan=(...e)=>this.chain(new H2(e,this.commandOptions));hset=(e,t)=>this.chain(new H3([e,t],this.commandOptions));hsetnx=(e,t,s)=>this.chain(new H5([e,t,s],this.commandOptions));hstrlen=(...e)=>this.chain(new H4(e,this.commandOptions));hvals=(...e)=>this.chain(new H6(e,this.commandOptions));incr=(...e)=>this.chain(new H8(e,this.commandOptions));incrby=(...e)=>this.chain(new H7(e,this.commandOptions));incrbyfloat=(...e)=>this.chain(new H9(e,this.commandOptions));keys=(...e)=>this.chain(new JS(e,this.commandOptions));lindex=(...e)=>this.chain(new J_(e,this.commandOptions));linsert=(e,t,s,i)=>this.chain(new Jk([e,t,s,i],this.commandOptions));llen=(...e)=>this.chain(new JO(e,this.commandOptions));lmove=(...e)=>this.chain(new JE(e,this.commandOptions));lpop=(...e)=>this.chain(new JR(e,this.commandOptions));lmpop=(...e)=>this.chain(new JC(e,this.commandOptions));lpos=(...e)=>this.chain(new JI(e,this.commandOptions));lpush=(e,...t)=>this.chain(new JT([e,...t],this.commandOptions));lpushx=(e,...t)=>this.chain(new JF([e,...t],this.commandOptions));lrange=(...e)=>this.chain(new JA(e,this.commandOptions));lrem=(e,t,s)=>this.chain(new JN([e,t,s],this.commandOptions));lset=(e,t,s)=>this.chain(new JM([e,t,s],this.commandOptions));ltrim=(...e)=>this.chain(new Jj(e,this.commandOptions));mget=(...e)=>this.chain(new Jz(e,this.commandOptions));mset=e=>this.chain(new JP([e],this.commandOptions));msetnx=e=>this.chain(new JD([e],this.commandOptions));persist=(...e)=>this.chain(new JL(e,this.commandOptions));pexpire=(...e)=>this.chain(new J$(e,this.commandOptions));pexpireat=(...e)=>this.chain(new JU(e,this.commandOptions));pfadd=(...e)=>this.chain(new JB(e,this.commandOptions));pfcount=(...e)=>this.chain(new Jq(e,this.commandOptions));pfmerge=(...e)=>this.chain(new JH(e,this.commandOptions));ping=e=>this.chain(new JJ(e,this.commandOptions));psetex=(e,t,s)=>this.chain(new JW([e,t,s],this.commandOptions));pttl=(...e)=>this.chain(new JK(e,this.commandOptions));publish=(...e)=>this.chain(new JV(e,this.commandOptions));randomkey=()=>this.chain(new JG(this.commandOptions));rename=(...e)=>this.chain(new JY(e,this.commandOptions));renamenx=(...e)=>this.chain(new JX(e,this.commandOptions));rpop=(...e)=>this.chain(new JQ(e,this.commandOptions));rpush=(e,...t)=>this.chain(new JZ([e,...t],this.commandOptions));rpushx=(e,...t)=>this.chain(new J0([e,...t],this.commandOptions));sadd=(e,t,...s)=>this.chain(new J1([e,t,...s],this.commandOptions));scan=(...e)=>this.chain(new J2(e,this.commandOptions));scard=(...e)=>this.chain(new J3(e,this.commandOptions));scriptExists=(...e)=>this.chain(new J5(e,this.commandOptions));scriptFlush=(...e)=>this.chain(new J4(e,this.commandOptions));scriptLoad=(...e)=>this.chain(new J6(e,this.commandOptions));sdiff=(...e)=>this.chain(new J8(e,this.commandOptions));sdiffstore=(...e)=>this.chain(new J7(e,this.commandOptions));set=(e,t,s)=>this.chain(new J9([e,t,s],this.commandOptions));setbit=(...e)=>this.chain(new We(e,this.commandOptions));setex=(e,t,s)=>this.chain(new Wt([e,t,s],this.commandOptions));setnx=(e,t)=>this.chain(new Ws([e,t],this.commandOptions));setrange=(...e)=>this.chain(new Wi(e,this.commandOptions));sinter=(...e)=>this.chain(new Wn(e,this.commandOptions));sinterstore=(...e)=>this.chain(new Wr(e,this.commandOptions));sismember=(e,t)=>this.chain(new Wa([e,t],this.commandOptions));smembers=(...e)=>this.chain(new Wo(e,this.commandOptions));smismember=(e,t)=>this.chain(new Wc([e,t],this.commandOptions));smove=(e,t,s)=>this.chain(new Wl([e,t,s],this.commandOptions));spop=(...e)=>this.chain(new Wu(e,this.commandOptions));srandmember=(...e)=>this.chain(new Wh(e,this.commandOptions));srem=(e,...t)=>this.chain(new Wp([e,...t],this.commandOptions));sscan=(...e)=>this.chain(new Wd(e,this.commandOptions));strlen=(...e)=>this.chain(new Wf(e,this.commandOptions));sunion=(...e)=>this.chain(new Wm(e,this.commandOptions));sunionstore=(...e)=>this.chain(new Wg(e,this.commandOptions));time=()=>this.chain(new Wb(this.commandOptions));touch=(...e)=>this.chain(new Wx(e,this.commandOptions));ttl=(...e)=>this.chain(new Wy(e,this.commandOptions));type=(...e)=>this.chain(new Wv(e,this.commandOptions));unlink=(...e)=>this.chain(new Ww(e,this.commandOptions));zadd=(...e)=>(e[1],this.chain(new Wz([e[0],e[1],...e.slice(2)],this.commandOptions)));xadd=(...e)=>this.chain(new W_(e,this.commandOptions));xack=(...e)=>this.chain(new WS(e,this.commandOptions));xdel=(...e)=>this.chain(new WE(e,this.commandOptions));xgroup=(...e)=>this.chain(new WC(e,this.commandOptions));xread=(...e)=>this.chain(new WA(e,this.commandOptions));xreadgroup=(...e)=>this.chain(new WN(e,this.commandOptions));xinfo=(...e)=>this.chain(new WR(e,this.commandOptions));xlen=(...e)=>this.chain(new WI(e,this.commandOptions));xpending=(...e)=>this.chain(new WT(e,this.commandOptions));xclaim=(...e)=>this.chain(new WO(e,this.commandOptions));xautoclaim=(...e)=>this.chain(new Wk(e,this.commandOptions));xtrim=(...e)=>this.chain(new Wj(e,this.commandOptions));xrange=(...e)=>this.chain(new WF(e,this.commandOptions));xrevrange=(...e)=>this.chain(new WM(e,this.commandOptions));zcard=(...e)=>this.chain(new WP(e,this.commandOptions));zcount=(...e)=>this.chain(new WD(e,this.commandOptions));zincrby=(e,t,s)=>this.chain(new WL([e,t,s],this.commandOptions));zinterstore=(...e)=>this.chain(new W$(e,this.commandOptions));zlexcount=(...e)=>this.chain(new WU(e,this.commandOptions));zmscore=(...e)=>this.chain(new W2(e,this.commandOptions));zpopmax=(...e)=>this.chain(new WB(e,this.commandOptions));zpopmin=(...e)=>this.chain(new Wq(e,this.commandOptions));zrange=(...e)=>this.chain(new WH(e,this.commandOptions));zrank=(e,t)=>this.chain(new WJ([e,t],this.commandOptions));zrem=(e,...t)=>this.chain(new WW([e,...t],this.commandOptions));zremrangebylex=(...e)=>this.chain(new WK(e,this.commandOptions));zremrangebyrank=(...e)=>this.chain(new WV(e,this.commandOptions));zremrangebyscore=(...e)=>this.chain(new WG(e,this.commandOptions));zrevrank=(e,t)=>this.chain(new WY([e,t],this.commandOptions));zscan=(...e)=>this.chain(new WX(e,this.commandOptions));zscore=(e,t)=>this.chain(new WQ([e,t],this.commandOptions));zunionstore=(...e)=>this.chain(new W0(e,this.commandOptions));zunion=(...e)=>this.chain(new WZ(e,this.commandOptions));get json(){return{arrappend:(...e)=>this.chain(new Je(e,this.commandOptions)),arrindex:(...e)=>this.chain(new Jt(e,this.commandOptions)),arrinsert:(...e)=>this.chain(new Js(e,this.commandOptions)),arrlen:(...e)=>this.chain(new Ji(e,this.commandOptions)),arrpop:(...e)=>this.chain(new Jn(e,this.commandOptions)),arrtrim:(...e)=>this.chain(new Jr(e,this.commandOptions)),clear:(...e)=>this.chain(new Ja(e,this.commandOptions)),del:(...e)=>this.chain(new Jo(e,this.commandOptions)),forget:(...e)=>this.chain(new Jc(e,this.commandOptions)),get:(...e)=>this.chain(new Jl(e,this.commandOptions)),mget:(...e)=>this.chain(new Ju(e,this.commandOptions)),mset:(...e)=>this.chain(new Jh(e,this.commandOptions)),numincrby:(...e)=>this.chain(new Jp(e,this.commandOptions)),nummultby:(...e)=>this.chain(new Jd(e,this.commandOptions)),objkeys:(...e)=>this.chain(new Jf(e,this.commandOptions)),objlen:(...e)=>this.chain(new Jm(e,this.commandOptions)),resp:(...e)=>this.chain(new Jg(e,this.commandOptions)),set:(...e)=>this.chain(new Jb(e,this.commandOptions)),strappend:(...e)=>this.chain(new Jx(e,this.commandOptions)),strlen:(...e)=>this.chain(new Jy(e,this.commandOptions)),toggle:(...e)=>this.chain(new Jv(e,this.commandOptions)),type:(...e)=>this.chain(new Jw(e,this.commandOptions))}}},W5=class{pipelinePromises=new WeakMap;activePipeline=null;indexInCurrentPipeline=0;redis;pipeline;pipelineCounter=0;constructor(e){this.redis=e,this.pipeline=e.pipeline()}async withAutoPipeline(e){let t=this.activePipeline??this.redis.pipeline();this.activePipeline||(this.activePipeline=t,this.indexInCurrentPipeline=0);let s=this.indexInCurrentPipeline++;e(t);let i=this.deferExecution().then(()=>{if(!this.pipelinePromises.has(t)){let e=t.exec({keepErrors:!0});this.pipelineCounter+=1,this.pipelinePromises.set(t,e),this.activePipeline=null}return this.pipelinePromises.get(t)}),n=(await i)[s];if(n.error)throw new Ha(`Command failed: ${n.error}`);return n.result}async deferExecution(){await Promise.resolve(),await Promise.resolve()}},W4=class{script;sha1;redis;constructor(e,t){this.redis=e,this.sha1=this.digest(t),this.script=t}async eval(e,t){return await this.redis.eval(this.script,e,t)}async evalsha(e,t){return await this.redis.evalsha(this.sha1,e,t)}async exec(e,t){return await this.redis.evalsha(this.sha1,e,t).catch(async s=>{if(s instanceof Error&&s.message.toLowerCase().includes("noscript"))return await this.redis.eval(this.script,e,t);throw s})}digest(e){return Hi.stringify(Hn(e))}},W6=class{client;opts;enableTelemetry;enableAutoPipelining;constructor(e,t){this.client=e,this.opts=t,this.enableTelemetry=t?.enableTelemetry??!0,t?.readYourWrites===!1&&(this.client.readYourWrites=!1),this.enableAutoPipelining=t?.enableAutoPipelining??!0}get readYourWritesSyncToken(){return this.client.upstashSyncToken}set readYourWritesSyncToken(e){this.client.upstashSyncToken=e}get json(){return{arrappend:(...e)=>new Je(e,this.opts).exec(this.client),arrindex:(...e)=>new Jt(e,this.opts).exec(this.client),arrinsert:(...e)=>new Js(e,this.opts).exec(this.client),arrlen:(...e)=>new Ji(e,this.opts).exec(this.client),arrpop:(...e)=>new Jn(e,this.opts).exec(this.client),arrtrim:(...e)=>new Jr(e,this.opts).exec(this.client),clear:(...e)=>new Ja(e,this.opts).exec(this.client),del:(...e)=>new Jo(e,this.opts).exec(this.client),forget:(...e)=>new Jc(e,this.opts).exec(this.client),get:(...e)=>new Jl(e,this.opts).exec(this.client),mget:(...e)=>new Ju(e,this.opts).exec(this.client),mset:(...e)=>new Jh(e,this.opts).exec(this.client),numincrby:(...e)=>new Jp(e,this.opts).exec(this.client),nummultby:(...e)=>new Jd(e,this.opts).exec(this.client),objkeys:(...e)=>new Jf(e,this.opts).exec(this.client),objlen:(...e)=>new Jm(e,this.opts).exec(this.client),resp:(...e)=>new Jg(e,this.opts).exec(this.client),set:(...e)=>new Jb(e,this.opts).exec(this.client),strappend:(...e)=>new Jx(e,this.opts).exec(this.client),strlen:(...e)=>new Jy(e,this.opts).exec(this.client),toggle:(...e)=>new Jv(e,this.opts).exec(this.client),type:(...e)=>new Jw(e,this.opts).exec(this.client)}}use=e=>{let t=this.client.request.bind(this.client);this.client.request=s=>e(s,t)};addTelemetry=e=>{if(this.enableTelemetry)try{this.client.mergeTelemetry(e)}catch{}};createScript(e){return new W4(this,e)}pipeline=()=>new W3({client:this.client,commandOptions:this.opts,multiExec:!1});autoPipeline=()=>(function e(t,s){return t.autoPipelineExecutor||(t.autoPipelineExecutor=new W5(t)),new Proxy(t,{get:(t,i)=>"pipelineCounter"===i?t.autoPipelineExecutor.pipelineCounter:"json"===i?e(t,!0):i in t&&!(i in t.autoPipelineExecutor.pipeline)?t[i]:(s?"function"==typeof t.autoPipelineExecutor.pipeline.json[i]:"function"==typeof t.autoPipelineExecutor.pipeline[i])?(...e)=>t.autoPipelineExecutor.withAutoPipeline(t=>{s?t.json[i](...e):t[i](...e)}):t.autoPipelineExecutor.pipeline[i]})})(this);multi=()=>new W3({client:this.client,commandOptions:this.opts,multiExec:!0});bitfield=(...e)=>new Hy(e,this.client,this.opts);append=(...e)=>new Hb(e,this.opts).exec(this.client);bitcount=(...e)=>new Hx(e,this.opts).exec(this.client);bitop=(e,t,s,...i)=>new Hv([e,t,s,...i],this.opts).exec(this.client);bitpos=(...e)=>new Hw(e,this.opts).exec(this.client);copy=(...e)=>new HS(e,this.opts).exec(this.client);dbsize=()=>new H_(this.opts).exec(this.client);decr=(...e)=>new Hk(e,this.opts).exec(this.client);decrby=(...e)=>new HO(e,this.opts).exec(this.client);del=(...e)=>new HE(e,this.opts).exec(this.client);echo=(...e)=>new HC(e,this.opts).exec(this.client);eval=(...e)=>new HR(e,this.opts).exec(this.client);evalsha=(...e)=>new HI(e,this.opts).exec(this.client);exists=(...e)=>new HT(e,this.opts).exec(this.client);expire=(...e)=>new HF(e,this.opts).exec(this.client);expireat=(...e)=>new HA(e,this.opts).exec(this.client);flushall=e=>new HN(e,this.opts).exec(this.client);flushdb=(...e)=>new HM(e,this.opts).exec(this.client);geoadd=(...e)=>new Hj(e,this.opts).exec(this.client);geopos=(...e)=>new HD(e,this.opts).exec(this.client);geodist=(...e)=>new Hz(e,this.opts).exec(this.client);geohash=(...e)=>new HP(e,this.opts).exec(this.client);geosearch=(...e)=>new HL(e,this.opts).exec(this.client);geosearchstore=(...e)=>new H$(e,this.opts).exec(this.client);get=(...e)=>new HU(e,this.opts).exec(this.client);getbit=(...e)=>new HB(e,this.opts).exec(this.client);getdel=(...e)=>new Hq(e,this.opts).exec(this.client);getrange=(...e)=>new HH(e,this.opts).exec(this.client);getset=(e,t)=>new HJ([e,t],this.opts).exec(this.client);hdel=(...e)=>new HW(e,this.opts).exec(this.client);hexists=(...e)=>new HK(e,this.opts).exec(this.client);hget=(...e)=>new HV(e,this.opts).exec(this.client);hgetall=(...e)=>new HG(e,this.opts).exec(this.client);hincrby=(...e)=>new HY(e,this.opts).exec(this.client);hincrbyfloat=(...e)=>new HX(e,this.opts).exec(this.client);hkeys=(...e)=>new HQ(e,this.opts).exec(this.client);hlen=(...e)=>new HZ(e,this.opts).exec(this.client);hmget=(...e)=>new H0(e,this.opts).exec(this.client);hmset=(e,t)=>new H1([e,t],this.opts).exec(this.client);hrandfield=(e,t,s)=>new Hg([e,t,s],this.opts).exec(this.client);hscan=(...e)=>new H2(e,this.opts).exec(this.client);hset=(e,t)=>new H3([e,t],this.opts).exec(this.client);hsetnx=(e,t,s)=>new H5([e,t,s],this.opts).exec(this.client);hstrlen=(...e)=>new H4(e,this.opts).exec(this.client);hvals=(...e)=>new H6(e,this.opts).exec(this.client);incr=(...e)=>new H8(e,this.opts).exec(this.client);incrby=(...e)=>new H7(e,this.opts).exec(this.client);incrbyfloat=(...e)=>new H9(e,this.opts).exec(this.client);keys=(...e)=>new JS(e,this.opts).exec(this.client);lindex=(...e)=>new J_(e,this.opts).exec(this.client);linsert=(e,t,s,i)=>new Jk([e,t,s,i],this.opts).exec(this.client);llen=(...e)=>new JO(e,this.opts).exec(this.client);lmove=(...e)=>new JE(e,this.opts).exec(this.client);lpop=(...e)=>new JR(e,this.opts).exec(this.client);lmpop=(...e)=>new JC(e,this.opts).exec(this.client);lpos=(...e)=>new JI(e,this.opts).exec(this.client);lpush=(e,...t)=>new JT([e,...t],this.opts).exec(this.client);lpushx=(e,...t)=>new JF([e,...t],this.opts).exec(this.client);lrange=(...e)=>new JA(e,this.opts).exec(this.client);lrem=(e,t,s)=>new JN([e,t,s],this.opts).exec(this.client);lset=(e,t,s)=>new JM([e,t,s],this.opts).exec(this.client);ltrim=(...e)=>new Jj(e,this.opts).exec(this.client);mget=(...e)=>new Jz(e,this.opts).exec(this.client);mset=e=>new JP([e],this.opts).exec(this.client);msetnx=e=>new JD([e],this.opts).exec(this.client);persist=(...e)=>new JL(e,this.opts).exec(this.client);pexpire=(...e)=>new J$(e,this.opts).exec(this.client);pexpireat=(...e)=>new JU(e,this.opts).exec(this.client);pfadd=(...e)=>new JB(e,this.opts).exec(this.client);pfcount=(...e)=>new Jq(e,this.opts).exec(this.client);pfmerge=(...e)=>new JH(e,this.opts).exec(this.client);ping=e=>new JJ(e,this.opts).exec(this.client);psetex=(e,t,s)=>new JW([e,t,s],this.opts).exec(this.client);pttl=(...e)=>new JK(e,this.opts).exec(this.client);publish=(...e)=>new JV(e,this.opts).exec(this.client);randomkey=()=>new JG().exec(this.client);rename=(...e)=>new JY(e,this.opts).exec(this.client);renamenx=(...e)=>new JX(e,this.opts).exec(this.client);rpop=(...e)=>new JQ(e,this.opts).exec(this.client);rpush=(e,...t)=>new JZ([e,...t],this.opts).exec(this.client);rpushx=(e,...t)=>new J0([e,...t],this.opts).exec(this.client);sadd=(e,t,...s)=>new J1([e,t,...s],this.opts).exec(this.client);scan=(...e)=>new J2(e,this.opts).exec(this.client);scard=(...e)=>new J3(e,this.opts).exec(this.client);scriptExists=(...e)=>new J5(e,this.opts).exec(this.client);scriptFlush=(...e)=>new J4(e,this.opts).exec(this.client);scriptLoad=(...e)=>new J6(e,this.opts).exec(this.client);sdiff=(...e)=>new J8(e,this.opts).exec(this.client);sdiffstore=(...e)=>new J7(e,this.opts).exec(this.client);set=(e,t,s)=>new J9([e,t,s],this.opts).exec(this.client);setbit=(...e)=>new We(e,this.opts).exec(this.client);setex=(e,t,s)=>new Wt([e,t,s],this.opts).exec(this.client);setnx=(e,t)=>new Ws([e,t],this.opts).exec(this.client);setrange=(...e)=>new Wi(e,this.opts).exec(this.client);sinter=(...e)=>new Wn(e,this.opts).exec(this.client);sinterstore=(...e)=>new Wr(e,this.opts).exec(this.client);sismember=(e,t)=>new Wa([e,t],this.opts).exec(this.client);smismember=(e,t)=>new Wc([e,t],this.opts).exec(this.client);smembers=(...e)=>new Wo(e,this.opts).exec(this.client);smove=(e,t,s)=>new Wl([e,t,s],this.opts).exec(this.client);spop=(...e)=>new Wu(e,this.opts).exec(this.client);srandmember=(...e)=>new Wh(e,this.opts).exec(this.client);srem=(e,...t)=>new Wp([e,...t],this.opts).exec(this.client);sscan=(...e)=>new Wd(e,this.opts).exec(this.client);strlen=(...e)=>new Wf(e,this.opts).exec(this.client);sunion=(...e)=>new Wm(e,this.opts).exec(this.client);sunionstore=(...e)=>new Wg(e,this.opts).exec(this.client);time=()=>new Wb().exec(this.client);touch=(...e)=>new Wx(e,this.opts).exec(this.client);ttl=(...e)=>new Wy(e,this.opts).exec(this.client);type=(...e)=>new Wv(e,this.opts).exec(this.client);unlink=(...e)=>new Ww(e,this.opts).exec(this.client);xadd=(...e)=>new W_(e,this.opts).exec(this.client);xack=(...e)=>new WS(e,this.opts).exec(this.client);xdel=(...e)=>new WE(e,this.opts).exec(this.client);xgroup=(...e)=>new WC(e,this.opts).exec(this.client);xread=(...e)=>new WA(e,this.opts).exec(this.client);xreadgroup=(...e)=>new WN(e,this.opts).exec(this.client);xinfo=(...e)=>new WR(e,this.opts).exec(this.client);xlen=(...e)=>new WI(e,this.opts).exec(this.client);xpending=(...e)=>new WT(e,this.opts).exec(this.client);xclaim=(...e)=>new WO(e,this.opts).exec(this.client);xautoclaim=(...e)=>new Wk(e,this.opts).exec(this.client);xtrim=(...e)=>new Wj(e,this.opts).exec(this.client);xrange=(...e)=>new WF(e,this.opts).exec(this.client);xrevrange=(...e)=>new WM(e,this.opts).exec(this.client);zadd=(...e)=>(e[1],new Wz([e[0],e[1],...e.slice(2)],this.opts).exec(this.client));zcard=(...e)=>new WP(e,this.opts).exec(this.client);zcount=(...e)=>new WD(e,this.opts).exec(this.client);zdiffstore=(...e)=>new W1(e,this.opts).exec(this.client);zincrby=(e,t,s)=>new WL([e,t,s],this.opts).exec(this.client);zinterstore=(...e)=>new W$(e,this.opts).exec(this.client);zlexcount=(...e)=>new WU(e,this.opts).exec(this.client);zmscore=(...e)=>new W2(e,this.opts).exec(this.client);zpopmax=(...e)=>new WB(e,this.opts).exec(this.client);zpopmin=(...e)=>new Wq(e,this.opts).exec(this.client);zrange=(...e)=>new WH(e,this.opts).exec(this.client);zrank=(e,t)=>new WJ([e,t],this.opts).exec(this.client);zrem=(e,...t)=>new WW([e,...t],this.opts).exec(this.client);zremrangebylex=(...e)=>new WK(e,this.opts).exec(this.client);zremrangebyrank=(...e)=>new WV(e,this.opts).exec(this.client);zremrangebyscore=(...e)=>new WG(e,this.opts).exec(this.client);zrevrank=(e,t)=>new WY([e,t],this.opts).exec(this.client);zscan=(...e)=>new WX(e,this.opts).exec(this.client);zscore=(e,t)=>new WQ([e,t],this.opts).exec(this.client);zunion=(...e)=>new WZ(e,this.opts).exec(this.client);zunionstore=(...e)=>new W0(e,this.opts).exec(this.client)};"undefined"==typeof atob&&(global.atob=e=>Buffer.from(e,"base64").toString("utf8"));var W8=class e extends W6{constructor(e){if("request"in e){super(e);return}if(e.url?(e.url.startsWith(" ")||e.url.endsWith(" ")||/\r|\n/.test(e.url))&&console.warn("[Upstash Redis] The redis url contains whitespace or newline, which can cause errors!"):console.warn("[Upstash Redis] The 'url' property is missing or undefined in your Redis config."),e.token?(e.token.startsWith(" ")||e.token.endsWith(" ")||/\r|\n/.test(e.token))&&console.warn("[Upstash Redis] The redis token contains whitespace or newline, which can cause errors!"):console.warn("[Upstash Redis] The 'token' property is missing or undefined in your Redis config."),super(new Hc({baseUrl:e.url,retry:e.retry,headers:{authorization:`Bearer ${e.token}`},agent:e.agent,responseEncoding:e.responseEncoding,cache:e.cache??"no-store",signal:e.signal,keepAlive:e.keepAlive,readYourWrites:e.readYourWrites}),{automaticDeserialization:e.automaticDeserialization,enableTelemetry:!process.env.UPSTASH_DISABLE_TELEMETRY,latencyLogging:e.latencyLogging,enableAutoPipelining:e.enableAutoPipelining}),this.addTelemetry({runtime:"string"==typeof EdgeRuntime?"edge-light":`node@${process.version}`,platform:process.env.VERCEL?"vercel":process.env.AWS_REGION?"aws":"unknown",sdk:"@upstash/redis@v1.34.3"}),this.enableAutoPipelining)return this.autoPipeline()}static fromEnv(t){if(void 0===process.env)throw TypeError('[Upstash Redis] Unable to get environment variables, `process.env` is undefined. If you are deploying to cloudflare, please import from "@upstash/redis/cloudflare" instead');let s=process.env.UPSTASH_REDIS_REST_URL||process.env.KV_REST_API_URL;s||console.warn("[Upstash Redis] Unable to find environment variable: `UPSTASH_REDIS_REST_URL`");let i=process.env.UPSTASH_REDIS_REST_TOKEN||process.env.KV_REST_API_TOKEN;return i||console.warn("[Upstash Redis] Unable to find environment variable: `UPSTASH_REDIS_REST_TOKEN`"),new e({...t,url:s,token:i})}};let W7=new Hs.Ratelimit({redis:W8.fromEnv(),limiter:Hs.Ratelimit.slidingWindow(10,"10 s"),analytics:!0,prefix:"uploader/ratelimit"});async function W9(e){return await new Promise(e=>setTimeout(e,100)),{id:"fakeId"}}let{GET:Ke,POST:Kt}=(e=>{let t=q6(e=>lR({req:e,res:void 0,event:void 0}),e=>lR(e),e,"nextjs-app");return{POST:t,GET:t}})({router:{fileUploader:(function e(t={}){let s={$types:{},routerConfig:{image:{maxFileSize:"4MB"}},routeOptions:{awaitServerData:!0},inputParser:{parseAsync:()=>Promise.resolve(void 0),_input:void 0,_output:void 0},middleware:()=>({}),onUploadError:()=>{},onUploadComplete:()=>void 0,errorFormatter:t.errorFormatter??qJ,...t};return{input:t=>e({...s,inputParser:t}),middleware:t=>e({...s,middleware:t}),onUploadComplete:e=>({...s,onUploadComplete:e}),onUploadError:t=>e({...s,onUploadError:t})}})({routerConfig:{image:{maxFileSize:"4MB",maxFileCount:5},video:{maxFileSize:"16MB",maxFileCount:2}},routeOptions:(void 0)??{},...E}).middleware(async({req:e})=>{let t=e.headers.get("x-forwarded-for")??"127.0.0.1",{success:s}=await W7.limit(t);if(!s)throw new Bz("Rate limit exceeded");let i=await W9(e);if(!i)throw new Bz("Unauthorized");return{userId:i.id}}).onUploadComplete(async({metadata:e,file:t})=>{console.log("Upload complete for userId:",e.userId),console.log("File URL:",t.url),console.log("File details:",t)})}}),Ks=new F.AppRouteRouteModule({definition:{kind:A.RouteKind.APP_ROUTE,page:"/api/uploadthing/route",pathname:"/api/uploadthing",filename:"route",bundlePath:"app/api/uploadthing/route"},resolvedPagePath:"/Users/david/src/5. Semester/SoftwareEngineering-Project/src/app/api/uploadthing/route.ts",nextConfigOutput:"",userland:T}),{workAsyncStorage:Ki,workUnitAsyncStorage:Kn,serverHooks:Kr}=Ks;function Ka(){return(0,N.patchFetch)({workAsyncStorage:Ki,workUnitAsyncStorage:Kn})}},1019:()=>{},339:()=>{},7965:e=>{"use strict";var t=Object.defineProperty,s=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,r={};((e,s)=>{for(var i in s)t(e,i,{get:s[i],enumerable:!0})})(r,{Analytics:()=>l}),e.exports=((e,r,a,o)=>{if(r&&"object"==typeof r||"function"==typeof r)for(let c of i(r))n.call(e,c)||c===a||t(e,c,{get:()=>r[c],enumerable:!(o=s(r,c))||o.enumerable});return e})(t({},"__esModule",{value:!0}),r);var a=`
local key = KEYS[1]
local field = ARGV[1]

local data = redis.call("ZRANGE", key, 0, -1, "WITHSCORES")
local count = {}

for i = 1, #data, 2 do
  local json_str = data[i]
  local score = tonumber(data[i + 1])
  local obj = cjson.decode(json_str)

  local fieldValue = obj[field]

  if count[fieldValue] == nil then
    count[fieldValue] = score
  else
    count[fieldValue] = count[fieldValue] + score
  end
end

local result = {}
for k, v in pairs(count) do
  table.insert(result, {k, v})
end

return result
`,o=`
local prefix = KEYS[1]
local first_timestamp = tonumber(ARGV[1]) -- First timestamp to check
local increment = tonumber(ARGV[2])       -- Increment between each timestamp
local num_timestamps = tonumber(ARGV[3])  -- Number of timestampts to check (24 for a day and 24 * 7 for a week)
local num_elements = tonumber(ARGV[4])    -- Number of elements to fetch in each category
local check_at_most = tonumber(ARGV[5])   -- Number of elements to check at most.

local keys = {}
for i = 1, num_timestamps do
  local timestamp = first_timestamp - (i - 1) * increment
  table.insert(keys, prefix .. ":" .. timestamp)
end

-- get the union of the groups
local zunion_params = {"ZUNION", num_timestamps, unpack(keys)}
table.insert(zunion_params, "WITHSCORES")
local result = redis.call(unpack(zunion_params))

-- select num_elements many items
local true_group = {}
local false_group = {}
local denied_group = {}
local true_count = 0
local false_count = 0
local denied_count = 0
local i = #result - 1

-- index to stop at after going through "checkAtMost" many items:
local cutoff_index = #result - 2 * check_at_most

-- iterate over the results
while (true_count + false_count + denied_count) < (num_elements * 3) and 1 <= i and i >= cutoff_index do
  local score = tonumber(result[i + 1])
  if score > 0 then
    local element = result[i]
    if string.find(element, "success\\":true") and true_count < num_elements then
      table.insert(true_group, {score, element})
      true_count = true_count + 1
    elseif string.find(element, "success\\":false") and false_count < num_elements then
      table.insert(false_group, {score, element})
      false_count = false_count + 1
    elseif string.find(element, "success\\":\\"denied") and denied_count < num_elements then
      table.insert(denied_group, {score, element})
      denied_count = denied_count + 1
    end
  end
  i = i - 2
end

return {true_group, false_group, denied_group}
`,c=`
local prefix = KEYS[1]
local first_timestamp = tonumber(ARGV[1])
local increment = tonumber(ARGV[2])
local num_timestamps = tonumber(ARGV[3])

local keys = {}
for i = 1, num_timestamps do
  local timestamp = first_timestamp - (i - 1) * increment
  table.insert(keys, prefix .. ":" .. timestamp)
end

-- get the union of the groups
local zunion_params = {"ZUNION", num_timestamps, unpack(keys)}
table.insert(zunion_params, "WITHSCORES")
local result = redis.call(unpack(zunion_params))

return result
`,l=class{redis;prefix;bucketSize;constructor(e){this.redis=e.redis,this.prefix=e.prefix??"@upstash/analytics",this.bucketSize=this.parseWindow(e.window)}validateTableName(e){if(!/^[a-zA-Z0-9_-]+$/.test(e))throw Error(`Invalid table name: ${e}. Table names can only contain letters, numbers, dashes and underscores.`)}parseWindow(e){if("number"==typeof e){if(e<=0)throw Error(`Invalid window: ${e}`);return e}let t=/^(\d+)([smhd])$/;if(!t.test(e))throw Error(`Invalid window: ${e}`);let[,s,i]=e.match(t),n=parseInt(s);switch(i){case"s":return 1e3*n;case"m":return 6e4*n;case"h":return 36e5*n;case"d":return 864e5*n;default:throw Error(`Invalid window unit: ${i}`)}}getBucket(e){return Math.floor((e??Date.now())/this.bucketSize)*this.bucketSize}async ingest(e,...t){this.validateTableName(e),await Promise.all(t.map(async t=>{let s=this.getBucket(t.time),i=[this.prefix,e,s].join(":");await this.redis.zincrby(i,1,JSON.stringify({...t,time:void 0}))}))}formatBucketAggregate(e,t,s){let i={};return e.forEach(([e,s])=>{"success"==t&&(e=1===e?"true":null===e?"false":e),i[t]=i[t]||{},i[t][(e??"null").toString()]=s}),{time:s,...i}}async aggregateBucket(e,t,s){this.validateTableName(e);let i=this.getBucket(s),n=[this.prefix,e,i].join(":"),r=await this.redis.eval(a,[n],[t]);return this.formatBucketAggregate(r,t,i)}async aggregateBuckets(e,t,s,i){this.validateTableName(e);let n=this.getBucket(i),r=[];for(let i=0;i<s;i+=1)r.push(this.aggregateBucket(e,t,n)),n-=this.bucketSize;return Promise.all(r)}async aggregateBucketsWithPipeline(e,t,s,i,n){this.validateTableName(e),n=n??48;let r=this.getBucket(i),o=[],c=this.redis.pipeline(),l=[];for(let i=1;i<=s;i+=1){let u=[this.prefix,e,r].join(":");c.eval(a,[u],[t]),o.push(r),r-=this.bucketSize,(i%n==0||i==s)&&(l.push(c.exec()),c=this.redis.pipeline())}return(await Promise.all(l)).flat().map((e,s)=>this.formatBucketAggregate(e,t,o[s]))}async getAllowedBlocked(e,t,s){this.validateTableName(e);let i=[this.prefix,e].join(":"),n=this.getBucket(s),r=await this.redis.eval(c,[i],[n,this.bucketSize,t]),a={};for(let e=0;e<r.length;e+=2){let t=r[e],s=t.identifier,i=+r[e+1];a[s]||(a[s]={success:0,blocked:0}),a[s][t.success?"success":"blocked"]=i}return a}async getMostAllowedBlocked(e,t,s,i,n){this.validateTableName(e);let r=[this.prefix,e].join(":"),a=this.getBucket(i),[c,l,u]=await this.redis.eval(o,[r],[a,this.bucketSize,t,s,n??5*s]);return{allowed:this.toDicts(c),ratelimited:this.toDicts(l),denied:this.toDicts(u)}}toDicts(e){let t=[];for(let s=0;s<e.length;s+=1){let i=+e[s][0],n=e[s][1];t.push({identifier:n.identifier,count:i})}return t}}},3900:(e,t,s)=>{"use strict";var i=Object.defineProperty,n=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,a=Object.prototype.hasOwnProperty,o=(e,t)=>{for(var s in t)i(e,s,{get:t[s],enumerable:!0})},c={};o(c,{Analytics:()=>u,IpDenyList:()=>v,MultiRegionRatelimit:()=>M,Ratelimit:()=>j}),e.exports=((e,t,s,o)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let c of r(t))a.call(e,c)||c===s||i(e,c,{get:()=>t[c],enumerable:!(o=n(t,c))||o.enumerable});return e})(i({},"__esModule",{value:!0}),c);var l=s(7965),u=class{analytics;table="events";constructor(e){this.analytics=new l.Analytics({redis:e.redis,window:"1h",prefix:e.prefix??"@upstash/ratelimit",retention:"90d"})}extractGeo(e){return void 0!==e.geo?e.geo:void 0!==e.cf?e.cf:{}}async record(e){await this.analytics.ingest(this.table,e)}async series(e,t){let s=Math.min((this.analytics.getBucket(Date.now())-this.analytics.getBucket(t))/36e5,256);return this.analytics.aggregateBucketsWithPipeline(this.table,e,s)}async getUsage(e=0){let t=Math.min((this.analytics.getBucket(Date.now())-this.analytics.getBucket(e))/36e5,256);return await this.analytics.getAllowedBlocked(this.table,t)}async getUsageOverTime(e,t){return await this.analytics.aggregateBucketsWithPipeline(this.table,t,e)}async getMostAllowedBlocked(e,t,s){return t=t??5,this.analytics.getMostAllowedBlocked(this.table,e,t,void 0,s)}},h=class{cache;constructor(e){this.cache=e}isBlocked(e){if(!this.cache.has(e))return{blocked:!1,reset:0};let t=this.cache.get(e);return t<Date.now()?(this.cache.delete(e),{blocked:!1,reset:0}):{blocked:!0,reset:t}}blockUntil(e,t){this.cache.set(e,t)}set(e,t){this.cache.set(e,t)}get(e){return this.cache.get(e)||null}incr(e){let t=this.cache.get(e)??0;return t+=1,this.cache.set(e,t),t}pop(e){this.cache.delete(e)}empty(){this.cache.clear()}size(){return this.cache.size}};function p(e){let t=e.match(/^(\d+)\s?(ms|s|m|h|d)$/);if(!t)throw Error(`Unable to parse window size: ${e}`);let s=Number.parseInt(t[1]);switch(t[2]){case"ms":return s;case"s":return 1e3*s;case"m":return 6e4*s;case"h":return 36e5*s;case"d":return 864e5*s;default:throw Error(`Unable to parse window size: ${e}`)}}var d=async(e,t,s,i)=>{try{return await e.redis.evalsha(t.hash,s,i)}catch(n){if(`${n}`.includes("NOSCRIPT")){let n=await e.redis.scriptLoad(t.script);return n!==t.hash&&console.warn("Upstash Ratelimit: Expected hash and the hash received from Redis are different. Ratelimit will work as usual but performance will be reduced."),await e.redis.evalsha(n,s,i)}throw n}},f={singleRegion:{fixedWindow:{limit:{script:`
  local key           = KEYS[1]
  local window        = ARGV[1]
  local incrementBy   = ARGV[2] -- increment rate per request at a given value, default is 1

  local r = redis.call("INCRBY", key, incrementBy)
  if r == tonumber(incrementBy) then
  -- The first time this key is set, the value will be equal to incrementBy.
  -- So we only need the expire command once
  redis.call("PEXPIRE", key, window)
  end

  return r
`,hash:"b13943e359636db027ad280f1def143f02158c13"},getRemaining:{script:`
      local key = KEYS[1]
      local tokens = 0

      local value = redis.call('GET', key)
      if value then
          tokens = value
      end
      return tokens
    `,hash:"8c4c341934502aee132643ffbe58ead3450e5208"}},slidingWindow:{limit:{script:`
  local currentKey  = KEYS[1]           -- identifier including prefixes
  local previousKey = KEYS[2]           -- key of the previous bucket
  local tokens      = tonumber(ARGV[1]) -- tokens per window
  local now         = ARGV[2]           -- current timestamp in milliseconds
  local window      = ARGV[3]           -- interval in milliseconds
  local incrementBy = ARGV[4]           -- increment rate per request at a given value, default is 1

  local requestsInCurrentWindow = redis.call("GET", currentKey)
  if requestsInCurrentWindow == false then
    requestsInCurrentWindow = 0
  end

  local requestsInPreviousWindow = redis.call("GET", previousKey)
  if requestsInPreviousWindow == false then
    requestsInPreviousWindow = 0
  end
  local percentageInCurrent = ( now % window ) / window
  -- weighted requests to consider from the previous window
  requestsInPreviousWindow = math.floor(( 1 - percentageInCurrent ) * requestsInPreviousWindow)
  if requestsInPreviousWindow + requestsInCurrentWindow >= tokens then
    return -1
  end

  local newValue = redis.call("INCRBY", currentKey, incrementBy)
  if newValue == tonumber(incrementBy) then
    -- The first time this key is set, the value will be equal to incrementBy.
    -- So we only need the expire command once
    redis.call("PEXPIRE", currentKey, window * 2 + 1000) -- Enough time to overlap with a new window + 1 second
  end
  return tokens - ( newValue + requestsInPreviousWindow )
`,hash:"e1391e429b699c780eb0480350cd5b7280fd9213"},getRemaining:{script:`
  local currentKey  = KEYS[1]           -- identifier including prefixes
  local previousKey = KEYS[2]           -- key of the previous bucket
  local now         = ARGV[1]           -- current timestamp in milliseconds
  local window      = ARGV[2]           -- interval in milliseconds

  local requestsInCurrentWindow = redis.call("GET", currentKey)
  if requestsInCurrentWindow == false then
    requestsInCurrentWindow = 0
  end

  local requestsInPreviousWindow = redis.call("GET", previousKey)
  if requestsInPreviousWindow == false then
    requestsInPreviousWindow = 0
  end

  local percentageInCurrent = ( now % window ) / window
  -- weighted requests to consider from the previous window
  requestsInPreviousWindow = math.floor(( 1 - percentageInCurrent ) * requestsInPreviousWindow)

  return requestsInPreviousWindow + requestsInCurrentWindow
`,hash:"65a73ac5a05bf9712903bc304b77268980c1c417"}},tokenBucket:{limit:{script:`
  local key         = KEYS[1]           -- identifier including prefixes
  local maxTokens   = tonumber(ARGV[1]) -- maximum number of tokens
  local interval    = tonumber(ARGV[2]) -- size of the window in milliseconds
  local refillRate  = tonumber(ARGV[3]) -- how many tokens are refilled after each interval
  local now         = tonumber(ARGV[4]) -- current timestamp in milliseconds
  local incrementBy = tonumber(ARGV[5]) -- how many tokens to consume, default is 1
        
  local bucket = redis.call("HMGET", key, "refilledAt", "tokens")
        
  local refilledAt
  local tokens

  if bucket[1] == false then
    refilledAt = now
    tokens = maxTokens
  else
    refilledAt = tonumber(bucket[1])
    tokens = tonumber(bucket[2])
  end
        
  if now >= refilledAt + interval then
    local numRefills = math.floor((now - refilledAt) / interval)
    tokens = math.min(maxTokens, tokens + numRefills * refillRate)

    refilledAt = refilledAt + numRefills * interval
  end

  if tokens == 0 then
    return {-1, refilledAt + interval}
  end

  local remaining = tokens - incrementBy
  local expireAt = math.ceil(((maxTokens - remaining) / refillRate)) * interval
        
  redis.call("HSET", key, "refilledAt", refilledAt, "tokens", remaining)
  redis.call("PEXPIRE", key, expireAt)
  return {remaining, refilledAt + interval}
`,hash:"5bece90aeef8189a8cfd28995b479529e270b3c6"},getRemaining:{script:`
  local key         = KEYS[1]
  local maxTokens   = tonumber(ARGV[1])
        
  local bucket = redis.call("HMGET", key, "refilledAt", "tokens")

  if bucket[1] == false then
    return {maxTokens, -1}
  end
        
  return {tonumber(bucket[2]), tonumber(bucket[1])}
`,hash:"a15be2bb1db2a15f7c82db06146f9d08983900d0"}},cachedFixedWindow:{limit:{script:`
  local key     = KEYS[1]
  local window  = ARGV[1]
  local incrementBy   = ARGV[2] -- increment rate per request at a given value, default is 1

  local r = redis.call("INCRBY", key, incrementBy)
  if r == incrementBy then
  -- The first time this key is set, the value will be equal to incrementBy.
  -- So we only need the expire command once
  redis.call("PEXPIRE", key, window)
  end
      
  return r
`,hash:"c26b12703dd137939b9a69a3a9b18e906a2d940f"},getRemaining:{script:`
  local key = KEYS[1]
  local tokens = 0

  local value = redis.call('GET', key)
  if value then
      tokens = value
  end
  return tokens
`,hash:"8e8f222ccae68b595ee6e3f3bf2199629a62b91a"}}},multiRegion:{fixedWindow:{limit:{script:`
	local key           = KEYS[1]
	local id            = ARGV[1]
	local window        = ARGV[2]
	local incrementBy   = tonumber(ARGV[3])

	redis.call("HSET", key, id, incrementBy)
	local fields = redis.call("HGETALL", key)
	if #fields == 2 and tonumber(fields[2])==incrementBy then
	-- The first time this key is set, and the value will be equal to incrementBy.
	-- So we only need the expire command once
	  redis.call("PEXPIRE", key, window)
	end

	return fields
`,hash:"a8c14f3835aa87bd70e5e2116081b81664abcf5c"},getRemaining:{script:`
      local key = KEYS[1]
      local tokens = 0

      local fields = redis.call("HGETALL", key)

      return fields
    `,hash:"8ab8322d0ed5fe5ac8eb08f0c2e4557f1b4816fd"}},slidingWindow:{limit:{script:`
	local currentKey    = KEYS[1]           -- identifier including prefixes
	local previousKey   = KEYS[2]           -- key of the previous bucket
	local tokens        = tonumber(ARGV[1]) -- tokens per window
	local now           = ARGV[2]           -- current timestamp in milliseconds
	local window        = ARGV[3]           -- interval in milliseconds
	local requestId     = ARGV[4]           -- uuid for this request
	local incrementBy   = tonumber(ARGV[5]) -- custom rate, default is  1

	local currentFields = redis.call("HGETALL", currentKey)
	local requestsInCurrentWindow = 0
	for i = 2, #currentFields, 2 do
	requestsInCurrentWindow = requestsInCurrentWindow + tonumber(currentFields[i])
	end

	local previousFields = redis.call("HGETALL", previousKey)
	local requestsInPreviousWindow = 0
	for i = 2, #previousFields, 2 do
	requestsInPreviousWindow = requestsInPreviousWindow + tonumber(previousFields[i])
	end

	local percentageInCurrent = ( now % window) / window
	if requestsInPreviousWindow * (1 - percentageInCurrent ) + requestsInCurrentWindow >= tokens then
	  return {currentFields, previousFields, false}
	end

	redis.call("HSET", currentKey, requestId, incrementBy)

	if requestsInCurrentWindow == 0 then 
	  -- The first time this key is set, the value will be equal to incrementBy.
	  -- So we only need the expire command once
	  redis.call("PEXPIRE", currentKey, window * 2 + 1000) -- Enough time to overlap with a new window + 1 second
	end
	return {currentFields, previousFields, true}
`,hash:"cb4fdc2575056df7c6d422764df0de3a08d6753b"},getRemaining:{script:`
	local currentKey    = KEYS[1]           -- identifier including prefixes
	local previousKey   = KEYS[2]           -- key of the previous bucket
	local now         	= ARGV[1]           -- current timestamp in milliseconds
  	local window      	= ARGV[2]           -- interval in milliseconds

	local currentFields = redis.call("HGETALL", currentKey)
	local requestsInCurrentWindow = 0
	for i = 2, #currentFields, 2 do
	requestsInCurrentWindow = requestsInCurrentWindow + tonumber(currentFields[i])
	end

	local previousFields = redis.call("HGETALL", previousKey)
	local requestsInPreviousWindow = 0
	for i = 2, #previousFields, 2 do
	requestsInPreviousWindow = requestsInPreviousWindow + tonumber(previousFields[i])
	end

	local percentageInCurrent = ( now % window) / window
  	requestsInPreviousWindow = math.floor(( 1 - percentageInCurrent ) * requestsInPreviousWindow)
	
	return requestsInCurrentWindow + requestsInPreviousWindow
`,hash:"558c9306b7ec54abb50747fe0b17e5d44bd24868"}}}},m={script:`
      local pattern = KEYS[1]

      -- Initialize cursor to start from 0
      local cursor = "0"

      repeat
          -- Scan for keys matching the pattern
          local scan_result = redis.call('SCAN', cursor, 'MATCH', pattern)

          -- Extract cursor for the next iteration
          cursor = scan_result[1]

          -- Extract keys from the scan result
          local keys = scan_result[2]

          for i=1, #keys do
          redis.call('DEL', keys[i])
          end

      -- Continue scanning until cursor is 0 (end of keyspace)
      until cursor == "0"
    `,hash:"54bd274ddc59fb3be0f42deee2f64322a10e2b50"},g="denyList",b="ipDenyList",x="ipDenyListStatus",y=`
  -- Checks if values provideed in ARGV are present in the deny lists.
  -- This is done using the allDenyListsKey below.

  -- Additionally, checks the status of the ip deny list using the
  -- ipDenyListStatusKey below. Here are the possible states of the
  -- ipDenyListStatusKey key:
  -- * status == -1: set to "disabled" with no TTL
  -- * status == -2: not set, meaning that is was set before but expired
  -- * status  >  0: set to "valid", with a TTL
  --
  -- In the case of status == -2, we set the status to "pending" with
  -- 30 second ttl. During this time, the process which got status == -2
  -- will update the ip deny list.

  local allDenyListsKey     = KEYS[1]
  local ipDenyListStatusKey = KEYS[2]

  local results = redis.call('SMISMEMBER', allDenyListsKey, unpack(ARGV))
  local status  = redis.call('TTL', ipDenyListStatusKey)
  if status == -2 then
    redis.call('SETEX', ipDenyListStatusKey, 30, "pending")
  end

  return { results, status }
`,v={};o(v,{ThresholdError:()=>S,disableIpDenyList:()=>O,updateIpDenyList:()=>k});var w=e=>864e5-((e||Date.now())-72e5)%864e5,S=class extends Error{constructor(e){super(`Allowed threshold values are from 1 to 8, 1 and 8 included. Received: ${e}`),this.name="ThresholdError"}},_=async e=>{if("number"!=typeof e||e<1||e>8)throw new S(e);try{let t=await fetch(`https://raw.githubusercontent.com/stamparm/ipsum/master/levels/${e}.txt`);if(!t.ok)throw Error(`Error fetching data: ${t.statusText}`);return(await t.text()).split("\n").filter(e=>e.length>0)}catch(e){throw Error(`Failed to fetch ip deny list: ${e}`)}},k=async(e,t,s,i)=>{let n=await _(s),r=[t,g,"all"].join(":"),a=[t,g,b].join(":"),o=[t,x].join(":"),c=e.multi();return c.sdiffstore(r,r,a),c.del(a),c.sadd(a,n.at(0),...n.slice(1)),c.sdiffstore(a,a,r),c.sunionstore(r,r,a),c.set(o,"valid",{px:i??w()}),await c.exec()},O=async(e,t)=>{let s=[t,g,"all"].join(":"),i=[t,g,b].join(":"),n=[t,x].join(":"),r=e.multi();return r.sdiffstore(s,s,i),r.del(i),r.set(n,"disabled"),await r.exec()},E=new h(new Map),C=e=>e.find(e=>E.isBlocked(e).blocked),R=e=>{E.size()>1e3&&E.empty(),E.blockUntil(e,Date.now()+6e4)},I=async(e,t,s)=>{let i;let[n,r]=await e.eval(y,[[t,g,"all"].join(":"),[t,x].join(":")],s);return n.map((e,t)=>{e&&(R(s[t]),i=s[t])}),{deniedValue:i,invalidIpDenyList:-2===r}},T=(e,t,[s,i],n)=>{if(i.deniedValue&&(s.success=!1,s.remaining=0,s.reason="denyList",s.deniedValue=i.deniedValue),i.invalidIpDenyList){let i=k(e,t,n);s.pending=Promise.all([s.pending,i])}return s},F=e=>({success:!1,limit:0,remaining:0,reset:0,pending:Promise.resolve(),reason:"denyList",deniedValue:e}),A=class{limiter;ctx;prefix;timeout;primaryRedis;analytics;enableProtection;denyListThreshold;constructor(e){this.ctx=e.ctx,this.limiter=e.limiter,this.timeout=e.timeout??5e3,this.prefix=e.prefix??"@upstash/ratelimit",this.enableProtection=e.enableProtection??!1,this.denyListThreshold=e.denyListThreshold??6,this.primaryRedis="redis"in this.ctx?this.ctx.redis:this.ctx.regionContexts[0].redis,this.analytics=e.analytics?new u({redis:this.primaryRedis,prefix:this.prefix}):void 0,e.ephemeralCache instanceof Map?this.ctx.cache=new h(e.ephemeralCache):void 0===e.ephemeralCache&&(this.ctx.cache=new h(new Map))}limit=async(e,t)=>{let s=null;try{let i=this.getRatelimitResponse(e,t),{responseArray:n,newTimeoutId:r}=this.applyTimeout(i);s=r;let a=await Promise.race(n);return this.submitAnalytics(a,e,t)}finally{s&&clearTimeout(s)}};blockUntilReady=async(e,t)=>{let s;if(t<=0)throw Error("timeout must be positive");let i=Date.now()+t;for(;!(s=await this.limit(e)).success;){if(0===s.reset)throw Error("This should not happen");let e=Math.min(s.reset,i)-Date.now();if(await new Promise(t=>setTimeout(t,e)),Date.now()>i)break}return s};resetUsedTokens=async e=>{let t=[this.prefix,e].join(":");await this.limiter().resetTokens(this.ctx,t)};getRemaining=async e=>{let t=[this.prefix,e].join(":");return await this.limiter().getRemaining(this.ctx,t)};getRatelimitResponse=async(e,t)=>{let s=this.getKey(e),i=this.getDefinedMembers(e,t),n=C(i),r=n?[F(n),{deniedValue:n,invalidIpDenyList:!1}]:await Promise.all([this.limiter().limit(this.ctx,s,t?.rate),this.enableProtection?I(this.primaryRedis,this.prefix,i):{deniedValue:void 0,invalidIpDenyList:!1}]);return T(this.primaryRedis,this.prefix,r,this.denyListThreshold)};applyTimeout=e=>{let t=null,s=[e];if(this.timeout>0){let e=new Promise(e=>{t=setTimeout(()=>{e({success:!0,limit:0,remaining:0,reset:0,pending:Promise.resolve(),reason:"timeout"})},this.timeout)});s.push(e)}return{responseArray:s,newTimeoutId:t}};submitAnalytics=(e,t,s)=>{if(this.analytics)try{let i=s?this.analytics.extractGeo(s):void 0,n=this.analytics.record({identifier:"denyList"===e.reason?e.deniedValue:t,time:Date.now(),success:"denyList"===e.reason?"denied":e.success,...i}).catch(e=>{let t="Failed to record analytics";`${e}`.includes("WRONGTYPE")&&(t=`
    Failed to record analytics. See the information below:

    This can occur when you uprade to Ratelimit version 1.1.2
    or later from an earlier version.

    This occurs simply because the way we store analytics data
    has changed. To avoid getting this error, disable analytics
    for *an hour*, then simply enable it back.

    `),console.warn(t,e)});e.pending=Promise.all([e.pending,n])}catch(e){console.warn("Failed to record analytics",e)}return e};getKey=e=>[this.prefix,e].join(":");getDefinedMembers=(e,t)=>[e,t?.ip,t?.userAgent,t?.country].filter(e=>!!e)};function N(){let e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=t.length;for(let i=0;i<16;i++)e+=t.charAt(Math.floor(Math.random()*s));return e}var M=class extends A{constructor(e){super({prefix:e.prefix,limiter:e.limiter,timeout:e.timeout,analytics:e.analytics,ctx:{regionContexts:e.redis.map(e=>({redis:e})),cache:e.ephemeralCache?new h(e.ephemeralCache):void 0}})}static fixedWindow(e,t){let s=p(t);return()=>({async limit(t,i,n){if(t.cache){let{blocked:s,reset:n}=t.cache.isBlocked(i);if(s)return{success:!1,limit:e,remaining:0,reset:n,pending:Promise.resolve(),reason:"cacheBlock"}}let r=N(),a=Math.floor(Date.now()/s),o=[i,a].join(":"),c=n?Math.max(1,n):1,l=t.regionContexts.map(e=>({redis:e.redis,request:d(e,f.multiRegion.fixedWindow.limit,[o],[r,s,c])})),u=e-(await Promise.any(l.map(e=>e.request))).reduce((e,t,s)=>{let i=0;return s%2&&(i=Number.parseInt(t)),e+i},0);async function h(){let t=[...new Set((await Promise.all(l.map(e=>e.request))).flat().reduce((e,t,s)=>(s%2==0&&e.push(t),e),[])).values()];for(let s of l){let i=(await s.request).reduce((e,t,s)=>{let i=0;return s%2&&(i=Number.parseInt(t)),e+i},0),n=(await s.request).reduce((e,t,s)=>(s%2==0&&e.push(t),e),[]);if(i>=e)continue;let r=t.filter(e=>!n.includes(e));if(0!==r.length)for(let e of r)await s.redis.hset(o,{[e]:c})}}let p=u>0,m=(a+1)*s;return t.cache&&!p&&t.cache.blockUntil(i,m),{success:p,limit:e,remaining:u,reset:m,pending:h()}},async getRemaining(t,i){let n=Math.floor(Date.now()/s),r=[i,n].join(":"),a=t.regionContexts.map(e=>({redis:e.redis,request:d(e,f.multiRegion.fixedWindow.getRemaining,[r],[null])}));return{remaining:Math.max(0,e-(await Promise.any(a.map(e=>e.request))).reduce((e,t,s)=>{let i=0;return s%2&&(i=Number.parseInt(t)),e+i},0)),reset:(n+1)*s}},async resetTokens(e,t){let s=[t,"*"].join(":");e.cache&&e.cache.pop(t),await Promise.all(e.regionContexts.map(e=>{d(e,m,[s],[null])}))}})}static slidingWindow(e,t){let s=p(t),i=p(t);return()=>({async limit(t,n,r){if(t.cache){let{blocked:s,reset:i}=t.cache.isBlocked(n);if(s)return{success:!1,limit:e,remaining:0,reset:i,pending:Promise.resolve(),reason:"cacheBlock"}}let a=N(),o=Date.now(),c=Math.floor(o/s),l=[n,c].join(":"),u=[n,c-1].join(":"),h=r?Math.max(1,r):1,p=t.regionContexts.map(t=>({redis:t.redis,request:d(t,f.multiRegion.slidingWindow.limit,[l,u],[e,o,i,a,h])})),m=o%i/i,[g,b,x]=await Promise.any(p.map(e=>e.request));x&&g.push(a,h.toString());let y=b.reduce((e,t,s)=>{let i=0;return s%2&&(i=Number.parseInt(t)),e+i},0),v=e-(Math.ceil(y*(1-m))+g.reduce((e,t,s)=>{let i=0;return s%2&&(i=Number.parseInt(t)),e+i},0));async function w(){let t=[...new Set((await Promise.all(p.map(e=>e.request))).flatMap(([e])=>e).reduce((e,t,s)=>(s%2==0&&e.push(t),e),[])).values()];for(let s of p){let[i,n,r]=await s.request,a=i.reduce((e,t,s)=>(s%2==0&&e.push(t),e),[]);if(i.reduce((e,t,s)=>{let i=0;return s%2&&(i=Number.parseInt(t)),e+i},0)>=e)continue;let o=t.filter(e=>!a.includes(e));if(0!==o.length)for(let e of o)await s.redis.hset(l,{[e]:h})}}let S=(c+1)*i;return t.cache&&!x&&t.cache.blockUntil(n,S),{success:!!x,limit:e,remaining:Math.max(0,v),reset:S,pending:w()}},async getRemaining(t,i){let n=Date.now(),r=Math.floor(n/s),a=[i,r].join(":"),o=[i,r-1].join(":"),c=t.regionContexts.map(e=>({redis:e.redis,request:d(e,f.multiRegion.slidingWindow.getRemaining,[a,o],[n,s])}));return{remaining:Math.max(0,e-await Promise.any(c.map(e=>e.request))),reset:(r+1)*s}},async resetTokens(e,t){let s=[t,"*"].join(":");e.cache&&e.cache.pop(t),await Promise.all(e.regionContexts.map(e=>{d(e,m,[s],[null])}))}})}},j=class extends A{constructor(e){super({prefix:e.prefix,limiter:e.limiter,timeout:e.timeout,analytics:e.analytics,ctx:{redis:e.redis},ephemeralCache:e.ephemeralCache,enableProtection:e.enableProtection,denyListThreshold:e.denyListThreshold})}static fixedWindow(e,t){let s=p(t);return()=>({async limit(t,i,n){let r=Math.floor(Date.now()/s),a=[i,r].join(":");if(t.cache){let{blocked:s,reset:n}=t.cache.isBlocked(i);if(s)return{success:!1,limit:e,remaining:0,reset:n,pending:Promise.resolve(),reason:"cacheBlock"}}let o=n?Math.max(1,n):1,c=await d(t,f.singleRegion.fixedWindow.limit,[a],[s,o]),l=c<=e,u=Math.max(0,e-c),h=(r+1)*s;return t.cache&&!l&&t.cache.blockUntil(i,h),{success:l,limit:e,remaining:u,reset:h,pending:Promise.resolve()}},async getRemaining(t,i){let n=Math.floor(Date.now()/s),r=[i,n].join(":");return{remaining:Math.max(0,e-await d(t,f.singleRegion.fixedWindow.getRemaining,[r],[null])),reset:(n+1)*s}},async resetTokens(e,t){let s=[t,"*"].join(":");e.cache&&e.cache.pop(t),await d(e,m,[s],[null])}})}static slidingWindow(e,t){let s=p(t);return()=>({async limit(t,i,n){let r=Date.now(),a=Math.floor(r/s),o=[i,a].join(":"),c=[i,a-1].join(":");if(t.cache){let{blocked:s,reset:n}=t.cache.isBlocked(i);if(s)return{success:!1,limit:e,remaining:0,reset:n,pending:Promise.resolve(),reason:"cacheBlock"}}let l=n?Math.max(1,n):1,u=await d(t,f.singleRegion.slidingWindow.limit,[o,c],[e,r,s,l]),h=u>=0,p=(a+1)*s;return t.cache&&!h&&t.cache.blockUntil(i,p),{success:h,limit:e,remaining:Math.max(0,u),reset:p,pending:Promise.resolve()}},async getRemaining(t,i){let n=Date.now(),r=Math.floor(n/s),a=[i,r].join(":"),o=[i,r-1].join(":");return{remaining:Math.max(0,e-await d(t,f.singleRegion.slidingWindow.getRemaining,[a,o],[n,s])),reset:(r+1)*s}},async resetTokens(e,t){let s=[t,"*"].join(":");e.cache&&e.cache.pop(t),await d(e,m,[s],[null])}})}static tokenBucket(e,t,s){let i=p(t);return()=>({async limit(t,n,r){if(t.cache){let{blocked:e,reset:i}=t.cache.isBlocked(n);if(e)return{success:!1,limit:s,remaining:0,reset:i,pending:Promise.resolve(),reason:"cacheBlock"}}let a=Date.now(),o=r?Math.max(1,r):1,[c,l]=await d(t,f.singleRegion.tokenBucket.limit,[n],[s,i,e,a,o]),u=c>=0;return t.cache&&!u&&t.cache.blockUntil(n,l),{success:u,limit:s,remaining:c,reset:l,pending:Promise.resolve()}},async getRemaining(e,t){let[n,r]=await d(e,f.singleRegion.tokenBucket.getRemaining,[t],[s]),a=Date.now()+i,o=r+i;return{remaining:n,reset:-1===r?a:o}},async resetTokens(e,t){e.cache&&e.cache.pop(t),await d(e,m,[t],[null])}})}static cachedFixedWindow(e,t){let s=p(t);return()=>({async limit(t,i,n){if(!t.cache)throw Error("This algorithm requires a cache");let r=Math.floor(Date.now()/s),a=[i,r].join(":"),o=(r+1)*s,c=n?Math.max(1,n):1;if("number"==typeof t.cache.get(a)){let i=t.cache.incr(a),n=i<e,r=n?d(t,f.singleRegion.cachedFixedWindow.limit,[a],[s,c]):Promise.resolve();return{success:n,limit:e,remaining:e-i,reset:o,pending:r}}let l=await d(t,f.singleRegion.cachedFixedWindow.limit,[a],[s,c]);t.cache.set(a,l);let u=e-l;return{success:u>=0,limit:e,remaining:u,reset:o,pending:Promise.resolve()}},async getRemaining(t,i){if(!t.cache)throw Error("This algorithm requires a cache");let n=Math.floor(Date.now()/s),r=[i,n].join(":");return"number"==typeof t.cache.get(r)?{remaining:Math.max(0,e-(t.cache.get(r)??0)),reset:(n+1)*s}:{remaining:Math.max(0,e-await d(t,f.singleRegion.cachedFixedWindow.getRemaining,[r],[null])),reset:(n+1)*s}},async resetTokens(e,t){if(!e.cache)throw Error("This algorithm requires a cache");let i=[t,Math.floor(Date.now()/s)].join(":");e.cache.pop(i);let n=[t,"*"].join(":");await d(e,m,[n],[null])}})}}},8306:function(e,t,s){var i;i=function(){var e=e||function(e,t){if("undefined"!=typeof window&&window.crypto&&(i=window.crypto),"undefined"!=typeof self&&self.crypto&&(i=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(i=globalThis.crypto),!i&&"undefined"!=typeof window&&window.msCrypto&&(i=window.msCrypto),!i&&"undefined"!=typeof global&&global.crypto&&(i=global.crypto),!i)try{i=s(5511)}catch(e){}var i,n=function(){if(i){if("function"==typeof i.getRandomValues)try{return i.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof i.randomBytes)try{return i.randomBytes(4).readInt32LE()}catch(e){}}throw Error("Native crypto module could not be used to get secure random number.")},r=Object.create||function(){function e(){}return function(t){var s;return e.prototype=t,s=new e,e.prototype=null,s}}(),a={},o=a.lib={},c=o.Base={extend:function(e){var t=r(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},l=o.WordArray=c.extend({init:function(e,s){e=this.words=e||[],t!=s?this.sigBytes=s:this.sigBytes=4*e.length},toString:function(e){return(e||h).stringify(this)},concat:function(e){var t=this.words,s=e.words,i=this.sigBytes,n=e.sigBytes;if(this.clamp(),i%4)for(var r=0;r<n;r++){var a=s[r>>>2]>>>24-r%4*8&255;t[i+r>>>2]|=a<<24-(i+r)%4*8}else for(var o=0;o<n;o+=4)t[i+o>>>2]=s[o>>>2];return this.sigBytes+=n,this},clamp:function(){var t=this.words,s=this.sigBytes;t[s>>>2]&=0xffffffff<<32-s%4*8,t.length=e.ceil(s/4)},clone:function(){var e=c.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],s=0;s<e;s+=4)t.push(n());return new l.init(t,e)}}),u=a.enc={},h=u.Hex={stringify:function(e){for(var t=e.words,s=e.sigBytes,i=[],n=0;n<s;n++){var r=t[n>>>2]>>>24-n%4*8&255;i.push((r>>>4).toString(16)),i.push((15&r).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,s=[],i=0;i<t;i+=2)s[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new l.init(s,t/2)}},p=u.Latin1={stringify:function(e){for(var t=e.words,s=e.sigBytes,i=[],n=0;n<s;n++){var r=t[n>>>2]>>>24-n%4*8&255;i.push(String.fromCharCode(r))}return i.join("")},parse:function(e){for(var t=e.length,s=[],i=0;i<t;i++)s[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new l.init(s,t)}},d=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(p.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return p.parse(unescape(encodeURIComponent(e)))}},f=o.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new l.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=d.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var s,i=this._data,n=i.words,r=i.sigBytes,a=this.blockSize,o=r/(4*a),c=(o=t?e.ceil(o):e.max((0|o)-this._minBufferSize,0))*a,u=e.min(4*c,r);if(c){for(var h=0;h<c;h+=a)this._doProcessBlock(n,h);s=n.splice(0,c),i.sigBytes-=u}return new l.init(s,u)},clone:function(){var e=c.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});o.Hasher=f.extend({cfg:c.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,s){return new e.init(s).finalize(t)}},_createHmacHelper:function(e){return function(t,s){return new m.HMAC.init(e,s).finalize(t)}}});var m=a.algo={};return a}(Math);return e},e.exports=i()},401:function(e,t,s){var i;i=function(e){return e.enc.Hex},e.exports=i(s(8306))},6392:function(e,t,s){var i;i=function(e){var t,s,i,n,r,a;return s=(t=e.lib).WordArray,i=t.Hasher,n=e.algo,r=[],a=n.SHA1=i.extend({_doReset:function(){this._hash=new s.init([0x67452301,0xefcdab89,0x98badcfe,0x10325476,0xc3d2e1f0])},_doProcessBlock:function(e,t){for(var s=this._hash.words,i=s[0],n=s[1],a=s[2],o=s[3],c=s[4],l=0;l<80;l++){if(l<16)r[l]=0|e[t+l];else{var u=r[l-3]^r[l-8]^r[l-14]^r[l-16];r[l]=u<<1|u>>>31}var h=(i<<5|i>>>27)+c+r[l];l<20?h+=(n&a|~n&o)+0x5a827999:l<40?h+=(n^a^o)+0x6ed9eba1:l<60?h+=(n&a|n&o|a&o)-0x70e44324:h+=(n^a^o)-0x359d3e2a,c=o,o=a,a=n<<30|n>>>2,n=i,i=h}s[0]=s[0]+i|0,s[1]=s[1]+n|0,s[2]=s[2]+a|0,s[3]=s[3]+o|0,s[4]=s[4]+c|0},_doFinalize:function(){var e=this._data,t=e.words,s=8*this._nDataBytes,i=8*e.sigBytes;return t[i>>>5]|=128<<24-i%32,t[(i+64>>>9<<4)+14]=Math.floor(s/0x100000000),t[(i+64>>>9<<4)+15]=s,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}}),e.SHA1=i._createHelper(a),e.HmacSHA1=i._createHmacHelper(a),e.SHA1},e.exports=i(s(8306))},190:(e,t,s)=>{"use strict";e.exports=s(4870)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),i=t.X(0,[326],()=>s(682));module.exports=i})();